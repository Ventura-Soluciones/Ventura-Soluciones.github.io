sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,n,s){"use strict";return e.extend("finanb1.controller.Login",{oCurrentUser:null,onInit:function(){const e=new s({username:"",password:"",rememberMe:false});this.getView().setModel(e,"loginModel")},onLoginPress:function(){const e=this.getView().getModel("loginModel");const s=e.getProperty("/username");const o=e.getProperty("/password");const r=e.getProperty("/rememberMe");if(!s||!o){n.error("Por favor ingrese usuario y contraseña");return}const a=this.byId("loginButton");if(a){a.setEnabled(false);a.setText("Verificando...")}this.authenticateUser(s,o).then(e=>{if(e){this.setAuthenticationState(true,s,r);t.show("Inicio de sesión exitoso",{duration:2e3});const e=this.getOwnerComponent().getRouter();e.navTo("RouteConfiguracion")}else{n.error("Usuario o contraseña incorrectos")}}).catch(e=>{console.error("Authentication error:",e);n.error("Error durante la autenticación. Por favor intente nuevamente.")}).finally(()=>{if(a){a.setEnabled(true);a.setText("Iniciar Sesión")}})},authenticateUser:function(e,t){return new Promise((n,o)=>{const r=new s;try{r.loadData("./model/mock/users.json",undefined,false);const s=r.getData();if(s&&s.users){const o=s.users;const r=o.find(function(n){return n.email===e&&n.password===t});if(r){this.oCurrentUser=r;n(true)}else{n(false)}}else{this.useFallbackUsers(e,t,n)}}catch(s){console.error("Error loading user data:",s);this.useFallbackUsers(e,t,n)}})},useFallbackUsers:function(e,t,n){const s=[{id:1,name:"Admin User",email:"admin@company.com",password:"admin123",role:"admin",status:"active",companies:[{id:1,name:"Demo Company"}]},{id:2,name:"Regular User",email:"user@company.com",password:"user123",role:"user",status:"active",companies:[{id:1,name:"Demo Company"}]}];const o=s.find(function(n){return n.email===e&&n.password===t});if(o){this.oCurrentUser=o;n(true)}else{n(false)}},setAuthenticationState:function(e,t,n){const s={isAuthenticated:e,userInfo:this.oCurrentUser||{},timestamp:Date.now()};if(n){localStorage.setItem("finanb1_auth",JSON.stringify(s))}else{sessionStorage.setItem("finanb1_auth",JSON.stringify(s))}},onForgotPassword:function(){n.information("Función de recuperación de contraseña en desarrollo")},onKeyPress:function(e){if(e.getParameter("keyCode")===13){this.onLoginPress()}},getAuthenticationState:function(){const e=sessionStorage.getItem("finanb1_auth")||localStorage.getItem("finanb1_auth");return e?JSON.parse(e):null}})});
//# sourceMappingURL=Login.controller.js.map