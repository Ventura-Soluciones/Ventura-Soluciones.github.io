/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/Button","sap/m/SearchField","sap/m/OverflowToolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/m/Table","sap/m/Column","sap/m/Sticky","sap/m/ScrollContainer","sap/m/ColumnListItem","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/ui/model/json/JSONModel","../Core","../library","../ViewStateManager","./ElementsPanelRenderer","./VisibilityType","../getResourceBundle"],function(e,t,n,i,s,o,a,r,h,l,_,d,c,u,p,g,E,f,T,m,C,y,N,S){"use strict";var L=c.extend("sap.ui.vk.ecad.ElementsPanel",{metadata:{library:"sap.ui.vk",aggregations:{content:{type:"sap.m.ScrollContainer",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},renderer:y,constructor:function(e,t){c.apply(this,arguments);T.observeAssociations(this)}});var b="sap-icon://hide";var v="sap-icon://hide";var M="sap-icon://show";L.prototype.onSetViewStateManager=function(e){this._manager=e;e.attachVisibilityChanged(this._onVisibilityChanged,this);this.refresh()};L.prototype.onUnsetViewStateManager=function(e){this._manager=null;e.detachVisibilityChanged(this._onVisibilityChanged,this);this.refresh()};L.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);e.attachContentChangesFinished(this._onContentChangesFinished,this);this._setContent(e.getContent())};L.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this);e.detachContentChangesFinished(this._onContentChangesFinished,this)};L.prototype.init=function(){if(c.prototype.init){c.prototype.init.apply(this)}var t=this;this._showButton=new e({enabled:false,iconFirst:true,icon:M,text:S().getText("ELEMENTS_PANEL_SHOW_BUTTON"),tooltip:S().getText("ELEMENTS_PANEL_SHOW_BUTTON_TOOLTIP"),press:this._onShowElements.bind(this)});this._hideButton=new e({enabled:false,iconFirst:true,icon:b,text:S().getText("ELEMENTS_PANEL_HIDE_BUTTON"),tooltip:S().getText("ELEMENTS_PANEL_HIDE_BUTTON_TOOLTIP"),press:this._onHideElements.bind(this)});this._settingsButton=new e({icon:"sap-icon://settings",tooltip:S().getText("ELEMENTS_PANEL_SETTINGS_BUTTON_TOOLTIP"),press:this._onSettings.bind(this)});this._table=new a({mode:"MultiSelect",sticky:[h.HeaderToolbar,h.ColumnHeaders],selectionChange:this._onSelectionChanged.bind(this),headerToolbar:new n({content:[this._showButton,this._hideButton,new s,this._settingsButton]}),columns:[new r({hAlign:g.TextAlign.Begin,header:new o({text:S().getText("ELEMENTS_PANEL_NAME_COLUMN")})}),new r({hAlign:g.TextAlign.Begin,header:new o({text:S().getText("ELEMENTS_PANEL_TYPE_COLUMN")})}),new r({hAlign:g.TextAlign.Begin,header:new o({text:S().getText("ELEMENTS_PANEL_DEVICE_REFERENCE_COLUMN")})}),new r({hAlign:g.TextAlign.Center,header:new o({text:S().getText("ELEMENTS_PANEL_VISIBLE_COLUMN")})})],items:{path:"/",template:new _({vAlign:"Middle",cells:[new o({text:"{refdes}"}),new o({text:{path:"",formatter:function(e){if(e.type==="2"){return S().getText("ELEMENTS_PANEL_TYPE_COMPONENT")}else if(e.type==="4"){return S().getText("ELEMENTS_PANEL_TYPE_NET")}else{return S().getText("ELEMENTS_PANEL_TYPE_UNKNOWN")}}}}),new o({text:"{deviceref}"}),new p({src:{path:"",formatter:function(e){var n=t._getVisibility(e);if(n===N.Hidden){return b}else if(n===N.Partial){return v}return M}},tooltip:{path:"",formatter:function(e){var n=t._getVisibility(e);if(n===N.Hidden){return S().getText("ELEMENTS_PANEL_VISIBLE_COLUMN_HIDDEN_TOOLTIP")}else if(n===N.Partial){return S().getText("ELEMENTS_PANEL_VISIBLE_COLUMN_PARTIAL_TOOLTIP")}return S().getText("ELEMENTS_PANEL_VISIBLE_COLUMN_VISIBLE_TOOLTIP")}}})]})}});this._scrollContainer=new l({vertical:true,horizontal:false,height:"100%",content:this._table});this.setAggregation("content",this._scrollContainer);this._scene=null;this._model=new f;this._model.setSizeLimit(1e5);this._table.setModel(this._model)};L.prototype.refresh=function(){if(!this._scene||!this._manager||!this._manager.getNodeHierarchy()){this._model.setData([]);return}var e=new Map;this._scanTree(e,this._manager.getNodeHierarchy().getSceneRef());this._model.setData(e.values().toArray());this._table.setModel(this._model);this.fireContentChanged()};L.prototype.onBeforeRendering=function(){this._table.setVisible(true);if(!this._resizeListenerId){this._resizeListenerId=E.register(this,this._handleResize.bind(this))}};L.prototype._setScene=function(e){this._scene=e;this.refresh()};L.prototype._getVisibility=function(e){return N.Visible};L.prototype._extractMetadata=function(e){if(e.length!=undefined){var t=new Map;e.forEach(function(e){if(e.category==="ecad"){t.set(e.tag,e.value)}});return t}return null};L.prototype._addElement=function(e,t,n,i){var s=t.get("type");var o=t.get("refdes");var a=t.get("deviceref");var r=e.get(o);if(!r){r={refdes:o,type:s,deviceref:a,elements:new Map,hiddenElements:0};e.set(o,r)}if(i==false){}r.elements.set(n.uid,n)};L.prototype._scanTree=function(e,t){var n=this._manager.getNodeHierarchy();var i=n.createNodeProxy(t);var s=this._extractMetadata(i.getNodeMetadata());n.destroyNodeProxy(i);if(s){var o=s.get("refdes");if(o){this._addElement(e,s,t,this._manager.getVisibilityState(t));return}}n.getChildren(t).forEach(function(t){this._scanTree(e,t)},this)};L.prototype._onSelectionChanged=function(e){this._updateButtons()};L.prototype._onVisibilityChanged=function(e){};L.prototype._handleResize=function(e){};L.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){var t=u.getElementById(this.getContentConnector());if(t){var n=t.getDefaultViewStateManager();if(n){this.setViewStateManager(n)}}}this._setScene(e);return this};L.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};L.prototype._onContentChangesFinished=function(e){this.refresh()};L.prototype._updateButtons=function(){var e=false,t=false;var n=this._table.getSelectedItems();n.forEach(function(n){var i=n.getBindingContext().getObject();var s=this._getVisibility(i);if(s===N.Visible){t=true}else if(s===N.Hidden){e=true}else{t=e=true}},this);this._showButton.setEnabled(e);this._hideButton.setEnabled(t)};L.prototype._onShowElements=function(){var e=[];var t=this._table.getSelectedItems();t.forEach(function(t){var n=t.getBindingContext().getObject();if(n.hiddenElements!==0){n.hiddenElements=0;n.elements.forEach(function(t){e.push(t)})}});this._manager.setVisibilityState(e,true,true,true);this._model.updateBindings(true);this._updateButtons()};L.prototype._onHideElements=function(){var e=[];var t=this._table.getSelectedItems();t.forEach(function(t){var n=t.getBindingContext().getObject();if(n.hiddenElements!==n.elements.size){n.hiddenElements=n.elements.size;n.elements.forEach(function(t){e.push(t)})}});this._manager.setVisibilityState(e,false,true,true);this._model.updateBindings(true);this._updateButtons()};L.prototype._onSettings=function(){};return L});
//# sourceMappingURL=ElementsPanel.js.map