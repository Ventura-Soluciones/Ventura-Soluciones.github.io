/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/Element"],function(t,e){"use strict";const i=t.extend("sap.ui.vk.svg.MiniMap",{metadata:{library:"sap.ui.vk",properties:{maxWidth:{type:"int",defaultValue:"320"},maxHeight:{type:"int",defaultValue:"320"}},associations:{viewport:{type:"sap.ui.vk.svg.Viewport",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{sizeChanged:{parameters:{width:{type:"int"},height:{type:"int"}}}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkMiniMapView");t.openEnd();t.close("div")}}});i.prototype.init=function(){t.prototype.init.call(this);this._sceneBBox=null;this._width=this._height=0;this._canvas=document.createElement("canvas");this._canvas.classList.add("sapUiVkMiniMapViewCanvas");this._rect=document.createElement("div");this._rect.classList.add("sapUiVkMiniMapViewAreaRect");this.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onMouseWheel,this)};i.prototype.exit=function(){this.setViewport(null);this.setViewStateManager(null)};i.prototype.setViewport=function(t){const i=e.getElementById(this.getViewport());i?.detachResize(this._updateRectPosition,this);i?.detachCameraChanged(this._updateRectPosition,this);this.setAssociation("viewport",t);t?.attachCameraChanged(this._updateRectPosition,this);t?.attachResize(this._updateRectPosition,this)};i.prototype.setViewStateManager=function(t){const i=e.getElementById(this.getViewStateManager());i?.detachVisibilityChanged(this._onContentUpdate,this);i?.detachTintColorChanged(this._onContentUpdate,this);this.setAssociation("viewStateManager",t);t?.attachVisibilityChanged(this._onContentUpdate,this);t?.attachTintColorChanged(this._onContentUpdate,this)};i.prototype._updateRectPosition=function(){const t=e.getElementById(this.getViewport());const i=this._sceneBBox;if(!t||!i){return}const n=t._getViewBox();const o=this._width/i[2];const s=this._height/i[3];const a=(n[0]-i[0])*o;const h=(n[1]-i[1])*s;this._rect.style.left=a+"px";this._rect.style.top=h+"px";this._rect.style.width=n[2]*o+"px";this._rect.style.height=n[3]*s+"px"};i.prototype._onMouseWheel=function(t){const i=e.getElementById(this.getViewport());if(!i){return}const n=this.getDomRef().getBoundingClientRect();const o=t.pageX-n.x;const s=t.pageY-n.y;if(o<0||o>=this._width||s<0||s>=this._height){return}let a=t.originalEvent.detail?t.originalEvent.detail*-40:t.originalEvent.wheelDelta;if(!t.originalEvent.touches){a=Math.min(Math.max(a,-20),20)}i.beginGesture(i._width*.5,i._height*.5);i.zoom(Math.pow(2,a/960));i.endGesture();t.setMarked();t.preventDefault()};i.prototype.ontouchstart=function(t){const i=e.getElementById(this.getViewport());const n=this._sceneBBox;if(!i||!n){return}const o=t=>{const e=this.getDomRef().getBoundingClientRect();const o=i._getViewBox();const s=t.pageX-e.x;const a=t.pageY-e.y;const h=o[0]+o[2]*.5-n[0]-s*n[2]/this._width;const c=o[1]+o[3]*.5-n[1]-a*n[3]/this._height;if(h!==0||c!==0){const t=i.getCamera();i.pan(h*t.zoom,c*t.zoom)}t.setMarked();t.preventDefault()};i.beginGesture(i._width*.5,i._height*.5);o(t);const s=jQuery(document);const a=t=>{s.off("mousemove",o);s.off("mouseup",a);i.endGesture()};s.on("mousemove",o);s.on("mouseup",a)};i.prototype._onContentUpdate=function(){const t=e.getElementById(this.getViewport());const i=t?._svgElement;const n=this.getDomRef();if(!i||!n){return}const o=i.getBBox();let s=this._sceneBBox;if(!s||!s[2]||!s[3]){s=this._sceneBBox=[o.x,o.y,o.width,o.height]}else{s[2]=Math.max(s[0]+s[2],o.x+o.width);s[3]=Math.max(s[1]+s[3],o.y+o.height);s[0]=Math.min(s[0],o.x);s[1]=Math.min(s[1],o.y);s[2]-=s[0];s[3]-=s[1]}const a=s[2]>0&&s[3]>0?s[2]/s[3]:1;const h=this.getMaxWidth();const c=this.getMaxHeight();const r=this._width=Math.min(h,Math.round(h*a));const d=this._height=Math.min(c,Math.round(c/a));n.style.width=r+"px";n.style.height=d+"px";this.fireSizeChanged({width:r,height:d});this._updateRectPosition();const p=i.getAttribute("width");const g=i.getAttribute("height");const l=i.getAttribute("viewBox");i.setAttribute("width",r+"px");i.setAttribute("height",d+"px");i.setAttribute("viewBox",s.join(" "));const u=(new XMLSerializer).serializeToString(i);const w="data:image/svg+xml; charset=utf8, "+encodeURIComponent(u);i.setAttribute("width",p);i.setAttribute("height",g);i.setAttribute("viewBox",l);const m=this._canvas;const _=window.devicePixelRatio||1;m.width=r*_;m.height=d*_;const f=new Image;f.src=w;f.onload=function(){const e=m.getContext("2d");const i=e.createLinearGradient(0,0,0,m.height);i.addColorStop(0,t.getBackgroundColorTop());i.addColorStop(1,t.getBackgroundColorBottom());e.fillStyle=i;e.fillRect(0,0,m.width,m.height);e.drawImage(f,0,0,m.width,m.height)}};i.prototype.onAfterRendering=function(){const t=this.getDomRef();t.appendChild(this._canvas);t.appendChild(this._rect);this._onContentUpdate()};return i});
//# sourceMappingURL=MiniMap.js.map