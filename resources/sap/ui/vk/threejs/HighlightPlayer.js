/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/Object","../thirdparty/three","../HighlightDisplayState"],function(t,i,e){"use strict";var s=t.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=e.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map}});s.prototype.reset=function(t,i){this.stop();this._highlightsNodesMap.clear();this._state=e.stopped;if(t&&i){var s=t.getHighlightIdNodesMap();var a=this;s.forEach(function(t,e){var s=i.getHighlight(e);a.addHighlights(s,t)})}return this};s.prototype.setViewStateManager=function(t){this._viewStateManager=t};s.prototype.addHighlights=function(t,i){if(t&&i&&i.length){this._highlightsNodesMap.set(t,{nodes:i})}};s.prototype.start=function(t){if(this._state===e.pausing){this._startTime=t-this._timeElapsed}else{this._startTime=t;this._timeElapsed=0}this._state=e.playing;var i=this._viewStateManager;this._highlightsNodesMap.forEach(function(t,e){var s=[];t.nodes.forEach(function(t){while(t){if(!t.visible){i.setVisibilityState(t,true,false);s.push(t)}t=t.parent}});t.hiddenNodes=s.length>0?s:undefined})};s.prototype.play=function(t){if(this._state!==e.playing){return false}this._timeElapsed=t-this._startTime;var i=[];this._highlightsNodesMap.forEach(function(t,e){const s=e.evaluate(this._timeElapsed/1e3);t.nodes.forEach(function(t){if(s.color!=null){t._vkSetHighlightColor(s.color)}if(s.opacity!=null){t._vkSetOpacity(s.opacity)}});if(s.isCompleted){if(e.isFadeOut()&&t.hiddenNodes!==undefined){this._viewStateManager.setVisibilityState(t.hiddenNodes,false,false)}if(e.isFadeInOut()){i.push(e)}}},this);i.forEach(function(t){this._highlightsNodesMap.delete(t)},this);if(this._highlightsNodesMap.size===0){this._state=e.stopped;return false}return true};s.prototype.stop=function(t){this._timeElapsed=0;this._startTime=0;var i=this;this._highlightsNodesMap.forEach(function(t,e){var s=t.nodes;for(var a=0;a<s.length;a++){var h=s[a];h._vkSetHighlightColor(undefined);h._vkSetOpacity(undefined)}if(e.isFadeOut()&&s.hiddenNodes!=undefined){i._viewStateManager.setVisibilityState(s.hiddenNodes,false,false)}});this._state=e.stopped;return this};s.prototype.pause=function(t){if(this._state===e.stopped){return this}this._timeElapsed=t-this._startTime;this._state=e.pausing;return this};return s});
//# sourceMappingURL=HighlightPlayer.js.map