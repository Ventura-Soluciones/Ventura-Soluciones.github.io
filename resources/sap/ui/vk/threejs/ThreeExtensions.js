/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../abgrToColor","../ObjectType","../thirdparty/three","../NodeContentType","./ThreeUtils"],function(t,e,i,r,a){"use strict";i.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){a.computeObjectOrientedBoundingBox(this,this.userData.boundingBox=new i.Box3)};i.Object3D.prototype._vkTraverseNodeGeometry=function(t){t(this);for(var e=0,i=this.children.length;e<i;e++){var r=this.children[e];if(r.geometry!==undefined&&r.userData.skipIt){if(r.children){r._vkTraverseNodeGeometry(t)}else{t(r)}}else if(r.children){r._vkTraverseNodeGeometry(t)}}};i.Object3D.prototype._vkSetHighlightColor=function(t){this._vkTraverseNodeGeometry(function(e){e.userData.highlightingColor=t;e._vkUpdateMaterialColorAndOpacity()})};i.Object3D.prototype._vkSetTintColor=function(t){this._vkTraverseNodeGeometry(function(e){e.userData.tintColor=t;e._vkUpdateMaterialColorAndOpacity()})};i.Object3D.prototype._vkSetOpacity=function(t,e){this.userData.opacity=t;var i;var r;if(e){i=new Map;r=new Map;e.forEach(function(t){if(!t.node||!t.parent){return}i.set(t.node,t);if(t.parent){var e=r.get(t.parent);if(!e){e=[]}e.push(t);r.set(t.parent,e)}})}this._vkTraverseNodes(function(t){t._vkUpdateMaterialOpacity(i)},i,r)};i.Object3D.prototype._vkUpdateMaterialColorAndOpacity=function(){if(!this.material||!this.material.color){return}var e=this.userData;e.blendColor=null;if(e.originalMaterial){this.material.color.copy(e.originalMaterial.color);this.material.emissive?.copy(e.originalMaterial.emissive);this.material.specular?.copy(e.originalMaterial.specular)}if(e.highlightColor!==undefined||e.tintColor!==undefined||e.highlightingColor!==undefined){if(!e.originalMaterial){e.originalMaterial=this.material;this.material=this.material.clone()}const r=new i.Vector4(0,0,0,0);if(e.highlightingColor!==undefined){r.fromArray(e.highlightingColor)}if(e.tintColor!==undefined){const a=t(e.tintColor);r.lerp(new i.Vector4(a.red/255,a.green/255,a.blue/255,1),a.alpha)}if(e.highlightColor!==undefined){const a=t(e.highlightColor);r.lerp(new i.Vector4(a.red/255,a.green/255,a.blue/255,1),a.alpha)}if(r.w>0){e.blendColor=r.toArray();const t=new i.Color(r.x,r.y,r.z);this.material.color.lerp(t,r.w);this.material.emissive?.lerp(t,r.w*.5);this.material.specular?.multiplyScalar(1-.75*r.w)}}this._vkUpdateMaterialOpacity()};i.Object3D.prototype._vkUpdateMaterialOpacity=function(t){if(!this.material){return}var e=this.userData;if(e.originalMaterial){this.material.opacity=e.originalMaterial.opacity;this.material.transparent=e.originalMaterial.transparent}var r=1;var a=false;let o;var n=this;do{o??=n.userData.renderMethod;var s=null,l=null;if(t){l=t.get(n)}if(l&&l.opacity!=null){s=l.opacity}else if(n.userData.opacity!==undefined&&n.userData.opacity!==1){s=n.userData.opacity}var h=1;if(l&&l.opacity!=null&&n.userData&&n.userData.offsetOpacity!=null){h=n.userData.offsetOpacity}if(s!=null){r*=s;r*=h;a=true}if(l&&l.parent){n=l.parent;continue}n=n.parent}while(n);if(o===2){r*=.5;a=true}if(a||this.renderOrder>0){if(!e.originalMaterial){e.originalMaterial=this.material;this.material=this.material.clone();if(this.isMesh&&!this.geometry.getAttribute("normal")){this.material.side=i.DoubleSide;this.material.userData.originalMaterialSide=i.DoubleSide}}if(this.renderOrder>0&&!this.isOutline){this.material.depthTest=false;this.material.transparent=true}if(this.material.opacity){this.material.opacity*=r;var u=e.originalMaterial.transparent||this.material.opacity<1;if(u!==this.material.transparent){this.material.transparent=u;this.material.needsUpdate=true}}}};i.Object3D.prototype._vkGetTotalOpacity=function(t){var e;if(t){e=new Map;t.forEach(function(t){if(!t.node||!t.parent){return}e.set(t.node,t)})}var i=1;var r=this;do{var a=null,o=null;if(e){o=e.get(r)}if(o&&o.opacity!=null){a=o.opacity}else if(r.userData&&r.userData.opacity!==undefined){a=r.userData.opacity}var n=1;if(o&&o.opacity!=null&&r.userData&&r.userData.offsetOpacity!=null){n=r.userData.offsetOpacity}if(a!=null){i*=a;i*=n}if(o&&o.parent){r=o.parent;continue}r=r.parent}while(r);return i};i.Object3D.prototype._vkTraverseMeshNodes=function(t){if(this._vkUpdate!==undefined||this.isDetailView){return}t(this);var e=this.children;for(var i=0,r=e.length;i<r;i++){e[i]._vkTraverseMeshNodes(t)}};i.Object3D.prototype._vkTraverseNodes=function(t,e,i){t(this);var r;if(i){r=i.get(this)}var a;if(r){for(a=0;a<r.length;a++){r[a].node._vkTraverseNodes(t,e,i)}}var o=this.children;if(o){for(a=0;a<o.length;a++){var n=o[a];if(e){var s=e.get(n);if(s){continue}}n._vkTraverseNodes(t,e,i)}}};function o(t,e){var i=t.min,r=t.max,a=e.elements,o=(i.x+r.x)*.5,n=(i.y+r.y)*.5,s=(i.z+r.z)*.5,l=r.x-o,h=r.y-n,u=r.z-s;var p=a[0]*o+a[4]*n+a[8]*s+a[12];var c=a[1]*o+a[5]*n+a[9]*s+a[13];var d=a[2]*o+a[6]*n+a[10]*s+a[14];var f=Math.abs(a[0]*l)+Math.abs(a[4]*h)+Math.abs(a[8]*u);var y=Math.abs(a[1]*l)+Math.abs(a[5]*h)+Math.abs(a[9]*u);var v=Math.abs(a[2]*l)+Math.abs(a[6]*h)+Math.abs(a[10]*u);i.set(p-f,c-y,d-v);r.set(p+f,c+y,d+v)}i.Object3D.prototype._expandBoundingBox=function(t,e,r,a){var n=new i.Box3;function s(i){const r=i.userData;var a=i.geometry;if(a!==undefined){const e=r.renderGroup;if(e?.boundingBox){n.setFromPackedArray(e.boundingBox)}else{if(!a.boundingBox){a.computeBoundingBox()}n.copy(a.boundingBox)}if(!n.isEmpty()){o(n,i.matrixWorld);if(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.min.z)&&isFinite(n.max.x)&&isFinite(n.max.y)&&isFinite(n.max.z)){t.union(n)}}}else if(r.pcgBoundingBox?.isEmpty()===false){n.copy(r.pcgBoundingBox);o(n,i.matrixWorld);t.union(n)}const s=r.boundingBox;if(s!==undefined&&s.min&&s.max&&!s.isEmpty()&&!e){n.copy(s);o(n,i.matrixWorld);t.union(n)}}function l(t){if(t._vkUpdate!==undefined&&(r||a&&t.userData.is2D)){return}if(!e||t.visible){s(t);var i=t.children;for(var o=0,n=i.length;o<n;o++){l(i[o])}}}l(this);return t};i.Object3D.prototype._vkPersistentId=function(){var t=this;do{if(t.userData.treeNode&&t.userData.treeNode.sid){return t.userData.treeNode.sid}t=t.parent}while(t);return null};i.Object3D.prototype._vkSetNodeContentType=function(t){this.userData.nodeContentType=t;if(t===r.Reference){this.visible=false;this.userData.skipIt=true}else if(t===r.Background){this.userData.renderStage=-1}else if(t===r.Symbol){this.userData.symbolContent=true;this.userData.renderStage=1;this.updateMatrix();this.updateMatrixWorld(true);this.userData.direction=(new i.Vector3).setFromMatrixColumn(this.matrixWorld,2).normalize()}};i.Object3D.prototype._vkGetNodeContentType=function(){return this.userData.nodeContentType};i.Camera.prototype._vkZoomTo=function(t,e){e=e||0;var r=new i.Vector3;t.getSize(r);if(r.lengthSq()===0){return this}var a=t.min,o=t.max;var n=[new i.Vector3(a.x,a.y,a.z),new i.Vector3(o.x,o.y,o.z),new i.Vector3(a.x,a.y,o.z),new i.Vector3(a.x,o.y,o.z),new i.Vector3(o.x,a.y,o.z),new i.Vector3(o.x,o.y,a.z),new i.Vector3(a.x,o.y,a.z),new i.Vector3(o.x,a.y,a.z)];var s=new i.Matrix4,l=new i.Vector3,h=new i.Box2;function u(t){n.forEach(function(e){l=e.project(t);h.expandByPoint(new i.Vector2(l.x,l.y))})}var p=this.view;if(p&&p.enabled){u(this);var c=p.offsetX+p.width*(.5+.25*(h.min.x+h.max.x));var d=p.offsetY+p.height*(.5-.25*(h.min.y+h.max.y));var f=Math.max(h.max.x-h.min.x,h.max.y-h.min.y)*.5*(1+e);p.width*=f;p.height*=f;p.offsetX=c-p.width*.5;p.offsetY=d-p.height*.5;return this}function y(t){s.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);for(var e in n){l.copy(n[e]).applyMatrix4(s);if(l.x<-1||l.x>1||l.y<-1||l.y>1){return false}}return true}var v=new i.Vector3;t.getCenter(v);var m=new i.Vector3;this.getWorldDirection(m);m.multiplyScalar(r.length());this.position.copy(v).sub(m);this.updateMatrixWorld(true);if(this.isPerspectiveCamera){while(!y(this)){this.position.sub(m);this.updateMatrixWorld(true)}var g=10;var x=this.position.clone();var D=v.clone();for(var M=0;M<g;M++){this.position.copy(x).add(D).multiplyScalar(.5);this.updateMatrixWorld(true);if(y(this)){x.copy(this.position)}else{D.copy(this.position)}}this.position.copy(x).sub(v).multiplyScalar(e).add(x);this.updateMatrixWorld(true)}else if(this.isOrthographicCamera){u(this);this.zoom/=Math.max(h.max.x-h.min.x,h.max.y-h.min.y)*.5*(1+e);this.updateProjectionMatrix()}return this};i.Mesh.prototype._vkClone=function(){var t=new i.Mesh;a.disposeMaterial(t.material);t.copy(this);return t}});
//# sourceMappingURL=ThreeExtensions.js.map