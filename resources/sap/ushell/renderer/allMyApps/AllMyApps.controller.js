// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/m/StandardListItem","sap/ui/core/EventBus","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/library","sap/ushell/renderer/allMyApps/AllMyAppsManager","sap/ushell/resources","sap/ushell/utils/WindowUtils","sap/ushell/EventHub","sap/ushell/state/ShellModel","sap/ushell/Container","sap/ushell/renderers/fiori2/allMyApps/AllMyAppsManager"],function(e,t,s,a,i,l,n,o,r,p,d,g,u,h,c,M){"use strict";const A=e.ListType;const f=r.AllMyAppsState;const y=r.AllMyAppsProviderType;const v=r.AppTitleState;var L=false;return a.extend("sap.ushell.renderer.allMyApps.AllMyApps",{iNumberOfProviders:0,onInit:function(){this.bFirstLoadOfAllMyApps=true;var e=new l;var t=this.getView();var a=s.getInstance();e.setSizeLimit(1e4);e.setProperty("/AppsData",[]);e.setProperty("/catalogEnabled",o.last("/core/catalog/enabled"));t.setModel(d.getTranslationModel(),"i18n");t.setModel(e,"allMyAppsModel");if(!this._fnResizeHandler){this._fnResizeHandler=this._adjustItemNavigationColumns.bind(this);window.addEventListener("resize",this._fnResizeHandler)}a.subscribe("launchpad","allMyAppsFirstCatalogLoaded",this.updateMasterFocusAndDetailsContext,this);a.subscribe("launchpad","allMyAppsFirstCatalogLoaded",this.onDetailLoad,this);a.subscribe("launchpad","allMyAppsMasterLoaded",this.onMasterLoad,this);a.subscribe("launchpad","allMyAppsNoCatalogsLoaded",this.onNoCatalogsLoaded,this)},_getConfigModel:function(){return h.getConfigModel()},onExit:function(){var e=s.getInstance();if(this._fnResizeHandler){window.removeEventListener("resize",this._fnResizeHandler);delete this._fnResizeHandler}const t=this.getView();const a=t&&t.byId("oItemsContainerlist");const i=a&&a.getDomRef();if(this._fnFocusInHandler&&i){i.removeEventListener("focusin",this._fnFocusInHandler);delete this._fnFocusInHandler}e.unsubscribe("launchpad","allMyAppsFirstCatalogLoaded",this.updateMasterFocusAndDetailsContext);e.unsubscribe("launchpad","allMyAppsFirstCatalogLoaded",this.onDetailLoad,this);e.unsubscribe("launchpad","allMyAppsMasterLoaded",this.onMasterLoad,this);e.unsubscribe("launchpad","allMyAppsNoCatalogsLoaded",this.onNoCatalogsLoaded,this)},_adjustItemNavigationColumns:function(){const e=this.getView();const t=e&&e.byId("oItemsContainerlist");const s=t&&t.getItemNavigation();const a=t&&t.getItems();if(s&&a.length>1){const e=a[0].getDomRef();const t=a[1].getDomRef();if(e&&t){const a=e.getBoundingClientRect().y===t.getBoundingClientRect().y;s.setColumns(a?2:1)}}},onBeforeRendering:function(){const e=this.getView();const t=e&&e.byId("oItemsContainerlist");const s=t&&t.getDomRef();if(this._fnFocusInHandler&&s){s.removeEventListener("focusin",this._fnFocusInHandler);delete this._fnFocusInHandler}},onAfterRendering:function(){return new Promise(function(e,t){var s=this;var a=this.getView();var l=a.getModel("allMyAppsModel");var n=this._getSplitApp();var o=a.byId("sapUshellAllMyAppsMasterPage");var r=a.byId("sapUshellAllMyAppsDetailsPage");if(!this.bAfterInitialLoading){if(o){o.setBusy(true)}if(r){r.setBusy(true)}n.toMaster(this.createId("sapUshellAllMyAppsMasterPage"),"show");if(!i.system.phone){n.toDetail("sapUshellAllMyAppsDetailsPage","show")}}if(this.bFirstLoadOfAllMyApps){l.setProperty("/AppsData",[])}else{var p=l.getProperty("/AppsData");l.setProperty("/AppsData",p)}const d=a.byId("oItemsContainerlist");const g=d&&d.getDomRef();if(!this._fnFocusInHandler&&g){this._fnFocusInHandler=this._adjustItemNavigationColumns.bind(this);g.addEventListener("focusin",this._fnFocusInHandler)}setTimeout(function(){s._getAllMyAppsManager().loadAppsData(l,s._getPopoverObject(),s.bFirstLoadOfAllMyApps);s._isSingleDataSource().then(function(t){L=t;s.switchToInitialState();s.bFirstLoadOfAllMyApps=false;e()})},0)}.bind(this))},switchToInitialState:function(){var e=this._getDataSourceList();return this._isSingleDataSource().then(function(t){if(t){this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.FirstLevelSpread);e.bindItems("allMyAppsModel>/AppsData/0/groups",this._getMasterListItemTemplate)}else{this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.FirstLevel);e.bindItems("allMyAppsModel>/AppsData",this._getMasterListItemTemplate())}if(i.system.phone){this._getSplitApp().toMaster(this.createId("sapUshellAllMyAppsMasterPage"),"show")}e.invalidate();this.updateMasterFocusAndDetailsContext(undefined,undefined,{bFirstCatalogLoadedEvent:true});this._getPopoverHeaderLabel().setText(d.i18n.getText("allMyApps_headerTitle"));this.updateHeaderButtonsState()}.bind(this))},handleSwitchToMasterAreaOnPhone:function(){var e=this._getDataSourcesSelectedPath();var t=e.split("/");this._getSplitApp().toMaster(this.createId("sapUshellAllMyAppsMasterPage"),"show");return this._isSingleDataSource().then(function(e){if(e){this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.FirstLevelSpread)}else if(t.length===3){this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.FirstLevel)}else{this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.SecondLevel)}this.updateHeaderButtonsState()}.bind(this))},handleMasterListItemPress:function(e){this.lastPressedMasterItem=e.getParameter("listItem");var t=this._getClickedDataSourceItemPath(this.lastPressedMasterItem);var s=this.getView();var a=s.getModel("allMyAppsModel");var i=a.getProperty(t+"/type");var l=this._getConfigModel().getProperty("/allMyAppsMasterLevel");var n=this._getCustomPanel();var o=this._getCustomPanelLabel();var r=this._getCustomPanelLink();var p=i===y.CATALOG;var d;if(p||l===f.FirstLevelSpread||l===f.SecondLevel){d=this.handleMasterListItemPressToDetails(t)}else{d=this.handleMasterListItemPressToSecondLevel(t)}n.setBindingContext(d,"allMyAppsModel");o.setBindingContext(d,"allMyAppsModel");if(r&&r.getVisible&&r.getVisible()){r.setBindingContext(d,"allMyAppsModel")}},handleMasterListItemPressToSecondLevel:function(e){var t=this.getView();var s=t.getModel("allMyAppsModel");var a=s.getProperty(e+"/type");var l=s.getProperty(e+"/title");var n=this._getSplitApp();var o=this._getDataSourceList();if(!i.system.phone){n.toDetail(this.createId("sapUshellAllMyAppsDetailsPage"))}o.bindItems("allMyAppsModel>"+e+"/groups",this._getMasterListItemTemplate());this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.SecondLevel);var r=this._setBindingContext(e+"/groups/0",t.byId("oItemsContainerlist"));o.invalidate();o.setSelectedItem(o.getItems()[0]);var p=o.getSelectedItem();if(p){p.focus()}if(a===y.HOME){this._getPopoverHeaderLabel().setText(d.i18n.getText("allMyApps_homeEntryTitle"))}else if(a===y.EXTERNAL){this._getPopoverHeaderLabel().setText(l)}this._getDetailsHeaderLabel().setText(s.getProperty(e+"/groups/0/title"));this.updateHeaderButtonsState();return r},handleMasterListItemPressToDetails:function(e){var t=this.getView();var s=t.getModel("allMyAppsModel");var a=this._setBindingContext(e,t.byId("oItemsContainerlist"));this._getDetailsHeaderLabel().setText(s.getProperty(e+"/title"));if(i.system.phone){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsDetailsPage"));this._getConfigModel().setProperty("/allMyAppsMasterLevel",f.Details)}this.updateHeaderButtonsState();return a},onMasterLoad:function(){var e=this.getView();var t=this._getPopoverHeaderBackButton();this.bAfterInitialLoading=true;e.byId("sapUshellAllMyAppsMasterPage").setBusy(false);t.focus();this._isSingleDataSource().then(function(e){L=e;this.updateMasterFocusAndDetailsContext(undefined,undefined,{bFirstCatalogLoadedEvent:false})}.bind(this))},onDetailLoad:function(){var e=this.getView();var t=e.byId("sapUshellAllMyAppsDetailsPage");t.setBusy(false);this.bAfterInitialLoading=true;if(!i.system.phone){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsDetailsPage"),"show")}},onNoCatalogsLoaded:function(){var e=this.getView();var t=e.byId("sapUshellAllMyAppsDetailsPage");t.setBusy(false);this.bAfterInitialLoading=true;if(!i.system.phone&&!L){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsEmptyDetailsPage"),"show")}else if(!i.system.phone&&L){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsDetailsPage"))}},updateMasterFocusAndDetailsContext:function(e,t,s){var a=this.getView();var i=a.getModel("allMyAppsModel");var l=this._getInitialFirstLevelSelectionIndex();var o=this._getDataSourceList();var r=this._getCustomPanelLabel();var p=this._getCustomPanelLink();var d;var g;if(L===true){d=i.createBindingContext("/AppsData/0/groups/0");g=i.getProperty(d.getPath())}else{d=i.createBindingContext("/AppsData/"+l);g=i.getProperty(d.getPath())}a.byId("oItemsContainerlist").setBindingContext(d,"allMyAppsModel");r.setBindingContext(d,"allMyAppsModel");a.byId("sapUshellAllMyAppsCustomPanel").setBindingContext(d,"allMyAppsModel");if(p.getVisible()){p.setBindingContext(d,"allMyAppsModel")}if(g!==undefined){this._getDetailsHeaderLabel().setText(g.title)}if(s.bFirstCatalogLoadedEvent===true){o.invalidate()}if(s.bFirstCatalogLoadedEvent===false&&l===0){this.onNoCatalogsLoaded()}o.setSelectedItem(o.getItems()[l]);var u=o.getSelectedItem();if(u){setTimeout(function(){u.focus()},0)}if(s.bFirstCatalogLoadedEvent){n.end("FLP:ShellAppTitle.onClick");n.end("FLP:ShellNavMenu.footerClick")}},handleCustomPanelLinkPress:function(e){var t=this.getView();var s=t.byId("sapUshellAllMyAppsCustomPanelLink");var a=s.getVisible()?s.getBindingContext("allMyAppsModel").getObject():{};if(a.handlePress){a.handlePress(e.getSource(),a)}},updateHeaderButtonsState:function(){this._getShellAppTitleToggleListButton().setVisible(this.getToggleListButtonVisible());this._getPopoverHeaderBackButton().setVisible(this.getBackButtonVisible())},getToggleListButtonVisible:function(){var e=this.getCurrentState();var t=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name==="Phone";var s=(t||i.system.phone)&&e===f.Details;return s},getBackButtonVisible:function(){var e=this._getConfigModel().getProperty("/shellAppTitleState");if(e!==v.AllMyAppsOnly){return true}var t=this.getCurrentState();return t===f.SecondLevel||t===f.Details},onAppItemClick:function(e){var t=this.getView().getModel("allMyAppsModel");var s=e.getSource().getBindingContext("allMyAppsModel").getPath();var a=t.getProperty(s+"/url");if(a){u.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:a}});if(a[0]==="#"){hasher.setHash(a);setTimeout(function(){this.getView().getParent().close()}.bind(this),50)}else{g.openURL(a,"_blank")}}},getCurrentState:function(){return this._getConfigModel().getProperty("/allMyAppsMasterLevel")},_isSingleDataSource:function(){return c.getServiceAsync("AllMyApps").then(function(e){if(e.isCatalogAppsEnabled()){return false}if(!e.isExternalProviderAppsEnabled()&&e.isHomePageAppsEnabled()){return true}return e.isExternalProviderAppsEnabled()&&Object.keys(e.getDataProviders()).length===1&&!e.isHomePageAppsEnabled()})},_getInitialFirstLevelSelectionIndex:function(){var e=this.getView();var t=e.getModel("allMyAppsModel");var s=t.getProperty("/AppsData");for(var a=0;a<s.length;a++){var i=s[a];if(i.type===y.CATALOG){return a}}return 0},_getPopoverHeaderBackButton:function(){if(!this._oPopoverHeaderBackButton){this._oPopoverHeaderBackButton=this._getPopoverHeaderContent(0)}return this._oPopoverHeaderBackButton},_getShellAppTitleToggleListButton:function(){if(!this._oShellAppTitleToggleListButton){this._oShellAppTitleToggleListButton=this._getPopoverHeaderContent(1)}return this._oShellAppTitleToggleListButton},_getPopoverHeaderContent:function(e){var t=this._getPopoverObject().getCustomHeader();var s=t.getContentLeft();var a=s[e];return a},_getPopoverHeaderLabel:function(){var e=this._getPopoverObject().getCustomHeader();var t=e.getContentMiddle();return t[0]},_getPopoverObject:function(){return this.getView().getParent()},_getDetailsHeaderLabel:function(){return this.getView().byId("sapUshellAllMyAppsDetailsHeaderLabel")},_setBindingContext:function(e,t){var s=this.getView().getModel("allMyAppsModel");var a=s.createBindingContext(e);t.setBindingContext(a,"allMyAppsModel");return a},_getClickedDataSourceItemPath:function(e){return e.getBindingContext("allMyAppsModel").getPath()},_getAllMyAppsManager:function(){return p},_getDataSourcesSelectedPath:function(){return this.lastPressedMasterItem.getBindingContextPath()},getControllerName:function(){return"sap.ushell.renderer.allMyApps.AllMyApps"},formatListItemType:function(e,t){var s=i.system.phone||t===f.FirstLevel&&e!==y.CATALOG;return s?A.Navigation:A.Active},_getMasterListItemTemplate:function(){if(!this.oTemplate){this.oTemplate=new t({type:{parts:["allMyAppsModel>type","/allMyAppsMasterLevel"],formatter:this.formatListItemType},title:"{allMyAppsModel>title}",wrapping:true})}return this.oTemplate},_getSplitApp:function(){return this.getView().byId("sapUshellAllMyAppsMasterDetail")},_getDataSourceList:function(){return this.getView().byId("sapUshellAllMyAppsDataSourcesList")},_getCustomPanel:function(){return this.getView().byId("sapUshellAllMyAppsCustomPanel")},_getCustomPanelLabel:function(){return this.getView().byId("sapUshellAllMyAppsCustomPanelLabel")},_getCustomPanelLink:function(){return this.getView().byId("sapUshellAllMyAppsCustomPanelLink")}})});
//# sourceMappingURL=AllMyApps.controller.js.map