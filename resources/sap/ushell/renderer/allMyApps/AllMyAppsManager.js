// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ui/thirdparty/jquery","sap/ushell/resources","sap/ushell/library","sap/ushell/Container"],function(t,jQuery,e,i,a){"use strict";var r=i.AllMyAppsProviderType;var o=function(){};o.prototype.loadAppsData=function(e,i,r){return a.getServiceAsync("AllMyApps").then(function(a){this.oPopover=i;if(!a.isEnabled()){return}this.iNumberOfProviders=0;this.oModel=e;if(a.isHomePageAppsEnabled()){this._handleGroupsData()}if(a.isExternalProviderAppsEnabled()){this._handleExternalProvidersData(e)}if(a.isCatalogAppsEnabled()){this._handleCatalogs(r)}if(!a.isCatalogAppsEnabled()||a.isCatalogAppsEnabled()&&r){var o=t.getInstance();o.publish("launchpad","allMyAppsMasterLoaded")}}.bind(this))};o.prototype._handleGroupsData=function(){var t=this._getGroupsData();var i={title:e.i18n.getText("allMyApps_homeEntryTitle")};var a;return new Promise(function(e,i){t.done(e).fail(i)}).then(function(t){i.groups=t;i.type=r.HOME;if(t.length===0){return}a=this.oModel.getProperty("/AppsData");if(a){var e=this._getIndexByType(a,i.type);if(e!==undefined){a[e]=i}else{a.unshift(i)}}this.oModel.setProperty("/AppsData",a);this.iNumberOfProviders+=1}.bind(this))};o.prototype._getIndexByType=function(t,e){if(t.length<=0){return 0}for(var i=0;i<t.length;i++){if(t[i].type===e){return i}}};o.prototype._getGroupsData=function(){var t=new jQuery.Deferred;a.getServiceAsync("FlpLaunchPage").then(function(t){return Promise.all([t.getDefaultGroup(),t.getGroups()])}).then(function(t){this.oDefaultGroup=t[0];var e=t[1];var i=[];e.forEach(function(t){i.push(this._getFormattedGroup(t))}.bind(this));return Promise.all(i)}.bind(this)).then(function(e){var i=e.filter(function(t){return t&&(t.apps.length>0||t.numberCustomTiles>0)});t.resolve(i)});return t.promise()};o.prototype._getFormattedGroup=function(t){var i;var r;var o;return a.getServiceAsync("FlpLaunchPage").then(function(a){if(a.isGroupVisible(t)===false){return}if(a.getGroupId(t)===a.getGroupId(this.oDefaultGroup)){r=e.i18n.getText("my_group")}else{r=a.getGroupTitle(t)}i={};i.title=r;i.apps=[];o=a.getGroupTiles(t);return this._getFormattedGroupApps(o)}.bind(this)).then(function(t){if(!t){return}i.apps=t.aFormattedApps;i.numberCustomTiles=t.iNumberOfCustomTiles;if(t.iNumberOfCustomTiles===1){i.sCustomLabel=e.i18n.getText("allMyApps_customStringSingle");i.sCustomLink=e.i18n.getText("allMyApps_customLinkHomePageSingle")}else{i.sCustomLabel=e.i18n.getText("allMyApps_customString",[t.iNumberOfCustomTiles]);i.sCustomLink=e.i18n.getText("allMyApps_customLinkHomePage")}i.handlePress=this._onHandleGroupPress;return i}.bind(this))};o.prototype._getFormattedGroupApps=function(t){var e=[];var i=0;return a.getServiceAsync("FlpLaunchPage").then(function(a){var r=[];t.forEach(function(t){if(a.isTileIntentSupported(t)){var o=this._getAppEntityFromTile(t).then(function(t){if(t){e.push(t)}else{i++}});r.push(o)}}.bind(this));return Promise.all(r)}.bind(this)).then(function(){return{iNumberOfCustomTiles:i,aFormattedApps:e}})};o.prototype._onHandleGroupPress=function(e,i){window.hasher.setHash("#Shell-home");this.oPopover.close();var a=t.getInstance();a.subscribe("launchpad","dashboardModelContentLoaded",function(){a.publish("launchpad","scrollToGroupByName",{groupName:i.title,isInEditTitle:false})},this);a.publish("launchpad","scrollToGroupByName",{groupName:i.title,isInEditTitle:false})};o.prototype._handleExternalProvidersData=function(){var e=this;return a.getServiceAsync("AllMyApps").then(function(i){var a=i.getDataProviders();var o=Object.keys(a);var s;var n;var l;var p;var u;var h;if(o.length>0){for(u=0;u<o.length;u++){s=o[u];n=a[s];l=n.getTitle();p={};p.title=l;h=n.getData();h.done(function(i){if(i&&i.length>0){this.groups=i;this.type=r.EXTERNAL;e.oModel.setProperty("/AppsData/"+e.iNumberOfProviders,this);e.iNumberOfProviders+=1;var a=t.getInstance();a.publish("launchpad","allMyAppsMasterLoaded")}}.bind(p))}}})};o.prototype._handleNotFirstCatalogsLoad=function(){var e=this.oModel.getProperty("/AppsData");var i=r.CATALOG;if(e.length&&e[e.length-1].type===i){this.bFirstCatalogLoaded=true;t.getInstance().publish("launchpad","allMyAppsFirstCatalogLoaded",{bFirstCatalogLoadedEvent:true})}};o.prototype._handleCatalogs=function(t){if(!t){this._handleNotFirstCatalogsLoad();return Promise.resolve()}this.bFirstCatalogLoaded=false;this.aPromises=[];return a.getServiceAsync("FlpLaunchPage").then(function(t){t.getCatalogs().done(function(){jQuery.when.apply(jQuery,this.aPromises).then(this._onDoneLoadingCatalogs.bind(this))}.bind(this)).fail(function(){this._onGetCatalogsFail(e.i18n.getText("fail_to_load_catalog_msg"))}.bind(this)).progress(this._addCatalogToModel.bind(this))}.bind(this))};o.prototype._addCatalogToModel=function(i){var o;var s={apps:[],numberCustomTiles:0,type:null};var n;var l=[a.getServiceAsync("FlpLaunchPage")];if(this._oAddCatalogToModelPromise){l.push(this._oAddCatalogToModelPromise)}this._oAddCatalogToModelPromise=Promise.all(l).then(function(t){o=t[0];s.type=r.CATALOG;var e=o.getCatalogTiles(i);this.aPromises.push(e);return e}.bind(this)).then(function(t){var e;if(t.length===0){return}var a=o.getCatalogTitle(i);e=this.oModel.getProperty("/AppsData");for(n=0;n<e.length;n++){if(e[n].type===r.CATALOG&&e[n].title===a){s=e[n];break}}s.title=o.getCatalogTitle(i);return this._getFormattedGroupApps(t)}.bind(this)).then(function(i){if(!i){return}Array.prototype.push.apply(s.apps,i.aFormattedApps);s.numberCustomTiles=i.iNumberOfCustomTiles;if(s.numberCustomTiles===1){s.sCustomLabel=e.i18n.getText("allMyApps_customStringSingle");s.sCustomLink=e.i18n.getText("allMyApps_customLinkAppFinderSingle")}else{s.sCustomLabel=e.i18n.getText("allMyApps_customString",[s.numberCustomTiles]);s.sCustomLink=e.i18n.getText("allMyApps_customLinkAppFinder")}s.handlePress=function(t,e){this.oPopover.close();window.hasher.setHash("#Shell-home&/appFinder/catalog/"+JSON.stringify({catalogSelector:e.title,tileFilter:"",tagFilter:"[]",targetGroup:""}))}.bind(this);if(s.apps.length>0||s.numberCustomTiles>0){this.oModel.setProperty("/AppsData/"+n,s);if(this.bFirstCatalogLoaded===false){t.getInstance().publish("launchpad","allMyAppsFirstCatalogLoaded",{bFirstCatalogLoadedEvent:true});this.bFirstCatalogLoaded=true}this.iNumberOfProviders+=1}}.bind(this));return this._oAddCatalogToModelPromise};o.prototype._onGetCatalogsFail=function(t){return a.getServiceAsync("MessageInternal").then(function(e){e.info(t)})};o.prototype._onDoneLoadingCatalogs=function(){var e=this.oModel.getProperty("/AppsData");e.sort(function(t,e){var i=t.title.toUpperCase();var a=e.title.toUpperCase();if(i<a){return-1}if(i>a){return 1}return 0});this.oModel.setProperty("/AppsData",e);var i=t.getInstance();if(!this.bFirstCatalogLoaded){i.publish("launchpad","allMyAppsNoCatalogsLoaded")}};o.prototype._getAppEntityFromTile=function(t){return a.getServiceAsync("FlpLaunchPage").then(function(e){var i;var a=e.getCatalogTilePreviewTitle(t);var r=e.getCatalogTilePreviewSubtitle(t);var o=e.getCatalogTileTargetURL(t);if(o&&(a||r)){i={};i.url=o;if(a){i.title=a;i.subTitle=r}else{i.title=r}return i}})};return new o});
//# sourceMappingURL=AllMyAppsManager.js.map