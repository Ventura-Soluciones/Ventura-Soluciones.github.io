// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Avatar","sap/m/library","sap/ui/core/Component","sap/ui/core/Element","sap/ushell/renderer/shellHeader/ShellHeader.controller","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/EventHub","sap/ushell/resources","sap/ushell/utils","sap/ui/core/mvc/View","sap/ui/core/mvc/XMLView","sap/ui/core/Fragment","sap/ushell/api/NewExperience","sap/ushell/renderer/ShellLayout","sap/ushell/renderer/Shell.controller","sap/ushell/state/ShellModel","sap/ushell/state/StateManager","sap/ushell/Config","sap/ushell/Container","sap/ushell/state/BindingHelper","sap/ui/core/ComponentContainer"],function(e,t,n,i,a,o,l,r,s,d,h,c,u,g,p,f,y,M,A,b,v,m){"use strict";const C=n.AvatarSize;const S=M.Operation;const w=M.ShellMode;const P=p.ShellArea;const F={Property:"Property",List:"List"};return h.extend("sap.ushell.renderer.Shell",{getControllerName:function(){return"sap.ushell.renderer.Shell"},waitForShellLayout:function(){if(!this._oShellLayoutPromise){this._oShellLayoutPromise=new Promise(function(e){this.getController().addDoable(r.once("ShellLayoutApplied").do(e))}.bind(this))}return this._oShellLayoutPromise},getViewDataConfig:function(){var e=this.getViewData()||{};var t=e.config||{};return t},createContent:function(){this._createUserActionsMenuButton(y.getConfigModel());this._allowUpToThreeActionInShellHeader();M.init(this.getViewDataConfig());this.initBackgroundImage();var e=this.createShellHeader();this.setNavigationBarMinHeight();var t=this.createRendererRootView();this.setDisplayBlock(true);d.setPerformanceMark("FLP - Shell.view rendering started!");return Promise.all([t,e]).then(function(e){var t=e[0];this.initCanvasShapesManager();return t}.bind(this))},initBackgroundImage:function(){this.waitForShellLayout().then(function(){var e=document.getElementById(P.BackgroundImage);var t=["<div class='sapUiShellBackgroundImage sapUiGlobalBackgroundImageForce sapUshellShellBG sapContrastPlus'></div>","<div class='sapMShellBG sapUiGlobalBackgroundImage'></div>"].join("\n");e.insertAdjacentHTML("afterbegin",t)})},createRendererRootView:function(){var e=this.getController();return u.load({name:"sap.ushell.renderer.RendererRootView",controller:e}).then(function(e){v.overrideUpdateAggregation(e);return e})},createRendererRootViewFallback:function(){var e=this.getController();return u.load({name:"sap.ushell.renderer.RendererRootViewFallback",controller:e}).then(function(e){v.overrideUpdateAggregation(e);return e})},createShellHeader:async function(){if(A.last("/core/shellBar/enabled")){return i.create({name:"sap.ushell.components.shell.ShellBar"}).then(e=>{e.setModel(s.i18nModel,"i18n");e.setModel(g.getModel(),"newExperience");e.setModel(y.getModel(),"shellModel");this.waitForShellLayout().then(()=>{const t=new m({component:e,id:"shell-header",async:true});e.enhanceComponentContainerAPI(t);t.placeAt(P.ShellHeader,"only");this.addDanglingControl(t);this._oShellHeader=t})})}else if(!A.last("/core/shellBar/enabled")){var e=new o;return u.load({name:"sap.ushell.renderer.shellHeader.ShellHeader",controller:e}).then(t=>{v.overrideUpdateAggregation(t);if(M.getShellMode()===w.Embedded){t.setNoLogo()}t.setModel(s.i18nModel,"i18n");t.setModel(g.getModel(),"newExperience");t.setModel(y.getModel(),"shellModel");this.addDanglingControl(t);this._oShellHeader=t;this.waitForShellLayout().then(function(){t.placeAt(P.ShellHeader,"only");e.onInit()})})}},setNavigationBarMinHeight:function(){return b.getServiceAsync("Menu").then(function(e){return e.isMenuEnabled()}).then(function(e){if(!e){return}this.waitForShellLayout().then(function(){var e=document.getElementById(P.NavigationBar);e.classList.add("sapUshellMenuBarHeight")})}.bind(this)).catch(function(t){e.info("Could not apply min-height of the navigationBar",t)})},createRightFloatingContainer:function(){this.addPendingInitialization(new Promise(function(e){sap.ui.require(["sap/ushell/ui/shell/RightFloatingContainer"],function(t){var n=new t({id:"right-floating-container",top:"2",right:"2",hideItemsAfterPresentation:true,visible:"{shellModel>/rightFloatingContainer/visible}",floatingContainerItems:{path:"shellModel>/rightFloatingContainer/items",factory:v.factory}});v.overrideUpdateAggregation(n);n.setModel(y.getModel(),"shellModel");this.addDanglingControl(n);this._oRightFloatingContainer=n;e();this.waitForShellLayout().then(function(){n.placeAt(P.RightFloatingContainer,"only")})}.bind(this))}.bind(this)))},initCanvasShapesManager:function(){this.bindFactory({model:y.getConfigModel(),factory:this.createCanvasShapesManager.bind(this),bindingPath:"/enableBackGroundShapes",bindingType:F.Property,valueCheck:function(e){return!!e}})},createCanvasShapesManager:function(){sap.ui.require(["sap/ushell/CanvasShapesManager"])},createSubHeader:function(){sap.ui.require(["sap/ushell/ui/shell/SubHeader"],function(e){var t=new e({id:"subhdr",content:{path:"shellModel>/subHeader/items",factory:v.factory}});v.overrideUpdateAggregation(t);t.setModel(y.getModel(),"shellModel");this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(P.SubHeader,"only")})}.bind(this))},createFloatingContainer:async function(){const e=await i.create({name:"sap.ushell.components.shell.FloatingContainer"});this.addDanglingControl(e);return e},createSidePane:function(){sap.ui.require(["sap/ushell/ui/shell/SidePane"],function(e){var t=new e({id:"shell-sidePane",visible:"{shellModel>/sidePane/visible}",content:{path:"shellModel>/sidePane/items",factory:v.factory}});v.overrideUpdateAggregation(t);t.setModel(y.getModel(),"shellModel");this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(P.SidePane,"only")})}.bind(this))},createToolArea:function(){sap.ui.require(["sap/ushell/ui/shell/ToolArea"],function(e){var t=new e({id:"shell-toolArea",visible:"{shellModel>/toolArea/visible}",toolAreaItems:{path:"shellModel>/toolArea/items",factory:v.factory}});v.overrideUpdateAggregation(t);t.setModel(y.getModel(),"shellModel");this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(P.ToolArea,"only")})}.bind(this))},createFloatingActions:function(){sap.ui.require(["sap/ushell/ui/shell/ShellFloatingActions"],function(e){var t=new e({id:"shell-floatingActions",floatingActions:{path:"shellModel>/floatingActions/items",factory:v.factory}});v.overrideUpdateAggregation(t);t.setModel(y.getModel(),"shellModel");this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(P.FloatingActions,"only")})}.bind(this))},initAllMyAppsView:function(){return b.getServiceAsync("AllMyApps").then(function(e){if(e.isEnabled()){return this.createAllMyAppsView()}}.bind(this))},createAllMyAppsView:function(){return c.create({id:"allMyAppsView",viewName:"sap.ushell.renderer.allMyApps.AllMyApps"}).then(function(e){e.setModel(y.getConfigModel(),"configModel");e.setModel(s.i18nModel,"i18n");e.addCustomData(new l({key:"aria-label",value:s.i18n.getText("allMyApps_headerTitle"),writeToDom:true}));this.addDanglingControl(e);if(A.last("/core/shellBar/enabled")){a.getElementById(this.getShellHeader().getAppTitle()).setAllMyApps(e)}else{this.getShellHeader().getAppTitle().setAllMyApps(e)}}.bind(this))},createPostCoreExtControls:function(){var e=y.getModel();sap.ui.require(["sap/ui/core/Popup"],function(e){e.setInitialZIndex(11)});this.bindFactory({model:e,factory:this.createFloatingContainer.bind(this),bindingPath:"/floatingContainer/items",bindingType:F.List,valueCheck:function(e){return!!e.length}});this.bindFactory({model:e,factory:this.createRightFloatingContainer.bind(this),bindingPath:"/rightFloatingContainer/visible",bindingType:F.Property,valueCheck:function(e){return!!e}});this.bindFactory({model:e,factory:this.createSubHeader.bind(this),bindingPath:"/subHeader/items",bindingType:F.List,valueCheck:function(e){return!!e.length}});this.bindFactory({model:e,factory:this.createToolArea.bind(this),bindingPath:"/toolArea/visible",bindingType:F.Property,valueCheck:function(e){return!!e}});this.bindFactory({model:e,factory:this.createSidePane.bind(this),bindingPath:"/sidePane/visible",bindingType:F.Property,valueCheck:function(e){return!!e}});this.bindFactory({model:e,factory:this.createFloatingActions.bind(this),bindingPath:"/floatingActions/items",bindingType:F.List,valueCheck:function(e){return!!e.length}});this.addPendingInitialization(this.initAllMyAppsView())},_allowUpToThreeActionInShellHeader:function(){const e=["moveAppFinderActionToShellHeader","moveUserSettingsActionToShellHeader","moveContactSupportActionToShellHeader","moveEditHomePageActionToShellHeader"];const t=this.getViewDataConfig();e.reduce((e,n)=>{if(e>=3){t[n]=false;return e}if(t[n]){e++}return e},0)},_createUserActionsMenuButton:function(e){const n=b.getUser();const i=s.i18n.getText("UserActionsMenuToggleButtonAria",[n.getFullName()||n.getId()]);const a=this.addDanglingControl.bind(this);let o;if(A.last("/core/shellBar/enabled")){sap.ui.require(["sap/ushell/thirdparty/ui5/webcomponents/Avatar"],function(t){o=new t({id:"userActionsMenuHeaderButton",src:"{configModel>/userImage/personPlaceHolder}",initials:n.getInitials(),tooltip:i});o.setModel(e,"configModel");a(o);M.updateAllBaseStates("header.headEndItems",S.Add,"userActionsMenuHeaderButton")})}else{o=new t({id:"userActionsMenuHeaderButton",src:"{configModel>/userImage/personPlaceHolder}",initials:n.getInitials(),ariaHasPopup:"Menu",displaySize:C.XS,tooltip:i,press:function(){r.emit("showUserActionsMenu",Date.now())}});o.setModel(e,"configModel");this.addDanglingControl(o);M.updateAllBaseStates("header.headEndItems",S.Add,"userActionsMenuHeaderButton")}},getShellHeader:function(){return this._oShellHeader},getRightFloatingContainer:function(){return this._oRightFloatingContainer},bindFactory:function(e){var t=e.model;var n=e.factory;var i=e.bindingPath;var a=e.bindingType;var o=e.valueCheck;var l=t.getProperty(i);if(o(l)){n()}else{var r;switch(a){case F.List:r=t.bindList(i);break;default:r=t.bindProperty(i)}this.addDanglingBinding(r);r.attachChange(function(){l=r.getModel().getProperty(r.getPath());if(o(l)){this.removeDanglingBinding(r);r.destroy();n()}},this)}},addDanglingBinding:function(e){this.getController().addDanglingBinding(e)},removeDanglingBinding:function(e){this.getController().removeDanglingBinding(e)},addDanglingControl:function(e){this.getController().addDanglingControl(e)},addPendingInitialization:function(e){return this.getController().addPendingInitialization(e)}})});
//# sourceMappingURL=Shell.view.js.map