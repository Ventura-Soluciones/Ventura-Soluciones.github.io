// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/Element","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/api/NewExperience","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/ui/shell/OverflowListItem","sap/ushell/Container","sap/ushell/state/BackNavigation","sap/ushell/state/ShellModel","sap/ushell/state/StateManager"],function(e,t,n,a,i,r,s,o,d,l,h,f,m,u){"use strict";const c=e.ListType;const v=d.FloatingNumberType;const p=u.LaunchpadState;const E=u.Operation;const g="endItemsOverflowBtn";return n.extend("sap.ushell.renderer.shellHeader.ShellHeader",{onInit:function(){this.aDoables=[];this.aDoables.push(o.on("navigateBack").do(this.pressNavBackButton.bind(this)));this.aDoables.push(o.on("showEndItemOverflow").do(this.pressEndItemsOverflow.bind(this)));this.aDoables.push(o.on("navigateFromShellApplicationNavigationMenu").do(this.navigateFromShellApplicationNavigationMenu.bind(this)));this.aDoables.push(o.on("setHeaderCentralAreaElement").do(this._handleSetHeaderCentralAreaElement.bind(this)));this.aDoables.push(s.on("/core/shellHeader/homeUri").do(this._updateHomeUri.bind(this)));this._updateHomeUri(s.last("/core/shellHeader/homeUri"));this.aDoables.push(o.on("updateHeaderOverflowState").do(this._handleHeadEndItemsOverflow.bind(this)));a.media.attachHandler(this._handleHeadEndItemsOverflow,this,a.media.RANGESETS.SAP_STANDARD);this.oHeadEndBinding=m.getModel().bindList("/header/headEndItems");this.oHeadEndBinding.attachChange(this._handleHeadEndItemsOverflow,this);r.attachActiveChanged(this._handleHeadEndItemsOverflow,this)},_handleSetHeaderCentralAreaElement:function(e){const{id:t,currentState:n,states:a}=e;if(n){u.updateCurrentState("header.centralAreaElement",E.Set,t)}else if(Array.isArray(a)){u.updateBaseStates(a,"header.centralAreaElement",E.Set,t)}else{u.updateAllBaseStates("header.centralAreaElement",E.Set,t)}},_addHeadEndItem:function(e,t,n){this._updateHeadEndItems(e,E.Add,t,n)},_removeHeadEndItem:function(e,t,n){this._updateHeadEndItems(e,E.Remove,t,n)},_updateHeadEndItems:function(e,t,n,a){if(n){u.updateCurrentState("header.headEndItems",t,e)}else if(Array.isArray(a)&&a.length>0){u.updateBaseStates(a,"header.headEndItems",t,e)}else{u.updateAllBaseStates("header.headEndItems",t,e)}},_handleHeadEndItemsOverflow:function(){const e=m.getModel().getProperty("/header/headEndItems");var n=e.indexOf(g)>-1;var i=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;if(i==="Phone"&&(r.isActive()||!n&&e.length>2)){this._addHeadEndItem(g,false,[p.Home,p.App]);this._moveNewExperienceToOverflow()}else if(i!=="Phone"&&n){var s=t.getElementById("headEndItemsOverflow");if(s){if(r.isActive()){const e=r.getOverflowItemControl();e.getParent()?.removeItem?.(e)}s.destroy()}this._removeHeadEndItem(g,false,[p.Home,p.App]);this._moveNewExperienceToShellHeader()}},_moveNewExperienceToOverflow:function(){if(r.isActive()){this._addHeadEndItem(r.getOverflowItemId(),false,[p.Home,p.App])}r.showInOverflow()},_moveNewExperienceToShellHeader:function(){if(r.isActive()){this._removeHeadEndItem(r.getOverflowItemId(),false,[p.Home,p.App])}r.showInShellHeader()},_updateHomeUri:function(e){var n=t.getElementById("shell-header");if(n){n.setHomeUri(e)}},pressNavBackButton:async function(){o.emit("showUserActionsMenu",false);f.navigateBack()},pressEndItemsOverflow:function(e){var n=t.getElementById("headEndItemsOverflow"),a=t.getElementById(e),r=Promise.resolve(),s;if(!a){return}if(!n){r=new Promise(function(e,t){sap.ui.require(["sap/ui/core/Fragment"],function(n){n.load({name:"sap.ushell.renderer.HeadEndItemsOverflowPopover",type:"XML",controller:this}).then(e).catch(t)}.bind(this),t)}.bind(this)).then(function(e){n=e;var a=t.getElementById("headEndItemsOverflowList");a.enhanceAccessibilityState=function(e,t){if(!e.isA("sap.ushell.ui.shell.OverflowListItem")){return t}if(e.getFloatingNumberType()!==v.None){t.describedby=e._oAriaDescribedbyText.getId()}return t};s=new i({headEndItems:m.getModel().getProperty("/header/headEndItems")});n.setModel(s)})}r.then(function(){if(n.isOpen()){n.close()}else{if(t.getElementById("shellNotificationsPopover")){o.emit("showNotifications",false)}n.openBy(a)}})},headEndItemsOverflowItemFactory:function(e,n){if(r.isActive()&&n.getObject()===r.getOverflowItemId()){return r.getOverflowItemControl()}var a=t.getElementById(n.getObject());var i=a.getBindingPath("floatingNumber");var s=a.getText();var o=a.getTooltip();var d=new l({id:e+"-"+a.getId(),icon:a.getIcon(),iconInset:true,tooltip:o!==s?o:null,title:s,type:c.Active,floatingNumber:i?{path:i}:undefined,floatingNumberMaxValue:a.getFloatingNumberMaxValue(),floatingNumberType:a.getFloatingNumberType(),visible:a.getVisible(),press:function(){if(a){a.firePress();var e=a.getTarget();if(e){h.getServiceAsync("Navigation").then(function(t){t.navigate({target:{shellHash:e}})})}}var n=t.getElementById("headEndItemsOverflow");if(n.isOpen()){n.close()}}});if(a._oAriaLabel){d.addAriaLabelledBy(a._oAriaLabel)}if(i){d.setModel(a.getModel())}return d},destroyHeadEndItemsOverflow:function(e){if(r.isActive()){const e=r.getOverflowItemControl();e.getParent()?.removeItem?.(e)}e.getSource().destroy()},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e)},isHeadEndItemNotInOverflow:function(e){var t=this.isHeadEndItemOverflow();var n=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;if(e==="ENDITEMSOVERFLOWBTN"){return t}if(!t){return true}if(["USERACTIONSMENUHEADERBUTTON","BACKBTN"].indexOf(e)>-1){return true}if(n==="Phone"){return false}if(["SF","FLOATINGCONTAINERBUTTON"].indexOf(e)>-1){return true}if(n==="Desktop"&&e==="COPILOTBTN"){return true}return false},isHeadEndItemOverflow:function(){var e=0,n,i=m.getModel().getProperty("/header/headEndItems");if(i.indexOf("endItemsOverflowBtn")===-1){return false}var r=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;var s=3;if(r==="Phone"){s=1}for(var o=0;o<i.length;o++){n=t.getElementById(i[o]);if(n&&n.getVisible()){e++}}if(t.getElementById("endItemsOverflowBtn").getVisible()){return e>s+1}return e>s},navigateFromShellApplicationNavigationMenu:function(e){if(window.hasher.getHash()!==e.substr(1)){o.emit("centerViewPort",Date.now());window.hasher.setHash(e)}var n=t.getElementById("shellAppTitle");if(n){n.close()}},onExit:function(){this.aDoables.forEach(function(e){e.off()});this.oHeadEndBinding.destroy();r.detachActiveChanged(this._handleHeadEndItemsOverflow,this)}})});
//# sourceMappingURL=ShellHeader.controller.js.map