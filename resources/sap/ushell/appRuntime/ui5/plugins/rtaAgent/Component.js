// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Component","sap/ui/core/EventBus","sap/ui/fl/initial/api/InitialFlexAPI","sap/ushell/api/RTA","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils","sap/ushell/appRuntime/ui5/plugins/baseRta/CheckConditions","sap/ushell/appRuntime/ui5/plugins/baseRta/Trigger"],function(t,e,i,n,s,r,o,a){"use strict";let u;function p(){return{sComponentName:"sap.ushell.appRuntime.ui5.plugins.rtaAgent",layer:"CUSTOMER",developerMode:false}}function l(t){return new Promise(function(e,i){u.postMessageToFlp("user.postapi.rtaPlugin","switchToolbarVisibility",{visible:t}).done(e).fail(i)})}function h(){return new Promise(function(t,e){u.postMessageToFlp("user.postapi.rtaPlugin","activatePlugin").done(t).fail(e)})}function c(){return o.checkUI5App().then(function(t){if(t){u.postMessageToFlp("user.postapi.rtaPlugin","showAdaptUI").fail(function(t){throw new Error(t)})}})}function d(){this.oTrigger.triggerStopRta(true,true)}return e.extend("sap.ushell.appRuntime.ui5.plugins.rtaAgent.Component",{metadata:{manifest:"json"},init:function(){this.mConfig=p();this._oPluginPromise=Promise.resolve();u=this.getComponentData().oPostMessageInterface;n.isKeyUser().then(function(t){if(t){return h()}return Promise.reject()}).then(function(){this.mConfig.i18n=this.getModel("i18n").getResourceBundle();this.mConfig.onStartHandler=this._onStartHandler.bind(this);this.mConfig.onErrorHandler=this._onErrorHandler.bind(this);this.mConfig.onStopHandler=this._onStopHandler.bind(this);this.oTrigger=new a(this.mConfig);return this.oTrigger.getInitPromise()}.bind(this)).then(function(){this._registerPostMessages();return this._restartRtaIfRequired()}.bind(this)).then(function(){return r.getAppLifeCycleService()}).then(function(t){t.attachAppLoaded(this._onAppLoaded,this)}.bind(this)).then(c).catch(function(e){if(e){t.error(e)}})},getPluginPromise:function(){return this._oPluginPromise},_registerPostMessages:function(){u.registerPostMessageAPIs({"user.postapi.rtaPlugin":{inCalls:{startUIAdaptation:{executeServiceCallFn:function(){i.getInstance().subscribe("sap.ushell","appClosed",d.bind(this));s.addTopHeaderPlaceHolder();this.oTrigger.triggerStartRta(this);return u.createPostMessageResult()}.bind(this)}},outCalls:{activatePlugin:{},showAdaptUI:{}}}})},_restartRtaIfRequired:function(){return o.checkUI5App().then(function(t){if(t){if(o.checkRestartRTA(this.mConfig.layer)){return l(false).then(function(){s.addTopHeaderPlaceHolder();return this.oTrigger.triggerStartRta(this)}.bind(this))}}return undefined}.bind(this))},_onAppLoaded:function(){o.checkUI5App().then(function(t){if(t){this._restartRtaIfRequired().then(function(){return c()})}}.bind(this))},_onStopHandler:function(){this._exitAdaptation()},_onStartHandler:function(){},_onErrorHandler:function(){this._exitAdaptation()},_exitAdaptation:function(){i.getInstance().unsubscribe("sap.ushell","appClosed",d.bind(this));l(true);this.oTrigger.exitRta();s.removeTopHeaderPlaceHolder()},exit:function(){i.getInstance().unsubscribe("sap.ushell","appClosed",d.bind(this));l(true);this._oPluginPromise=this._oPluginPromise.then(r.getAppLifeCycleService.bind(r)).then(function(t){t.detachAppLoaded(this._onAppLoaded,this)}.bind(this))}})});
//# sourceMappingURL=Component.js.map