// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/appRuntime/ui5/services/Container","sap/ushell/appRuntime/ui5/AppCommunicationMgr","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/ui/thirdparty/URI","sap/base/Log"],function(e,t,n,i,s){"use strict";var r;function u(){this.init=function(){t.registerCommHandlers({"sap.ushell.sessionHandler":{oServiceCalls:{beforeApplicationHide:{executeServiceCallFn:function(e){return Promise.resolve()}},afterApplicationShow:{executeServiceCallFn:function(e){return Promise.resolve()}},logout:{executeServiceCallFn:function(e){return r.handleLogoutEvent(e)}},extendSessionEvent:{executeServiceCallFn:function(e){return r.handleExtendSessionEvent(e)}}}}});this.attachUserEvents();this.userActivityHandler()};this.handleLogoutEvent=function(){return new Promise((t,n)=>{r.detachUserEvents();e.getFLPUrlAsync(true).then(function(i){if(r.isSameDomain(i,document.URL)===false){e.logout().then(t,n)}else{t()}})})};this.isSameDomain=function(e,t){var n,r,u=false;if(e===undefined||t===undefined){return false}try{n=new i(e);r=new i(t);if(n.origin()===r.origin()){u=true}}catch(n){s.error("Check for same domain of iframe and FLP failed: "+e+" "+t,n,"sap.ushell.appRuntime.ui5.SessionHandlerAgent")}return u};this.handleExtendSessionEvent=function(){e.sessionKeepAlive();return Promise.resolve()};this.attachUserEvents=function(){document.addEventListener("mousedown",this.userActivityHandler);document.addEventListener("mousemove",this.userActivityHandler);document.addEventListener("keyup",this.userActivityHandler);document.addEventListener("touchstart",this.userActivityHandler)};this.detachUserEvents=function(){document.removeEventListener("mousedown",this.userActivityHandler);document.removeEventListener("mousemove",this.userActivityHandler);document.removeEventListener("keyup",this.userActivityHandler);document.removeEventListener("touchstart",this.userActivityHandler)};this.userActivityHandler=function(e){if(r.oUserActivityTimer!==undefined){return}r.oUserActivityTimer=setTimeout(function(){n.postMessageToFLP("sap.ushell.sessionHandler.notifyUserActive",{});r.oUserActivityTimer=undefined},1e4)}}var o=new u;r=o;return o});
//# sourceMappingURL=SessionHandlerAgent.js.map