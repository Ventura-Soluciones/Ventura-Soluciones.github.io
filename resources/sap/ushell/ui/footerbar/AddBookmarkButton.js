// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/ButtonRenderer","sap/m/Dialog","sap/m/library","sap/m/MessageBox","sap/m/Text","sap/m/VBox","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/state/StateManager"],function(e,t,o,i,r,s,a,n,l,u,p,d,h,c,g,f){"use strict";var y=r.ButtonType;var m=l.ValueState;var v=l.mvc.ViewType;const b=f.LaunchpadState;const S=f.ShellMode;const{Headerless:k,Standalone:T,Embedded:M,Merged:B}=S;var P=t.extend("sap.ushell.ui.footerbar.AddBookmarkButton",{metadata:{library:"sap.ushell",properties:{beforePressHandler:{type:"function",group:"Misc",defaultValue:null},afterPressHandler:{type:"function",group:"Misc",defaultValue:null},title:{type:"string",group:"Misc",defaultValue:null},subtitle:{type:"string",group:"Misc",defaultValue:null},info:{type:"string",group:"Misc",defaultValue:null},tileIcon:{type:"string",group:"Appearance",defaultValue:null},numberUnit:{type:"string",group:"Appearance",defaultValue:null},keywords:{type:"string",group:"Misc",defaultValue:null},customUrl:{type:"any",group:"Misc",defaultValue:null},serviceUrl:{type:"any",group:"Misc",defaultValue:null},dataSource:{type:"any",group:"Misc",defaultValue:null},serviceRefreshInterval:{type:"string",group:"Misc",defaultValue:null},showGroupSelection:{type:"boolean",group:"Misc",defaultValue:true},showPageSelection:{type:"boolean",group:"Misc",defaultValue:true},appData:{type:"object",group:"Misc",defaultValue:null,deprecated:true}}},renderer:o});P.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this,arguments)}this.bSpaceEnabled=h.last("/core/spaces/enabled");this.bMyHomeEnabled=h.last("/core/spaces/myHome/enabled");this.setIcon("sap-icon://add-favorite");this.setText(g.i18n.getText("addToHomePageBtn"));this.setEnabled();this.oModel=new d({showGroupSelection:true,showPageSelection:true,title:"",subtitle:"",numberValue:0,info:"",icon:"",numberUnit:"",keywords:""});this.attachPress(function(){var e=this.getBeforePressHandler();if(e){e()}this.showAddBookmarkDialog()}.bind(this))};P.prototype.exit=function(){if(this.oDialog){this.oDialog.destroy()}if(this.oModel){this.oModel.destroy()}if(t.prototype.exit){t.prototype.exit.apply(this,arguments)}};P.prototype.setBookmarkTileView=function(e){this.bookmarkTileView=e};P.prototype.getBookmarkTileView=function(){return this.bookmarkTileView};P.prototype.showAddBookmarkDialog=function(){var e=this.getAppData()||{};var t={serviceUrl:this.getServiceUrl()||e.serviceUrl,customUrl:this.getCustomUrl()||e.customUrl};this.oModel.setProperty("/serviceUrl",!!t.serviceUrl);var o;if(this.bSpaceEnabled){o=u.create({type:v.XML,viewName:"sap.ushell.ui.bookmark.SaveOnPage",viewData:t})}else{o=u.create({viewName:"module:sap/ushell/ui/footerbar/SaveAsTile.view",viewData:t})}return o.then(function(e){this.setBookmarkTileView(e);e.setModel(this.oModel);return new Promise(function(t,o){sap.ui.require(["sap/ui/layout/form/SimpleForm","sap/ui/layout/library"],function(o,i){this.oSimpleForm=new o({id:"bookmarkFormId",layout:i.form.SimpleFormLayout.ResponsiveGridLayout,content:[e],editable:true}).addStyleClass("sapUshellAddBookmarkForm");t(this._openDialog(this.oSimpleForm))}.bind(this))}.bind(this))}.bind(this))};P.prototype._openDialog=function(e){this.oDialog=new i({id:"bookmarkDialog",title:g.i18n.getText("addToHomePageBtn"),contentWidth:"25rem",content:e,beginButton:new t("bookmarkOkBtn",{text:g.i18n.getText("saveBtn"),type:y.Emphasized,press:[this._handleOKButtonPress,this]}),endButton:new t("bookmarkCancelBtn",{text:g.i18n.getText("cancelBtn"),press:[this._handleCancelButtonPress,this]}),stretch:p.system.phone,horizontalScrolling:false,afterClose:function(){var e=this.getAfterPressHandler();if(e){e()}this._restoreDialogEditableValuesToDefault();this.oDialog.destroy();delete this.oDialog}.bind(this)}).addStyleClass("sapContrastPlus");this.oDialog.open();return this.oDialog};P.prototype._handleOKButtonPress=function(){if(this.oDialog.getBusy()){return}if(!this.bSpaceEnabled){this._handleOKButtonPressClassicMode();return}this._handleOKButtonPressSpacesMode()};P.prototype._handleCancelButtonPress=function(){if(!this.bSpaceEnabled){this._handleCancelButtonPressClassicMode();return}this._handleCancelButtonPressSpacesMode()};P.prototype.setTitle=function(e){this.setProperty("title",e,true);this.oModel.setProperty("/title",e);return this};P.prototype.setSubtitle=function(e){this.setProperty("subtitle",e,true);this.oModel.setProperty("/subtitle",e);return this};P.prototype.setInfo=function(e){this.setProperty("info",e,true);this.oModel.setProperty("/info",e);return this};P.prototype.setTileIcon=function(e){this.setProperty("tileIcon",e,true);this.oModel.setProperty("/icon",e);return this};P.prototype.setShowGroupSelection=function(e){this.setProperty("showGroupSelection",e,true);this.oModel.setProperty("/showGroupSelection",e);return this};P.prototype.setNumberUnit=function(e){this.setProperty("numberUnit",e,true);this.oModel.setProperty("/numberUnit",e);return this};P.prototype.setServiceRefreshInterval=function(e){this.setProperty("serviceRefreshInterval",e,true);this.oModel.setProperty("/serviceRefreshInterval",e);return this};P.prototype.setDataSource=function(e){this.setProperty("dataSource",e,true);this.oModel.setProperty("/dataSource",e);return this};P.prototype.setKeywords=function(e){this.setProperty("keywords",e,true);this.oModel.setProperty("/keywords",e);return this};P.prototype.setAppData=function(e){this.setProperty("appData",e,true);var t=["showGroupSelection","title","subtitle","info","icon","numberUnit","keywords","serviceRefreshInterval","dataSource"];var o=["showInfo","showPreview"];Object.keys(e).forEach(function(i){if(t.indexOf(i)>-1){var r=i==="icon"?"tileIcon":i;this.setProperty(r,e[i],true)}if(t.indexOf(i)>-1||o.indexOf(i)>-1){this.oModel.setProperty("/"+i,e[i])}}.bind(this));return this};P.prototype._restoreDialogEditableValuesToDefault=function(){if(this.oModel){this.oModel.setProperty("/title",this.getTitle());this.oModel.setProperty("/subtitle",this.getSubtitle());this.oModel.setProperty("/info",this.getInfo())}};P.prototype._handleCancelButtonPressSpacesMode=function(){var e=this.getBookmarkTileView().getController();var t=e.getBookmarkTileData();if(t.title||t.subtitle||t.info||t.contentNodes.length){var o=g.i18n.getText("SaveAsTileDialog.MessageBox.Action.Discard");var i=g.i18n.getText("SaveAsTileDialog.MessageBox.Message.Discard");var r=g.i18n.getText("SaveAsTileDialog.MessageBox.Title.Discard");s.show(i,{title:r,actions:[o,s.Action.CANCEL],emphasizedAction:o,onClose:function(e){if(e===o){this.oDialog.close()}}.bind(this)})}else{this.oDialog.close()}};P.prototype._handleOKButtonPressSpacesMode=function(){var t=this.getBookmarkTileView().getController();var o=t.getBookmarkTileData();var i=true;if(o.contentNodes.length===0){var r=t.byId("SelectedNodesComboBox");if(r){r.setValueState(m.Error);r.setValueStateText(g.i18n.getText("bookmarkPageSelectError"));i=false}}if(!o.title||o.title.length<1){var s=t.byId("bookmarkTitleInput");if(s){s.setValueState(m.Error);s.setValueStateText(g.i18n.getText("bookmarkTitleInputError"));i=false}}if(!i){sap.ushell.Container.getServiceAsync("MessageInternal").then(function(e){e.info(g.i18n.getText("SaveAsTileDialog.MessageToast.ValidationFailed"))});return}this.oDialog.setBusy(true);this.oDialog.close();var a=sap.ushell.Container.getServiceAsync("BookmarkV2");var n=o.contentNodes.map(function(t){return a.then(function(e){return e.addBookmark(o,t)}).then(function(){return{pageId:t.id,status:"resolved"}}).catch(function(o){e.error("Failed to add one a bookmark: ",o,"sap.ushell.ui.footerbar.AddBookmarkButton");return{pageId:t.id,error:o,status:"failed"}})});Promise.all(n).then(function(e){sap.ushell.Container.getServiceAsync("MessageInternal").then(function(t){var i=e.filter(function(e){return e.status==="resolved"}).length;var r=e.filter(function(e){return e.status==="failed"});if(i===1){t.info(g.i18n.getText("SaveAsTileDialog.MessageToast.TileCreatedInPage"))}else if(i>1){t.info(g.i18n.getText("SaveAsTileDialog.MessageToast.TileCreatedInPages"))}if(r.length){this._showErrorDialog(r,i,o.title)}}.bind(this))}.bind(this))};P.prototype._showErrorDialog=function(e,t,o){sap.ushell.Container.getServiceAsync("MessageInternal").then(function(i){var r;var s;if(e.length===1){if(t===0){r=g.i18n.getText("SaveAsTileDialog.MessageBox.SinglePageError")}else{r=g.i18n.getText("SaveAsTileDialog.MessageBox.OnePageError")}s=g.i18n.getText("SaveAsTileDialog.MessageBox.PageErrorDetail",[o,e[0].pageId])}else if(e.length>1){if(t===0){r=g.i18n.getText("SaveAsTileDialog.MessageBox.AllPagesError")}else{r=g.i18n.getText("SaveAsTileDialog.MessageBox.SomePagesError")}var l=e.map(function(e){return e.pageId}).join("\n");s=g.i18n.getText("SaveAsTileDialog.MessageBox.PagesErrorDetail",[o,l])}var u=new n({items:[new a({text:s}).addStyleClass("sapUiSmallMarginBottom"),new a({text:e.map(function(e){return e.error}).join("\n")}).addStyleClass("sapUiSmallMarginBottom"),new a({text:g.i18n.getText("SaveAsTileDialog.MessageBox.PageErrorSolution")})]});i.errorWithDetails(r,u)})};P.prototype._handleCancelButtonPressClassicMode=function(){this.oDialog.close()};P.prototype._handleOKButtonPressClassicMode=function(){var t=this.getBookmarkTileView();var o=t.getController();var i=o.getBookmarkTileData();if(!i.title||i.title.length<1){var r=t.getTitleInput();if(r){r.setValueState(m.Error);r.setValueStateText(g.i18n.getText("bookmarkTitleInputError"));return Promise.reject()}}this.oDialog.setBusy(true);this.oDialog.close();var s=i.group?i.group.object:"";delete i.group;return Promise.all([sap.ushell.Container.getServiceAsync("BookmarkV2"),sap.ushell.Container.getServiceAsync("MessageInternal")]).then(function(t){var o=t[0];var r=t[1];return o.addBookmark(i,s).then(function(){r.info(g.i18n.getText("tile_created_msg"))}).catch(function(t){e.error("Failed to add bookmark",t,"sap.ushell.ui.footerbar.AddBookmarkButton");r.error(g.i18n.getText("fail_to_add_tile_msg"))})})};P.prototype.setEnabled=function(o){var i=true;const r=f.getLaunchpadState();const s=f.getShellMode();if(sap.ushell.Container){var a=h.last("/core/shell/enablePersonalization");if(a!==undefined){i=a}if(!i&&this.bSpaceEnabled&&this.bMyHomeEnabled){i=true}}if(!i||r===b.App&&[k,T,M,B].includes(s)){o=false}if(!sap.ushell.Container){if(this.getEnabled()){e.warning("Disabling 'Save as Tile' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.AddBookmarkButton")}o=false}t.prototype.setEnabled.call(this,o);if(!o){this.addStyleClass("sapUshellAddBookmarkButton")}};return P});
//# sourceMappingURL=AddBookmarkButton.js.map