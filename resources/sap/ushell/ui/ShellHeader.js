// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/theming/Parameters","sap/ui/Device","sap/ui/dom/units/Rem","sap/base/Log","sap/ushell/api/NewExperience","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/ShellHeaderRenderer","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/state/StateManager","sap/ushell/Container","sap/ui/events/KeyCodes"],(e,t,o,i,n,s,a,r,l,h,u,g,d,c,p,f,m,y)=>{"use strict";const L=f.ShellMode;const S="sapUshellShellShowSearchOverlay";let v=0;let R,_;const E=sap.ui.require.toUrl("sap/ushell/themes/base/img/SAPLogo.svg");const F=t.extend("sap.ushell.ui.ShellHeader",{metadata:{library:"sap.ushell",properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},showLogo:{type:"boolean",defaultValue:true},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string"},centralAreaElement:{type:"string",defaultValue:null},showNewExperienceSwitch:{type:"boolean",defaultValue:false},title:{type:"string",defaultValue:""}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ui.core.Control",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{},events:{searchSizeChanged:{}}},renderer:d});F.prototype.setHomeUri=function(e){if(p.hasInvalidProtocol(e)){a.fatal("Tried to set a URL with an invalid protocol as the home uri. Setting to an empty string instead.",null,"sap/ushell/ui/ShellHeader");e=""}this._bHomeIsRoot=c.isRootIntent(e);return this.setProperty("homeUri",e)};F.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};F.prototype.FLPRangeSet={name:"Ushell",rangeBorders:[600,1024,1440,1920],rangeNames:["Phone","Tablet","Desktop","LargeDesktop","ExtraLargeDesktop"]};F.prototype.init=function(){n.media.initRangeSet(this.FLPRangeSet.name,this.FLPRangeSet.rangeBorders,"px",this.FLPRangeSet.rangeNames);n.media.attachHandler(this.invalidate,this,this.FLPRangeSet.name);n.resize.attachHandler(this.refreshLayout,this);this.getCustomLogoAltText();l.once("ShellNavigationInitialized").do(()=>{m.getServiceAsync("ShellNavigationInternal").then(e=>{this._rerenderLogoNavigationFilterBound=this._rerenderLogoNavigationFilter.bind(this,e);e.registerNavigationFilter(this._rerenderLogoNavigationFilterBound);this._rerenderLogoNavigationFilterBound.detach=function(){e.unregisterNavigationFilter(this._rerenderLogoNavigationFilterBound)}})});this._oLastFocusedHeaderElement=null;this._oEventDelegate={onfocusin:this._handleOnFocusIn,onkeydown:this._handleOnKeyDown,onBeforeFastNavigationFocus:this._handleOnBeforeFastNavigationFocus};this.addEventDelegate(this._oEventDelegate,this)};F.prototype.exit=function(){n.media.detachHandler(this.invalidate,this,this.FLPRangeSet.name);n.resize.detachHandler(this.refreshLayout,this);if(this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter){this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter.detach()}this.removeEventDelegate(this._oEventDelegate);delete this._oEventDelegate};F.prototype.setFocusOnShellHeader=function(e){if(e){const e=this.getHeadEndItems();if(e.length>0){e[e.length-1].focus()}else{this.getAppTitle().focus()}}else{const e=this.getHeadItems();if(e.length>0){e[0].focus()}else{this.getAppTitle().focus()}}};F.prototype.onsapspace=function(e){if(e.target===this.getDomRef("logo")){this._setLocationHref(e.target.href)}};F.prototype._setLocationHref=function(e){if(p.hasInvalidProtocol(e)){a.fatal("Tried to navigate to URL with an invalid protocol. Preventing navigation.",null,"sap/ushell/ui/ShellHeader");return}window.location.href=e};F.prototype.onAfterRendering=function(){const e=this.getDomRef();if(!R&&document.body.getBoundingClientRect().height===0){e.style.visibility="hidden";e.style.height="2.75rem";return}this.refreshLayout()};F.prototype._handleOnKeyDown=function(e){if(e.keyCode!==y.ARROW_RIGHT&&e.keyCode!==y.ARROW_LEFT){return}this._handleArrowNavigation(e)};F.prototype._handleArrowNavigation=function(e){const t=this.getDomRef();const o=document.activeElement;if(!o||!t.contains(o)||o.tagName==="INPUT"||o.tagName==="TEXTAREA"){return}const i=this._getFocusableHeaderItems();let n;let s=i.indexOf(o);if(s<0&&this._oLastFocusedHeaderElement){s=i.indexOf(this._oLastFocusedHeaderElement)}if(s>=0){const t=e.keyCode===y.ARROW_RIGHT?s+1:s-1;n=i[t]}if(!n){if(document.getElementById("shell-header-logo")){document.getElementById("shell-header-logo").focus();return}this.setFocusOnShellHeader();return}n.focus()};F.prototype._handleOnFocusIn=function(){const e=document.activeElement;this._oLastFocusedHeaderElement=e};F.prototype._getFocusableHeaderItems=function(){const t=this.getDomRef();const o=Array.from(t.querySelectorAll("*:is(input, textarea, select, button, a, [tabindex])")).filter(e=>!e.disabled&&!e.hidden&&(e.checkVisibility?.()??true)&&e.getAttribute("tabindex")!=="-1");if(e.getRTL()){return o.reverse()}return o};F.prototype._handleOnBeforeFastNavigationFocus=function(e){e.preventDefault();const t=this._getFocusableHeaderItems();if(this._oLastFocusedHeaderElement&&t.includes(this._oLastFocusedHeaderElement)){this._oLastFocusedHeaderElement.focus();return}this._oLastFocusedHeaderElement=null;if(document.getElementById("shell-header-logo")){document.getElementById("shell-header-logo").focus()}else{this.setFocusOnShellHeader()}};F.prototype.onThemeChanged=function(e){let t=false;if(R!==e.theme){R=e.theme;t=true}if(_!==this.getLogo()){_=this.getLogo();t=true}if(t){this.invalidate()}};F.prototype.getLogo=function(){const e=this.getCustomCompanyLogoUrl();if(e!==""){return e}if(this.getProperty("logo")!==""){return this.getProperty("logo")}const t=i.get({name:"sapUiGlobalLogo",callback:()=>{this.invalidate()}});if(t==="none"){return E}if(t){const e=/url[\s]*\('?"?([^'")]*)'?"?\)/.exec(t);if(e){return e[1]}}return undefined};F.prototype.getCustomCompanyLogoUrl=function(){return h.last("/core/companyLogo/url")};F.prototype.getCustomLogoAltText=function(){const t=h.last("/core/companyLogo/accessibleText");let o;delete this._sCustomAltText;if(t){try{const i=JSON.parse(t);if(i){o=e.getLanguage();this._sCustomAltText=i[o];if(!this._sCustomAltText){Object.keys(i).forEach(e=>{if(e.indexOf(o)===0){this._sCustomAltText=i[e]}})}if(!this._sCustomAltText){Object.keys(i).forEach(e=>{if(o.indexOf(e)===0){this._sCustomAltText=i[e]}})}if(!this._sCustomAltText){this._sCustomAltText=i.default}}}catch(e){a.warning("Custom logo image ALT text is not a JSON string.",t);this._sCustomAltText=t}}};F.prototype.getLogoAltText=function(e){if(!e){return""}if(e===E){return g.i18n.getText("sapLogoText")}return this._sCustomAltText||g.i18n.getText("SHELL_LOGO_TOOLTIP")};F.prototype.refreshLayout=function(){if(!this.getDomRef()){return}if(this.getSearchVisible()){const e=this.getDomRef("hdr-search");e.style.display="none";this._hideElementsForSearch();e.style.display="";e.style["max-width"]=`${v}rem`;this.fireSearchSizeChanged({remSize:s.fromPx(e.getBoundingClientRect().width),isFullWidth:this.isPhoneState()||this.getDomRef("hdr-end").style.display==="none"})}};F.prototype.removeHeadItem=function(e){if(typeof e==="number"){e=this.getHeadItems()[e]}this.removeAggregation("headItems",e)};F.prototype.isExtraLargeState=function(){return n.media.getCurrentRange(this.FLPRangeSet.name).from===this.FLPRangeSet.rangeBorders[3]};F.prototype.isMediumOrBiggerState=function(){return n.media.getCurrentRange(this.FLPRangeSet.name).from>=this.FLPRangeSet.rangeBorders[0]};F.prototype.isPhoneState=function(){const e=n.media.getCurrentRange(n.media.RANGESETS.SAP_STANDARD).name;const t=this.getDomRef().getBoundingClientRect().width>v;return n.system.phone||e==="Phone"||!t};F.prototype.setSearchState=function(e,t,o){if(this.SearchState[e]&&this.getSearchState()!==e){if(typeof t==="boolean"){o=t;t=undefined}this.setProperty("searchState",e,false);const i=e!=="COL";document.body.classList.toggle(S,i&&o);v=i?t||35:0}};F.prototype._hideElementsForSearch=function(){if(this.isExtraLargeState()){return}let e;const t=this.getDomRef("hdr-search-container");const o=this.getDomRef("hdr-begin");const i=this.getDomRef("hdr-center");const n=this.getDomRef("hdr-end");if(this.getSearchState()==="EXP"||this.isPhoneState()){e=s.toPx(v+3)}else{e=s.toPx(9+.5)}const a=[o];Array.prototype.forEach.call(o.childNodes,e=>{a.unshift(e)});if(i){a.unshift(i)}o.style.flexBasis="";n.style.display="";a.forEach(e=>{if(e.getAttribute("id")==="shellAppTitle"){e.classList.remove("sapUiPseudoInvisibleText")}else{e.style.display=""}});let r;for(let n=0;n<a.length;n++){r=a[n];if(e>t.getBoundingClientRect().width){if(r.getAttribute("id")==="shellAppTitle"){r.classList.add("sapUiPseudoInvisibleText")}else{r.style.display="none";if(i&&n===0){o.style.flexBasis="auto"}}}else{return}}if(s.toPx(v)>t.getBoundingClientRect().width){n.style.display="none"}};F.prototype.getSearchWidth=function(){return v};F.prototype.isHomepage=function(){const e=window.hasher&&`#${window.hasher.getHash()}`||"";const t=new RegExp("[?]"+"(?:"+"(?!&[/])."+")*");const o=e.replace(t,"");return c.isRootIntent(o)||o==="#Launchpad-openFLPPage"};F.prototype._rerenderLogoNavigationFilter=function(e,t,o){const i=e.hashChanger.isInnerAppNavigation(t,o);if(i){this.invalidate()}return e.NavigationFilterStatus.Continue};F.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL};F.prototype.getCentralControl=function(){return o.getElementById(this.getCentralAreaElement())};F.prototype.setNoLogo=function(){this.setLogo(undefined)};F.prototype._getLeanMode=function(){return f.getShellMode()===L.Lean};F.prototype.getNewExperienceSwitchControl=function(){if(!r.isActive()){return}if(this.getShowNewExperienceSwitch()){return r.getShellHeaderControl()}};return F});
//# sourceMappingURL=ShellHeader.js.map