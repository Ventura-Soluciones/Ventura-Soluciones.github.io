// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["./AnchorNavigationBarRenderer","sap/base/i18n/Localization","sap/base/util/isEmptyObject","sap/m/Bar","sap/m/Button","sap/ui/core/Element","sap/ui/core/ResizeHandler","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/library","sap/ushell/resources"],function(e,t,s,i,o,r,l,n,jQuery,h,a){"use strict";var f=i.extend("sap.ushell.ui.launchpad.AnchorNavigationBar",{metadata:{library:"sap.ushell",properties:{accessibilityLabel:{type:"string",defaultValue:null},selectedItemIndex:{type:"int",group:"Misc",defaultValue:0},overflowEnabled:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{groups:{type:"sap.ushell.ui.launchpad.AnchorItem",multiple:true,singularName:"group"}},events:{afterRendering:{},itemPress:{}}},renderer:e});f.prototype.init=function(){this.bGroupWasPressed=false;this.bIsRtl=t.getRTL();this._bIsRenderedCompletely=false;this.fnNavigationBarItemsVisibility=this.setNavigationBarItemsVisibility.bind(this);this.fnAdjustVisibleAnchorItemsAccessibility=this.adjustVisibleAnchorItemsAccessibility.bind(this)};f.prototype.onBeforeRendering=function(){if(this._sResizeListenerId){l.deregister(this._sResizeListenerId);this._sResizeListenerId=null}var e=window.document.getElementsByClassName("sapUshellAnchorNavigationBarItemsScroll")[0];if(e){e.removeEventListener("scroll",this.fnNavigationBarItemsVisibility)}};f.prototype.onAfterRendering=function(){var e=this.getDomRef();if(this._bIsRenderedCompletely){this.reArrangeNavigationBarElements();this.adjustVisibleAnchorItemsAccessibility();var t=window.document.getElementsByClassName("sapUshellAnchorNavigationBarItemsScroll")[0];if(t){t.addEventListener("scroll",this.fnNavigationBarItemsVisibility)}if(e){this._sResizeListenerId=l.register(e,this.reArrangeNavigationBarElements.bind(this))}}};f.prototype.openOverflowPopup=function(){var e=jQuery(".sapUshellAnchorItemOverFlow").hasClass("sapUshellAnchorItemOverFlowOpen");if(this.oOverflowButton&&!e){this.oOverflowButton.firePress()}};f.prototype.closeOverflowPopup=function(){if(this.oPopover){this.oPopover.close()}};f.prototype.reArrangeNavigationBarElements=function(){this.anchorItems=this.getVisibleGroups();var e=this.getSelectedItemIndex()||0;if(this.anchorItems.length){this.adjustItemSelection(e)}if(n.system.phone&&this.anchorItems.length){this.anchorItems.forEach(function(e){e.setIsGroupVisible(false)});this.anchorItems[this.getSelectedItemIndex()].setIsGroupVisible(true)}else{setTimeout(function(){if(this.isDestroyed()){return}this.setNavigationBarItemsVisibility()}.bind(this),200)}};f.prototype._scrollToGroupByGroupIndex=function(e,t){var s=n.system.tablet?".sapUshellAnchorNavigationBarItemsScroll":".sapUshellAnchorNavigationBarItems";var i=document.documentElement.querySelector(s);var o=this.anchorItems[e].getDomRef();if(i&&o){var r=i.getBoundingClientRect();var l=o.getBoundingClientRect();var h=jQuery(i);var a=this.bIsRtl?h.scrollLeftRTL():i.scrollLeft;var f;if(l.left<r.left){f=l.left-r.left-16}else if(l.right>r.right){f=l.right-r.right+16}if(f){if(this.bIsRtl){h.scrollLeftRTL(a+f)}else{i.scrollLeft=a+f}}this.setNavigationBarItemsVisibility()}};f.prototype.setNavigationBarItemsVisibility=function(){if(!n.system.phone){this.setNavigationBarItemsVisibilityOnDesktop()}else if(this.anchorItems&&this.anchorItems.length>0){this.oOverflowButton.removeStyleClass("sapUshellShellHidden");var e=this.getSelectedItemIndex()||0;if(this.oPopover){this.oPopover.setTitle(this.anchorItems[e].getTitle())}}};f.prototype.setNavigationBarItemsVisibilityOnDesktop=function(){if(this.anchorItems.length&&(!this.isMostRightAnchorItemVisible()||!this.isMostLeftAnchorItemVisible())){this.oOverflowButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowButton){this.oOverflowButton.addStyleClass("sapUshellShellHidden")}if(this.bIsRtl){if(this.anchorItems.length&&!this.isMostLeftAnchorItemVisible()){this.oOverflowRightButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowRightButton){this.oOverflowRightButton.addStyleClass("sapUshellShellHidden")}if(this.anchorItems.length&&!this.isMostRightAnchorItemVisible()){this.oOverflowLeftButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowLeftButton){this.oOverflowLeftButton.addStyleClass("sapUshellShellHidden")}}else{if(this.anchorItems.length&&!this.isMostLeftAnchorItemVisible()){this.oOverflowLeftButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowLeftButton){this.oOverflowLeftButton.addStyleClass("sapUshellShellHidden")}if(this.anchorItems.length&&!this.isMostRightAnchorItemVisible()){this.oOverflowRightButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowRightButton){this.oOverflowRightButton.addStyleClass("sapUshellShellHidden")}}};f.prototype.adjustItemSelection=function(e){setTimeout(function(){if(this.anchorItems&&this.anchorItems.length){this.anchorItems.forEach(function(e){e.setSelected(false)});if(e>=0&&e<this.anchorItems.length){this.anchorItems[e].setSelected(true);this._scrollToGroupByGroupIndex(e)}}}.bind(this),50)};f.prototype.isMostRightAnchorItemVisible=function(){var e=jQuery(".sapUshellAnchorNavigationBarInner"),t=!s(e)?e.width():0,i=!s(e)&&e.offset()?e.offset().left:0,o=this.bIsRtl?this.anchorItems[0].getDomRef():this.anchorItems[this.anchorItems.length-1].getDomRef(),r=!s(o)?jQuery(o).width():0,l;if(r<0){r=80}l=o&&jQuery(o).offset()?jQuery(o).offset().left:0;return Math.ceil(l)+r<=i+t};f.prototype.isMostLeftAnchorItemVisible=function(){var e=jQuery(".sapUshellAnchorNavigationBarInner"),t=!s(e)&&e.offset()&&e.offset().left||0,i=this.bIsRtl?this.anchorItems[this.anchorItems.length-1].getDomRef():this.anchorItems[0].getDomRef(),o=!s(i)&&jQuery(i).offset()?jQuery(i).offset().left:0;return Math.ceil(o)>=t};f.prototype.setSelectedItemIndex=function(e){if(e!==undefined){this.setProperty("selectedItemIndex",e,true)}};f.prototype.setOverflowEnabled=function(e){this.setProperty("overflowEnabled",e);if(this.oOverflowButton){this.oOverflowButton.setEnabled(e)}};f.prototype._getOverflowLeftArrowButton=function(){if(!this.oOverflowLeftButton){this.oOverflowLeftButton=new o({icon:"sap-icon://slim-arrow-left",tooltip:a.i18n.getText("scrollToTop"),press:function(){this._scrollToGroupByGroupIndex(0)}.bind(this)}).addStyleClass("sapUshellShellHidden");this.oOverflowLeftButton._bExcludeFromTabChain=true}return this.oOverflowLeftButton};f.prototype._getOverflowRightArrowButton=function(){if(!this.oOverflowRightButton){this.oOverflowRightButton=new o({icon:"sap-icon://slim-arrow-right",tooltip:a.i18n.getText("scrollToEnd"),press:function(){this._scrollToGroupByGroupIndex(this.anchorItems.length-1)}.bind(this)}).addStyleClass("sapUshellShellHidden");this.oOverflowRightButton._bExcludeFromTabChain=true}return this.oOverflowRightButton};f.prototype._getOverflowButton=function(){if(!this.oOverflowButton){this.oOverflowButton=new o("sapUshellAnchorBarOverflowButton",{icon:"sap-icon://slim-arrow-down",tooltip:a.i18n.getText("more_groups"),enabled:this.getOverflowEnabled(),press:function(){this._togglePopover()}.bind(this)}).addStyleClass("sapUshellShellHidden")}return this.oOverflowButton};f.prototype._togglePopover=function(){sap.ui.require(["sap/m/Popover","sap/ui/model/Filter","sap/ushell/ui/launchpad/GroupListItem","sap/m/List","sap/m/library"],function(e,s,i,o,l){var n=l.ListMode;if(!this.oPopover){this.oList=new o({mode:n.SingleSelectMaster,rememberSelections:false,selectionChange:function(e){this.fireItemPress({group:e.getParameter("listItem")});this.oPopover.close()}.bind(this)});this.oPopover=new e("sapUshellAnchorBarOverflowPopover",{showArrow:false,showHeader:false,placement:"Left",content:[this.oList],horizontalScrolling:false,beforeOpen:function(){var e=jQuery(".sapUshellAnchorItemOverFlow"),s=t.getRTL(),i=s?-1*e.outerWidth():e.outerWidth();this.setOffsetX(i)},afterClose:function(){jQuery(".sapUshellAnchorItemOverFlow").removeClass("sapUshellAnchorItemOverFlowOpen");jQuery(".sapUshellAnchorItemOverFlow").toggleClass("sapUshellAnchorItemOverFlowPressed",false)}}).addStyleClass("sapUshellAnchorItemsPopover").addStyleClass("sapContrastPlus")}if(this.oPopover.isOpen()){this.oPopover.close()}else{this.anchorItems=this.getVisibleGroups();this.oList.setModel(this.getModel());var h=this.getModel().getProperty("/tileActionModeActive");var a=new s("","EQ","a");a.fnTest=function(e){if(!e.visibilityModes[h?1:0]){return false}return e.isGroupVisible||h};this.oList.bindItems({path:"/groups",template:new i({title:"{title}",groupId:"{groupId}",index:"{index}"}),filters:[a]});var f=jQuery(".sapUshellAnchorItemSelected").attr("id");var p=r.getElementById(f);this.oList.getItems().forEach(function(e){if(p.mProperties.groupId===e.mProperties.groupId){e.addStyleClass("sapUshellAnchorPopoverItemSelected")}else{e.addStyleClass("sapUshellAnchorPopoverItemNonSelected")}});jQuery(".sapUshellAnchorItemOverFlow").toggleClass("sapUshellAnchorItemOverFlowPressed",true);this.oPopover.openBy(this.oOverflowButton)}}.bind(this))};f.prototype.getVisibleGroups=function(){return this.getGroups().filter(function(e){return e.getVisible()})};f.prototype._setRenderedCompletely=function(e){this._bIsRenderedCompletely=e};f.prototype.handleAnchorItemPress=function(e){this.bGroupWasPressed=true;this.fireItemPress({group:e.getSource(),manualPress:true})};f.prototype.adjustVisibleAnchorItemsAccessibility=function(){var e=this.getVisibleGroups(),t=e.length;e.forEach(function(e,s){e.setPosinset(s+1);e.setSetsize(t)})};f.prototype.addGroup=function(e,t){e.attachVisibilityChanged(this.fnAdjustVisibleAnchorItemsAccessibility);return this.addAggregation("groups",e,t)};f.prototype.insertGroup=function(e,t,s){e.attachVisibilityChanged(this.fnAdjustVisibleAnchorItemsAccessibility);return this.insertAggregation("groups",e,t,s)};f.prototype.removeGroup=function(e,t){e.detachVisibilityChanged(this.fnAdjustVisibleAnchorItemsAccessibility);return this.removeAggregation("groups",e,t)};f.prototype.exit=function(){if(this.oOverflowLeftButton){this.oOverflowLeftButton.destroy()}if(this.oOverflowRightButton){this.oOverflowRightButton.destroy()}if(this.oOverflowButton){this.oOverflowButton.destroy()}if(this.oPopover){this.oPopover.destroy()}if(i.prototype.exit){i.prototype.exit.apply(this,arguments)}if(this._sResizeListenerId){l.deregister(this._sResizeListenerId);this._sResizeListenerId=null}};return f});
//# sourceMappingURL=AnchorNavigationBar.js.map