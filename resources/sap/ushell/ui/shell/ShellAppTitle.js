// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Bar","sap/m/Button","sap/m/Label","sap/m/HBox","sap/m/VBox","sap/m/library","sap/m/Popover","sap/m/ResponsivePopover","sap/m/Title","sap/m/ToggleButton","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/IconPool","sap/ui/Device","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/Container","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/state/StateManager","sap/ushell/state/ShellModel"],function(e,t,o,n,s,l,i,p,r,a,h,u,c,d,g,y,v,A,f,M,T,S){"use strict";const C=A.AppTitleState;const P=A.AllMyAppsState;const _=l.PlacementType;const m=T.ShellMode;var N=t.extend("sap.ushell.ui.shell.ShellAppTitle",{metadata:{library:"sap.ushell",properties:{title:{type:"string",group:"Data",defaultValue:null},subTitle:{type:"string",group:"Data",defaultValue:null},showAppTitle:{type:"boolean",group:"Data",defaultValue:true},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:"sap-icon://folder"}},associations:{navigationMenu:{type:"sap.ushell.ui.shell.ShellNavigationMenu"},allMyApps:{type:"sap.ui.core.mvc.View"},newExperienceControl:{type:"sap.ui.core.Control"}},events:{textChanged:{deprecated:true}}},renderer:{apiVersion:2,render:function(e,t){var o=t._getControlVisibilityAndState();var n=t.getText();e.openStart("div",t);e.class("sapUshellHeadTitle");if(o||d.system.phone){e.class("sapUshellAppTitleClickable")}e.openEnd();e.openStart("h1");e.class("sapUiPseudoInvisibleText");e.attr("aria-level","1");e.openEnd();e.text(n||"");e.close("h1");e.openStart("div",t.getId()+"-button");e.class("sapUshellAppTitle");if(o||d.system.phone){e.attr("tabindex","0")}if(t.getTooltip_AsString()){e.attr("title",t.getTooltip_AsString())}if(o){e.attr("role","button");e.attr("aria-haspopup","dialog");e.attr("aria-label",n)}e.openEnd();if(t.getShowAppTitle()){e.openStart("span");e.class("sapUshellAppTitleText");e.openEnd();e.text(n||"");e.close("span")}if(o&&n){e.openStart("span");e.class("sapUshellShellHeadAction");e.openEnd();e.renderControl(t.oIcon);e.close("span")}e.close("div");e.close("div")}}});N.prototype.init=function(){t.prototype.init.apply(this,arguments);this.oIcon=c.createControlByURI(c.getIconURI("slim-arrow-down"));this.oIcon.addStyleClass("sapUshellAppTitleMenuIcon");this._screenWidth=null;if(d.system.desktop){this.addEventDelegate({onkeydown:function(e){if(e.altKey&&e.keyCode===40){this.onclick(e)}}.bind(this)})}if(y.last("/core/shellBar/enabled")){d.resize.attachHandler(N._showAppTitleText.bind(this))}};N._showAppTitleText=function(e){const t=e.width;if(!this._screenWidth||Math.abs(this._screenWidth-t)>50){this.setShowAppTitle(true);this._screenWidth=t}};N.prototype._getNewExperienceWrapper=function(){if(!this._oNewExperienceWrapper){this._oNewExperienceWrapper=new s({renderType:"Bare"});this._oNewExperienceWrapper.addStyleClass("sapUiSmallMarginBeginEnd");this.addDependent(this._oNewExperienceWrapper)}return this._oNewExperienceWrapper};N.prototype.onBeforeRendering=function(){if(!y.last("/core/shellBar/enabled")){this.setShowAppTitle(d.media.getCurrentRange(d.media.RANGESETS.SAP_STANDARD).name!=="Phone")}};N.prototype.getFocusDomRef=function(){return this.getDomRef("button")};N._getCurrentState=function(){return S.getConfigModel().getProperty("/shellAppTitleState")};N._setCurrentState=function(e){S.getConfigModel().setProperty("/shellAppTitleState",e)};N.prototype.onclick=function(e){e.preventDefault();this.firePress();if(!this._getControlVisibilityAndState()){if(d.system.phone){window.hasher.setHash(y.last("/core/shellHeader/rootIntent"))}return}if(N._getCurrentState()===C.AllMyAppsOnly){g.start("FLP:ShellAppTitle.onClick","Click ShellAppTitle in HOME state, Launching AllMyApps","FLP");this._openCloseAllMyAppsPopover();return}this._openCloseNavMenuPopover()};N.prototype._openCloseAllMyAppsPopover=function(){if(!this.oAllMyAppsPopover){this.oAllMyAppsPopover=this._createAllMyAppsPopover()}if(this.oAllMyAppsPopover){if(this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}else{this.oAllMyAppsPopover.openBy(this)}}};N.prototype._openCloseNavMenuPopover=function(){if(!this.oNavMenuPopover){this.oNavMenuPopover=this._createNavMenuPopover()}N._setCurrentState(C.ShellNavMenu);if(this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}else{this.oNavMenuPopover.openBy(this)}if(this.oNavMenuPopover.getFooter()){const e=T.getShellMode()===m.Default;const t=T.isLegacyHome();this.oNavMenuPopover.getFooter().setVisible(e||t)}};N.prototype._getControlVisibilityAndState=function(){g.start("FLP:ShellAppTitle.getControlVisibilityAndState","Check AllMyApps and NavShellMenu visibility","FLP");const e=T.getShellMode()===m.Default;const t=T.isLegacyHome();var o=this._isNavMenuEnabled();var n=o;if(e||t){var s=y.last("/core/services/allMyApps/enabled");n=s||o;if(s&&o){N._setCurrentState(C.ShellNavMenu)}else if(!s&&o){N._setCurrentState(C.ShellNavMenuOnly)}else if(s&&!o){N._setCurrentState(C.AllMyAppsOnly)}}else{N._setCurrentState(C.ShellNavMenuOnly)}g.end("FLP:ShellAppTitle.getControlVisibilityAndState");return n};N.prototype._createAllMyAppsPopover=function(){var e=h.getElementById(this.getAllMyApps());if(!e){return null}var t=new p("sapUshellAllMyAppsPopover",{placement:_.Bottom,title:"",showArrow:true,customHeader:this._getPopoverHeader(),verticalScrolling:false,showHeader:{path:"configModel>/shellAppTitleState",formatter:function(e){return e!==C.ShellNavMenu}},content:[e],contentHeight:"28rem",contentWidth:"56rem"}).addStyleClass("sapContrastPlus");t.setModel(S.getConfigModel(),"configModel");t.attachBeforeOpen(()=>{v.getServiceAsync("AppLifeCycle").then(e=>{if(e.getCurrentApplication()?.homePage){const e=h.getElementById(this.getNewExperienceControl());if(e){const o=this._getNewExperienceWrapper();o.addItem(e);t.insertContent(o,0)}else if(this._oNewExperienceWrapper){this.addDependent(this._oNewExperienceWrapper)}}})});t.attachAfterOpen(function(){var e=t.getCustomHeader();var o=e.getContentLeft()[0];var n=e.getContentLeft()[1];if(n.getVisible()){n.firePress();n.setPressed(true)}o.focus()});t.attachAfterClose(this._afterCloseAllMyAppsPopover.bind(this));return t};N.prototype._afterCloseAllMyAppsPopover=function(){if(this._bOpenNavigationMenu===true){this._bOpenNavigationMenu=false;this.oNavMenuPopover.openBy(this)}else if(!d.system.phone){this.focus()}};N.prototype._createNavMenuPopover=function(){var e=h.getElementById(this.getNavigationMenu());this.oTitle=new r("navMenuInnerTitle",{wrapping:true,text:"{shellModel>/application/title}"});this.oSecondTitle=new o("navMenuInnerSecondTitle",{text:"{shellModel>/header/secondTitle}",visible:"{= !!${shellModel>/header/secondTitle}}",wrapping:true});this.oIconControl=new u({src:"{shellModel>/application/icon}"});const t=new s({items:[this.oTitle,this.oSecondTitle]}).addStyleClass("sapUshellNavTitleBox");const l=new s({items:[this.oIconControl]}).addStyleClass("sapUiContentPadding");const p=new n("navMenuTitleBar",{width:"100%",items:[l,t]});var a=new i("sapUshellAppTitlePopover",{placement:_.Bottom,showArrow:true,showHeader:false,contentWidth:"20rem",horizontalScrolling:false,content:[p,e]}).addStyleClass("sapContrastPlus");if(y.last("/core/services/allMyApps/enabled")){a.setFooter(this._getPopoverFooterContent())}a.addStyleClass("sapUshellAppTitleNavigationMenuPopover");a.setModel(S.getModel(),"shellModel");S.getConfigModel().setProperty("/allMyAppsMasterLevel",P.FirstLevel);a.attachBeforeOpen(function(){e._beforeOpen();const t=h.getElementById(this.getNewExperienceControl());if(t){const e=this._getNewExperienceWrapper();e.addItem(t);a.insertContent(e,1)}else if(this._oNewExperienceWrapper){this.addDependent(this._oNewExperienceWrapper)}}.bind(this));a.attachAfterOpen(function(){e.$().on("touchmove.scrollFix",function(e){e.stopPropagation()});e._afterOpen()});a.attachAfterClose(this._afterCloseNavigationMenuPopover.bind(this));return a};N.prototype._afterCloseNavigationMenuPopover=function(){if(this._bOpenAllMyApps){this._bOpenAllMyApps=false;this._openCloseAllMyAppsPopover()}else if(!d.system.phone){this.focus()}};N.prototype._setAllMyAppsTitle=function(e){const t=N._getCurrentState();const o=S.getModel().getProperty("/header/secondTitle");if(o&&(t==="AllMyAppsOnly"||t==="AllMyApps")){e=`${e} - ${o}`}r.prototype.setText.apply(this,[e])};N.prototype._getPopoverHeader=function(){var t=new r({text:f.i18n.getText("allMyApps_headerTitle"),level:"H1"});t.setText=this._setAllMyAppsTitle.bind(t);var o=new e("sapUshellShellAppPopoverHeader",{contentLeft:[this._createPopoverBackButton(),this._createPopoverToggleButton()],contentMiddle:[t]});return o};N.prototype.onAfterRendering=function(){this._adjustAppTitleTooltip()};N.prototype._adjustAppTitleTooltip=function(){const e=this.getDomRef("button");const t=e&&e.firstChild;if(t){let e;const o=y.last("/core/services/allMyApps/enabled");const n=T.getShellMode()===m.Default;const s=T.isLegacyHome();const l=(n||s)&&o;const i=h.getElementById(this.getNavigationMenu());const p=i&&i.getItems()&&i.getItems().length>0;if(p){e=f.i18n.getText("shellNavMenu_openMenuTooltip_navigationMenu")}else if(l){e=f.i18n.getText("shellNavMenu_openMenuTooltip_allMyApps")}else{const o=t.offsetWidth<t.scrollWidth;e=o?this.getText():null}if(this.getTooltip()!==e){this.setTooltip(e)}}};N.prototype._createPopoverBackButton=function(){var e=new t("sapUshellAppTitleBackButton",{icon:c.getIconURI("nav-back"),press:[this._popoverBackButtonPressHandler,this],tooltip:f.i18n.getText("backBtn_tooltip"),visible:this.getAllMyAppsController().getBackButtonVisible()});e.addStyleClass("sapUshellCatalogNewGroupBackButton");return e};N.prototype._popoverBackButtonPressHandler=function(){var e=this.getAllMyAppsController();var t=e.getCurrentState();if(t===P.FirstLevel||t===P.FirstLevelSpread){if(N._getCurrentState()!==C.AllMyAppsOnly){N._setCurrentState(C.ShellNavMenu);this.oAllMyAppsPopover.close();this._bOpenNavigationMenu=true}}else if(t===P.SecondLevel){e.switchToInitialState()}else{e.handleSwitchToMasterAreaOnPhone()}e.updateHeaderButtonsState()};N.prototype._createPopoverToggleButton=function(){var e=this.getAllMyAppsController();var t=new a("sapUshellAllMyAppsToggleListButton",{icon:c.getIconURI("sap-icon://menu2"),press:function(t){e.switchToInitialState();this.setTooltip(t.getParameter("pressed")?f.i18n.getText("ToggleButtonHide"):f.i18n.getText("ToggleButtonShow"))},tooltip:f.i18n.getText("ToggleButtonShow"),visible:e.getToggleListButtonVisible()});d.media.attachHandler(function(){t.setVisible(e.getToggleListButtonVisible())},this,d.media.RANGESETS.SAP_STANDARD);t.addStyleClass("sapUshellAllMyAppsToggleListButton");return t};N.prototype._getPopoverFooterContent=function(){var o=new t("allMyAppsButton",{text:f.i18n.getText("allMyApps_launchingButtonTitle"),press:this._allMyAppsButtonPressHandler.bind(this),visible:{path:"shellConfig>/shellAppTitleState",formatter:function(e){return e===C.ShellNavMenu}}});var n=new e("shellpopoverFooter",{contentMiddle:[o]});this.addCustomData(o,"role","button");this.addCustomData(o,"aria-label",f.i18n.getText("allMyApps_launchingButtonTitle"));return n};N.prototype._allMyAppsButtonPressHandler=function(){if(h.getElementById(this.getAllMyApps())){g.start("FLP:ShellNavMenu.footerClick","Click the footer of ShellNavMenu, Launching AllMyApps","FLP");N._setCurrentState(C.AllMyApps);this.oNavMenuPopover.close();this._bOpenAllMyApps=true}};N.prototype._isNavMenuEnabled=function(){var e=h.getElementById(this.getNavigationMenu());return e?e.getItems()&&e.getItems().length>0:false};N.prototype.addCustomData=function(e,t,o){e.addCustomData(new M({key:t,value:o,writeToDom:true}))};N.prototype.close=function(){if(this.oNavMenuPopover&&this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}if(this.oAllMyAppsPopover&&this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}};N.prototype.setTooltip=function(e){this.setAggregation("tooltip",e);this.oIcon.setTooltip(e)};N.prototype.getAllMyAppsController=function(){var e=h.getElementById(this.getAllMyApps());return e.getController()};N.prototype.onkeyup=function(e){if(e.keyCode===32){this.onclick(e)}};N.prototype.onsapenter=N.prototype.onclick;N.prototype.exit=function(){var e=h.getElementById(this.getNavigationMenu());var t=h.getElementById(this.getAllMyApps());if(e){e.destroy()}if(t){t.destroy()}if(this.oAllMyAppsPopover){this.oAllMyAppsPopover.destroy()}if(this.oNavMenuPopover){this.oNavMenuPopover.destroy()}if(this.oIcon){this.oIcon.destroy()}};return N});
//# sourceMappingURL=ShellAppTitle.js.map