// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/ClientSideTargetResolution/Utils","sap/base/util/ObjectPath","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/fe/navigation/SelectionVariant","sap/base/Log","sap/ushell/utils"],function(e,t,a,r,n,i,s){"use strict";async function o(t,a){var r,n=t.resolutionResult,i=t.inbound&&(t.inbound.signature||{}),s=f(n)||i.additionalParameters==="ignored"||g(t);if(!s){l(t);return t}var o=t.intentParamsPlusAllDefaults["sap-xapp-state"]&&t.intentParamsPlusAllDefaults["sap-xapp-state"][0];if(o){const s=await b(a,o);if(c(s)){if(f(n)){var m=e.constructParameterDominatorMap(i.parameters);Object.keys(n.oNewAppStateMembers).forEach(function(e){var t=m[e].dominatedBy;if(p(s,t)){delete n.oNewAppStateMembers[e]}})}var d=i.additionalParameters==="ignored";if(!f(n)&&!g(t)&&!d){l(t);return t}r=a.createEmptyAppState(undefined,true);if(r){r.setData(s);await u(r,t);return t}}else{delete n.oNewAppStateMembers;l(t);return t}}if(f(n)){var P=a.createEmptyAppState(undefined,true);await u(P,t);return t}l(t);return t}async function u(e,t){var a=e.getData()||{},r,i={},o=t.inbound.signature,u=t.resolutionResult;if(a.selectionVariant){r=new n(JSON.stringify(a.selectionVariant))}else{r=new n}if(f(u)){Object.keys(u.oNewAppStateMembers).forEach(function(e){r.massAddSelectOption(e,u.oNewAppStateMembers[e].Ranges)})}var m=o.additionalParameters==="ignored";r=d(r,i,o.parameters,m);if(r.getParameterNames().length!==0||r.getSelectOptionsPropertyNames().length!==0||i.deleted){a.selectionVariant=r.toJSONObject()}if(!i.changed&&!i.deleted&&!f(u)){l(t);return}e.setData(a);await s.promisify(e.save());t.intentParamsPlusAllDefaults["sap-xapp-state"]=[e.getKey()];t.mappedIntentParamsPlusSimpleDefaults["sap-xapp-state"]=[e.getKey()];l(t)}function l(e){P(e);S(e);delete e.resolutionResult.oNewAppStateMembers}function f(e){return e.oNewAppStateMembers&&!a(e.oNewAppStateMembers)}function m(e,t){return Array.isArray(e)&&e.some(function(e){return t.indexOf(e)!==-1})}function p(e,t){if(e&&e.selectionVariant){var a=new n(JSON.stringify(e.selectionVariant)),r=a.getSelectOptionsPropertyNames()||[],i=a.getParameterNames()||[];if(m(r,t)||m(i,t)){return true}}return false}function d(e,t,a,r){var s=new n,o=e.getParameterNames()||[],u=e.getSelectOptionsPropertyNames()||[],l,f;o.forEach(function(n){l=e.getParameter(n);if(r&&!a[n]){t.deleted=true;return}if(a[n]&&a[n].renameTo){if(s.getParameter(a[n].renameTo)===undefined&&s.getSelectOption(a[n].renameTo)===undefined){s.addParameter(a[n].renameTo,l);t.changed=true}else{i.error("renaming of appstate creates duplicates "+n+"->"+a[n].renameTo)}}else if(s.getParameter(n)===undefined&&s.getSelectOption(n)===undefined){s.addParameter(n,l)}});u.forEach(function(n){f=e.getSelectOption(n);if(r&&!a[n]){t.deleted=true;return}if(a[n]&&a[n].renameTo){if(s.getSelectOption(a[n].renameTo)===undefined&&s.getParameter(a[n].renameTo)===undefined){s.massAddSelectOption(a[n].renameTo,f);t.changed=true}else{i.error("renaming of appstate creates duplicates "+n+"->"+a[n].renameTo)}}else if(s.getSelectOption(n)===undefined&&s.getParameter(n)===undefined){s.massAddSelectOption(n,f)}});o.forEach(function(t){e.removeParameter(t)});u.forEach(function(t){e.removeSelectOption(t)});s.getParameterNames().forEach(function(t){e.addParameter(t,s.getParameter(t))});s.getSelectOptionsPropertyNames().forEach(function(t){e.massAddSelectOption(t,s.getSelectOption(t))});return e}function c(e){return e===undefined||r(e)}function g(e){return e.inbound&&e.inbound.signature&&e.inbound.signature.parameters&&Object.keys(e.inbound.signature.parameters).some(function(t){return!!e.inbound.signature.parameters[t].renameTo})}function P(e){e.defaultedParamNames=e.defaultedParamNames.filter(function(t){if(e.intentParamsPlusAllDefaults[t]&&!Array.isArray(e.intentParamsPlusAllDefaults[t])){if(!(e.resolutionResult.oNewAppStateMembers&&e.resolutionResult.oNewAppStateMembers[t])){return false}}return true})}function S(e){var a=t.get("inbound.signature.parameters",e)||{},r={};e.defaultedParamNames.forEach(function(e){var t=a[e]&&a[e].renameTo||e;if(r[t]){i.error("renaming of defaultedParamNames creates duplicates"+e+"->"+t)}else{r[t]=true}});e.mappedDefaultedParamNames=Object.keys(r).sort()}async function b(e,t){const a=await s.promisify(e.getAppState(t));return a.getData()}return{mixAppStateIntoResolutionResultAndRename:o,_hasRenameTo:g}});
//# sourceMappingURL=XAppStateProcessing.js.map