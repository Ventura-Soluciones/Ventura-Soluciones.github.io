// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ushell/Config","sap/ushell/library","sap/base/util/deepClone","sap/base/util/deepExtend","sap/base/Log","sap/ushell/utils","sap/ushell/Container"],(e,t,o,a,r,s,i,n)=>{"use strict";const c="sap.ushell.services.BookmarkV2";const u=o.ContentNodeType;function d(){this._getLaunchPageService=function(){if(!this._oLaunchPageServicePromise){this._oLaunchPageServicePromise=n.getServiceAsync("LaunchPage")}return this._oLaunchPageServicePromise};this._getPagesService=function(){if(!this._oPagesServicePromise){this._oPagesServicePromise=n.getServiceAsync("Pages")}return this._oPagesServicePromise};this._addBookmarkToContentNodes=async function(e,t,o,a){const r=t.map(async t=>{if(t&&t.hasOwnProperty("type")&&t.isContainer){if(t.type===u.Page){return this.addBookmarkToPage(e,t.id,a)}if(t.type===u.HomepageGroup){const r=await this._getLaunchPageService();const s=await i.promisify(r.getGroupById(t.id));return this.addBookmarkToHomepageGroup(e,s,o,a)}throw new Error(`Bookmark Service: The API needs to be called with a valid content node type. '${t.type}' is not supported.`)}throw new Error("Bookmark Service: Not a valid content node.")});return Promise.all(r)};this.addBookmark=async function(e,o,r){const i=t.last("/core/shell/enablePersonalization");const u=t.last("/core/spaces/enabled");const d=t.last("/core/spaces/myHome/enabled");if(!i&&(!u||!d)){return}try{await this._checkBookmarkParameters(e);const t=a(e,20);t.url=await this._changeUrlStatesToPersistent(t.url);if(typeof o==="undefined"&&u){const e=await n.getServiceAsync("Menu");const o=await e.getDefaultSpace();const a=o&&o.children&&o.children[0];return this._addBookmarkToContentNodes(t,[a],false,r)}if((typeof o==="undefined"||!o.hasOwnProperty("type"))&&!Array.isArray(o)){return this.addBookmarkToHomepageGroup(t,o,false,r)}const s=[].concat(o);return this._addBookmarkToContentNodes(t,s,false,r)}catch(e){s.error("Error during Bookmark creation: ",e,c);throw e}};this.addCustomBookmark=async function(e,t,o,s){const i=a(t);const n=r(i,{vizType:e,vizConfig:{"sap.flp":{chipConfig:i.chipConfig},"sap.platform.runtime":{includeManifest:!i.loadManifest}}});delete n.chipConfig;delete n.loadManifest;n.url=await this._changeUrlStatesToPersistent(n.url);const c=[].concat(o);return this._addBookmarkToContentNodes(n,c,true,s)};this.addBookmarkToHomepageGroup=async function(o,a,r,s){if(t.last("/core/spaces/enabled")){throw new Error("Bookmark Service: The API is not available in spaces mode.")}const n=await this._getLaunchPageService();let c;if(r){c=await i.promisify(n.addCustomBookmark(o,a,s))}else{c=await i.promisify(n.addBookmark(o,a,s))}const u={tile:c,group:a};e.getInstance().publish("sap.ushell.services.Bookmark","bookmarkTileAdded",u)};this.addBookmarkToPage=async function(e,o,a){if(!t.last("/core/spaces/enabled")){throw new Error("Bookmark Service: 'addBookmarkToPage' is not valid in launchpad home page mode, use 'addBookmark' instead.")}const r=t.last("/core/shell/enablePersonalization");const s=t.last("/core/spaces/myHome/enabled");const i=t.last("/core/spaces/myHome/myHomePageId");if(!r&&(!s||s&&o!==i)){throw new Error("Bookmark Service: Add bookmark is not allowed as the personalization functionality is not enabled.")}if(e&&(typeof e.title!=="string"||typeof e.url!=="string")){throw new Error("Bookmark Service - Invalid bookmark data.")}const n=await this._getPagesService();return n.addBookmarkToPage(o,e,undefined,a)};this.addBookmarkByGroupId=async function(e,o,a){if(t.last("/core/spaces/enabled")){const e="Bookmark Service: The API 'addBookmarkByGroupId' is not supported in launchpad spaces mode.";throw new Error(e)}const r=await this._getLaunchPageService();const s=await i.promisify(r.getGroups());const n=s.find(e=>e.id===o)||null;return this.addBookmark(e,n,a)};this.getShellGroupIDs=async function(e){if(t.last("/core/spaces/enabled")){const e="Bookmark Service: The API 'getShellGroupIDs' is not supported in launchpad spaces mode.";throw new Error(e)}const o=await this._getLaunchPageService();let a=await i.promisify(o.getGroupsForBookmarks(e));a=a.map(e=>({id:o.getGroupId(e.object),title:e.title}));return a};this._checkBookmarkParameters=async function(e){if(!e){throw new Error("Invalid Bookmark Data: No bookmark parameters passed.")}const t=e.dataSource;let o;if(t){if(t.type!=="OData"){throw new Error(`Invalid Bookmark Data: Unknown data source type: ${t.type}`)}o=t.settings&&t.settings.odataVersion;const e=["2.0","4.0"];if(!e.includes(o)){throw new Error(`Invalid Bookmark Data: Unknown OData version in the data source: ${o}`)}}if(e.serviceUrl){const o=await n.getServiceAsync("ReferenceResolver");if(o.hasSemanticDateRanges(e.serviceUrl)&&!t){throw new Error("Invalid Bookmark Data: Provide a data source to use semantic date ranges.")}}};this.countBookmarks=async function(e,o){if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return i.promisify(t.countBookmarks(e,o))}const a=await this._getPagesService();return a.countBookmarks({url:e,contentProviderId:o})};this.countCustomBookmarks=async function(e){if(!e||!e.url||!e.vizType){throw new Error("countCustomBookmarks: required parameters are missing.")}if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return t.countCustomBookmarks(e)}const o=await this._getPagesService();return o.countBookmarks(e)};this.deleteBookmarks=async function(o,a){if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();const r=await i.promisify(t.deleteBookmarks(o,a));e.getInstance().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",o);return r}const r=await this._getPagesService();return r.deleteBookmarks({url:o,contentProviderId:a})};this.deleteCustomBookmarks=async function(o){if(!o||!o.url||!o.vizType){throw new Error("deleteCustomBookmarks: Some required parameters are missing.")}if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();await t.deleteCustomBookmarks(o);e.getInstance().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",o.url);return}const a=await this._getPagesService();return a.deleteBookmarks(o)};this.updateBookmarks=async function(e,o,r){const s=a(o,20);s.url=await this._changeUrlStatesToPersistent(s.url);if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return i.promisify(t.updateBookmarks(e,s,r))}const n=await this._getPagesService();return n.updateBookmarks({url:e,contentProviderId:r},s)};this.updateCustomBookmarks=async function(e,o){if(!e||!e.url||!e.vizType){throw new Error("deleteCustomBookmarks: Some required parameters are missing.")}const a=r({},o,{vizConfig:{"sap.flp":{chipConfig:o.chipConfig},"sap.platform.runtime":{includeManifest:!o.loadManifest}}});delete a.chipConfig;delete a.loadManifest;a.url=await this._changeUrlStatesToPersistent(a.url);if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return t.updateCustomBookmarks(e,a)}const s=await this._getPagesService();return s.updateBookmarks(e,a)};this.getContentNodes=async function(){if(!t.last("/core/spaces/enabled")){const e=await this._getLaunchPageService();const t=await i.promisify(e.getGroupsForBookmarks());const o=t.map(t=>({id:e.getGroupId(t.object),label:t.title,type:u.HomepageGroup,isContainer:true}));return o}const e=await n.getServiceAsync("Menu");return e.getContentNodes()};this._changeUrlStatesToPersistent=async function(e){const t=await n.getServiceAsync("AppState");const o=t.getPersistentWhenShared();if(t.getSupportedPersistencyMethods().length===0&&o!==true){return e}if(!e||typeof e!=="string"){return e}return i.promisify(t.setAppStateToPublic(e))}}d.hasNoAdapter=true;return d},true);
//# sourceMappingURL=BookmarkV2.js.map