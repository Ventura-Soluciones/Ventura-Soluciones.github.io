// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/services/UserRecents/UserRecentsBase","sap/ushell/utils"],function(e,s,t){"use strict";const a=s.extend("sap.ushell.services.UserRecents.RecentAppsUsage",{constructor:function(){s.call(this,"AppsUsage")}});a.MAX_DAYS=30;a.prototype.init=async function(){const s=this.getDayFromDate(new Date);let t=false;if(!t||s!==this.oAppsUsageData.recentDay){t=true;try{const e=await this.load();this.oAppsUsageData=e||{recentDay:null,recentAppsUsageMap:{}};await this.calculateInitialUsage(s);return this.oAppsUsageData}catch(s){e.error("Load data in Init failed",s,"sap.ushell.services.UserRecents.RecentAppsUsage");return Promise.reject(s)}}};a.prototype.calculateInitialUsage=async function(e){if(e!==this.oAppsUsageData.recentDay){this._addNewDay();this.oAppsUsageData.recentDay=e;this._cleanUnusedHashes();await this.save(this.oAppsUsageData)}};a.prototype.addAppUsage=async function(e){if(!t.validHash(e)){return Promise.reject("Non valid hash")}await this.init();const s=this.oAppsUsageData.recentAppsUsageMap[e]||[];if(s.length===0){s[0]=1}else{s[s.length-1]+=1}this.oAppsUsageData.recentAppsUsageMap[e]=s;await this.save(this.oAppsUsageData)};a.prototype.getAppsUsage=async function(){await this.init();const e={};let s,t;let a=true;for(const p in this.oAppsUsageData.recentAppsUsageMap){e[p]=this._getHashUsageSum(p);if(a){s=t=e[p];a=false}else if(e[p]<t){t=e[p]}else if(e[p]>s){s=e[p]}}return{usageMap:e,maxUsage:s,minUsage:t}};a.prototype._addNewDay=function(){let e;for(const s in this.oAppsUsageData.recentAppsUsageMap){e=this.oAppsUsageData.recentAppsUsageMap[s];e[e.length]=0;if(e.length>a.MAX_DAYS){e=e.shift()}}};a.prototype._cleanUnusedHashes=function(){let e;for(const s in this.oAppsUsageData.recentAppsUsageMap){e=this._getHashUsageSum(s);if(e===0){delete this.oAppsUsageData.recentAppsUsageMap[s]}}};a.prototype._getHashUsageSum=function(e){const s=this.oAppsUsageData.recentAppsUsageMap[e];return s.reduce(function(e,s){return e+s},0)};return a});
//# sourceMappingURL=RecentAppsUsage.js.map