// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/RenderManager","sap/ui/core/support/Plugin","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/Label","sap/m/Text","sap/m/MessageStrip","sap/m/FlexBox","sap/ui/model/resource/ResourceModel","sap/m/SearchField","sap/m/MessageBox","sap/base/util/isEmptyObject"],function(e,t,n,i,r,a,o,s,u,p,l,f,g,c,d,y){"use strict";var h;var v=i.extend("sap.ushell.support.plugins.flpConfig.FlpConfigurationPlugin",{constructor:function(e){h=new g({bundleName:"sap/ushell/support/plugins/flpConfig/i18n/FlpConfigurationPlugin"});i.apply(this,["sapUiFlpConfigurationPlugin",h.getResourceBundle().getText("PLUGIN_NAME"),e]);this._oSupportStub=e;if(this.runsAsToolPlugin()){this._aEventIds=[this.getId()+"ReceiveData"]}else{this._aEventIds=[this.getId()+"RequestData"]}}});v.prototype.isToolPlugin=function(){return true};v.prototype.isAppPlugin=function(){return true};v.prototype.init=function(){i.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){setTimeout(function(){this.requestData()}.bind(this),500);var e=(new n).getInterface();e.openStart("div",this.getId());e.openEnd();e.close("div");e.flush(this.dom());e.destroy()}else{}};v.prototype.exit=function(){i.prototype.exit.apply(this,arguments)};v.prototype.requestData=function(){this._oSupportStub.sendEvent(this.getId()+"RequestData",{eventData:{data:{}}})};v.prototype.onsapUiFlpConfigurationPluginRequestData=function(e){var t={};this.prepareForSending(window["sap-ushell-config"],t);this._oSupportStub.sendEvent(this.getId()+"ReceiveData",{eventData:{data:t}})};v.prototype.onsapUiFlpConfigurationPluginReceiveData=function(e){this.flpConfig=e.getParameter("eventData").data;t.load("sap.ui.table").then(function(){sap.ui.require(["sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/table/library"],function(e,t,n){this.getFlpConfigurationPluginUI(null,e,t,n.SelectionMode)}.bind(this))}.bind(this))};function b(){var t=0;var n=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();var i=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData();if(Array.isArray(i[n])){i[n].forEach(function(e,r){var a=I(i[n][r],n);if(t<a){t=a}});if(t>0){e.getElementById("sap-ui-support-flpConfigurationPlugin-TreeTable"+n).expandToLevel(t-1)}else{d.error(new u({text:e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("i18n").getResourceBundle().getText("MISSING_HIERARCHY_LEVEL")}))}}}function E(){var t=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();e.getElementById("sap-ui-support-flpConfigurationPlugin-TreeTable"+t).collapseAll()}v.prototype.onPressSearchNewModel=function(t){var n;var i;var a;var o;var s;var u;var p;var l;var f;var g=[];var c={};var d="";var y={};var h={};var v=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("Full");var b=t.getParameter("query");if(!v){v=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData()}else{v=v.getData()}Object.keys(v).forEach(function(e){c[e]=0});if(b){for(var E in v){d=E;n=[];P(v[E],E,d,n,b);h[E]=n}Object.keys(h).forEach(function(e){o=h[e];for(var t=0;t<o.length;t++){s=o[t].split(".");u=[];for(var n=0;n<s.length;n++){if(!isNaN(parseInt(s[n],10))){u.push(parseInt(s[n],10))}else{u.push(s[n])}}for(var r=0;r<u.length;r+=2){p={property:""};p[u[0]]=[];if(isNaN(parseInt(u[r],10))){i=u.slice(0,r+1);if(!m(y,i)&&typeof m(y,u.slice(0,u.length-2))!=="object"){B(y,i,[p],u[0],i.length)}f=m(v,u.slice(0,r+2));if(f&&m(y,u.slice(0,r+2))){T(y,f.property,u.slice(0,r+2).toString()+",property")}else if(r!==u.length-2){g.push(u.slice(0,r+2).toString())}}}a=u.slice(0);B(y,u,{property:"",value:""},u[0],i.length);f=m(v,a);if(f){T(y,f.value,a.toString()+",value");T(y,f.property,a.toString()+",property")}}g.forEach(function(e){f=m(v,e.split(","));if(f&&m(y,e.split(","))){T(y,f.property,e+",property")}});g=[];if(y[e]&&Array.isArray(y[e][0][e])&&y[e][0][e].length===0){y[e]=y[e].splice(1)}});e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new r(y));e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new r(v),"Full");var w=0;Object.keys(c).forEach(function(t){l=t;if(y[l]&&Array.isArray(y[l])){y[l].forEach(function(e,t){var n=I(y[l][t],l);if(w<n){w=n}})}e.getElementById("sap-ui-support-flpConfigurationPlugin-TreeTable"+t).expandToLevel(w-1);e.getElementById(t).setCount(C(y[t],t,0))})}else{Object.keys(c).forEach(function(t){e.getElementById(t).setCount(C(v[t],t,0))});e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new r(v))}};function I(e,t){var n=0;if(e[t]){e[t].forEach(function(e){var i=I(e,t);if(i>n){n=i}})}return n+1}function m(e,t){for(var n=0;n<t.length;n++){if(e){e=e[t[n]]}}return e}function C(e,t,n){if(Array.isArray(e)){e.forEach(function(e){if(e[t]){n=C(e[t],t,n)}else{n+=1}});return n}return undefined}function T(e,t,n){var i=n.split(",");for(var r=0;r<i.length-1;r++){e=e[i[r]]}e[i[i.length-1]]=t}function B(e,t,n,i,r){if(t.length===1){e[t[0]]=n}else{var a=t.shift();e[a]=B(typeof e[a]==="undefined"?{}:e[a],t,n,i,r)}if(e[i]&&e.property&&e.value){delete e.value;e.property=""}return e}function P(e,t,n,i,r){e.forEach(function(e,a){if(e[t]){n=n+"."+a+"."+t;n=P(e[t],t,n,i,r)}else if(e.property.indexOf(r)>-1){n=n+"."+a;i.push(n);n=n.substring(0,n.lastIndexOf("."))}});n=n.substring(0,n.lastIndexOf("."));if(isNaN(parseInt(n.substr(n.lastIndexOf(".")+1),10))){return n}return n.substring(0,n.lastIndexOf("."))}function w(e,t){if(typeof e!=="object"){return[{property:t,value:e}]}return Object.keys(e).map(function(n){var i={property:n};var r=e[n];if(typeof r==="object"&&r!==null&&!y(r)&&!Array.isArray(r)){i[t]=w(r,t);return i}else{try{i.value=JSON.stringify(r)}catch(e){i.value=r}}return i})}v.prototype.prepareForSending=function(e,t){Object.keys(e).forEach(function(n){var i=e[n];switch(typeof i){case"object":if(i===null){t[n]=i;return}else if(Array.isArray(i)){t[n]=[]}else{t[n]={}}this.prepareForSending(e[n],t[n]);break;case"undefined":t[n]="undefined";return;case"function":return;default:t[n]=e[n];return}}.bind(this))};v.prototype.getNewConfigJSON=function(e){var t={};Object.keys(e).forEach(function(n){t[n]=w(e[n],n)});return t};v.prototype.getFlpConfigurationPluginUI=function(t,n,i,g){var d,v,I,m={};I=this.getNewConfigJSON(this.flpConfig);d=new r(I);for(var T in I){m[T]=C(I[T],T,0)}if(!e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar")){if(!I||y(I)){new l({text:h.getResourceBundle().getText("ERROR_MESSAGE"),type:"Warning",showIcon:true,showCloseButton:false}).placeAt(this.getId())}else{v=new o("sap-ui-support-flpConfigurationPlugin-TabBar",{headerMode:"Inline"});Object.keys(this.flpConfig).forEach(function(e,t){v.insertItem(new s(e,{key:e,text:e,count:m[e],content:[new n("sap-ui-support-flpConfigurationPlugin-TreeTable"+e,{rows:"{/"+e+"/}",selectionMode:g.None,enableCellFilter:true,extension:[new f({items:[new a({icon:"sap-icon://expand",text:"{i18n>EXPAND_BUTTON}",press:b}),new a({icon:"sap-icon://collapse",text:"{i18n>COLLAPSE_BUTTON}",press:E})]})],columns:[new i({label:new u({text:"{i18n>COLUMN_PROPERTY}"}),template:new p({text:"{property}"})}),new i({label:new u({text:"{i18n>COLUMN_VALUE}"}),template:new p({text:"{value}"})})]})]}),t)});var B=new c({search:this.onPressSearchNewModel});B.placeAt(this.getId());v.setModel(d);v.setModel(h,"i18n");v.placeAt(this.getId())}}};return v});
//# sourceMappingURL=FlpConfigurationPlugin.js.map