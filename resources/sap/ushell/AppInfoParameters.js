// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/services/AppConfiguration","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/restricted/_curry","sap/base/util/restricted/_zipObject","sap/ui/VersionInfo","sap/ushell/Container"],(t,e,r,n,a,i,s,o)=>{"use strict";const p="LAUNCHPAD";const u=["productName","theme","appIntent","url"];const c=["productName","theme","languageTag","appIntent","technicalAppComponentId","appId","appVersion","appSupportInfo","appFrameworkVersion","appFrameworkId","title","applicationParams","shellFrameworkVersion","url","abap.transaction"];class l{#t={theme:this.#e.bind(this,"User.env.sap-theme-NWBC"),languageTag:this.#e.bind(this,"User.env.sap-languagebcp47"),appIntent:this.#r.bind(this),appFrameworkId:this.#n.bind(this),appFrameworkVersion:this.#a.bind(this),appSupportInfo:this.#i.bind(this),technicalAppComponentId:this.#s.bind(this),appId:this.#o.bind(this),appVersion:this.#p.bind(this),productName:a(this.#u.bind(this))("productName"),applicationParams:this.#c.bind(this),url:this.#l.bind(this),"abap.transaction":this.#h.bind(this)};#m={};#d={};#f(t){let e=t.applicationType;if(e==="TR"){e="GUI"}return e}#g(){return e.getCurrentApplication()?.appCapabilities||{}}async#a(e){const r=this.#f(e);if(r==="UI5"){try{const t=await s.load();return`${t.version||""} (${t.buildTimestamp||""})`||""}catch(e){t.error("VersionInfo could not be loaded",e)}}}async#p(t){const e=t.componentInstance;if(e){const t=e.getManifestEntry("/sap.app/applicationVersion/version");return t}}async#i(t){const[e]=await t.getTechnicalParameter("sap-ach")||[];if(e){return e}return this.#g().appSupportInfo}async#s(t){const r=this.#f(t);const n=e.getMetadata();if(r==="UI5"){const e=t.componentInstance;if(e){let t=e.getManifestEntry("/sap.ui5/componentName");if(!t){t=e.getMetadata().getComponentName()}return t}return n.technicalName}if(r==="URL"){const t=e.getCurrentApplication();if(t.appCapabilities.technicalAppComponentId){return t.appCapabilities.technicalAppComponentId}}if(r==="GUI"){return(n.technicalName||"").replace(/ .*/,"").replace(/^\*/,"")}if(r==="WDA"||r==="NWBC"){return n.technicalName}}async#o(t){const[e]=await t.getTechnicalParameter("sap-fiori-id")||[];if(t.homePage){if(e){if(e!==""){return`${p} (${e})`}return p}return p}else if(e){return e}return this.#g().appId||t.inboundPermanentKey}async#e(t){const e=await o.getServiceAsync("ReferenceResolver");const r=await e.resolveReferences([t]);return r[t]}async#n(t){const r=e.getCurrentApplication();let n=this.#f(t);if(n==="URL"){n=r.appCapabilities&&r.appCapabilities.appFrameworkId}const a={NWBC:"WDA",TR:"GUI"};return a[n]||n}async#u(t,e){const r=await e.getSystemContext();return r.getProperty(t)}async#r(){const t=window.hasher&&window.hasher.getHash();if(!t){throw new Error("Could not identify current application hash")}return t}async#c(t,e){let r={};if(e?.getCurrentAppTargetResolution?.().extendedInfo){r=e.getCurrentAppTargetResolution().extendedInfo.appParams}return r}async getAllAppInfo(t,e,r,n){const a={};const i=Object.keys(this.#t);const s=Object.keys(this.#m);const o=Array.from(new Set([...i,...s]));try{const r=await this.#A(o,e,n);for(const e in r){if(t){a[e]=r[e]}else{a[e]={value:r[e]}}}}catch{}const p=Object.keys(this.#d);try{const r=await this.#A(p,e,n);for(const e in r){if(t){a[e]=r[e].value}else{a[e]=r[e]}}}catch{}return a}async getInfo(t,e,r){if(!e){throw new Error("Parameter application missing")}return this.#A(["appFrameworkId"],e,r).then(()=>this.#A(t,e,r))}async#A(e,r,n){const a=e.map(async e=>{if(c.includes(e)){if(Object.hasOwn(this.#m,e)){return this.#m[e]}if(Object.hasOwn(this.#t,e)){return this.#t[e](r,n)}t.error(`value for parameter '${e}' is not set.`);return}if(Object.hasOwn(this.#d,e)){if(true){const t=this.#d[e];if(t.migrated){return t.value}}return this.#d[e]}if(e.includes(".")){return this.#u(e,r,n)}t.error(`'${e}' is not a valid app info parameter`)});return Promise.allSettled(a).then(t=>{for(let e=0;e<t.length;e++){if(t[e].status==="fulfilled"){t[e]=t[e].value}else{t[e]=undefined}}return i(e,t)})}setCustomAttributes(e){if(e===undefined||Object.keys(e).length===0){this.flush();return}let a=r(e);if(a.info&&Object.keys(a).length===1){t.error("The old interface for setting custom attributes is deprecated and will be removed in future.");a=a.info}const i={};for(const e in a){if(e==="customProperties"){continue}if(u.includes(e)){t.error(`Attribute '${e}' is restricted and will be ignored.`);continue}if(!c.includes(e)){if(true){t.error(`Attribute '${e}' is not supported and will be moved to customProperties instead. This migration will be removed in future.`);i[e]={value:a[e],showInAbout:false,migrated:true};continue}t.error(`Attribute '${e}' is not supported and will be ignored. It should be moved to the customProperties instead.`);continue}const r=a[e];if(typeof r!=="string"){t.error(`Attribute value for '${e}' is not a string and will be ignored.`);continue}this.#m[e]=r}const s={...i,...a.customProperties};for(const e in s){let r=s[e];if(c.includes(e)){this.#m[e]=r;continue}if(!n(r)){t.error(`Custom attribute '${e}' does not have the correct format. This property will be ignored in future.`);r={value:r,showInAbout:false,migrated:true}}if(!this.#b(e,r)){continue}this.#d[e]=r}}#b(e,r){if(!n(r)){t.error(`Custom attribute '${e}' does not have the correct format and will be ignored.`);return false}if(r.showInAbout===false){return true}r.showInAbout=true;if(!r.label){t.error(`Custom attribute '${e}' has no label and will be ignored.`);return false}return true}#l(){return o.getFLPUrl(true)}#h(t,e){return e?.getCurrentAppTargetResolution?.().appInfo?.["abap.transaction"]}store(t={}){t.appInfoParameters={appParameters:r(this.#m),customAppParameters:r(this.#d)}}restore(t={}){const{appParameters:e,customAppParameters:n}=t.appInfoParameters||{};this.#m=e?r(e):{};this.#d=n?r(n):{}}flush(){this.#m={};this.#d={}}}return new l},false);
//# sourceMappingURL=AppInfoParameters.js.map