// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/deepEqual","sap/base/util/Deferred","sap/ui/Device","sap/ui/core/Element","sap/ui/core/EventBus","sap/ushell/appIntegration/KeepAliveApps","sap/ushell/state/BackNavigation","sap/ushell/state/ContentDensity","sap/ushell/state/Favicon","sap/ushell/appIntegration/contracts/EmbeddedUI5Handler","sap/ushell/appIntegration/contracts/StatefulContainerV1Handler","sap/ushell/appIntegration/contracts/StatefulContainerV2Handler","sap/ushell/appIntegration/ApplicationContainerCache","sap/ushell/appIntegration/ApplicationHandle","sap/ushell/appIntegration/AppLifeCycle/KeepAliveMode","sap/ushell/appIntegration/PostMessageManager/AppruntimeHandler","sap/ushell/appIntegration/PostMessageManager/NWBCHandler","sap/ushell/appIntegration/PostMessageManager/LifecycleHandler","sap/ushell/appIntegration/PostMessageManager/ServiceHandler","sap/ushell/appIntegration/PostMessageManager/MessageBrokerHandler","sap/ushell/appIntegration/PostMessageManager","sap/ushell/appIntegration/PostMessagePluginInterface","sap/ushell/appIntegration/IframeApplicationContainer","sap/ushell/appIntegration/UI5ApplicationContainer","sap/ushell/services/AppConfiguration","sap/ushell/utils","sap/ushell/Config","sap/ushell/ApplicationType","sap/ushell/utils/UriParameters","sap/base/Log","sap/ushell/EventHub","sap/ushell/utils/UrlParsing","sap/ui/thirdparty/hasher","sap/ushell/services/MessageBroker/MessageBrokerEngine","sap/ushell/renderer/utils","sap/m/library","sap/ushell/AppInfoParameters","sap/ushell/Container","sap/ushell/resources","sap/ushell/state/ShellModel","sap/ushell/state/StateManager","sap/ushell/state/KeepAlive","sap/ushell/ui5service/ShellUIServiceFactory","sap/ui/core/service/ServiceFactoryRegistry","sap/ushell/library"],(e,t,i,n,a,s,o,r,p,l,c,u,h,d,f,g,A,y,m,C,I,v,S,_,b,w,R,P,F,M,T,H,N,E,U,L,k,B,x,D,W,$,O,K,V)=>{"use strict";const q=V.appIntegration.contracts.StatefulType;const G=W.ShellMode;const j=W.LaunchpadState;const z=W.Operation;const J=L.URLHelper;const Q=3500;function X(){this._bDisableHomeAppCache=false;this._bEnableRouterRetrigger=true;this._oCurrentApplication={};this._oGlobalShellUIService=null;this._oNavContainer=null;this._pLastApplicationStart=Promise.resolve();this._oStorageAppIdMap={};this._oStorageAppIdNextIndex={};this._aDoables=[];if(window.QUnit===undefined){E.connect("FLP")}}X.prototype.KeepAliveMode=f;X.prototype.init=function(e,t){const i=[];if(R.last("/core/shell/enablePersistantAppstateWhenSharing")){B.getServiceAsync("AppState").then(e=>{const t=J.triggerEmail.bind(J);J.triggerEmail=function(i,n,a,s,o){const r=document.URL;e.setAppStateToPublic(r).done((e,r,p,l,c)=>{n=n&&r&&l&&n.includes(r)?n.replace(r,l):n;n=n&&p&&c&&n.includes(p)?n.replace(p,c):n;a=a&&r&&l&&a.includes(r)?a.replace(r,l):a;a=a&&p&&c&&a.includes(p)?a.replace(p,c):a;t(i,n,a,s,o)}).fail(t)}})}this._startPostMessageHandling();i.push(O.init().then(()=>{K.register("sap.ushell.ui5service.ShellUIService",O)}));i.push(this._createGlobalShellUIService());this._oNavContainer=e;this._bDisableHomeAppCache=t;a.getInstance().subscribe("sap.ushell","getAppLifeCycle",this._onGetAppLifeCycle,this);this._addEvents();i.push(r.init());p.init();d.init(this,this._oNavContainer);this._oNavContainer.attachAfterNavigate(this.onAfterNavigate.bind(this));this._oNavContainer.attachBeforeNavigate(this.onBeforeNavigate.bind(this));return Promise.allSettled(i)};X.prototype._onGetAppLifeCycle=function(e,t,i){M.error("the EventBus channel 'sap.ushell.getAppLifeCycle' is private and was discontinued.")};X.prototype._addEvents=function(){this._aDoables.push(T.on("disableKeepAliveRestoreRouterRetrigger").do(e=>{const t=e.appId;this._bEnableRouterRetrigger=e.disable;const i=s.get(t);if(i){i.enableRouterRetrigger=e.disable}}));this._aDoables.push(T.on("setApplicationFullWidth").do(e=>{this._setApplicationFullWidth(e.bValue)}));this._aDoables.push(T.on("reloadCurrentApp").do(e=>{this._reloadCurrentApp(e)}))};X.prototype._startPostMessageHandling=function(){I.init({getCurrentApplication:()=>this.getCurrentApplication()?.container,getAllApplications:()=>h.getAll()});g.register();A.register();y.register();m.register();C.register();this._waitForPluginsAndReplayPostMessages();v.init(true,t=>{Object.keys(t).forEach(i=>{const n=t[i];if(n.oServiceCalls){Object.keys(n.oServiceCalls).forEach(e=>{const t=n.oServiceCalls[e];const a=`${i}.${e}`;if(t.executeServiceCallFn){I.setRequestHandler(a,async(e,i)=>{const n={oMessageData:JSON.parse(i.data),oMessage:i};return w.promisify(t.executeServiceCallFn(n))})}})}if(n.oRequestCalls){Object.keys(n.oRequestCalls).forEach(t=>{const a=n.oRequestCalls[t];const s=`${i}.${t}`;const o={};if(e(a.distributionType,["all"])){o.ignoreCapabilities=true}else if(a.distributionType){M.error("Unsupported distribution type",a.distributionType,"sap.ushell.appIntegration.AppLifeCycle")}if(a.isActiveOnly){o.activeOnly=true}I.setDistributionPolicy(s,o)})}})})};X.prototype._waitForPluginsAndReplayPostMessages=async function(){const e=await B.getServiceAsync("PluginManager");const t=e.getPluginLoadingPromise("RendererExtensions");await w.promisify(t);I.replayStoredMessages()};X.prototype.registerHandleHashChange=function(e){e.hashChanger.attachEvent("hashChanged",t=>{if(N.disableBlueBoxHashChangeTrigger){return}if(t.mParameters&&e.hashChanger.isInnerAppNavigation(t.mParameters.newHash,t.mParameters.oldHash)){I.sendRequestToAllApplications("sap.ushell.appRuntime.innerAppRouteChange",{oHash:t.mParameters},false)}I.sendRequestToAllApplications("sap.ushell.appRuntime.hashChange",{sHash:t.mParameters.fullHash},false)})};X.prototype.getCurrentApplication=function(){return this._oCurrentApplication};X.prototype._setApplicationFullWidth=function(e){const t=this.getCurrentApplication();if(t.container){t.container.toggleStyleClass("sapUShellApplicationContainerLimitedWidth",!e)}};X.prototype.getShellUIService=function(){return this._oGlobalShellUIService};X.prototype.resetGlobalShellUIService=function(){if(this._oGlobalShellUIService){this._oGlobalShellUIService.resetService()}};X.prototype._createGlobalShellUIService=async function(){this._oGlobalShellUIService=await O.createInstanceInternal()};X.prototype.onBeforeNavigate=function(e){const t=e.getParameter("fromId")||"";const i=e.getParameter("from");const n=e.getParameter("toId")||"";if(n===t){return}if(t&&i&&i.isA("sap.ushell.appIntegration.ApplicationContainer")){const e=i;const t=e.getCurrentAppId();const n=!!e.isA("sap.ushell.appIntegration.IframeApplicationContainer");const a=e.getStatefulType()>q.NotSupported;const o=!!s.get(t);const r=n&&a;if(n&&(o||r)){e.sendRequest("sap.ushell.sessionHandler.beforeApplicationHide",{},false)}}};X.prototype.onAfterNavigate=async function(e){const t=e.getParameter("fromId")||"";const i=e.getParameter("from");const n=e.getParameter("toId")||"";const o=e.getParameter("to");const r=["Shell-appfinder-component","Shell-home-component","pages-component-container","homeApp-component-wrapper-container","homeApp-component-container","workPageRuntime-component-container","runtimeSwitcher-component-container"];const p=t===n;const l=r.some(e=>n.includes(e));if(t&&i){if(i.isA("sap.ushell.appIntegration.ApplicationContainer")){const e=i;if(!p){await this._handleExitApplication(e,l)}}else{const e=t;const s=i;if(p){return}if(n.indexOf("Shell-appfinder-component")>0){a.getInstance().publish("sap.ushell","appFinderAfterNavigate")}if(this._bDisableHomeAppCache){try{this._removeApplicationContainerFromNavContainer(s);s.destroy()}catch(t){M.error(`Error when trying to destroy the home component: '${e}'`,t)}}}}if(n&&o){if(o.isA("sap.ushell.appIntegration.ApplicationContainer")){const e=o;const t=e.getCurrentAppId();if(e.getIframeReusedForApp()){e.setIframeReusedForApp(false);if(e.isA("sap.ushell.appIntegration.IframeApplicationContainer")){e.sendRequest("sap.ushell.sessionHandler.afterApplicationShow",{},false)}}if(s.get(t)){await this._restoreApplication(t)}}else{if(l){await this._destroyKeepAliveApps(e=>e.keepAliveMode===f.Restricted)}k.flush()}}};X.prototype._storeApplication=async function(e){const t=s.get(e);if(t){const e=t.container;const i=e.getIsKeepAlive();if(!i){M.error("Application should be kept alive but the flag is not set",null,"sap.ushell.appIntegration.AppLifeCycle");return}if(e.isA("sap.ushell.appIntegration.IframeApplicationContainer")){e.setDataHelpId("");if(e.getStatefulType()===q.ContractV2){const t=u.isStatefulContainerSupportingKeepAlive(e);if(t){const t=e.getCurrentAppId();if(!t){return}this._setContainerReadyForReuse(e);await u.storeAppWithinSameFrame(e,t)}}await e.sendRequest("sap.ushell.appRuntime.keepAliveAppHide",{},false)}else if(e.isA("sap.ushell.appIntegration.UI5ApplicationContainer")){await l.storeApp(e,t)}t.stateStored=true;const n=e.getCurrentAppTargetResolution();this._publishAppClosedEvent(n)}};X.prototype._destroyApplication=async function(e,t,i){if(typeof e!=="string"||!t){return}const n=s.get(e);const a=!!n;if(!t.getCurrentAppId()&&!i&&!a){return}const o=t.getCurrentAppTargetResolution();s.removeById(e);$.destroy(n);const r=t.getStatefulType()!==q.NotSupported;if(!i&&r){t.setDataHelpId("");this._setContainerReadyForReuse(t);if(t.getStatefulType()===q.ContractV2){await u.destroyApp(t,e)}else if(t.getStatefulType()===q.ContractV1){await c.destroyApp(t,e)}this._publishAppClosedEvent(o);return}if(t.getStatefulType()===q.ContractV2){await u.destroyApp(t,e)}else if(t.getStatefulType()===q.ContractV1){await c.destroyApp(t,e)}s.removeByContainer(t,e=>{$.destroy(e)});try{const e=t.sendBeforeAppCloseEvent();await w.promisify(e)}catch(e){M.error("FLP got a failed response from the iframe for the 'sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent' message sent",e,"sap.ushell.appIntegration.AppLifeCycle.js")}h.removeByContainer(t);this._removeApplicationContainerFromNavContainer(t);try{t.destroy()}catch(e){M.error(`Exception when trying to close application with id '${t.getId()}'. This error must be fixed in order for FLP to operate properly.`,e,"sap.ushell.appIntegration.AppLifeCycle")}this._publishAppClosedEvent(o)};X.prototype._restoreApplication=async function(e){const t=s.get(e);if(t?.stateStored){o.restore(t.service);O.restore(t);const e=t.container;if(e.isA("sap.ushell.appIntegration.IframeApplicationContainer")){await e.sendRequest("sap.ushell.appRuntime.keepAliveAppShow",{},false)}else if(e.isA("sap.ushell.appIntegration.UI5ApplicationContainer")){await l.restoreAppAfterNavigate(e,t)}}};X.prototype._handleExitApplication=async function(e,t){if(!e){return}const i=e.getCurrentAppId();if(!i){return}const n=o.isBackNavigation()&&!t;if(n){await this._destroyApplication(i,e)}else{if(e.getIsKeepAlive()){return this._storeApplication(i)}return this._destroyApplication(i,e)}};X.prototype._destroyKeepAliveApps=async function(e,t){try{const i=[];s.forEach(t=>{if(e(t)){i.push(t)}});const n=i.map(e=>this._destroyApplication(e.appId,e.container,t));await Promise.allSettled(n)}catch(e){M.error("_destroyKeepAliveApps call failed",e)}};X.prototype._addStorageEntry=function(e,t,i,n,a){const o=s.get(e);if(o){return o}const r={service:{},shellHash:`#${H.constructShellHash(n)}`,appId:e,stt:"loading",currentState:null,controlManager:null,container:t,meta:undefined,app:undefined,keepAliveMode:a,appTarget:i,ui5ComponentName:i.ui5ComponentName,enableRouterRetrigger:this._bEnableRouterRetrigger,stateStored:false};s.set(e,r);return r};X.prototype.storeAppExtensions=async function(){const e=this.getCurrentApplication();if(!e){return}const t=e.appId;const i=s.get(t);if(!i){return}o.store(i.service);$.store(i);k.store(i)};X.prototype._calculateKeepAliveMode=function(e,t,i){const n=Object.values(f);if(e.startsWith("application-Shell-startIntent")||e.startsWith("application-Shell-startGUI")||e.startsWith("application-Shell-startWDA")){return f.False}let a=new URLSearchParams(window.location.search).get("sap-keep-alive");if(n.includes(a)){return a}a=i.params?.["sap-keep-alive"];if(n.includes(a)){return a}if(t.url){a=F.fromURL(t.url).get("sap-keep-alive");if(n.includes(a)){return a}}const s=H.constructShellHash(i);if(s&&w.isRootIntent(s)){return f.True}return f.False};X.prototype._calculateAppType=function(e){if(e.applicationType==="URL"&&e.additionalInformation?.startsWith?.("SAPUI5.Component=")){return"SAPUI5"}return e.applicationType};X.prototype._reloadCurrentApp=async function(e){const t=h.getById(e.sAppContainerId);if(t){await this._destroyApplication(t.getCurrentAppId(),t)}const i=await B.getServiceAsync("ShellNavigationInternal");try{i.hashChanger.treatHashChanged(e.sCurrentHash)}catch(e){M.error("Error when trying to re-load the current displayed application",e,"sap.ushell.services.AppLifeCycle")}};X.prototype._createOrReuseApplicationContainer=function(e,t,i,n){let a;const o=s.get(e);if(o&&o.container){a=o.container}if(!a){const e=h.findFreeContainerByUrl(i.url);const t=e?.getStatefulType()!==q.NotSupported;if(t){a=e}}if(!a){i.shellUIService=this._oGlobalShellUIService.getInterface();const n=i?.ui5ComponentName;const s=!!n;const o={dataHelpId:t,initialAppId:e,currentAppId:e,currentAppUrl:i.url,shellUIService:i.shellUIService,currentAppTargetResolution:i,applicationType:i.applicationType,openWithPostByAppParam:i.openWithPostByAppParam,reservedParameters:i.reservedParameters,systemAlias:i.systemAlias,targetNavigationMode:i.targetNavigationMode,url:i.url,frameworkId:i.appCapabilities?.appFrameworkId};if(s){a=new _({...o,ui5ComponentName:i.ui5ComponentName})}else{a=new S({...o})}this._oNavContainer.addPage(a)}else{a.setIsFetchedFromCache(true);a.setDataHelpId(t)}h.setContainerActive(a);a.setIsKeepAlive(n);return a};X.prototype._removeApplicationContainerFromNavContainer=function(e){this._oNavContainer.removePage(e.getId(),true)};X.prototype._setApplicationContainerActive=function(e){h.forEach(t=>{if(t&&t!==e){try{M.info(`Deactivating container ${t.getId()}`);t.setActive(false)}catch(e){}}});if(e){M.info(`Activating container "${e.getId()}"`);e.setActive(true)}};X.prototype._openApp=async function(e,t,i,n,a){const o=t.getIsFetchedFromCache();if(a&&o&&u.isStatefulContainerSupportingKeepAlive(t)){return u.restoreAppWithinSameFrame(t,i.url,e,i)}if(t.getStatefulType()===q.ContractV2){if(o&&t.getCurrentAppId()===e){return}const n=await u.createApp(t,i.url,e,i);if(n?.deletedKeepAliveId){const e=s.get(n.deletedKeepAliveId);if(e){s.removeById(n.deletedKeepAliveId);$.destroy(e)}}return}if(t.getStatefulType()===q.ContractV1){if(o&&t.getCurrentAppId()===e){return}await c.createApp(t,e,i);return}const r=i?.ui5ComponentName;const p=!!r;if(p&&!a){const a=!!i?.componentHandle;if(!a){b.setApplicationInInitMode();await l.createApp(t,i,n);const e=R.last("/core/extension/SupportTicket");if(e){w.awaitTimeout(0).then(()=>w.requireAsync(["sap/ushell/UserActivityLog"])).then(([e])=>{e.activate()})}}const s=i.componentHandle;const o=s.getInstance();t.setUi5ComponentId(i.ui5ComponentId);t.setComponentHandle(s);this._oCurrentApplication.app=o;const r=await l.getNavigationRedirectHash(t);if(typeof r==="string"){await this._destroyApplication(e,t);return r}if(typeof o.active==="function"){o.active()}}};X.prototype._announceAppOpening=function(e){window.setTimeout(()=>{const e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=x.i18n.getText("loadingComplete");window.setTimeout(()=>{e.setAttribute("aria-live","off");e.innerHTML=""},0)}},600)};X.prototype.publishAppOpeningEvent=function(e){window.setTimeout(()=>{a.getInstance().publish("launchpad","appOpening",e)},0)};X.prototype.publishAppOpenedEvent=function(e){w.setPerformanceMark("FLP.appOpened");window.setTimeout(()=>{a.getInstance().publish("sap.ushell","appOpened",e)},0);const t=this._publicEventDataFromResolutionResult(e);T.emit("AppRendered",t,true);U.publishExternalEvent("appOpened",t)};X.prototype._publishAppClosedEvent=function(e){window.setTimeout(()=>{a.getInstance().publish("sap.ushell","appClosed",e)},0);const t=this._publicEventDataFromResolutionResult(e);U.publishExternalEvent("appClosed",t)};X.prototype._publicEventDataFromResolutionResult=function(e){const t={};if(!e){return e}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(i=>{t[i]=e[i]});Object.freeze(t);return t};X.prototype._isFullWidth=function(e,t){let i;const n=this._calculateAppType(e);const a=P.getDefaultFullWidthSetting(n);const s=e.appCapabilities?.fullWidth;if(a){if(e.fullWidth===false||e.fullWidth==="false"||t.fullWidth===false||t.fullWidth==="false"||s===false){i=false}}else if(e.fullWidth||e.fullWidth==="true"||t.fullWidth||t.fullWidth==="true"){i=true}if(i===undefined){i=a}return i};X.prototype._getBaseAppId=function(e){const t=H.getStableIntent(e);const i=H.getBasicHash(t);const n=`application-${i}`;return n};X.prototype._getStorageAppId=function(e,t){const i=H.getStableIntent(e);if(this._oStorageAppIdMap[i]){return this._oStorageAppIdMap[i]}let n;if(!this._oStorageAppIdNextIndex[t]){this._oStorageAppIdNextIndex[t]=0;n=t}if(!n){n=`${t}-${this._oStorageAppIdNextIndex[t]}`}this._oStorageAppIdMap[i]=n;this._oStorageAppIdNextIndex[t]++;return n};X.prototype._awaitLastApplicationStart=async function(){const e=new t;const i=this._pLastApplicationStart;this._pLastApplicationStart=this._pLastApplicationStart.then(()=>e.promise);await i;return e};X.prototype._startApplication=async function(e,t,i,n,a){const o=this._getBaseAppId(i.sFixedShellHash);const r=this._getStorageAppId(i.sFixedShellHash,o);await this._cleanupBeforeNewApp(r,t,i,n,a);this._sendFocusBackToShell();this.publishAppOpeningEvent(i);this._announceAppOpening(i);const p=this._calculateKeepAliveMode(r,i,t);const l=p!==f.False;const c=this._createOrReuseApplicationContainer(r,o,i,l);const u=!!s.get(r);if(l){this._oCurrentApplication=this._addStorageEntry(r,c,i,t,p)}else{this._oCurrentApplication={appId:r,stt:"loading",container:c,meta:undefined,app:undefined}}w.setPerformanceMark("FLP - addAppContainer");const h=s.get(r);if(h){k.restore(h)}else{k.flush()}this._setApplicationContainerActive(c);const g=await this._openApp(r,c,i,t,u);const A=new d(r,i,c,g);if(typeof g==="string"){return A}this._initializeAppWithMetadata(c,i);c.setReadyForRendering(true);w.setPerformanceMark("FLP -- centerViewPort");this.publishAppOpenedEvent(i);return A};X.prototype.startApplication=async function(e,t,i,n,a){const s=await this._awaitLastApplicationStart();const o=this._oCurrentApplication;try{const o=await this._startApplication(e,t,i,n,a);s.resolve();return o}catch(e){const t=!!this._oCurrentApplication?.appId;const i=t&&this._oCurrentApplication.appId!==o?.appId;if(i){const e=this._oCurrentApplication.container;if(e){await this._destroyApplication(e.getCurrentAppId(),e,true)}const t=o?.container?.isDestroyed()??true;if(t){this._oCurrentApplication={}}else{this._oCurrentApplication=o}}s.resolve();throw e}};X.prototype.switchViewState=function(e,t,i,n){const a=s.get(this._oCurrentApplication.appId);if(!a){W.destroyManagedControls()}const o=W.getShellMode();const r={TR:{headerless:G.Minimal}};let p;if(!n){p=r[i]?.[o]}W.switchState(e,p);const l=s.get(t);if(l){$.restore(l)}else{$.flush()}W.applyStalledChanges()};X.prototype._isFloatingContainerDocked=function(){const e=D.getModel().getProperty("/floatingContainer/state").includes("docked");const t=D.getModel().getProperty("/floatingContainer/visible");return e&&t};X.prototype._sendFocusBackToShell=function(){if(!i.system.desktop){return}sap.ui.require(["sap/ushell/renderer/AccessKeysHandler"],e=>{const t=W.getLaunchpadState();const i=W.getShellMode()===G.Default;const a=n.getElementById("shellAppTitle");if(a&&t===j.App&&i){const t=a.getFocusDomRef();if(t){e.sendFocusBackToShell(t.getAttribute("id"))}}})};X.prototype._initializeAppWithMetadata=function(e,t){const i=b.getMetadata(t,t?.sFixedShellHash);this._oCurrentApplication.meta=i;if(!e.getIsFetchedFromCache()){e.toggleStyleClass("sapUshellDefaultBackground",!i.hideLightBackground);const n=this._isFullWidth(t,i);if(!n){e.addStyleClass("sapUShellApplicationContainerLimitedWidth")}if(this._isFloatingContainerDocked()&&window.matchMedia("(min-width: 106.4rem)").matches){e.addStyleClass("sapUShellDockingContainer");e.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}else if(this._isFloatingContainerDocked()){e.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}}let n="sap-icon://folder";if(i&&i.icon){n=i.icon}W.updateCurrentState("application.icon",z.Set,n)};X.prototype._cleanupBeforeNewApp=async function(e,t,i,n,a){const o=this.getCurrentApplication()?.container;const r=o&&o.getStatefulType()!==q.NotSupported;if(r){await this._handleExitApplication(o,false)}const p=s.get(e);const l=!!p;const c=p?.container;const d=!!i?.ui5ComponentName;if(l){const i=`#${H.constructShellHash(t)}`;const s=H.compareHashes(i,p.shellHash);const o=s.sameIntent&&s.sameParameters;if(!o){M.warning(`The keepAlive app '${e}' has to be destroyed because of id clashes.`);await this._destroyApplication(e,c)}else if(n&&a){M.warning(`The keepAlive app '${e}' has to be destroyed because of a bookmark start.`);await this._destroyApplication(e,c)}}if(d&&!l){const t=H.getBasicHash(i.sFixedShellHash);const n=`application-${t}-component`;if(o&&o.isA("sap.ushell.appIntegration.UI5ApplicationContainer")){if(o.getUi5ComponentName()===i.ui5ComponentName){M.warning(`The app '${o.getCurrentAppId()}' has to be destroyed because of component name clashes.`);await this._destroyApplication(o.getCurrentAppId(),o,true)}else if(o.getUi5ComponentId()===n){M.warning(`The app '${o.getCurrentAppId()}' has to be destroyed because of component id clashes.`);await this._destroyApplication(o.getCurrentAppId(),o,true)}}await this._destroyKeepAliveApps(t=>{if(t.appId===e){return false}if(t.ui5ComponentName===i.ui5ComponentName){M.warning(`The app '${t.appId}' has to be destroyed because of component name clashes.`);return true}if(t.appTarget?.ui5ComponentId===n){M.warning(`The app '${t.appId}' has to be destroyed because of component id clashes.`);return true}return false},true)}const f=h.findFreeContainerByUrl(i.url);if(f&&f.getStatefulType()===q.ContractV2){let t=false;let i;if(f.getIsInvalidIframe()){t=true;i="iframe is in invalid state"}else if(u.isIframeIsValidSupported(f)){const e=(new Date).getTime()-f.getIsIframeValidTime().time;t=e>=Q;i=`iframe did not ping in the last '${e}' ms`}if(t){M.warning(`Destroying stateful container iframe due to unresponsiveness (${f.getId()})`,`reason: ${i}`,"sap.ushell.appIntegration.AppLifeCycle");return this._destroyApplication(e,f,true)}}};X.prototype.setNavContainer=function(e){this._oNavContainer=e};X.prototype._setContainerReadyForReuse=function(e){if(!e){return}h.setContainerReadyForReuse(e,e.getCurrentAppUrl());e.setIsKeepAlive(false);e.setCurrentAppUrl("");e.setIsFetchedFromCache(false)};X.prototype.reset=function(){this._aDoables.forEach(e=>{e.off()});this._aDoables=[];s._clean();h.destroyAllContainers();I.reset();this._oStorageAppIdMap={};this._oStorageAppIdNextIndex={};this._bDisableHomeAppCache=false;this._bEnableRouterRetrigger=true;this._oCurrentApplication={};this._oNavContainer=null;this._pLastApplicationStart=Promise.resolve();this._oStorageAppIdMap={};this._oStorageAppIdNextIndex={}};return new X});
//# sourceMappingURL=AppLifeCycle.js.map