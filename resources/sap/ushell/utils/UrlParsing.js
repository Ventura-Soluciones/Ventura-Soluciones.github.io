// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/Log","sap/base/util/deepEqual","sap/base/util/merge","sap/ushell/TechnicalParameters"],function(e,t,n,r,a){"use strict";const s={};const o=/^(([A-Za-z0-9_/]+)-([A-Za-z0-9_/-]+)(~([A-Z0-9a-z=+/]+))?)?([?]([^&]|(&[^/]))*&?)?$/;s.getShellHash=function(e){const t=/[^#]*#(([^&]|&[^/])*)(&\/.*)?/;const n=t.exec(e);if(n){return n[1]}return undefined};s.getHash=function(e){const t=/#(.*)/;const n=t.exec(e);if(n){return n[1]}return undefined};s.isIntentUrl=function(e){return this._isIntentUrl(e,window.location.href)};s.isIntentUrlAsync=function(e){return new Promise(function(e,t){sap.ui.require("sap/ushell/Container").getFLPUrlAsync(true).done(e).fail(t)}).then(function(t){return this._isIntentUrl(e,t)}.bind(this))};s._isIntentUrl=function(t,n){const r=/^#/;if(typeof t!=="string"){return false}if(!r.test(t)){const r=new e(t).normalize();const a=`${r.protocol()}://${r.host()}${r.pathname()}`;const s=new e(n).normalize();const o=`${s.protocol()}://${s.host()}${s.pathname()}`;if(a!==o){return false}}const a=s.getHash(t);if(!a){return false}const o=s.parseShellHash(a);if(o&&o.semanticObject&&o.action){return true}return false};s.parseParameters=function(e){try{const t=new URLSearchParams(e);const n=t.keys();let r=n.next();const a={};while(r.done===false){a[decodeURIComponent(r.value)]=t.getAll(r.value);r=n.next()}return a}catch(n){t.error("URL parsing - malformed URL parameters string:",e);return{}}};function c(e,t,n){let r="";t=t||"&";n=n||"=";let a="";const s=[];for(const t in e){if(e.hasOwnProperty(t)){s.push(t)}}s.sort();for(let o=0;o<s.length;o=o+1){const c=s[o];if(Array.isArray(e[c])){for(let s=0;s<e[c].length;s=s+1){r+=a+encodeURIComponent(c)+n+encodeURIComponent(e[c][s]);a=t}}else{r+=a+encodeURIComponent(c)+n+encodeURIComponent(e[c]);a=t}}return r}s.paramsToString=function(e){return c(e)};s.removeParametersWithEmptyValue=function(e,t){if(!e){return}Object.keys(e).forEach(n=>{if(t.includes(n)&&e[n].length===1&&e[n][0]===""){delete e[n]}})};s.privparamsToString=function(e,t,n){return c(e,t,n)};s.addParamsToUrl=function(t,n){const r=new e(t);Object.keys(n).forEach(e=>{r.addSearch(e,n[e])});return r.toString()};s.addShellParamsToURL=function(t,n){const r=new e(t);const a=r.hash();const o=r.toString().replace(a,"");const c=s.parseShellHash(a)||{};Object.assign(c.params,n.params);const i=`#${s.constructShellHash(c)}`;return o+i};s.parseShellHash=function(e){const t=o;if(!e){return undefined}const n=s.splitHash(e);const r=t.exec(n.shellPart);if(r){const e=r[2];const t=r[3];const a=r[5];const o=r[6];const c=s.parseParameters(o);return{semanticObject:e,action:t,contextRaw:a,params:c,appSpecificRoute:n.appSpecificRoute}}if(n.appSpecificRoute){return{semanticObject:undefined,action:undefined,contextRaw:undefined,params:{},appSpecificRoute:n.appSpecificRoute}}return undefined};s.privstripLeadingHash=function(e){if(e[0]==="#"){return e.substring(1)}return e};s.ensureLeadingHash=function(e){if(!e){e="#"}else if(e.charAt(0)!=="#"){e=`#${e}`}return e};s.getBasicHash=function(e){const t=this.parseShellHash(e);if(!t){return""}return`${t.semanticObject}-${t.action}`};s.splitHash=function(e){const t=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/;if(e===undefined||e===null||e===""){return{}}const n=t.exec(e);const r=n[1];if(r!==""&&!o.test(r)){return{}}const a=n[2];if(r||a){return{shellPart:r,appSpecificRoute:a}}return{}};function i(e,t){if(t){return e+t}return e}s.constructShellHash=function(e){let n;if(!e){return""}if(!e.target){e.target={};e.target.semanticObject=e.semanticObject;e.target.action=e.action;e.target.contextRaw=e.contextRaw}if(e.target.shellHash||e.target.shellHash===""){const t=s.privstripLeadingHash(e.target.shellHash);return i(t,e.appSpecificRoute)}if(e.target.semanticObject&&e.target.action){n=`${e.target.semanticObject}-${e.target.action.replace(/[?].*/,"")}`}else{return i("",e.appSpecificRoute)}if(e.target.contextRaw){n+=`~${e.target.contextRaw}`}let r="?";const a=[];for(const t in e.params){if(e.params.hasOwnProperty(t)){a.push(t)}}const o=e.params&&JSON.parse(JSON.stringify(e.params))||{};if(e.appStateKey){a.push("sap-xapp-state");o["sap-xapp-state"]=e.appStateKey}a.sort();for(let e=0;e<a.length;e=e+1){const s=a[e];if(Array.isArray(o[s])){if(o[s].length>1){t.error("Array startup parameters violate the designed intent of the Unified Shell Intent, use only single-valued parameters!")}for(let e=0;e<o[s].length;e=e+1){n+=`${r+encodeURIComponent(s)}=${encodeURIComponent(o[s][e])}`;r="&"}}else{n+=`${r+encodeURIComponent(s)}=${encodeURIComponent(o[s])}`;r="&"}}return i(n,e.appSpecificRoute)};s.compareHashes=function(e,t){const n=this.parseShellHash(e)||{};const r=this.parseShellHash(t)||{};return{sameIntent:this.haveSameIntent(n,r),sameParameters:this.haveSameIntentParameters(n,r),sameAppSpecificRoute:n.appSpecificRoute===r.appSpecificRoute}};s.haveSameIntent=function(e,t){e=e||{};t=t||{};return e.semanticObject===t.semanticObject&&e.action===t.action&&e.contextRaw===t.contextRaw};s.haveSameIntentParameters=function(e,t){e=e||{};t=t||{};const n=r({},e.params);const a=r({},t.params);return!this._parametersChanged(this._removeNonIntentParameters(n),this._removeNonIntentParameters(a))};s.getStableIntent=function(e){const t=this.parseShellHash(e)||{};const n=this._removeNonIntentParameters(t.params);const r=Object.keys(n).sort().reduce((e,t)=>{const r=n[t];r.sort();e[t]=r;return e},{});return this.constructShellHash({target:{semanticObject:t.semanticObject,action:t.action,contextRaw:t.contextRaw},params:r})};s._removeNonIntentParameters=function(e){const t=a.getParameters({isIntentParameter:false});let n;if(e){for(let r=0;r<t.length;r++){n=t[r];if(e[n.name]){delete e[n.name]}}}return e||{}};s._parametersChanged=function(e,t){return!n(e,t)};return s});
//# sourceMappingURL=UrlParsing.js.map