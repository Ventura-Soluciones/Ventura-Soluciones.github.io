//Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/integration/Host","sap/ui/model/json/JSONModel","sap/ushell/Container","sap/ushell/EventHub","sap/ui/model/resource/ResourceModel","./DestinationResolver","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize"],function(e,t,r,o,n,a,s,i){"use strict";return function(l,c){var g=new e(l,c);g._oHostContext=null;g._oHostContextModel=null;g._destinationResolver=new a;g._mUnresolvedDestinations=new WeakMap;g.setResolveDestination(function(e,t){if(!e||!t){return Promise.reject("No destination name or card instance given.")}return g._destinationResolver.resolveCardDestination(e,t).catch(r=>{g._mUnresolvedDestinations.set(t,{error:r,destinationName:e})})});g.attachCardStateChanged(async e=>{const t=e.getParameter("card");const r=t.getBlockingMessage();if(r?.type==="Error"&&g._mUnresolvedDestinations.has(t)){r.illustrationType=s.UnableToLoad;r.illustrationSize=i.ExtraSmall;const e=await g._getBundle();switch(g._mUnresolvedDestinations.get(t)?.error){case a.ERROR_CODES.NO_DESTINATION_FOUND:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.NoDestinationFound.Title",[g._mUnresolvedDestinations.get(t)?.destinationName||""]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.NoDestinationFound.Description",[t.getReferenceId()]);break;case a.ERROR_CODES.COULD_NOT_RETRIEVE_DESTINATIONS:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.CouldNotRetrieveDestinations.Title",[g._mUnresolvedDestinations.get(t)?.destinationName]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.CouldNotRetrieveDestinations.Description");break;case a.ERROR_CODES.NO_CARD_OR_DESTINATION_NAME:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.NoCardOrDestinationName.Title");r.description=e.getText("WorkPage.Host.DestinationResolver.Error.NoCardOrDestinationName.Description");break;case a.ERROR_CODES.RESOLVED_URL_EMPTY:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.ResolvedUrlEmpty.Title",[g._mUnresolvedDestinations.get(t)?.destinationName]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.ResolvedUrlEmpty.Description",[t.getReferenceId()]);break;default:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.Generic.Title",[g._mUnresolvedDestinations.get(t)?.destinationName]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.Generic.Description",[g._mUnresolvedDestinations.get(t)?.error])}t.showBlockingMessage(r);g._mUnresolvedDestinations.delete(t)}});g.attachCardInitialized(function(e){var t=e.getParameter("card");if(t&&t.isA&&t.isA("sap.ui.integration.widgets.Card")){o.emit("UITracer.trace",{source:"Card",reason:"Init",data:{cardId:t.getManifestEntry("/sap.app/id"),providerId:t.getReferenceId()}})}});g._setContainer=function(e){this.oContainer=e};g._setNavigationDisabled=function(e){this._bNavigationDisabled=!!e};g._executeNavigation=function(e){var t=e.getParameter("parameters"),r=e.getParameter("card");if(e.getParameter("type")!=="Navigation"||this._bNavigationDisabled){return Promise.resolve()}if(t&&t.hasOwnProperty("url")){o.emit("UITracer.trace",{reason:"LaunchApp",source:"Card",data:{cardId:r.getManifestEntry("/sap.app/id"),providerId:r.getReferenceId(),targetUrl:t.url}});return Promise.resolve()}e.preventDefault(true);return this.oContainer.getServiceAsync("Navigation").then(function(e){var n={};if(t.hasOwnProperty("ibnTarget")){n.target=t.ibnTarget}if(t.hasOwnProperty("ibnParams")){n.params=t.ibnParams}if(t.hasOwnProperty("ibnAppSpecificRoute")){n.appSpecificRoute=t.ibnAppSpecificRoute}o.emit("UITracer.trace",{reason:"LaunchApp",source:"Card",data:{cardId:r.getManifestEntry("/sap.app/id"),providerId:r.getReferenceId(),targetUrl:"#"+n.target.semanticObject+"-"+n.target.action}});return e.navigate(n)})};g.attachAction(g._executeNavigation.bind(g));g.fetch=function(t,r,n,a){if(a&&a.isA&&a.isA("sap.ui.integration.widgets.Card")){return e.prototype.fetch.apply(this,arguments).then(function(e){o.emit("UITracer.trace",{source:"Card",reason:"FetchData",data:{cardId:a.getManifestEntry("/sap.app/id"),providerId:a.getReferenceId(),targetUrl:t,status:e.status}});return e})}return e.prototype.fetch.apply(this,arguments)};g.getContextValue=function(e){try{if(!e){return Promise.reject()}if(e.charAt(0)==="/"){return g.getContextValue(e.substring(1))}return g.getContext().then(function(){return g._oHostContextModel.getProperty("/"+e+"/value")})}catch(e){return Promise.resolve()}};g.getContext=function(){if(!g._oHostContext){g._oHostContext=r.getServiceAsync("UserInfo").then(function(e){return g._getBundle().then(function(t){return g._applyHostContext(e,t)}).catch(function(){return g._applyHostContext(e)})}).catch(function(){return{}})}return Promise.resolve(g._oHostContext)};g._getBundle=function(){if(!this._oResourceBundle){this._oResourceBundle=new n({bundleName:"sap.ushell.utils.workpage.resources.resources",async:true}).getResourceBundle()}return this._oResourceBundle};g._applyHostContext=function(e,r){if(!r){r={getText:function(e){return e}}}g._oHostContext={"sap.workzone":{label:r.getText("WorkPage.Host.Context.WorkZone.Label"),currentUser:{label:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Label"),id:{label:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Id.Label"),type:"string",tags:["technical"],placeholder:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Id.Placeholder"),description:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Id.Desc"),value:e.getId()},name:{label:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Name.Label"),type:"string",placeholder:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Name.Placeholder"),description:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Name.Desc"),value:e.getFullName()},firstName:{label:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.FirstName.Label"),type:"string",placeholder:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.FirstName.Placeholder"),description:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.FirstName.Desc"),value:e.getFirstName()},lastName:{label:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.LastName.Label"),type:"string",placeholder:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.LastName.Placeholder"),description:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.LastName.Desc"),value:e.getLastName()},email:{label:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Email.Label"),type:"string",placeholder:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Email.Placeholder"),description:r.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Email.Desc"),value:e.getEmail()}}}};g._oHostContextModel=new t(g._oHostContext);return g._oHostContext};return g}});
//# sourceMappingURL=WorkPageHost.js.map