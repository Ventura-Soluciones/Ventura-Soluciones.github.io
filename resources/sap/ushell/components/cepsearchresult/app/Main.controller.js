//Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Core","sap/ui/model/json/JSONModel","./util/Edition","sap/m/library","sap/m/Menu","sap/m/MenuItem","sap/ushell/ui/footerbar/AddBookmarkButton","sap/f/GridContainerItemLayoutData","sap/ushell/EventHub","sap/ushell/Container"],function(e,t,i,a,s,o,r,n,h,l,u){"use strict";var c=s.URLHelper;return e.extend("sap.ushell.components.cepsearchresult.app.Main",{totalCounts:{},onInit:function(){this._sSearchTerm="";this._iTotalCount=0;this._oTabBar=this.byId("searchCategoriesTabs");this._oResourceModel=this.getView().getModel("appI18n");this._oCountModel=new i(this.totalCounts);this._oTabBar.setModel(this._oCountModel,"counts");this.updateTitles();this.applyPersonalization();this.getView().setVisible(false);var e=u?.getRendererInternal();if(e&&e.getRouter&&e.getRouter()){this._oRouter=e.getRouter();this._oRouter.getRoute("wzsearch").attachMatched(this.onRouteMatched.bind(this))}this.changeEdition(a.getEditionName())},onRouteMatched:function(e){var t=e.getParameter("arguments"),i=t["?query"],a=i&&i.searchTerm,s=i&&i.category;this._oEdition.loaded().then(function(){if(a!==this.getSearchTerm()&&s===this.getCategory()){this.changeSearchTerm(a)}else if(s!==this.getCategory()){if(a!==this.getSearchTerm()){this._sSearchTerm=a}this.changeCategory(s)}this.getView().setVisible(true);l.emit("CloseFesrRecord",Date.now())}.bind(this))},changeEdition:function(e){if(e===this._sEditionName){return Promise.resolve()}this._sEditionName=e;this._oEdition=new a(this._sEditionName);return this._oEdition.loaded().then(function(){var e=this._oEdition.getDefaultCategory();this._sCategory=e.getKey();this.updateTabs();if(!this._oRouter){this.updateCategories(true)}this.getView().setVisible(true)}.bind(this))},changeCategory:function(e){this._sCategory=e;this.updateTabs()},changeSearchTerm:function(e){this._sSearchTerm=e;this.updateCategories(true)},getEditionName:function(){return this._sEditionName},getSearchTerm:function(){return this._sSearchTerm},getCategory:function(){return this._sCategory},applyPersonalization:function(){},getPersonalization:function(e,t){var i;i=localStorage.getItem("sap.ushell.components.cepsearchresult.app-"+e);return Promise.resolve(i!==undefined?i:t)},setPersonalization:function(e,t){localStorage.setItem("sap.ushell.components.cepsearchresult.app-"+e,t+"")},updateTabs:function(){var e=this._oTabBar;e.removeAllItems();this._oEdition.getAppMenuItems().map(function(t){e.addItem(t)});e.setModel(this._oEdition.getResourceModel(),"i18n");e.setSelectedKey(this.getCategory());e.setVisible(e.getItems().length>2);this.totalCounts={};this._oCountModel.setData(this.totalCounts);this.updateTitles()},updateCategories:function(e){var t=this._oTabBar,i=t.getSelectedKey();t.getItems().map(function(t){var a=t.getKey(),s=t._getCategoryInstance();if(e){this.detachCategory(s);s.resetData()}if(a===i){this.showCategory(s)}s.setVisible(a===i);this.updateResult(s)}.bind(this))},tabSelectionChange:function(e){this.updateCategories(false)},showCategory:function(e){var t=this.byId("contentCell");t.removeAllWidgets();e.setLayoutData(new h({columns:16,minRows:2}));t.addWidget(e)},updateTitles:function(){var e=0;for(var t in this.totalCounts){if(t!=="all"){e+=this.totalCounts[t]}}this.totalCounts.all=e;this.updateAppTitle(e);this._oCountModel.checkUpdate(true,true)},updateAppTitle:function(e){var t=this.byId("titleText");if(!t){return}var i="...",a=this._oResourceModel.getResourceBundle();if(Number.isInteger(e)){i="("+e+")"}t.setText(a.getText("SEARCHRESULTAPP.HeaderTitle",[this.getSearchTerm()||"",i]))},updateResult:function(e){this.attachCategory(e);e.search(this.getSearchTerm())},attachCategory:function(e){if(!e._attached){e.attachAfterSearch(this.handleAfterSearch,this);e.attachViewAll(this.handleViewAll,this);e._attached=true}},detachCategory:function(e){if(e._attached){e.detachAfterSearch(this.handleAfterSearch,this);e.detachViewAll(this.handleViewAll,this);e._attached=false}},viewAll:function(e,t){this._oTabBar.setSelectedKey(e);var i=this._oTabBar;i.getItems().map(function(i){if(i.getKey()===e){i._getCategoryInstance().setCurrentView(t)}});this.updateCategories()},handleAfterSearch:function(e){this._oCountModel.setProperty("/"+e.getParameter("category"),e.getParameter("count"));this.updateTitles()},handleViewAll:function(e){this.viewAll(e.getParameter("key"),e.getParameter("currentView"))},onAfterRendering:function(){this.adaptScrollArea()},adaptScrollArea:function(){if(this.getView().getDomRef()){var e=this.getView().getDomRef().querySelector(".sapUiCEPSRAppScroll");e.style.height="calc( 100% - "+e.offsetTop+"px )"}},openTitleMenu:function(e){if(!this._oTitleMenu){this._oTitleMenu=new o({items:[new r({text:"{appI18n>SEARCHRESULTAPP.TitleMenu.SaveAsTile}",icon:"sap-icon://header",press:this.triggerBookmark.bind(this),visible:false}),new r({text:"{appI18n>SEARCHRESULTAPP.TitleMenu.Email}",icon:"sap-icon://email",press:this.triggerEmail.bind(this)})]});this._oTitleMenu.setModel(this._oResourceModel,"appI18n")}this._oTitleMenu.openBy(e.getSource())},triggerBookmark:function(){var e=this._oResourceModel.getResourceBundle(),t=this.getSearchTerm(),i=new n({title:e.getText("SEARCHRESULTAPP.Bookmark.Title",[t]),subtitle:"",tileIcon:"sap-icon://search",keywords:"search,result,"+t,showGroupSelection:false,customUrl:document.location.hash});i.firePress()},triggerEmail:function(){var e=this._oResourceModel.getResourceBundle();c.triggerEmail("",e.getText("SEARCHRESULTAPP.EMail.Subject",[this.getSearchTerm()]),document.location.href)},onExit:function(){var e=this._oTabBar;e.getItems().map(function(e){var t=e._getCategoryInstance();this.detachCategory(t);t.resetData()}.bind(this))}})});
//# sourceMappingURL=Main.controller.js.map