// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/base/Log","sap/ui/core/theming/Parameters","sap/ui/core/mvc/Controller","sap/ui/core/Element","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/api/NewExperience","sap/ushell/thirdparty/ui5/webcomponents/Button","sap/ushell/thirdparty/ui5/webcomponents-fiori/ShellBarItem","sap/ushell/state/BackNavigation","sap/ushell/state/BindingHelper","sap/ushell/Container","sap/ushell/Config","sap/ushell/resources","sap/ushell/utils","sap/ushell/EventHub","sap/ushell/ui/shell/ShellAppTitle","sap/ushell/thirdparty/ui5/webcomponents-fiori/ShellBarSpacer"],function(e,t,o,i,n,s,l,a,r,c,h,u,p,g,d,f,m,T,C){"use strict";const A=["NOTIFICATIONSCOUNTBUTTON","PRODUCTSWITCHBTN","USERACTIONSMENUHEADERBUTTON","SF"];return i.extend("sap.ushell.components.shell.ShellBar.controller.ShellBar",{_aDoables:[],_sSapLogo:sap.ui.require.toUrl("sap/ushell/themes/base/img/SAPLogo.svg"),onInit:function(){u.overrideUpdateAggregation(this.byId("shellBar"));this._aDoables.push(g.on("/core/shellHeader/homeUri").do(this._updateHomeUri.bind(this)));this._updateHomeUri(g.last("/core/shellHeader/homeUri"));this.getView().setModel(this.getConfigurationModel(),"config");this.prepareLogo();this.prepareShellAppTitle();this._aDoables.push(m.on("navigateBack").do(this.pressNavBackButton.bind(this)));this._aDoables.push(m.on("navigateFromShellApplicationNavigationMenu").do(this.navigateFromShellApplicationNavigationMenu.bind(this)));s.resize.attachHandler(this.handleResize.bind(this))},handleResize:function(e){if(this._iDebounceTimerHandleResize){clearTimeout(this._iDebounceTimerHandleResize)}this._iDebounceTimerHandleResize=setTimeout(()=>{const e=this.byId("shellBar");e.getBinding("content").refresh(true)},400)},getConfigurationModel:function(){const e=new l({windowTitleExtension:g.last("/core/shell/windowTitleExtension")||""});return e},onContentItemVisibilityChange:function(e){if(this._iDebounceTimerContentItemVisibilityChange){clearTimeout(this._iDebounceTimerContentItemVisibilityChange)}this._iDebounceTimerContentItemVisibilityChange=setTimeout(()=>{const t=e.getParameter("items");const o=a.getShellHeaderControl()?.getId();const i=t.reduce((e,t)=>{const i=t.getId();if(["shellAppTitle",o].includes(i)){e[i]=t}return e},{});if(i.shellAppTitle){i.shellAppTitle.setShowAppTitle(false)}const s=n.getElementById(this.getOwnerComponent().getAppTitle());const l=i[o];if(l){s.setNewExperienceControl(l)}else if(a.getShellHeaderControl()?.getParent()===this.byId("shellBar")){s.setNewExperienceControl(null)}},400)},onSearchButtonClick:function(e){this.getOwnerComponent().fireSearchButtonPress(e)},onSearchFieldToggle:function(e){const t=e.getParameter("expanded")?"EXP_S":"COL";this.getOwnerComponent().setSearchState(t)},onProfileClick:function(){m.emit("showUserActionsMenu",Date.now())},isHeadEndItem:function(e){const t=e.toUpperCase();if(A.includes(t)){return false}const o=n.getElementById(e);return o instanceof c},isContentItem:function(e){const t=e.toUpperCase();if(A.includes(t)){return false}const o=n.getElementById(e);return!(o instanceof c)},isProfileMenu:function(e){return e==="USERACTIONSMENUHEADERBUTTON"},hasNotifications:function(e){const t=e.some(e=>e.toUpperCase()==="NOTIFICATIONSCOUNTBUTTON");if(t){const e=n.getElementById("NotificationsCountButton").getModel("configModel");this.getView().setModel(e,"configModel")}return t},onNotificationsClick:function(){m.emit("showNotifications",Date.now())},hasProducts:function(e){return e.some(e=>e.toUpperCase()==="PRODUCTSWITCHBTN")},onProductSwitchClick:function(){m.emit("showProducts",Date.now())},onLogoClick:function(){p.getServiceAsync("Navigation").then(e=>{e.navigate({target:{shellHash:this.getOwnerComponent().getModel().getProperty("/logo/homeUri")}})})},prepareLogo:function(){const e=this.getOwnerComponent().getModel();this.getCustomLogoAltText();const t=this.getLogo();e.setProperty("/logo/src",t);e.setProperty("/logo/alt",this.getLogoAltText(t))},prepareShellAppTitle:function(){const e=new C({id:"shellBarSpacer"});const t=new T({id:"shellAppTitle",text:"{shellModel>/application/title}",title:"{shellModel>/application/title}",icon:"{shellModel>/application/icon}",subTitle:"{shellModel>/header/secondTitle}"});t.data("hide-order","9999",true);this.getOwnerComponent().setAppTitle(t);p.getRendererInternal("fiori2").addHeaderEndItem({id:t.getId()},true,false);p.getRendererInternal("fiori2").addHeaderEndItem({id:e.getId()},true,false)},_updateHomeUri:function(e){const t=this.getOwnerComponent().getModel();t.setProperty("/logo/homeUri",e);t.setProperty("/logo/isRootIntent",f.isRootIntent(e))},getLogo:function(){const e=g.last("/core/companyLogo/url");if(e!==""){return e}const t=o.get({name:"sapUiGlobalLogo",callback:()=>{this.getOwnerComponent.invalidate()}});if(t){const e=/url[\s]*\('?"?([^'")]*)'?"?\)/.exec(t);if(e){return e[1]}}return this._sSapLogo},getCustomLogoAltText:function(){const o=g.last("/core/companyLogo/accessibleText");let i;delete this._sCustomAltText;if(o){try{const t=JSON.parse(o);if(t){i=e.getLanguage();this._sCustomAltText=t[i];if(!this._sCustomAltText){Object.keys(t).forEach(e=>{if(e.indexOf(i)===0){this._sCustomAltText=t[e]}})}if(!this._sCustomAltText){Object.keys(t).forEach(e=>{if(i.indexOf(e)===0){this._sCustomAltText=t[e]}})}if(!this._sCustomAltText){this._sCustomAltText=t.default}}}catch(e){t.warning("Custom logo image ALT text is not a JSON string.",o);this._sCustomAltText=o}}},getLogoAltText:function(e){if(!e){return""}if(e===this._sSapLogo){return d.i18n.getText("sapLogoText")}return this._sCustomAltText||d.i18n.getText("SHELL_LOGO_TOOLTIP")},pressNavBackButton:async function(){m.emit("showUserActionsMenu",false);h.navigateBack()},navigateFromShellApplicationNavigationMenu:function(e){if(window.hasher.getHash()!==e.substr(1)){m.emit("centerViewPort",Date.now());window.hasher.setHash(e)}var t=n.getElementById("shellAppTitle");if(t){t.close()}},onExit:function(){this._aDoables.forEach(e=>{e.off()});this._aDoables=[]}})});
//# sourceMappingURL=ShellBar.controller.js.map