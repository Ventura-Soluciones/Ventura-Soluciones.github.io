// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/base/Log","sap/ushell/resources","sap/base/util/deepClone","sap/ushell/Container"],function(e,t,i,o,r,n,s){"use strict";return e.extend("sap.ushell.components.shell.Settings.notifications.NotificationsSetting",{onInit:function(){this._oModel=new t({rows:[],originalRows:[]});var e=this.getView(),i;e.setBusy(true);e.setModel(r.getTranslationModel(),"i18n");s.getServiceAsync("NotificationsV2").then(function(t){this._oNotificationService=t;this._initializeFlags();t.readSettings().then(function(e){i=JSON.parse(e);this._oModel.setProperty("/rows",i.value);this._oModel.setProperty("/originalRows",n(i.value))}.bind(this)).finally(function(){e.setBusy(false);e.setModel(this._oModel)}.bind(this))}.bind(this))},onAfterRendering:function(){var e=this._oModel.getProperty("/flags"),t=this._oModel.getProperty("/rows");if(t!==undefined){this._oModel.setProperty("/originalRows",n(t))}if(e!==undefined){this._oModel.setProperty("/originalFlags/highPriorityBannerEnabled",e.highPriorityBannerEnabled)}},onCancel:function(){var e=this._oModel.getProperty("/originalFlags"),t=this._oModel.getProperty("/originalRows");this._oModel.setProperty("/flags/highPriorityBannerEnabled",e.highPriorityBannerEnabled);this._oModel.setProperty("/rows",n(t));this._oModel.setProperty("/originalFlags",{});this._oModel.setProperty("/originalRows",[])},onSave:function(){var e=this._oModel.getProperty("/rows"),t=this._oModel.getProperty("/originalRows"),i,r,n=[],s=[];for(var a=0;a<e.length;a++){i=e[a];r=t[a];if(this._notficationSettingsDiffer(i,r)){n.push(i)}}if(this._flagsHaveChanged()){this._handleFlagsSave()}n.forEach(function(e){s.push(this._oNotificationService.saveSettingsEntry(e))}.bind(this));return Promise.all(s).catch(e=>{o.error("Failed to save the notification settings in the notifivation service.",e,"sap.ushell.components.ushell.settings.notifications.NotificationsSetting");throw e})},_flagsHaveChanged:function(){return this._oModel.getProperty("/flags/highPriorityBannerEnabled")!==this._oModel.getProperty("/originalFlags/highPriorityBannerEnabled")},_handleFlagsSave:function(){var e=this._oModel.getProperty("/flags/highPriorityBannerEnabled");this._oModel.setProperty("/originalFlags/highPriorityBannerEnabled",e);this._oNotificationService.setUserSettingsFlags({highPriorityBannerEnabled:e})},_notficationSettingsDiffer:function(e,t){return e.NotificationTypeId!==t.NotificationTypeId||e.PriorityDefault!==t.PriorityDefault||e.DoNotDeliver!==t.DoNotDeliver||e.DoNotDeliverMob!==t.DoNotDeliverMob||e.DoNotDeliverEmail!==t.DoNotDeliverEmail},onSelectMobile:function(e){var t=e.getSource().getBindingContext().getPath();this._oModel.setProperty(t+"/DoNotDeliverMob",!e.getParameter("selected"))},onSelectEmail:function(e){var t=e.getSource().getBindingContext().getPath();this._oModel.setProperty(t+"/DoNotDeliverEmail",!e.getParameter("selected"))},onSelectHighPriority:function(e){var t=e.getSource().getBindingContext().getPath();if(e.getParameter("selected")){this._oModel.setProperty(t+"/PriorityDefault","HIGH")}else{this._oModel.setProperty(t+"/PriorityDefault","")}},onEnableSwitchChange:function(e){var t=e.getParameter("state"),i=e.getSource().getBindingContext().getPath();this._oModel.setProperty(i+"/DoNotDeliver",!t);this._oModel.setProperty(i+"/DoNotDeliverMob",true);this._oModel.setProperty(i+"/DoNotDeliverEmail",true);this._oModel.setProperty(i+"/PriorityDefault","")},_initializeFlags:function(){var e=this._oNotificationService.getUserSettingsFlags(),t=this._oNotificationService._getNotificationSettingsMobileSupport(),i=this._oNotificationService._getNotificationSettingsEmailSupport();e.then(function(e){this._oModel.setProperty("/flags",{});this._oModel.setProperty("/flags/highPriorityBannerEnabled",e.highPriorityBannerEnabled);this._oModel.setProperty("/flags/mobileNotificationsEnabled",t);this._oModel.setProperty("/flags/emailNotificationsEnabled",i);this._oModel.setProperty("/originalFlags",{});this._oModel.setProperty("/originalFlags/highPriorityBannerEnabled",e.highPriorityBannerEnabled)}.bind(this))}})});
//# sourceMappingURL=NotificationsSetting.controller.js.map