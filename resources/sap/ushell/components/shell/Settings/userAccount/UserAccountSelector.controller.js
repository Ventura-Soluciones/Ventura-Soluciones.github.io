// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/base/Log","sap/ushell/Config","sap/ushell/resources","sap/m/MessageBox","sap/m/MessageToast","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/Container"],function(e,t,n,s,o,i,r,a,l,g){"use strict";return e.extend("sap.ushell.components.shell.Settings.userAccount.UserAccountSelector",{onInit:function(){var e=g.getRendererInternal("fiori2").getShellConfig(),t=e.enableUserImgConsent;this.imgConsentEnabled=t||false;this.oUser=g.getUser();var i=o.getTranslationModel();var r=this.getConfigurationModel();this.getView().setModel(i,"i18n");this.getView().setModel(r,"config");this.oUser.attachOnSetImage(function(){r.setProperty("/icon",s.last("/core/shell/model/userImage/personPlaceHolder"))});g.getServiceAsync("PersonalizationV2").then(function(e){return e.isResetEntirePersonalizationSupported().then(function(e){if(!e){r.setProperty("/isResetPersonalizationVisible",false)}})}).catch(function(e){n.error("The personalization service could not be loaded because of: ."+e.toString())})},getConfigurationModel:function(){var e=new t({}),n=g.getUser(),o=s.last("/core/shell/model/userImage/personPlaceHolder")||"sap-icon://person-placeholder";e.setData({icon:o,name:n.getFullName(),id:n.getId(),mail:n.getEmail(),server:window.location.host,imgConsentEnabled:this.imgConsentEnabled,isImageConsentForUser:n.getImageConsent(),isResetPersonalizationVisible:this.isResetPersonalizationVisible||true,displayUserId:s.last("/core/userSettings/displayUserId")});return e},onCancel:function(){if(this.imgConsentEnabled){this.getView().getModel("config").setProperty("/isImageConsentForUser",this.oUser.getImageConsent())}},onSave:function(e){if(this.imgConsentEnabled){return this.onSaveUserImgConsent(e)}return Promise.resolve()},onSaveUserImgConsent:function(e){var t=this.oUser,s=t.getImageConsent(),o=this.getView().getModel("config"),i=o.getProperty("/isImageConsentForUser"),r;n.debug("[000] onSaveUserImgConsent:current",i,"UserAccountSelector.controller");n.debug("[000] onSaveUserImgConsent:original",s,"UserAccountSelector.controller");if(s!==i){t.setImageConsent(i);return new Promise(function(i,a){r=e();r.then(function(){t.resetChangedProperty("isImageConsent");i()});r.catch(function(e){if(!e.includes("ISIMAGECONSENT")){t.resetChangedProperty("isImageConsent");i()}else{t.setImageConsent(s);t.resetChangedProperty("isImageConsent");o.setProperty("/isImageConsentForUser",s);n.error(e);a(e)}})})}return Promise.resolve()},termsOfUserPress:function(){var e=this.getView().byId("termsOfUseTextFlexBox"),t=this.getView().byId("termsOfUseLink"),n=e.getVisible();e.setVisible(!n);t.setText(o.i18n.getText(n?"userImageConsentDialogShowTermsOfUse":"userImageConsentDialogHideTermsOfUse"))},showMessageBoxWarningDeletePersonalization:function(){i.warning(o.i18n.getText("userAccountResetPersonalizationWarningDialogDescription"),{onClose:this.resetEntirePersonalization.bind(this),actions:[i.Action.OK,i.Action.CANCEL],contentWidth:"600px"})},resetEntirePersonalization:function(e){if(e===i.Action.OK){this.getView().setBusy(true);g.getServiceAsync("PersonalizationV2").then(function(e){return e.resetEntirePersonalization().then(function(){r.show(o.i18n.getText("userAccountResetPersonalizationWarningDialogSuccessToast"),{onClose:l.refreshBrowser})}).catch(this.showErrorMessageBox.bind(this))}.bind(this)).catch(this.showErrorMessageBox.bind(this)).finally(function(){this.getView().setBusy(false)}.bind(this))}},showErrorMessageBox:function(){i.error(o.i18n.getText("userAccountResetPersonalizationWarningDialogErrorDialog"),{actions:i.Action.CLOSE,contentWidth:"600px"})}})});
//# sourceMappingURL=UserAccountSelector.controller.js.map