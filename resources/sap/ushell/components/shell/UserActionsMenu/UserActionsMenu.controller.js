// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/library","sap/m/StandardListItem","sap/ui/core/Element","sap/ui/core/ElementMetadata","sap/ui/core/Fragment","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/Container","sap/ushell/EventHub","sap/ushell/resources","sap/ushell/ui/footerbar/AboutButton","sap/ushell/ui/footerbar/ContactSupportButton","sap/ushell/ui/launchpad/ActionItem","sap/ushell/ui/QuickAccess","sap/ushell/state/ShellModel","sap/ushell/state/StateManager"],function(e,t,n,o,i,s,r,a,l,u,c,p,g,d,h,f,v,A,m){"use strict";const y=t.ListType;const B=t.ButtonType;const I=m.Operation;return r.extend("sap.ushell.components.shell.UserActionsMenu.UserActionsMenu",{_aDanglingControl:[],_aDoables:[],onInit:function(){const e=this.getShellConfig();this._createActionButtons(e);this.oModel=new a(this.getInitialModelData());this._aDoables.push(p.on("showUserActionsMenu").do(e=>{if(this.getPopoverIsOpen()||!e){this._toggleUserActionsMenuPopover(false)}else{this._toggleUserActionsMenuPopover(true)}}))},onExit:function(){this._destroyDanglingControls();this._aDoables.forEach(function(e){e.off()});this._aDanglingControl=[];this._aDoables=[];var e=o.getElementById("sapUshellUserActionsMenuPopover");if(e){e.destroy()}},getInitialModelData:function(){const e=c.getUser();const t=u.last("/core/userActionsMenu/displayUserId");const n={userName:e.getFullName()||"",identifier:t?e.getId():e.getEmail()||e.getId(),initials:e.getInitials(),userEmail:t?e.getEmail():""};return n},filterUserActions:function(t){if(!o.getElementById(t)){e.debug("Could not render ActionItem because it was not created: "+t);return false}else if(t==="logoutBtn"){return!this.getDisplayAvatar()}return true},getModel:function(){return this.oModel},_createActionButtons:function(e){var t=u.last("/core/extension/enableHelp");var n=u.last("/core/shell/enableAbout");if(n){this._createAboutButton(t)}if(!e.moveAppFinderActionToShellHeader&&u.last("/core/catalog/enabled")){this._createAppFinderButton(e,t)}if(!e.moveUserSettingsActionToShellHeader){this._createSettingsButton(t)}if(!e.moveContactSupportActionToShellHeader){this._createSupportTicketButton(t)}if(e.enableRecentActivity&&u.last("/core/shell/model/showRecentActivity")){this._createRecentActivitiesButton();this._createFrequentActivitiesButton()}if(!e.disableSignOut){this._createLogoutButton()}},_createAppFinderButton:function(e,t){if(o.getElementById("openCatalogBtn")){return}var n=new f("openCatalogBtn",{text:g.i18n.getText("open_appFinderBtn"),icon:"sap-icon://sys-find",visible:!e.disableAppFinder,actionType:"action",press:function(){l.start("FLP:AppFinderLoadingStartToEnd","AppFinderLoadingStartToEnd","FLP");c.getServiceAsync("Navigation").then(function(e){e.navigate({target:{semanticObject:"Shell",action:"appfinder"}})})}});if(t){n.addStyleClass("help-id-openCatalogActionItem")}this._addDanglingControl(n);m.updateAllBaseStates("userActions.items",I.Add,n.getId())},_createAboutButton:function(e){var t="aboutBtn";if(!o.getElementById(t)){var n=new d(t);if(e){n.addStyleClass("help-id-"+t)}this._addDanglingControl(n);this.getRenderer().showActionButton(t,false)}},_createSettingsButton:function(e){var t="userSettingsBtn";if(!o.getElementById(t)){var n=new f(t,{tooltip:g.i18n.getText("ControlKey")+" + "+g.i18n.getText("CommaKey"),text:g.i18n.getText("userSettings"),icon:"sap-icon://action-settings",press:function(){p.emit("openUserSettings",Date.now())}});if(e){n.addStyleClass("help-id-loginDetails")}this._addDanglingControl(n)}m.updateAllBaseStates("userActions.items",I.Add,t)},_createSupportTicketButton:function(e){u.on("/core/extension/SupportTicket").do(function(t){var n="ContactSupportBtn";var i=o.getElementById(n);if(t&&!i){i=new h(n);this._addDanglingControl(i);if(e){i.addStyleClass("help-id-contactSupportBtn")}}if(t){this.getRenderer().showActionButton(n)}else{this.getRenderer().hideActionButton(n)}}.bind(this))},_createRecentActivitiesButton:function(){var e="recentActivitiesBtn";u.on("/core/shell/model/enableTrackingActivity").do(function(t){if(t){var n=o.getElementById(e);if(!n){n=new f(e,{text:g.i18n.getText("recentActivities"),icon:"sap-icon://customer-history",press:function(){v.openQuickAccessDialog("recentActivityFilter","userActionsMenuHeaderButton")}});this._addDanglingControl(n)}this.getRenderer().showActionButton(e,false)}else{this.getRenderer().hideActionButton(e,false)}}.bind(this))},_createFrequentActivitiesButton:function(){var e="frequentActivitiesBtn";u.on("/core/shell/model/enableTrackingActivity").do(function(t){if(t){var n=o.getElementById(e);if(!n){n=new f(e,{text:g.i18n.getText("frequentActivities"),icon:"sap-icon://activity-individual",tooltip:g.i18n.getText("frequentActivitiesTooltip"),press:function(){v.openQuickAccessDialog("frequentlyUsedFilter","userActionsMenuHeaderButton")}});this._addDanglingControl(n)}this.getRenderer().showActionButton(e,false)}else{this.getRenderer().hideActionButton(e,false)}}.bind(this))},_createLogoutButton:function(){var e="logoutBtn";if(o.getElementById(e)){return}var t=new f(e,{visible:true,type:B.Transparent,icon:"sap-icon://log",text:g.i18n.getText("signoutBtn_title"),press:this.logout});this._addDanglingControl(t);this.getRenderer().showActionButton(e,false)},logout:function(){sap.ui.require(["sap/m/MessageBox","sap/ushell/ui/launchpad/LoadingDialog"],function(e,t){var n=new t({text:""});var o=true;var s=false;var r={};c.getGlobalDirty().done(function(a){o=false;if(s===true){n.exit();n=new t({text:""})}var l=function(){var t=g.i18n;if(a===c.DirtyState.DIRTY){r.message=t.getText("unsaved_data_warning_popup_message");r.icon=e.Icon.WARNING;r.messageTitle=t.getText("unsaved_data_warning_popup_title")}else{r.message=t.getText("signoutConfirmationMsg");r.icon=e.Icon.QUESTION;r.messageTitle=t.getText("signoutMsgTitle")}return r};r=l(a);e.show(r.message,r.icon,r.messageTitle,[e.Action.OK,e.Action.CANCEL],function(t){if(t===e.Action.OK){n.openLoadingScreen();n.showAppInfo(g.i18n.getText("beforeLogoutMsg"),null);c.defaultLogout()}},i.uid("confirm"))});if(o===true){n.openLoadingScreen();s=true}})},_addDanglingControl:function(e){this._aDanglingControl.push(e)},_destroyDanglingControls:function(){if(this._aDanglingControl){this._aDanglingControl.forEach(function(e){if(e.destroyContent){e.destroyContent()}e.destroy()})}},_toggleUserActionsMenuPopover:async function(e){let t;var n=new Promise(e=>{if(this.getDisplayAvatar()){t="sap.ushell.components.shell.UserActionsMenu.UserActionsMenu";sap.ui.require(["sap/ushell/thirdparty/ui5/webcomponents-fiori/UserMenuItem"],()=>{e()})}else{t="sap.ushell.components.shell.UserActionsMenu.UserActionsMenuPopover";e()}});if(!this.oPopover){await Promise.all([n,s.load({name:t,type:"XML",controller:this})]).then(t=>{this.oPopover=t[1];this.oPopover.setModel(this.getModel());this.oPopover.setModel(A.getModel(),"shellModel");if(this.getDisplayAvatar()){this.oPopover.placeAt("WebComponents-shellArea","last");this.oPopover.attachClose(()=>{this.popoverClose()})}return this._toggleUserActionsMenuPopover(e)})}else if(e){m.refreshState("userActions.items");this.popoverOpen()}else{this.popoverClose();if(window.document.activeElement&&window.document.activeElement.id!=="userActionsMenuHeaderButton"){window.document.getElementById("userActionsMenuHeaderButton")?.focus()}}},onItemPress:function(e){const t=e.getParameter("item").data("actionItemId");const n=o.getElementById(t);if(n){n.firePress();p.emit("showUserActionsMenu",false)}},userActionsMenuItemFactory:function(e,t){var n=o.getElementById(t.getObject());const i=sap.ui.require("sap/ushell/thirdparty/ui5/webcomponents-fiori/UserMenuItem");return new i({id:e+"-"+n.getId(),icon:n.getIcon(),text:n.getText(),tooltip:n.getTooltip(),visible:n.getVisible(),customData:[{key:"actionItemId",value:n.getId()}]})},userActionsMenuPopoverItemFactory:function(e,t){var i=o.getElementById(t.getObject());return new n({id:e+"-"+i.getId(),icon:i.getIcon(),tooltip:i.getTooltip(),iconInset:true,title:i.getText(),visible:i.getVisible(),type:y.Active,customData:[{key:"actionItemId",value:i.getId()}],press:function(){if(i){i.firePress();p.emit("showUserActionsMenu",false)}}}).addStyleClass("sapUshellUserActionsMenuActionItem")},getRenderer:function(){if(!this._oRenderer){this._oRenderer=c.getRendererInternal("fiori2")}return this._oRenderer},getShellConfig:function(){return this.getRenderer().getShellConfig()},getDisplayAvatar:function(){return!!u.last("/core/userActionsMenu/displayAvatar")},getPopoverIsOpen:function(){if(this.getDisplayAvatar()){return this.bPopoverOpen||this.oPopover?.getOpen()}return this.oPopover?.isOpen()},popoverOpen:function(){if(this.getDisplayAvatar()){this.bPopoverOpen=true;return this.oPopover.setOpen(true)}return this.oPopover.openBy(o.getElementById("userActionsMenuHeaderButton"))},popoverClose:function(){if(this.getDisplayAvatar()){window.setTimeout(()=>{this.bPopoverOpen=false},400);return this.oPopover.setOpen(false)}return this.oPopover.close()}})});
//# sourceMappingURL=UserActionsMenu.controller.js.map