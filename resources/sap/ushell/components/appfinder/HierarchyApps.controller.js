// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/View","sap/ui/core/mvc/Controller","sap/ui/thirdparty/jquery","sap/m/MessageToast","sap/ushell/resources","sap/ushell/Container"],function(e,t,jQuery,r,o,a){"use strict";var s;return t.extend("sap.ushell.components.appfinder.HierarchyApps",{onInit:function(){var e=this.getView().getViewData().easyAccessSystemsModel;if(e){this.getView().setModel(e,"easyAccessSystems")}s=this.getView().getViewData().CatalogsManager&&this.getView().getViewData().CatalogsManager.getInstance()},getCrumbsData:function(e,t){var r=e.split("/");r.splice(r.length-2,2);var o=[];while(r.length){var a=r.join("/");var s=t.getProperty(a+"/text");o.unshift({text:s,path:a});r.splice(r.length-2,2)}return o},_updateAppBoxedWithPinStatuses:function(e){var t=this.getView();if(!e){e=t.layout.getBinding("items").getPath()}var r=t.getModel("easyAccess");var o=r.getProperty(e)?r.getProperty(e):[];this.getView().oVisualizationOrganizerHelper.updateBookmarkCount.call(this,o).then(function(t){r.setProperty(e,t)})},updateBookmarkCount:function(e){return a.getServiceAsync("BookmarkV2").then(function(t){var r=e.map(function(e){return t.countBookmarks(e.url).then(function(t){e.bookmarkCount=t;return e})});return new Promise(function(e){jQuery.when.apply(jQuery,r).then(function(){var t=Array.prototype.slice.call(arguments);e(t)})})})},updatePageBindings:function(e){this.getView().layout.bindAggregation("items","easyAccess>"+e+"/apps",this.getView().oItemTemplate);this._updateAppBoxedWithPinStatuses(e+"/apps");this.getView().breadcrumbs.bindProperty("currentLocationText","easyAccess>"+e+"/text");var t=this.getCrumbsData(e,this.getView().getModel("easyAccess"));this.getView().crumbsModel.setProperty("/crumbs",t);var r=this.getView().getModel("easyAccess").getProperty(e+"/apps");this.getView().updateResultSetMessage(r.length,false)},onAppBoxPressed:function(e){if(e.mParameters.srcControl.$().closest(".sapUshellPinButton").length){return}var t=e.getSource().getProperty("url");if(t&&t.indexOf("#")===0){hasher.setHash(t)}},_handleSuccessMessage:function(e,t){var a;var s=t.addToGroups?t.addToGroups.length:0;var i=t.newGroups?t.newGroups.length:0;var n=s+i;if(n===1){var u;if(s===1){u=t.addToGroups[0].title}else{u=t.newGroups[0]}a=o.i18n.getText("appAddedToSingleGroup",[e.text,u])}else{a=o.i18n.getText("appAddedToSeveralGroups",[e.text,n])}if(n>0){r.show(a,{duration:3e3,width:"15em",my:"center bottom",at:"center bottom",of:window,offset:"0 -50",collision:"fit fit"})}return a},_prepareErrorMessage:function(e,t){var r,o,a,s=0,i=false,n;for(var u in e){r=e[u].group;o=e[u].action;if(o==="addBookmark_ToExistingGroup"){s++;if(s===1){a=r.title}}else if(o==="addBookmark_ToNewGroup"){s++;if(s===1){a=r}}else{i=true}}if(i){if(e.length===1){n={messageId:"fail_tile_operation_create_new_group"}}else{n={messageId:"fail_tile_operation_some_actions"}}}else if(e.length===1){n={messageId:"fail_app_operation_add_to_group",parameters:[t,a]}}else{n={messageId:"fail_app_operation_add_to_several_groups",parameters:[t]}}return n},_handleBookmarkAppPopoverResponse:function(e,t){var r=[];t.newGroups.forEach(function(t){r.push(this._createGroupAndAddBookmark(t,e))}.bind(this));t.addToGroups.forEach(function(t){r.push(this._addBookmark(t,e))}.bind(this));return jQuery.when.apply(jQuery,r).then(function(){var r=Array.prototype.slice.call(arguments);this._handlePopoverGroupsActionPromises(e,t,r)}.bind(this))},_handlePopoverGroupsActionPromises:function(e,t,r){var o=r.filter(function(e,t,r){return!e.status});if(o.length){var a=this._prepareErrorMessage(o,e.text);s.notifyOnActionFailure(a.messageId,a.parameters);return}this._updateAppBoxedWithPinStatuses();this._handleSuccessMessage(e,t)},_createGroupAndAddBookmark:function(e,t){var r=jQuery.Deferred(),o={};var a=s.createGroup(e);a.done(function(a){var s=this._addBookmark(a.getObject(),t,true);s.done(function(e){r.resolve(e)}).fail(function(){o={group:e,status:0,action:"addBookmark_ToNewGroup"};r.resolve(o)})}.bind(this)).fail(function(){o={group:e,status:0,action:"addBookmark_NewGroupCreation"};r.resolve(o)});return r.promise()},_addBookmark:function(e,t,r){var o=jQuery.Deferred(),s={};a.getServiceAsync("BookmarkV2").then(function(a){var i=a.addBookmark({url:t.url,title:t.text,subtitle:t.subtitle,icon:t.icon},e.object);var n=r?"addBookmark_ToNewGroup":"addBookmark_ToExistingGroup";i.then(function(){s={group:e,status:1,action:n};o.resolve(s)}).catch(function(){s={group:e,status:0,action:n};o.resolve(s)})});return o.promise()},showSaveAppPopover:function(e){this.getView().oVisualizationOrganizerHelper.onHierarchyAppsPinButtonClick.call(this,e).then(function(e){if(e){this._updateAppBoxedWithPinStatuses()}}.bind(this))},showGroupListPopover:function(t){var r=this.getView().getModel();var o=t.oSource.getParent().getBinding("title").getContext().getObject();var a=t.oSource;if(r.getProperty("/groupContext").path){var s=r.getProperty("/groupContext").path;var i=r.getProperty(s);var n={newGroups:[],addToGroups:[i]};this._handleBookmarkAppPopoverResponse(o,n);return}var u=r.getProperty("/groups").map(function(e){return{selected:false,initiallySelected:false,oGroup:e}});e.create({viewName:"module:sap/ushell/components/appfinder/GroupListPopoverView",viewData:{enableHideGroups:r.getProperty("/enableHideGroups"),enableHelp:r.getProperty("/enableHelp"),singleGroupSelection:true}}).then(function(e){e.getController().initializeData({groupData:u});var t=e.open(a);t.then(this._handleBookmarkAppPopoverResponse.bind(this,o));this.getView().addDependent(e);return e}.bind(this))},resultTextFormatter:function(e,t){var r=o.i18n;if(e){var a=e.systemName?e.systemName:e.systemId;var s="";if(t){s=r.getText("search_easy_access_results",[t,a])}return s}return""},showMoreResultsVisibilityFormatter:function(e,t){if(e&&e.length<t){return true}return false},showMoreResultsTextFormatter:function(e,t){if(!e||!t){return""}var r=e.length;return o.i18n.getText("EasyAccessSearchResults_ShowMoreResults",[r,t])}})},true);
//# sourceMappingURL=HierarchyApps.controller.js.map