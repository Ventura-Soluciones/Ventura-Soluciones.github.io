//Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/pages/controller/PagesAndSpaceId","sap/ushell/Config","sap/ushell/Container","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/core/Component","sap/ui/core/ComponentContainer"],function(e,t,o,n,i,a,s,r){"use strict";return e.extend("sap.ushell.components.runtimeSwitcher.controller.RuntimeSwitcher",{onInit:function(){this.oNavContainer=this.byId("switcherNavContainer");this.oPagesRuntime=this.byId("pagesRuntime");this.oWorkpageRuntime=this.byId("workpagesRuntime");this.oWorkpageRuntime.addEventDelegate({onBeforeFirstShow:this._onBeforeFirstShowWorkpageRuntime.bind(this)});this.oPagesRuntime.addEventDelegate({onBeforeFirstShow:this._onBeforeFirstShowPagesRuntime.bind(this)});this._oInitPromise=this._handleRouter().then(function(){var e=n.getRendererInternal();this.oContainerRouter=e.getRouter();this.oContainerRouter.getRoute("home").attachMatched(this._handleRouter,this);this.oContainerRouter.getRoute("openFLPPage").attachMatched(this._handleRouter,this)}.bind(this))},_createComponentContainer:function(e){return new r(e)},_onBeforeFirstShowPagesRuntime:function(){const e=this;return s.create({name:"sap.ushell.components.pages",componentData:{navigationDisabled:true},asyncHints:{preloadBundles:["sap/ushell/preload-bundles/homepage-af-dep.js"]},manifest:true}).then(t=>{const o=e._createComponentContainer({component:t,height:"100%",async:true});o.placeAt(e.byId("pagesRuntime"));e.oPageRuntimeComponent=t})},_onBeforeFirstShowWorkpageRuntime:function(){const e=this;const t=this._getWorkpageComponentProperties();return s.create(t).then(function(t){const o=new e._createComponentContainer({component:t,height:"100%",async:true});o.placeAt(e.byId("workpagesRuntime"));e.oWorkPageRuntimeComponent=t;if(typeof e.oWorkPageRuntimeComponent?.setPageId==="function"&&e._sCurrentPageId){e.oWorkPageRuntimeComponent.setPageId(e._sCurrentPageId);e._sCurrentPageId=undefined}})},_handleRouter:function(){var e;if(o.last("/core/workPages/myHome/pageId")){this._toggleToWorkPagesRuntime(o.last("/core/workPages/myHome/pageId"));return Promise.resolve()}return Promise.all([t.getPageAndSpaceId(),n.getServiceAsync("Menu")]).then(function(t){var o;e=t[0]&&t[0].pageId;if(!e){return Promise.reject("No pageId found")}o=t[1];return o.isWorkPage(e)}).then(function(t){if(t||new URLSearchParams(window.location.search).get("sap-ushell-rt")==="workpage"){this._toggleToWorkPagesRuntime(e)}else{this._toggleToPagesRuntime()}}.bind(this)).catch(function(){this._toggleToPagesRuntime()}.bind(this))},_toggleToPagesRuntime:function(){this.oNavContainer.to(this.oPagesRuntime);if(this.oWorkPageRuntimeComponent){if(typeof this.oWorkPageRuntimeComponent.hideRuntime==="function"){this.oWorkPageRuntimeComponent.hideRuntime()}}if(this.oPageRuntimeComponent){this.oPageRuntimeComponent.onRouteMatched()}},_toggleToWorkPagesRuntime:function(e){this.oNavContainer.to(this.oWorkpageRuntime);if(this.oPageRuntimeComponent){this.oPageRuntimeComponent.hideRuntime()}if(this.oWorkPageRuntimeComponent){if(typeof this.oWorkPageRuntimeComponent.onRouteMatched==="function"){this.oWorkPageRuntimeComponent.onRouteMatched()}else if(typeof this.oWorkPageRuntimeComponent.setPageId==="function"){this.oWorkPageRuntimeComponent.setPageId(e)}}else{this._sCurrentPageId=e}},onExit:function(){this.oContainerRouter.getRoute("home").detachRouteMatched(this._handleRouter,this);this.oContainerRouter.getRoute("openFLPPage").detachRouteMatched(this._handleRouter,this)},_getWorkpageComponentProperties:function(){const e=o.last("/core/customPreload/enabled")?o.last("/core/customPreload/coreResourcesComplement"):[];const t=i({componentData:{navigationDisabled:true,pageWidthSizeMode:n.getFLPPlatform(true)==="MYHOME"?"large":"fullWidth"},manifest:true},o.last("/core/workPages/component"));const s=t.addCoreResourcesComplement===undefined?true:t.addCoreResourcesComplement;if(s){const o=a.get("asyncHints.preloadBundles",t)||[];a.set("asyncHints.preloadBundles",o.concat(e),t)}delete t.addCoreResourcesComplement;return t}})});
//# sourceMappingURL=RuntimeSwitcher.controller.js.map