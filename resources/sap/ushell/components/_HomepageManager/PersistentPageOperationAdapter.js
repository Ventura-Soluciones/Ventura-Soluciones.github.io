// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/Object","sap/ushell/Config","sap/ushell/resources","sap/ushell/components/MessagingHelper","sap/m/GenericTile","sap/base/util/uid","sap/base/Log","sap/ui/performance/Measurement","sap/m/library","sap/base/util/deepEqual","sap/ushell/Container"],function(e,r,i,t,o,n,a,u,l,s,d){"use strict";var c=l.GenericTileMode;var g=l.LoadState;var p=e.extend("sap.ushell.components._HomepageManager.PersistentPageOperationAdapter",{constructor:function(r){e.call(this);this.oPageBuilderService=r},_getIsAppBox:function(e){var r=this.oPageBuilderService,i=!!(r.getCatalogTileTargetURL(e)&&(r.getCatalogTilePreviewTitle(e)||r.getCatalogTilePreviewSubtitle(e)));return i},getCurrentHiddenGroupIds:function(e){var r=e.getProperty("/groups"),i=[],t,o,n;for(o=0;o<r.length;o++){n=r[o]?r[o].isGroupVisible:true;if(r[o].object){t=this.oPageBuilderService.getGroupId(r[o].object)}if(!n&&t!==undefined){i.push(t)}}return i},getPreparedTileModel:function(e,i,t){var a=this.oPageBuilderService,u=n(),l,s=a.getTileSize(e),d=[],g;t=t||a.getTileType(e);if(t==="link"){d=[new o({mode:c.LineMode})]}l={isCustomTile:!this._getIsAppBox(e),object:e,originalTileId:a.getTileId(e),uuid:u,tileCatalogId:encodeURIComponent(a.getCatalogTileId(e)),tileCatalogIdStable:a.getStableCatalogTileId(e)||"",content:d,long:s==="1x2",target:a.getTileTarget(e)||"",debugInfo:a.getTileDebugInfo(e),isTileIntentSupported:a.isTileIntentSupported(e),rgba:"",isLocked:i,showActionsIcon:r.last("/core/home/enableTileActionsIcon"),isLinkPersonalizationSupported:a.isLinkPersonalizationSupported(e),navigationMode:undefined};if(t==="card"){g=a.getCardManifest(e);l.isCard=true;if(g){l.manifest=g}}return l},getPreparedGroupModel:function(e,i,o,u){var l=this.oPageBuilderService,s=e&&l.getGroupTiles(e)||[],d=[],c=[],g,p=r.last("/core/shell/model/personalization"),f=r.last("/core/extension/enableHelp");var h=!!(e&&l.isGroupLocked(e)),v=!!(e&&l.isGroupFeatured(e));for(g=0;g<s.length;++g){var P=s[g],G=l.getTileType(P).toLowerCase();if(G==="tile"||G==="card"){d.push(this.getPreparedTileModel(s[g],h,G))}else if(G==="link"){c.push(this.getPreparedTileModel(s[g],h,G))}else{a.error("Unknown tile type: '"+G+"'",undefined,"sap.ushell.components.HomepageManager")}}return{title:i&&t.getLocalizedText("my_group")||e&&l.getGroupTitle(e)||u&&u.title||"",object:e,groupId:n(),helpId:f&&e?l.getGroupId(e):null,links:c,pendingLinks:[],tiles:d,isDefaultGroup:!!i,editMode:!e,isGroupLocked:h,isFeatured:v,visibilityModes:[true,true],removable:!e||l.isGroupRemovable(e),sortable:p,isGroupVisible:!e||l.isGroupVisible(e),isEnabled:!i,isLastGroup:o||false,isRendered:!!(u&&u.isRendered),isGroupSelected:false}},getPage:function(){u.start("FLP:DashboardManager.loadPersonalizedGroups","loadPersonalizedGroups","FLP");return this._getGroupsFromServer().then(this.loadGroupsFromArray.bind(this))},_getGroupsFromServer:function(){var e=this;return new Promise(function(r,i){e.oPageBuilderService.getGroups().done(function(e){u.end("FLP:DashboardManager.loadPersonalizedGroups");r(e)}).fail(i)})},loadGroupsFromArray:function(e){var r=this;u.start("FLP:DashboardManager.loadGroupsFromArray","loadGroupsFromArray","FLP");u.start("FLP:DashboardManager.getDefaultGroup","getDefaultGroup","FLP");return new Promise(function(i,t){r.oPageBuilderService.getDefaultGroup().done(function(t){u.end("FLP:DashboardManager.getDefaultGroup");if(e.length===0&&t===undefined){i([]);return}var o=0,n,a=[],l,d;e=r._sortGroups(t,e);d=e.findIndex(function(e){return s(e,t)});l=e.length;u.start("FLP:DashboardManager._getGroupModel","_getGroupModel","FLP");for(o=0;o<l;++o){n=r.getPreparedGroupModel(e[o],o===d,o===l-1);n.index=o;a.push(n)}u.end("FLP:DashboardManager._getGroupModel");u.end("FLP:DashboardManager.loadGroupsFromArray");i(a)}).fail(t)})},_sortGroups:function(e,i){var t=0,o=this,n=i.findIndex(function(r){return s(r,e)}),a=[],u,l,d;if(n>-1){i.splice(n,1)}while(t<i.length){l=i[t];d=this.oPageBuilderService.isGroupLocked(l);if(d){a.push(l);i.splice(t,1)}else{t++}}if(!r.last("/core/home/disableSortedLockedGroups")){a.sort(function(e,r){var i=o.oPageBuilderService.getGroupTitle(e).toLowerCase(),t=o.oPageBuilderService.getGroupTitle(r).toLowerCase();return i<t?-1:1})}a.sort(function(e,r){var i=o.oPageBuilderService.isGroupFeatured(e),t=o.oPageBuilderService.isGroupFeatured(r);if(i===t){return 0}else if(i>t){return-1}return 1});u=a;u.push(e);u.push.apply(u,i);return u},addGroupAt:function(e,r,i){var t=this;return new Promise(function(o,n){try{if(r===undefined){t.oPageBuilderService.addGroup(e.title).done(function(r){o(t.getPreparedGroupModel(r,i,e.isLastGroup,undefined))}).fail(n)}else{t.oPageBuilderService.addGroupAt(e.title,r).done(function(r){o(t.getPreparedGroupModel(r,i,e.isLastGroup,undefined))}).fail(n)}}catch(e){n()}})},renameGroup:function(e,r,i){var t=this;return new Promise(function(i,o){try{t.oPageBuilderService.setGroupTitle(e.object,r).done(function(){i()}).fail(o)}catch(e){o()}})},deleteGroup:function(e){var r=this,i=e.object;return new Promise(function(e,t){try{r.oPageBuilderService.removeGroup(i).done(function(){e()}).fail(t)}catch(e){t()}})},moveGroup:function(e,r,i){var t=this;return new Promise(function(i,o){try{t.oPageBuilderService.moveGroup(e.object,r).done(function(){i()}).fail(o)}catch(e){o()}})},resetGroup:function(e,r){var i=this,t=e.object;return new Promise(function(o,n){try{i.oPageBuilderService.resetGroup(t).done(function(n){o(i.getPreparedGroupModel(n||t,r,e.isLastGroup,undefined))}).fail(n)}catch(e){n()}})},refreshGroup:function(e){var r=this,i="Failed to refresh group with id:"+e+" in the model";return new Promise(function(t){r.oPageBuilderService.getGroups().fail(function(){a.error(i,null,"sap.ushell.components.HomepageManager");t(null)}).done(function(i){var o=null;for(var n=0;n<i.length;n++){if(r.oPageBuilderService.getGroupId(i[n])===e){o=i[n];break}}if(o){r.oPageBuilderService.getDefaultGroup().done(function(i){var n=e===i.getId(),a=r.getPreparedGroupModel(o,n,false,{isRendered:true});t(a)})}else{t(null)}})})},getIndexOfGroup:function(e,r){var i=-1,t=this,o=this.oPageBuilderService.getGroupId(r);e.every(function(e,r){var n=t.oPageBuilderService.getGroupId(e.object);if(n===o){i=r;return false}return true});return i},getOriginalGroupIndex:function(e){var r=this.oPageBuilderService,i=e.object,t=this.oPageBuilderService.getGroups();return new Promise(function(e,o){t.done(function(t){var o;for(var n=0;n<t.length;n++){if(r.getGroupId(t[n])===r.getGroupId(i)){o=n;break}}e(o)}).fail(o)})},moveTile:function(e,r,i,t,o){var n=this,a,u=new Promise(function(u,l){try{var s=n.oPageBuilderService.moveTile(e.object,r.tileIndex,r.newTileIndex,i.object,t.object,o);s.done(function(e){a=e;u(e)});s.fail(l)}catch(e){l()}});return u.then(this._getTileViewAsPromise.bind(this)).then(function(e){return Promise.resolve({content:e,originalTileId:n.oPageBuilderService.getTileId(a),object:a})})},removeTile:function(e,r){var i=this,o=r.object,n=i.oPageBuilderService.getTileTitle(o),a;a=new Promise(function(r,a){try{i.oPageBuilderService.removeTile(e.object,o).done(function(){t.showLocalizedMessage("tile_deleted_msg",[n,e.title]);r()}).fail(a)}catch(e){a()}});return a},_getTileViewAsPromise:function(e){var r=this,i=new Promise(function(i,t){var o=r.oPageBuilderService.getTileView(e);o.done(i);o.fail(t)});return i},refreshTile:function(e){this.oPageBuilderService.refreshTile(e)},setTileVisible:function(e,r){this.oPageBuilderService.setTileVisible(e,r)},getTileType:function(e){return this.oPageBuilderService.getTileType(e)},getTileSize:function(e){return this.oPageBuilderService.getTileSize(e)},getTileTitle:function(e){return this.oPageBuilderService.getTileTitle(e.object)},getTileId:function(e){return this.oPageBuilderService.getTileId(e)},isLinkPersonalizationSupported:function(e){return this.oPageBuilderService.isLinkPersonalizationSupported(e)},getTileTarget:function(e){return this.oPageBuilderService.getTileTarget(e.object)},getTileView:function(e){return this.oPageBuilderService.getTileView(e.object)},getTileActions:function(e){return this.oPageBuilderService.getTileActions(e)},getFailedLinkView:function(e){var r=this.oPageBuilderService.getCatalogTilePreviewSubtitle(e.object);var t=this.oPageBuilderService.getCatalogTilePreviewTitle(e.object);if(!t&&!r){t=i.i18n.getText("cannotLoadLinkInformation")}return new o({mode:c.LineMode,state:g.Failed,header:t,subheader:r})},getTileModelByCatalogTileId:function(e){a.error("Cannot get tile with id "+e+": Method is not supported")},transformGroupModel:function(){return}});var f=null;return{getInstance:function(e){if(!f){f=new p(e)}return f},destroy:function(){f=null}}});
//# sourceMappingURL=PersistentPageOperationAdapter.js.map