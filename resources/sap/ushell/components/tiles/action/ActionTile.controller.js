// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/Log"],function(t,e,i,jQuery,n){"use strict";return t.extend("sap.ushell.components.tiles.action.ActionTile",{onInit:function(){var t=this.getView();var n=t.getViewData();var o=e.getResourceBundleModel();var r=n.chip;var a=e.getActionConfiguration(r);var g=this;function c(t,e){var i=o.getResourceBundle();var n=i.getText("configuration.semantic_object")+":\n"+t+"\n\n"+i.getText("configuration.semantic_action")+":\n"+e;return n}t.setModel(o,"i18n");var s=new i({config:a,displayText:c(a.semantic_object,a.semantic_action)});t.setModel(s);if(r.configurationUi.isEnabled()){r.configurationUi.setAsyncUiProvider(function(){return e.getConfigurationUi(g.getView(),"sap.ushell.components.tiles.action.Configuration").then(function(t){r.configurationUi.attachCancel(g.onCancelConfiguration.bind(null,t));r.configurationUi.attachSave(g.onSaveConfiguration.bind(null,t,c));return t})});t.byId("actionTile").setTooltip(o.getResourceBundle().getText("edit_configuration.tooltip"))}},onPress:function(t){var e=this.getView().getViewData().chip;if(e.configurationUi.isEnabled()){e.configurationUi.display()}},onSaveConfiguration:function(t,o){var r=jQuery.Deferred();var a=t.getModel();var g=a.getProperty("/tileModel");var c=t.getViewData().chip;function s(t){n.warning(t,null,"sap.ushell.components.tiles.action.ActionTile.controller");r.reject(t)}var l=e.checkTMInputOnSaveConfig(t);if(l){r.reject("mandatory_fields_missing");return r.promise()}var p=e.getResourceBundleModel().getResourceBundle();if(e.tableHasDuplicateParameterNames(a.getProperty("/config/rows"))){r.reject(p.getText("configuration.signature.uniqueParamMessage.text"))}else if(!e.tableHasInvalidSapPrelaunchOperationValue(a.getProperty("/config/rows"))){var u=JSON.stringify([{type:"split",source:"p1",target:["p2","p3"]},{type:"merge",source:["p4","p5"],target:"p6"}]);r.reject(p.getText("configuration.signature.invalidSapPrelaunchOperationsMessage.text",[u]))}else{var f=a.getProperty("/config/formFactorConfigDefault")?undefined:e.buildFormFactorsObject(a);var d=e.getMappingSignatureString(a.getProperty("/config/rows"),a.getProperty("/config/isUnknownAllowed"));var _=e.getMappingSignature(a.getProperty("/config/rows"),a.getProperty("/config/isUnknownAllowed"));var v={semantic_object:(a.getProperty("/config/semantic_object")||"").trim(),semantic_action:(a.getProperty("/config/semantic_action")||"").trim(),display_title_text:(a.getProperty("/config/display_title_text")||"").trim(),url:(a.getProperty("/config/url")||"").trim(),ui5_component:(a.getProperty("/config/ui5_component")||"").trim(),navigation_provider:(a.getProperty("/config/navigation_provider")||"").trim(),navigation_provider_role:(a.getProperty("/config/navigation_provider_role")||"").trim(),navigation_provider_instance:(a.getProperty("/config/navigation_provider_instance")||"").trim(),target_application_id:(a.getProperty("/config/target_application_id")||"").trim(),target_application_alias:(a.getProperty("/config/target_application_alias")||"").trim(),transaction:{code:(a.getProperty("/config/transaction/code")||"").trim()},web_dynpro:{application:(a.getProperty("/config/web_dynpro/application")||"").trim(),configuration:(a.getProperty("/config/web_dynpro/configuration")||"").trim()},target_system_alias:(a.getProperty("/config/target_system_alias")||"").trim(),display_info_text:(a.getProperty("/config/display_info_text")||"").trim(),form_factors:f,mapping_signature:d,signature:_};var y=c.bag.getBag("tileProperties");y.setText("display_title_text",v.display_title_text);c.writeConfiguration.setParameterValues({tileConfiguration:JSON.stringify(v)},function(){var l=e.getActionConfiguration(c,false);var p=e.getActionConfiguration(c,true);a=new i({config:l,tileModel:g});t.setModel(a);g.setData({config:p,displayText:o(p.semantic_object,p.semantic_action)},false);y.save(function(){n.debug("property bag 'tileProperties' saved successfully");r.resolve()},s)},s)}return r.promise()},onCancelConfiguration:function(t){var i=t.getViewData();var n=t.getModel();var o=n.getProperty("/tileModel");var r=i.chip;var a=e.getActionConfiguration(r,false);t.getModel().setData({config:a,tileModel:o},false)}})});
//# sourceMappingURL=ActionTile.controller.js.map