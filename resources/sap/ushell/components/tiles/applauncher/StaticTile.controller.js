// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ushell/Config","sap/ushell/utils/WindowUtils","sap/m/library","sap/ushell/library","sap/ui/model/json/JSONModel","sap/base/Log","sap/ui/thirdparty/jquery","sap/ushell/utils/UrlParsing","sap/ushell/EventHub","sap/ushell/Container"],function(e,t,i,a,r,n,o,s,jQuery,l,g,p){"use strict";var c=r.GenericTileScope;var _=r.GenericTileMode;var u=n.AppType;return e.extend("sap.ushell.components.tiles.applauncher.StaticTile",{_aDoables:[],onInit:function(){var e=this.getView();var a=e.getViewData();var r=a.chip;var n=t.getAppLauncherConfig(r,r.configurationUi.isEnabled(),false);var s=this;var g=n.navigation_target_url;var p;var c=r.url.getApplicationSystem();if(c){if(l.isIntentUrl(g)){p=l.parseShellHash(g);if(!p.params){p.params={}}p.params["sap-system"]=c;g="#"+l.constructShellHash(p)}else{g+=(g.indexOf("?")<0?"?":"&")+"sap-system="+c}}this.navigationTargetUrl=g;var u=new o({sizeBehavior:i.last("/core/home/sizeBehavior"),wrappingType:i.last("/core/home/wrappingType"),config:n,mode:n.display_mode,nav:{navigation_target_url:r.configurationUi&&r.configurationUi.isEnabled()?"":g},search:{display_highlight_terms:[]}});e.setModel(u);this._aDoables.push(i.on("/core/home/sizeBehavior").do(function(e){u.setProperty("/sizeBehavior",e)}));if(r.types){r.types.attachSetType(function(e){if(s.tileType!==e){if(e==="link"){u.setProperty("/mode",_.LineMode)}else{u.setProperty("/mode",u.getProperty("/config/display_mode"))}s.tileType=e}})}if(!this.tileType){this.tileType="tile"}if(r.search){var f=e.getModel().getProperty("/config/display_search_keywords");var d=f.split(/[, ]+/).filter(function(e){return e&&e!==""});if(n.display_title_text&&n.display_title_text!==""&&d.indexOf(n.display_title_text)===-1){d.push(n.display_title_text)}if(n.display_subtitle_text&&n.display_subtitle_text!==""&&d.indexOf(n.display_subtitle_text)===-1){d.push(n.display_subtitle_text)}if(n.display_info_text&&n.display_info_text!==""&&d.indexOf(n.display_info_text)===-1){d.push(n.display_info_text)}r.search.setKeywords(d);r.search.attachHighlight(function(t){e.getModel().setProperty("/search/display_highlight_terms",t)})}if(r.bag&&r.bag.attachBagsUpdated){r.bag.attachBagsUpdated(function(i){if(i.indexOf("tileProperties")>-1){t._updateTilePropertiesTexts(e,r.bag.getBag("tileProperties"))}})}if(r.configuration&&r.configuration.attachConfigurationUpdated){r.configuration.attachConfigurationUpdated(function(i){if(i.indexOf("tileConfiguration")>-1){t._updateTileConfiguration(e,r.configuration.getParameterValueAsString("tileConfiguration"))}})}if(r.preview){r.preview.setTargetUrl(g);r.preview.setPreviewIcon(n.display_icon_url);r.preview.setPreviewTitle(n.display_title_text);if(r.preview.setPreviewSubtitle&&typeof r.preview.setPreviewSubtitle==="function"){r.preview.setPreviewSubtitle(n.display_subtitle_text)}}if(r.configurationUi.isEnabled()){r.configurationUi.setAsyncUiProvider(function(){return t.getConfigurationUi(e,"sap.ushell.components.tiles.applauncher.Configuration").then(function(e){r.configurationUi.attachCancel(s.onCancelConfiguration.bind(null,e));r.configurationUi.attachSave(s.onSaveConfiguration.bind(null,e));return e})});this.getView().getContent()[0].setTooltip(t.getResourceBundleModel().getResourceBundle().getText("edit_configuration.tooltip"))}if(r.actions){var y=[];var v=n.actions;if(v){y=v.slice()}if(i.last("/core/shell/enablePersonalization")){var h=u.getProperty("/mode")===_.LineMode?"link":"tile";var b=t.getTileSettingsAction(u,this.onSaveRuntimeSettings.bind(this),h);y.push(b)}r.actions.setActionsProvider(function(){return y})}},onExit:function(){this._aDoables.forEach(function(e){e.off()});this._aDoables=[]},onPress:function(e){var t=this.getView();var r=t.getViewData();var n=r.chip;var o=t.getModel().getProperty("/config");if(e.getSource().getScope&&e.getSource().getScope()===c.Display){if(n.configurationUi.isEnabled()){n.configurationUi.display()}else if(this.navigationTargetUrl){g.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:this.navigationTargetUrl}});if(this.navigationTargetUrl[0]==="#"){hasher.setHash(this.navigationTargetUrl)}else{var s=i.last("/core/shell/enableRecentActivity")&&i.last("/core/shell/enableRecentActivityLogging");if(s){var l={title:o.display_title_text,appType:u.URL,url:o.navigation_target_url,appId:o.navigation_target_url};p.getRendererInternal("fiori2").logRecentActivity(l)}a.openURL(this.navigationTargetUrl,"_blank")}}}},onSaveRuntimeSettings:function(e){var t=e.getModel();var i=this.getView().getViewData().chip;var a=this.getView().getModel().getProperty("/config");a.display_title_text=t.getProperty("/title")||"";a.display_subtitle_text=t.getProperty("/subtitle")||"";a.display_info_text=t.getProperty("/info")||"";a.display_search_keywords=t.getProperty("/keywords")||"";var r=i.bag.getBag("tileProperties");r.setText("display_title_text",a.display_title_text);r.setText("display_subtitle_text",a.display_subtitle_text);r.setText("display_info_text",a.display_info_text);r.setText("display_search_keywords",a.display_search_keywords);function n(e){s.error(e,null,"sap.ushell.components.tiles.applauncher.StaticTile.controller")}r.save(function(){s.debug("property bag 'tileProperties' saved successfully");this.getView().getModel().setProperty("/config/display_title_text",a.display_title_text);this.getView().getModel().setProperty("/config/display_subtitle_text",a.display_subtitle_text);this.getView().getModel().setProperty("/config/display_info_text",a.display_info_text);this.getView().getModel().setProperty("/config/display_search_keywords",a.display_search_keywords);this.getView().getModel().refresh()}.bind(this),n)},onSaveConfiguration:function(e){var i=new jQuery.Deferred;var a=e.getModel();var r=a.getProperty("/tileModel");var n=e.getViewData().chip;var l=t.tileActionsRows2TileActionsArray(a.getProperty("/config/tile_actions_rows"));var g={display_icon_url:a.getProperty("/config/display_icon_url"),navigation_use_semantic_object:a.getProperty("/config/navigation_use_semantic_object"),navigation_target_url:a.getProperty("/config/navigation_target_url"),navigation_semantic_object:(a.getProperty("/config/navigation_semantic_object")||"").trim(),navigation_semantic_action:(a.getProperty("/config/navigation_semantic_action")||"").trim(),navigation_semantic_parameters:(a.getProperty("/config/navigation_semantic_parameters")||"").trim(),display_search_keywords:a.getProperty("/config/display_search_keywords")};var p=t.checkInputOnSaveConfig(e);if(!p){p=t.checkTileActions(e)}if(p){i.reject("mandatory_fields_missing");return i.promise()}if(g.navigation_use_semantic_object){g.navigation_target_url=t.getSemanticNavigationUrl(g);a.setProperty("/config/navigation_target_url",g.navigation_target_url)}var c=n.bag.getBag("tileProperties");c.setText("display_title_text",a.getProperty("/config/display_title_text"));c.setText("display_subtitle_text",a.getProperty("/config/display_subtitle_text"));c.setText("display_info_text",a.getProperty("/config/display_info_text"));c.setText("display_search_keywords",g.display_search_keywords);var _=n.bag.getBag("tileNavigationActions");t.populateTileNavigationActionsBag(_,l);function u(e,t){s.error(e,null,"sap.ushell.components.tiles.applauncher.StaticTile.controller");i.reject(e,t)}n.writeConfiguration.setParameterValues({tileConfiguration:JSON.stringify(g)},function(){var a=t.getAppLauncherConfig(n,false,false);var l=t.getAppLauncherConfig(n,true,false);var g=new o({config:a,nav:{navigation_target_url:""},tileModel:r});e.setModel(g);r.setData({config:l,nav:{navigation_target_url:""}},false);if(n.preview){n.preview.setTargetUrl(a.navigation_target_url);n.preview.setPreviewIcon(a.display_icon_url);n.preview.setPreviewTitle(a.display_title_text);if(n.preview.setPreviewSubtitle&&typeof n.preview.setPreviewSubtitle==="function"){n.preview.setPreviewSubtitle(a.display_subtitle_text)}}c.save(function(){s.debug("property bag 'tileProperties' saved successfully");if(n.title){n.title.setTitle(a.display_title_text,function(){i.resolve()},u)}else{i.resolve()}},u);_.save(function(){s.debug("property bag 'navigationProperties' saved successfully")},u)},u);e.destroy();return i.promise()},onCancelConfiguration:function(e){var i=e.getViewData();var a=e.getModel();var r=a.getProperty("/tileModel");var n=i.chip;var o=t.getAppLauncherConfig(n,n.configurationUi.isEnabled(),false);e.getModel().setData({config:o,nav:{navigation_target_url:""},tileModel:r},false);e.destroy()},formatters:{leanURL:a.getLeanURL.bind(a)}})});
//# sourceMappingURL=StaticTile.controller.js.map