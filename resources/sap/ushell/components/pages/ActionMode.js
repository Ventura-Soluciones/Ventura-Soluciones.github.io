//Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/Element","sap/ushell/resources","sap/ushell/EventHub","sap/base/Log","sap/ushell/Container"],function(e,t,n,i,o,r,a,s){"use strict";var g={};g.start=function(t,n){this.oController=t;var a=t.getView().getModel("viewSettings");var s=a.getProperty("/addToMyHomeOnly");if(!s){t.getView().getModel("viewSettings").setProperty("/actionModeEditActive",true)}t.getView().getModel("viewSettings").setProperty("/actionModeActive",true);t.handleMyHomeActionMode(true).catch(t.navigateToErrorPage.bind(t));r.emit("enableMenuBarNavigation",false);var g=i.getElementById("ActionModeBtn");this.sActionButtonActivateText=g.getText();n=n||o.i18n.getText("PageRuntime.EditMode.Exit");g.setTooltip(n);g.setText(n);if(e.system.desktop){sap.ui.require(["sap/ushell/renderer/AccessKeysHandler"],function(e){e.attachEvent("editModeDone",this.save,this)}.bind(this))}};g.cancel=function(){this._cleanup()};g.save=function(){a.info("store actions in pages service");this._cleanup()};g._cleanup=function(){this.oController.getView().getModel("viewSettings").setProperty("/actionModeActive",false);this.oController.getView().getModel("viewSettings").setProperty("/actionModeEditActive",false);this.oController.handleMyHomeActionMode(false).catch(this.oController.navigateToErrorPage.bind(this.oController));r.emit("enableMenuBarNavigation",true);var t=i.getElementById("ActionModeBtn");t.setTooltip(this.sActionButtonActivateText);t.setText(this.sActionButtonActivateText);if(e.system.desktop){sap.ui.require(["sap/ushell/renderer/AccessKeysHandler"],function(e){e.detachEvent("editModeDone",this.save,this)}.bind(this))}};g.addVisualization=function(e,t){var n=t.getBindingContext().getModel();var i=t.getBindingContext().getPath();var o=i.split("/");var r=parseInt(o[2],10);var a=n.getProperty("/pages/"+r+"/id");var g=n.getProperty(i+"/id");s.getServiceAsync("Navigation").then(function(e){var t="Shell-appfinder?&/catalog/"+JSON.stringify({pageID:encodeURIComponent(a),sectionID:encodeURIComponent(g)});e.navigate({target:{shellHash:t}})})};g.addSection=function(e,t,n){var i=n.index;var o=t.getBindingContext().getPath();var r=o.split("/");var a=parseInt(r[2],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.addSection(a,i);var n={onAfterRendering:function(){setTimeout(function(){t.getSections()[i].getTitleInput().focus()},0);t.removeEventDelegate(n)}};t.addEventDelegate(n)})};g.deleteSection=function(e,i){return s.getServiceAsync("MessageInternal").then(function(e){var r=i.getTitle();var a=r?o.i18n.getText("PageRuntime.Message.Section.Delete",[r]):o.i18n.getText("PageRuntime.Message.Section.DeleteNoTitle");var s=o.i18n.getText("PageRuntime.Dialog.Title.Delete");function g(e){if(e===t.Action.DELETE){this.oController.getOwnerComponent().getPagesService().then(function(e){var t=i.getBindingContext().getPath(),r=i.getParent(),a=t.split("/"),s=parseInt(a[2],10),g=parseInt(a[4],10);e.deleteSection(s,g);n.show(o.i18n.getText("PageRuntime.Message.SectionDeleted"));var c=r.getSections();if(c.length){var l=c[g!==0?g-1:g];l.focus();var v={onAfterRendering:function(){l.focus();l.removeEventDelegate(v)}};l.addEventDelegate(v)}else{var d={onAfterRendering:function(){r.focus();r.removeEventDelegate(d)}};r.addEventDelegate(d)}})}}e.confirm(a,g.bind(this),s,[t.Action.DELETE,t.Action.CANCEL])}.bind(this))};g.resetSection=function(e,t){var i=t.getBindingContext().getPath();var r=i.split("/");var a=parseInt(r[2],10);var s=parseInt(r[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.resetSection(a,s);n.show(o.i18n.getText("PageRuntime.Message.SectionReset"))})};g.changeSectionTitle=function(e,t,n){var i=t.getBindingContext().getPath();var o=t.getProperty("title");var r=i.split("/");var a=parseInt(r[2],10);var s=parseInt(r[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.renameSection(a,s,o)})};g.moveSection=function(e,t,n){var i=n.draggedControl.getBindingContext().getPath();var o=n.droppedControl.getBindingContext().getPath();var r=n.dropPosition;var a=o.split("/");var s=i.split("/");var g=parseInt(s[2],10);var c=parseInt(s[4],10);var l=parseInt(a[4],10);if(c===l-1&&r==="Before"||c===l+1&&r==="After"){return Promise.resolve()}if(r==="After"){l=l+1}var v=this.oController.getOwnerComponent();return v.getPagesService().then(function(e){return e.moveSection(g,c,l)}).then(function(){t.announceMove();t.getSections()[l!==0&&l>c?l-1:l].focus()})};g.changeSectionVisibility=function(e,t,n){if(this.oController===undefined||n.visible===undefined){return Promise.resolve()}var i=t.getBindingContext().getPath();var o=n.visible;var r=i.split("/");var a=parseInt(r[2],10);var s=parseInt(r[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.setSectionVisibility(a,s,o)})};return g});
//# sourceMappingURL=ActionMode.js.map