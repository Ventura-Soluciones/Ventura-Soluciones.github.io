// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ushell/utils","sap/ushell/EventHub"],function(i,t,e){"use strict";var s={};s.init=function(t,s){this.aRefreshVisualizations=[];this.oPagesVisibility={};this.oPagesRuntimeNavContainer=t;this.oPagesNavContainer=s;this.oPagesRuntimeNavContainer.attachNavigate(this._onOuterNavContainerNavigated,this);this.oPagesNavContainer.attachNavigate(this._onPageNavigated,this);this._onTabNavigatedBind=this._onTabNavigated.bind(this);document.addEventListener("visibilitychange",this._onTabNavigatedBind);this.oEventBus=i.getInstance();this.oEventBus.subscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventBus.subscribe("sap.ushell","navigated",this._onShellNavigated,this);this.oEventHubListener=e.once("PagesRuntimeRendered").do(function(){this._setCurrentPageVisibility(true)}.bind(this))};s._onEnableRequests=function(i,t,e){if(!e||e.active===undefined){return}this._setCurrentPageVisibility(e.active)};s._setCurrentPageVisibility=function(i){const t=this.oPagesNavContainer.getCurrentPage();if(t){this._setPageVisibility(t,i,false)}};s._setPageVisibility=function(i,t,e){if(!i){return}if(i.getContent()[0].isA("sap.ushell.ui.launchpad.Page")){var s=i.getBindingContext().getPath();if(this.oPagesVisibility[s]===t){return}this.oPagesVisibility[s]=t;this._visitVisualizations(i,function(i){i.setActive(t,e)})}};s._isPagesNavContainerVisible=function(){return this.oPagesRuntimeNavContainer.getCurrentPage()===this.oPagesNavContainer};s._visitVisualizations=function(i,t){if(!t){return}i.getContent()[0].getSections().forEach(function(i){i.getVisualizations().forEach(t)})};s._onShellNavigated=function(){var i=window.hasher.getHash();if(t.isFlpHomeIntent(i)&&this._isPagesNavContainerVisible()){this._setCurrentPageVisibility(true);this._refreshVisualizations()}else{this._setCurrentPageVisibility(false)}return Promise.resolve()};s.addVisualizationForRefresh=function(i){this.aRefreshVisualizations.push(i)};s._refreshVisualizations=function(){this.aRefreshVisualizations.forEach(function(i){i.setActive(i.getActive(),true)});this.aRefreshVisualizations=[]};s._onTabNavigated=function(){var i=window.hasher.getHash();if(t.isFlpHomeIntent(i)&&this._isPagesNavContainerVisible()){this._setCurrentPageVisibility(!document.hidden)}return Promise.resolve()};s._onPageNavigated=function(i){if(this._isPagesNavContainerVisible()){var t=i.getParameters();this._setPageVisibility(t.from,false,false);this._setPageVisibility(t.to,true,false)}};s._onOuterNavContainerNavigated=function(i){const t=i.getParameter("to");const e=t===this.oPagesNavContainer;this._setCurrentPageVisibility(e)};s.getPageVisibility=function(i){return this.oPagesVisibility[i]};s.exit=function(){this.oEventBus.unsubscribe("sap.ushell","navigated",this._onShellNavigated,this);document.removeEventListener("visibilitychange",this._onTabNavigatedBind);this.oPagesNavContainer.detachNavigate(this._onPageNavigated,this);this.oPagesRuntimeNavContainer.detachNavigate(this._onOuterNavContainerNavigated,this);this.oEventBus.unsubscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventHubListener.off()};return s});
//# sourceMappingURL=StateManager.js.map