// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/library","sap/m/Popover","sap/m/Text","sap/ui/core/Element","sap/ui/core/EventBus","sap/ushell/components/HomepageManager","sap/ushell/resources","sap/ushell/utils/WindowUtils","sap/ushell/EventHub"],function(e,t,i,n,o,a,s,r,l,c,d){"use strict";var p=i.PlacementType;var u=function(){this.oEventBus=s.getInstance();this.init=function(e){this.oModel=e}};u.prototype._activate=function(){this.oModel.setProperty("/tileActionModeActive",true);this.aOrigHiddenGroupsIds=this.getHomepageManager().getCurrentHiddenGroupIds(this.oModel);var e=a.getElementById("dashboardGroups");e.addLinksToUnselectedGroups();var t=a.getElementById("ActionModeBtn");if(t){t.setText(l.i18n.getText("exitEditMode"));if(t.setSelected){t.setSelected(true)}}this.oEventBus.publish("launchpad","actionModeActive")};u.prototype._deactivate=function(){this.oModel.setProperty("/tileActionModeActive",false);this.oEventBus.publish("launchpad","actionModeInactive",this.aOrigHiddenGroupsIds);var e=a.getElementById("TileActions");if(e!==undefined){e.destroy()}var t=a.getElementById("ActionModeBtn");if(t){t.setText(l.i18n.getText("activateEditMode"));if(t.setSelected){t.setSelected(false)}}};u.prototype.toggleActionMode=function(e,t,i){i=i||[];var n=i.filter(function(e){return e.getVisible()});var o={group:n[e.getProperty("/topGroupInViewPortIndex")]};if(e.getProperty("/tileActionModeActive")){this._deactivate();var a=document.querySelector(".sapUshellTileContainerHeader[tabindex='0']");if(a){var s=a.closest("sapUshellTileContainer");if(s){o.restoreLastFocusedTileContainerById=s.getAttribute("id")}}}else{this._activate()}setTimeout(function(){this.oEventBus.publish("launchpad","scrollToGroup",o)}.bind(this),0)};u.prototype.activateGroupEditMode=function(e){var t=e.getDomRef().getElementsByClassName("sapUshellTileContainerContent");for(var i=0;i<t.length;i++){t[i].classList.add("sapUshellTileContainerEditMode")}};u.prototype.getHomepageManager=function(){if(!this.oHomepageManager){this.oHomepageManager=r.prototype.getInstance()}return this.oHomepageManager};u.prototype._filterActions=function(e,t){var i=t.getModel();var n=t.getParent().getBindingContext().getPath();if(i.getProperty(n+"/isGroupLocked")){["tileSettingsBtn","linkSettingsBtn","ConvertToTile","ConvertToLink","moveTile_action"].forEach(function(t){e=e.filter(function(e){return e.id!==t})})}if(this.getHomepageManager().getPersonalizableGroups().length<2){e=e.filter(function(e){return e.id!=="moveTile_action"})}return e};u.prototype._openActionsMenu=function(i){var n=i.getSource();var o=n.getBindingContext().getObject().object;var r=this.getHomepageManager().getTileActions(o);r=this._filterActions(r,n);var l=document.getElementsByClassName("sapUshellTileActionLayerDivSelected");for(var c=0;c<l.length;c++){l[c].classList.remove("sapUshellTileActionLayerDivSelected")}var d=n.getDomRef().getElementsByClassName("sapUshellTileActionLayerDiv");for(var u=0;u<d.length;u++){d[u].classList.add("sapUshellTileActionLayerDivSelected")}var g=[];r.forEach(function(i){if(!i.press&&!i.targetURL){e.warning("Invalid Tile action discarded: "+JSON.stringify(i));return}g.push(new t({text:i.text,icon:i.icon,press:this._handleActionPress.bind(this,i,n)}))}.bind(this));if(g.length===0){this._openNoActionsPopover(i);return}var h=n.getActionSheetIcon?n.getActionSheetIcon():undefined;if(!h){var f=a.getElementById(n.getId()+"-action-more");h=f||n}var v=a.getElementById("TileActions");if(!v){sap.ui.require(["sap/m/ActionSheet"],function(e){v=new e("TileActions",{placement:p.VerticalPreferedBottom,afterClose:function(){var e=document.getElementsByClassName("sapUshellTileActionLayerDivSelected");for(var t=0;t<e.length;t++){e[t].classList.remove("sapUshellTileActionLayerDivSelected")}var i=s.getInstance();i.publish("dashboard","actionSheetClose",n)}});this._openActionSheet(v,g,h)}.bind(this))}else{this._openActionSheet(v,g,h)}};u.prototype._openActionSheet=function(e,t,i){t=t||[];e.destroyButtons();t.forEach(function(t){e.addButton(t)});e.openBy(i)};u.prototype._openNoActionsPopover=function(e){var t=e.getSource();var i=new o({text:l.i18n.getText("tileHasNoActions")});new n({placement:p.Bottom,showHeader:false,ariaLabelledBy:i.getId(),content:i}).addStyleClass("sapUiContentPadding").openBy(t)};u.prototype._handleActionPress=function(e,t){if(e.press){e.press(t)}else if(e.targetURL){d.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:e.targetURL}});if(e.targetURL.indexOf("#")===0){hasher.setHash(e.targetURL)}else{c.openURL(e.targetURL,"_blank")}}};return new u},true);
//# sourceMappingURL=ActionMode.js.map