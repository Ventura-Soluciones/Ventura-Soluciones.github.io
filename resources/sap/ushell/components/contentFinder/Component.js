//Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/core/UIComponent","sap/ushell/components/contentFinder/model/GraphQLModel","sap/ui/model/json/JSONModel","sap/ushell/adapters/cdm/v3/_LaunchPage/readUtils","sap/ushell/adapters/cdm/v3/utilsCdm","sap/f/library"],function(e,t,i,s,o,a,n,r,l){"use strict";const d=l.LayoutType;const u=500;return s.extend("sap.ushell.components.contentFinder.Component",{metadata:{manifest:"json",library:"sap.ushell",interfaces:["sap.ui.core.IAsyncContentCreation"],properties:{enablePersonalization:{type:"boolean",defaultValue:true,group:"Behavior"},noItemsInCatalogDescription:{type:"string",defaultValue:"",group:"Appearance"},showAppBoxFieldsPlaceholder:{type:"boolean",defaultValue:true,group:"Appearance"},showCategoryTreeWhenEmpty:{type:"boolean",defaultValue:true,group:"Appearance"},showApplicationLaunchButton:{type:"boolean",defaultValue:false,group:"Appearance"}},events:{visualizationFilterApplied:{allowPreventDefault:true,parameters:{types:{type:"string[]"},searchTerm:{type:"string"},pagination:{type:{skip:"integer",top:"integer"}},filter:{type:"any"},categoryId:{type:"string"}}},contentFinderClosed:{parameters:{}},widgetSelected:{parameters:{widgetId:{type:"string"}}},visualizationsAdded:{parameters:{visualizations:{type:"object[]"}}}}},logComponent:"sap.ushell.components.ContentFinder.Component",init:function(){s.prototype.init.apply(this,arguments);this.oResourceBundle=this.getModel("i18n").getResourceBundle();this.setModel(this.getUiModel(),"ui");this.setModel(this.getDataModel());this.setModel(this.getDataModel(),"data");this.setModel(this.getSelectionModel(),"selection");this.initializeUiModel(false);this.initializeDataModel();this.initializeSelectionModel();this._initializeSidebarStatus();const e=this.getComponentData();if(e?.visualizationFilters){this.setVisualizationsFilters(e.visualizationFilters)}this.oRestrictedVisualizationsMap=new Map;this._bLoading=false},setVisualizationsFilters:function(e){const t=this.getUiModel();if(e?.available){t.setProperty("/visualizations/filters/available",e.available)}if(e?.displayed){t.setProperty("/visualizations/filters/displayed",e.displayed)}if(e?.selected){t.setProperty("/visualizations/filters/selected",e.selected)}},getUiModel:function(){if(!this.oUiModel){this.oUiModel=new a}return this.oUiModel},getDataModel:function(){if(!this.oDataModel){this.oDataModel=new o;this.oDataModel.setSizeLimit(Infinity)}return this.oDataModel},getSelectionModel:function(){if(!this.oSelectionModel){this.oSelectionModel=new a;this.oSelectionModel.setSizeLimit(Infinity)}return this.oSelectionModel},_setComponentSettingsProperty:function(e,t){this.setProperty(e,t);this.getModel("ui").setProperty("/componentSettings/"+e,t);return this},setEnablePersonalization:function(e){return this._setComponentSettingsProperty("enablePersonalization",!!e)},setNoItemsInCatalogDescription:function(e){return this._setComponentSettingsProperty("noItemsInCatalogDescription",e)},setShowAppBoxFieldsPlaceholder:function(e){return this._setComponentSettingsProperty("showAppBoxFieldsPlaceholder",!!e)},setShowCategoryTreeWhenEmpty:function(e){return this._setComponentSettingsProperty("showCategoryTreeWhenEmpty",!!e)},setShowApplicationLaunchButton:function(e){return this._setComponentSettingsProperty("showApplicationLaunchButton",!!e)},setCategoryTree:function(t){const i=this.getDataModel();if(!Array.isArray(t)){e.error("Category tree data must be an array.");t=[]}i.setProperty("/categoryTree",t)},queryVisualizations:function(e,t,i){const s=this.getUiModel();const o=s.getProperty("/visualizations/filters/selected");const a=s.getProperty("/visualizations/filters/available");const n=a.find(e=>e.key===o);if(!this._bLoading){this._bLoading=true;s.setProperty("/visualizations/loaded",false);this.fireEvent("visualizationFilterApplied",{pagination:{skip:e||0,top:s.getProperty("/visualizations/growingThreshold")},types:n?.types||[],search:t||null,categoryId:i||null})}},getSelectedVisualizationFilter:function(){this.oUiModel=this.getUiModel();const e=this.oUiModel.getProperty("/visualizations/filters/selected");const t=this.oUiModel.getProperty("/visualizations/filters/available");let i={};if(t?.length>0){i=t.find(t=>t.key===e)||t[0]}return i},setVisualizationData:function(e,t=false,s){const o=i.get("visualizations.nodes",e)||[];const a=i.get("visualizations.totalCount",e)||0;const n=this.getDataModel();const r=this.getUiModel();const l=this._prepareVisualizations(o);let d;if(t){d=[]}else{d=n.getProperty("/visualizations/items")}n.setProperty("/visualizations/items",d.concat(l));if(Number(a)>0){n.setProperty("/visualizations/totalCount",a)}r.setProperty("/visualizations/loaded",true);r.setProperty("/customErrorMessage",s);this._bLoading=false},setContextData:function(e){const s=i.get("restrictedVisualizations",e)||[];const o=this.getDataModel();this.oRestrictedVisualizationsMap.clear();s.forEach(e=>{this.oRestrictedVisualizationsMap.set(e,true)});o.setProperty("/visualizations/restrictedItems",t([],s))},addVisualizations:function(e){if(e.length>0){this.fireEvent("visualizationsAdded",{visualizations:e})}},triggerContentFinderClosed:function(){this.fireEvent("contentFinderClosed")},triggerWidgetSelected:function(e){if(e){this.fireEvent("widgetSelected",{widgetId:e})}},resetAppSearch:function(){this.initializeUiModel(true);this.initializeSelectionModel();this.useSelectionModel(false);this.updateSidebarStatus()},useSelectionModel:function(e){let t;if(e){t=this.getSelectionModel()}else{t=this.getDataModel()}this.setModel(t,"data")},initializeUiModel:function(e=false){const t=this.getUiModel();let i;if(e){i={preservedLayoutType:t.getProperty("/preservedLayoutType"),categoryTree:t.getProperty("/categoryTree"),visualizations:{filters:t.getProperty("/visualizations/filters"),listView:t.getProperty("/visualizations/listView")}}}t.setData({layoutType:d.TwoColumnsMidExpanded,preservedLayoutType:d.TwoColumnsMidExpanded,maxColumnsCount:2,componentSettings:{enablePersonalization:this.getEnablePersonalization(),noItemsInCatalogDescription:this.getNoItemsInCatalogDescription(),showAppBoxFieldsPlaceholder:this.getShowAppBoxFieldsPlaceholder(),showCategoryTreeWhenEmpty:this.getShowCategoryTreeWhenEmpty(),showApplicationLaunchButton:this.getShowApplicationLaunchButton()},categoryTree:{hasData:false,itemPressed:false,selectedId:undefined,selectedTitle:undefined,visible:true,largeDataSet:false},visualizations:{appliedSearchTerm:"",filters:{displayed:[],filterIsTitle:true,selected:"tiles",available:[]},growingThreshold:100,listView:false,loaded:false,searchFieldValue:"",searchTerm:"",showSelectedPressed:false}});if(e){t.setData(i,true)}},initializeDataModel:function(){this.getDataModel().setData({categoryTree:[],visualizations:{items:[],totalCount:0,restrictedItems:[]}})},initializeSelectionModel:function(){this.getSelectionModel().setData({visualizations:{items:[],totalCount:0,restrictedItems:[]}})},resetVisualizations:function(){const e=this.getDataModel();e.setProperty("/visualizations/items",[]);e.setProperty("/visualizations/totalCount",0)},_initializeSidebarStatus:function(){const e=this.getDataModel();const t=this.getUiModel();this.oCategoryTreeLengthBinding=e.bindProperty("/categoryTree/length");this.oShowCategoryTreeWhenEmptyBinding=t.bindProperty("/componentSettings/showCategoryTreeWhenEmpty");this.oMaxColumnsCountBinding=t.bindProperty("/maxColumnsCount");this.oVisualizationsFilterSelectedBinding=t.bindProperty("/visualizations/filters/selected");[this.oCategoryTreeLengthBinding,this.oShowCategoryTreeWhenEmptyBinding,this.oMaxColumnsCountBinding,this.oVisualizationsFilterSelectedBinding].forEach(e=>e.attachChange(this.onUpdateSidebarStatus,this));this.updateSidebarStatus()},onUpdateSidebarStatus:function(){this.iUpdateSidebarStatusTimeout=this.iUpdateSidebarStatusTimeout||setTimeout(()=>{this.updateSidebarStatus();this.iUpdateSidebarStatusTimeout=null},0)},updateSidebarStatus:function(e){const t=this.getDataModel();const i=this.getUiModel();const s=i.getProperty("/maxColumnsCount");const o=t.getProperty("/categoryTree")?.length>0;const a=i.getProperty("/componentSettings/showCategoryTreeWhenEmpty");const n=i.getProperty("/visualizations/filters/selected");let r;if(n==="cards"){r=d.MidColumnFullScreen}else if(e){r=e}else if(a||o){r=i.getProperty("/preservedLayoutType");if(r===d.OneColumn&&s>1){r=d.TwoColumnsMidExpanded}}else{r=d.MidColumnFullScreen}let l=true;if(r===d.TwoColumnsMidExpanded&&s===1||r===d.MidColumnFullScreen){l=false}if(e&&e!==d.OneColumn){i.setProperty("/preservedLayoutType",e)}i.setProperty("/layoutType",r);i.setProperty("/categoryTree/hasData",o);i.setProperty("/categoryTree/visible",l);const u=this._shouldTreeTableBeVisible();i.setProperty("/largeDataSet",u)},_shouldTreeTableBeVisible:function(){const e=this.getDataModel();const t=e.bindTree("/categoryTree");const i=t.getCount();return i>u},_prepareVisualizations:function(s){return t([],s).reduce((t,s)=>{if(!s?.descriptor||!s?.descriptor?.value){e.error("No descriptor available. Cannot load this visualization.",null,this.logComponent);return t}const o=s.descriptor.value["sap.app"];const a=s.descriptor.value["sap.fiori"];let l="";if(a?.registrationIds[0]){l=a.registrationIds[0]}else if(o?.id){l=o.id}let d;if(s.targetAppIntent){const e=n.harmonizeTarget(s.descriptor.value["sap.flp"]?.target);d=r.toHashFromTargetIntent(s.targetAppIntent,e)}t.push({id:s.id,appId:l,icon:i.get("icons.icon",s.descriptor.value["sap.ui"])||"",info:o&&o.info||"",launchUrl:d||"",subtitle:o&&o.subTitle||"",title:o&&o.title||"",type:s.type,dataHelpId:s.id,vizData:s,added:false,systemLabel:s.systemLabel||""});return t},[])}})});
//# sourceMappingURL=Component.js.map