// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/ui/core/Locale","sap/ushell/components/cards/ManifestPropertyHelper","sap/ushell/resources","sap/ui/core/mvc/Controller","sap/base/strings/formatMessage","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/Log"],function(e,t,a,i,r,n,o,jQuery,s){"use strict";return r.extend("sap.ushell.components.cards.Configuration",{formatter:n,onInit:function(){var e=this.getView(),t=e.getViewData(),a=t.chipInstance,r,n=a.configuration.getParameterValueAsString("cardManifest"),s;if(n){s=this._prepareManifest(n,a)}r=new o({data:{editorValue:JSON.stringify(s,null,4)||""},config:{originalLanguage:"",sapLogonLanguage:"",displayOriginalLanguageWarning:false,manifestEditorEditable:true}});e.setModel(r);e.setModel(i.i18nModel,"i18n");e.setViewName("sap.ushell.components.cards.Configuration");a.configurationUi.attachSave(this.onSaveConfiguration.bind(this));this._checkOriginalLanguage()},onSaveConfiguration:function(){var e=new jQuery.Deferred,t=this.getView().getModel(),r=t.getProperty("/data/editorValue"),n,o;try{n=JSON.parse(r)}catch(t){this._logErrorAndReject({error:i.i18n.getText("configuration.invalidJSONProvided")},e);return e}o=a.extractCardData(n);this._saveManifestAndTileConfig(o.manifest,o.tileConfiguration).then(this._saveTilePropertiesBag.bind(this,o)).then(this._saveTitle.bind(this,o.bagProperties.display_title_text)).then(this._updateTileModel.bind(this,o)).then(e.resolve).catch(function(t){this._logErrorAndReject(t,e)}.bind(this));return e.promise()},_saveManifestAndTileConfig:function(e,t){var a=this.getView().getViewData().chipInstance;var i=new Promise(function(i,r){a.writeConfiguration.setParameterValues({cardManifest:JSON.stringify(e),tileConfiguration:t},i,function(e,t){r({error:e,errorInfo:t})})});return i},_saveTilePropertiesBag:function(e){var t=this.getView().getViewData().chipInstance;var a=t.bag.getBag("tileProperties");this._fillCardBag(e,a);var i=new Promise(function(e,t){a.save(e,function(e,a){t({error:e,errorInfo:a})})});return i},_saveTitle:function(e){var t=this.getView().getViewData().chipInstance;var a=new Promise(function(a,i){if(t.title){t.title.setTitle(e,a,function(e,t){i({error:e,errorInfo:t})})}else{a()}});return a},_updateTileModel:function(e){var t=this.getView().getModel("tileModel");t.setProperty("/data/display_title_text",e.bagProperties.display_title_text);t.setProperty("/data/display_subtitle_text",e.bagProperties.display_subtitle_text)},_logErrorAndReject:function(e,t){s.error(e.error,null,"card.Configuration.controller");t.reject(e.error,e.errorInfo)},_fillCardBag:function(e,t){Object.keys(e.bagProperties).forEach(function(a){if(e.bagProperties[a]){t.setText(a,e.bagProperties[a])}else{t.resetProperty(a)}})},_prepareManifest:function(e,t){var i=JSON.parse(e),r=a.getCardData(t);return a.mergeCardData(i,r)},_checkOriginalLanguage:function(){var e,t;if(!this._isOriginalLanguage()){e=this.getView().getModel();t=this._getLanguages();e.setProperty("/config/originalLanguage",t.originalLanguage.toUpperCase());e.setProperty("/config/sapLogonLanguage",t.logonLanguage.toUpperCase());e.setProperty("/config/displayOriginalLanguageWarning",true);e.setProperty("/config/manifestEditorEditable",false)}},_isOriginalLanguage:function(){var e=this._getLanguages(),t=e.originalLanguage.toLowerCase(),a=e.logonLanguage.toLowerCase(),i=e.ui5CoreLanguage.toLowerCase();return t===""||t===a||t===i},_getLanguages:function(){var a=this.oView.getViewData().chipInstance;return{originalLanguage:a.bag.getOriginalLanguage(),logonLanguage:new t(e.getLanguageTag()).getSAPLogonLanguage(),ui5CoreLanguage:e.getLanguage()}}})});
//# sourceMappingURL=Configuration.controller.js.map