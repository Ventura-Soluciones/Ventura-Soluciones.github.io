// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/i18n/Localization","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/m/GenericTile","sap/m/ImageContent","sap/m/library","sap/m/NumericContent","sap/m/TileContent","sap/ui/core/ComponentContainer","sap/ui/core/Component","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/Device","sap/ui/model/resource/ResourceModel","sap/ui/thirdparty/datajs","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/EventHub","sap/ushell/Container"],function(e,t,i,r,n,s,o,a,l,p,u,c,f,d,h,T,g,v,jQuery,m,w,y,b,L,C,_){"use strict";var U=f.mvc.ViewType;var k=o.GenericTileMode;var I=w.AppType;function R(e){var t={};t[e.namespace.replace(/\./g,"/")]=e.path||".";sap.ui.loader.config({paths:t})}var S=function(o,c,f){var w=i([],f.config.groups);var z=0;var D=10;var G=10;var P=10;var F;var V={};for(var j=0;j<w.length;j++){if(w[j].isDefaultGroup===true){F=w[j];break}}if(!F&&w.length>0){F=w[0];F.isDefaultGroup=true}this.translationBundle=y.i18n;this.TileType={Tile:"tile",Link:"link",Card:"card"};var A;if(f.config.pathToLocalizedContentResources){var M=new T({bundleUrl:f.config.pathToLocalizedContentResources,bundleLocale:t.getLanguage()});A=M.getResourceBundle()}function N(e){if(A){return A.getText(e)}return e}var H=f.config.catalogs||[];H.forEach(function(e){if(A){e.title=N(e.title)}e.tiles.forEach(function(e){e.getTitle=function(){return e.title};e.getChip=function(){return{getBaseChipId:function(){return e.chipId}}}})});w.forEach(function(e){if(A){e.title=N(e.title)}e.tiles.forEach(function(e){J(e,true)})});function E(){return 100*Math.random()<z}function B(){return 100*Math.random()<D}function x(){return G+P*Math.random()}function O(e,t){var i;for(i=0;i<e.tiles.length;i=i+1){if(t.id===e.tiles[i].id){return i}}return-1}function q(e,t){var i;for(i=0;i<e.length;i=i+1){if(t.id===e[i].id){return i}}return-1}function W(e){var t=new jQuery.Deferred;window.setTimeout(function(){t.resolve(e)},x());return t.promise()}function J(t,i){if(t.tileType!=="sap.ushell.ui.tile.DynamicTile"||!t.properties||!t.properties.serviceUrl){return}if(t.intervalTimer){window.clearInterval(t.intervalTimer);t.intervalTimer=undefined}if(i){var r=t.serviceRefreshInterval;if(r){r=r*1e3}else{r=1e4}t.intervalTimer=window.setInterval(function(){g.read(t.properties.serviceUrl+"?id="+t.id+"&t="+(new Date).getTime(),function(){e.debug("Dynamic tile service call succeed for tile "+t.id)},function(i){e.debug("Dynamic tile service call failed for tile "+t.id+", error message:"+i)})},b.sanitizeTimeoutDelay(r))}}this.getGroups=function(){var e=new jQuery.Deferred;window.setTimeout(function(){e.resolve(w.slice(0))},x());return e.promise()};this.getDefaultGroup=function(){var e=new jQuery.Deferred;e.resolve(F);return e.promise()};this.addGroup=function(e){var t=new jQuery.Deferred;var i=E();window.setTimeout(function(){if(!i){var r={id:"group_"+w.length,title:e,tiles:[]};w.push(r);t.resolve(r)}else{this.getGroups().done(function(e){t.reject(e)}).fail(function(){t.reject()})}}.bind(this),x());return t.promise()};this.getGroupTitle=function(e){return e.title};this.setGroupTitle=function(e,t){var i=new jQuery.Deferred;var r=E();window.setTimeout(function(){if(!r){e.title=t;i.resolve()}else{W(e).done(function(e){i.reject(e.title)}).fail(function(){i.reject()})}},x());return i.promise()};this.getGroupId=function(e){return e.id};this.hideGroups=function(e){if(e&&w){for(var t=0;t<w.length;t++){if(e.indexOf(w[t].id)!==-1){w[t].isVisible=false}else{w[t].isVisible=true}}}return(new jQuery.Deferred).resolve()};this.isGroupVisible=function(e){return e&&(e.isVisible===undefined?true:e.isVisible)};this.moveGroup=function(e,t){var i=new jQuery.Deferred;var r=E();window.setTimeout(function(){if(!r){w.splice(t,0,w.splice(q(w,e),1)[0]);i.resolve()}else{this.getGroups().done(function(e){i.reject(e)}).fail(function(){i.reject()})}}.bind(this),x());return i.promise()};this.removeGroup=function(e){var t=new jQuery.Deferred;var i=E();window.setTimeout(function(){if(!i){w.splice(q(w,e),1);e.tiles.forEach(function(e){J(e,false)});t.resolve()}else{this.getGroups().done(function(e){t.reject(e)}).fail(function(){t.reject()})}}.bind(this),x());return t.promise()};this.resetGroup=function(e){var t=new jQuery.Deferred;var r=E();window.setTimeout(function(){if(!r){e.tiles.forEach(function(e){J(e,false)});e=i({},f.config.groups[q(f.config.groups,e)]);w.splice(q(w,e),1,e);e.tiles.forEach(function(e){J(e,true)});t.resolve(e)}else{this.getGroups().done(function(e){t.reject(e)}).fail(function(){t.reject()})}}.bind(this),x());return t.promise()};this.isGroupRemovable=function(e){return e&&!e.isPreset};this.isGroupLocked=function(e){return e.isGroupLocked};this.isGroupFeatured=function(e){return e.isFeatured};this.getGroupTiles=function(e){return e.tiles};this.getLinkTiles=function(e){return e.links};this.getTileTitle=function(e){return e.title};this.getTileType=function(e){if(e.isLink){return this.TileType.Link}if(e.isCard){return this.TileType.Card}return this.TileType.Tile};this.getTileId=function(e){return e.id};this.getTileSize=function(e){return e.size};this.getTileTarget=function(e){var t;if(e.properties){t=e.properties.href||e.properties.targetURL}return e.target_url||t||""};this.isTileIntentSupported=function(e){if(e&&e.formFactor){var t;var i=e.formFactor;var r=h.system;if(r.desktop){t="Desktop"}else if(r.tablet){t="Tablet"}else if(r.phone){t="Phone"}if(i.indexOf(t)===-1){return false}}return true};this.isTileIntentSupportedAsync=function(e){return Promise.resolve(this.isTileIntentSupported(e))};this.isLinkPersonalizationSupported=function(e){if(e){return e.isLinkPersonalizationSupported}return true};this.getTileView=function(e){var t=new jQuery.Deferred;var i=E();if(B()){window.setTimeout(function(){if(!i){this._getTileView(e).done(function(e){t.resolve(e)})}else{t.reject()}}.bind(this),x())}else if(!i){this._getTileView(e).done(function(e){t.resolve(e)})}else{t.reject()}return t.promise()};this._getTileView=function(e){var t="unknown error";var i=this.getTileType(e)==="link";var r=new jQuery.Deferred;this._translateTileProperties(e);if(e.namespace&&e.path&&e.moduleType){R(e);if(e.moduleType==="UIComponent"){u.create({componentData:{properties:e.properties},name:e.moduleName}).then(e=>{var t=new p({component:e,height:"100%",width:"100%"});r.resolve(t)})}else{d.create({viewName:e.moduleName,type:U[e.moduleType],viewData:{properties:e.properties},height:"100%"}).then(function(e){r.resolve(e)})}return r.promise()}else if(e.tileType){var s=i?"Link":e.tileType;if(s){try{this._createTileInstance(e,s).done(function(e){this._handleTilePress(e);this._applyDynamicTileIfoState(e);r.resolve(e)}.bind(this));return r.promise()}catch(t){r.resolve(new n({header:t&&t.name+": "+t.message||this.translationBundle.getText("failedTileCreationMsg"),frameType:this._parseTileSizeToGenericTileFormat(e.size)}));return r.promise()}}else{t="TileType: "+e.tileType+" not found!"}}else{t="No TileType defined!"}r.resolve(new n({header:t,frameType:this._parseTileSizeToGenericTileFormat(e.size)}));return r.promise()};this._getCatalogTileViewAsync=function(e){var t=new jQuery.Deferred;var i;var r="unknown error";var s=this.getTileType(e)==="link";this._translateTileProperties(e);if(e.namespace&&e.path&&e.moduleType){R(e);if(e.moduleType==="UIComponent"){u.create({componentData:{properties:e.properties},name:e.moduleName}).then(e=>{var i=new p({component:e,height:"100%",width:"100%"});t.resolve(i)})}else{d.create({viewName:e.moduleName,type:U[e.moduleType],viewData:{properties:e.properties},height:"100%"}).then(function(e){t.resolve(e)})}return t.promise()}else if(e.tileType){var o=s?"Link":e.tileType;if(o){try{i=this._createCatalogTileInstanceAsync(e,o);i.done(function(e){this._handleTilePress(e);this._applyDynamicTileIfoState(e);t.resolve(e)}.bind(this))}catch(i){t.resolve(new n({header:i&&i.name+": "+i.message||this.translationBundle.getText("failedTileCreationMsg"),frameType:this._parseTileSizeToGenericTileFormat(e.size)}))}}else{r="TileType: "+e.tileType+" not found!"}return t.promise()}r="No TileType defined!";t.resolve(new n({header:r,frameType:this._parseTileSizeToGenericTileFormat(e.size)}));return t.promise()};this._createTileInstance=function(e,t){var i;var s=new jQuery.Deferred;var o=this._getImageContent({src:e.properties.icon});o.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":i=new n({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:L.getLeanURL(e.properties.targetURL),tileContent:new l({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new a({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:this._genericTilePressHandler.bind(this,e)});V[e.id]=i;s.resolve(i);break;case"sap.ushell.ui.tile.StaticTile":i=new n({mode:e.mode||(e.properties.icon?k.ContentMode:k.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:L.getLeanURL(e.properties.targetURL),tileContent:new l({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:o}),press:this._genericTilePressHandler.bind(this,e)});V[e.id]=i;s.resolve(i);break;case"Link":i=new n({mode:k.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:L.getLeanURL(e.properties.targetURL,e.properties.href),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});V[e.id]=i;s.resolve(i);break;default:var p=e.tileType.replace(/\./g,"/");sap.ui.require([p],function(){var t=r.get(e.tileType);i=new t(e.properties||{});V[e.id]=i;s.resolve(i)})}return s.promise()};this.getCardManifest=function(e){var t=JSON.parse(JSON.stringify(e.manifest));return t};this._createCatalogTileInstanceAsync=function(e,t){var i=new jQuery.Deferred;var r;var s=this._getImageContent({src:e.properties.icon});s.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":r=new n({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:L.getLeanURL(e.properties.targetURL),tileContent:new l({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new a({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;case"sap.ushell.ui.tile.StaticTile":r=new n({mode:e.mode||(e.properties.icon?k.ContentMode:k.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:L.getLeanURL(e.properties.targetURL),tileContent:new l({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:s}),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;case"Link":r=new n({mode:k.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:L.getLeanURL(e.properties.targetURL,e.properties.href),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});break;default:t=e.tileType&&e.tileType.replace(/\./g,"/");sap.ui.require([t],function(t){r=new t(e.properties||{});i.resolve(r)})}i.resolve(r);return i.promise()};this._createCatalogTileInstance=function(t,i){var s;var o;var p;var u=this._getImageContent({src:t.properties.icon});u.addStyleClass("sapUshellFullWidth");switch(i){case"sap.ushell.ui.tile.DynamicTile":s=new n({header:t.properties.title,subheader:t.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(t.size),url:L.getLeanURL(t.properties.targetURL),tileContent:new l({frameType:this._parseTileSizeToGenericTileFormat(t.size),footer:t.properties.info,unit:t.properties.numberUnit,content:new a({scale:t.properties.numberFactor,value:t.properties.numberValue,truncateValueTo:5,indicator:t.properties.stateArrow,valueColor:this._parseTileValueColor(t.properties.numberState),icon:t.properties.icon,width:"100%"})}),press:function(e){this._genericTilePressHandler(t,e)}.bind(this)});break;case"sap.ushell.ui.tile.StaticTile":s=new n({mode:t.mode||(t.properties.icon?k.ContentMode:k.HeaderMode),header:t.properties.title,subheader:t.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(t.size),url:L.getLeanURL(t.properties.targetURL),tileContent:new l({frameType:this._parseTileSizeToGenericTileFormat(t.size),footer:t.properties.info,content:u}),press:function(e){this._genericTilePressHandler(t,e)}.bind(this)});break;case"Link":s=new n({mode:k.LineMode,subheader:t.properties.subtitle,header:t.properties.title,url:L.getLeanURL(t.properties.targetURL,t.properties.href),press:function(e){this._genericTilePressHandler(t,e)}.bind(this)});break;default:o=t.tileType.replace(/\./g,"/");p=sap.ui.require(o);if(!p){if(!r.get(t.tileType)){e.warning("FLP: local LaunchPageAdapter. The resource is used before being loaded: "+o);sap.ui.requireSync(o)}p=r.get(t.tileType)}s=new p(t.properties||{})}return s};this._genericTilePressHandler=function(e,t){if(t.getSource().getScope&&t.getSource().getScope()==="Display"){if(e.properties.targetURL){C.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:e.properties.targetURL}});if(e.properties.targetURL[0]==="#"){v.setHash(e.properties.targetURL)}else{var i=m.last("/core/shell/enableRecentActivity")&&m.last("/core/shell/enableRecentActivityLogging");if(i){var r={title:e.properties.title,appType:I.URL,url:e.properties.targetURL,appId:e.properties.targetURL};_.getRendererInternal("fiori2").logRecentActivity(r)}L.openURL(e.properties.targetURL,"_blank")}}}};this._parseTileSizeToGenericTileFormat=function(e){return e==="1x2"?"TwoByOne":"OneByOne"};this._parseTileValueColor=function(e){var t=e;switch(e){case"Positive":t="Good";break;case"Negative":t="Critical";break}return t};this._applyDynamicTileIfoState=function(e){var t=e.onAfterRendering;e.onAfterRendering=function(){if(t){t.apply(this,arguments)}var e=this.getModel();if(!e){return}var i=e.getProperty("/data/display_info_state");var r=this.getDomRef();var n=r.getElementsByClassName("sapMTileCntFtrTxt")[0];switch(i){case"Negative":n.classList.add("sapUshellTileFooterInfoNegative");break;case"Neutral":n.classList.add("sapUshellTileFooterInfoNeutral");break;case"Positive":n.classList.add("sapUshellTileFooterInfoPositive");break;case"Critical":n.classList.add("sapUshellTileFooterInfoCritical");break;default:return}}};this._handleTilePress=function(e){if(typeof e.attachPress==="function"){e.attachPress(function(){if(typeof e.getTargetURL==="function"){var t=e.getTargetURL();C.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:t}});if(t){if(t[0]==="#"){v.setHash(t)}else{L.openURL(t,"_blank")}}}})}};this._translateTileProperties=function(e){if(this.translationBundle&&A&&!e._isTranslated){var t=e.properties;var i=e.keywords;t.title=N(t.title);t.subtitle=N(t.subtitle);t.info=N(t.info);if(i){for(var r=0;r<i.length;r++){i[r]=N(i[r])}}e._isTranslated=true}};this.refreshTile=function(){};this.setTileVisible=function(e,t){J(e,t)};this.addTile=function(e,t){if(!t){t=F}var r=new jQuery.Deferred;var n=E();window.setTimeout(function(){if(!n){var s=i({title:"A new tile was added",size:"1x1"},e,{id:"tile_0"+e.chipId});t.tiles.push(s);J(s,true);r.resolve(s)}else{this.getGroups().done(function(e){r.reject(e)}).fail(function(){r.reject()})}}.bind(this),x());return r.promise()};this.removeTile=function(e,t){var i=new jQuery.Deferred;var r=E();window.setTimeout(function(){if(!r){e.tiles.splice(O(e,t),1);J(t,false);i.resolve()}else{this.getGroups().done(function(e){i.reject(e)}).fail(function(){i.reject()})}}.bind(this),x());return i.promise()};this.moveTile=function(e,t,i,r,n,s){var o=new jQuery.Deferred;var a=E();window.setTimeout(function(){if(!a){if(n===undefined){n=r}e.isLink=s?s===this.TileType.Link:e.isLink;r.tiles.splice(t,1);n.tiles.splice(i,0,e);o.resolve(e)}else{this.getGroups().done(function(e){o.reject(e)}).fail(function(){o.reject()})}}.bind(this),x());return o.promise()};this.getTile=function(){var e=new jQuery.Deferred;return e.promise()};this.getCatalogs=function(){var e=new jQuery.Deferred;H.forEach(function(t){window.setTimeout(function(){e.notify(t)},300)});window.setTimeout(function(){e.resolve(H)},1500);return e.promise()};this.isCatalogsValid=function(){return true};this.getCatalogError=function(){return};this.getCatalogId=function(e){return e.id};this.getCatalogTitle=function(e){return e.title};this.getCatalogTiles=function(e){var t=new jQuery.Deferred;window.setTimeout(function(){t.resolve(e.tiles)},x());return t.promise()};this.getCatalogTileId=function(e){if(e.chipId){return e.chipId}return"UnknownCatalogTileId"};this.getStableCatalogTileId=function(e){if(e.referenceChipId){return e.referenceChipId}if(e.chipId){return e.chipId}return"UnknownCatalogTileId"};this.getCatalogTileTitle=function(e){return e.title};this.getCatalogTileSize=function(e){return e.size};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewAsync(e)};this.getCatalogTileTargetURL=function(e){return e.properties&&e.properties.targetURL||null};this.getCatalogTilePreviewTitle=function(e){return e.properties&&e.properties.title||null};this.getCatalogTilePreviewInfo=function(e){return e.properties&&e.properties.info||null};this.getCatalogTilePreviewIndicatorDataSource=function(e){var t;if(e.properties&&e.properties.serviceUrl){t={path:e.properties.serviceUrl,refresh:e.properties.serviceRefreshInterval}}return t};this.getCatalogTilePreviewSubtitle=function(e){return e.properties&&e.properties.subtitle||null};this.getCatalogTilePreviewIcon=function(e){return e.properties&&e.properties.icon||null};this.getCatalogTileKeywords=function(e){return[e.title,e.properties&&e.properties.subtitle,e.properties&&e.properties.info,e.keywords].flat().filter(function(e){return e})};this.getCatalogTileTags=function(e){return e&&e.tags||[]};this.addBookmark=function(e,t){var i=t||F;var r=new jQuery.Deferred;var n=E();var s=e.title;var o=e.subtitle;var a=e.info;var l=e.url;var p=this.isLinkPersonalizationSupported();window.setTimeout(function(){if(!n){var e={title:s,size:"1x1",chipId:"tile_0"+i.tiles.length,tileType:"sap.ushell.ui.tile.StaticTile",id:"tile_0"+i.tiles.length,isLinkPersonalizationSupported:p,keywords:[],properties:{icon:"sap-icon://time-entry-request",info:a,subtitle:o,title:s,targetURL:l}};i.tiles.push(e);J(e,true);r.resolve(e)}else{this.getGroups().done(function(e){r.reject(e)}).fail(function(){r.reject()})}}.bind(this),x());return r.promise()};this.updateBookmarks=function(e,t){var i=new jQuery.Deferred;var r=0;var n=this.getGroups();n.done(function(n){n.forEach(function(i){i.tiles.forEach(function(i){if(i.properties&&i.properties.targetURL===e){for(var n in t){if(t.hasOwnProperty(n)){i.properties[n]=t[n]}}var s=V[i.id];if(s!==undefined){s.setHeader(i.properties.title);s.setSubheader(i.properties.subtitle)}r++}})});i.resolve(r)});n.fail(function(){i.reject()});return i.promise()};this.deleteBookmarks=function(e){var t=new jQuery.Deferred;var i=0;var r;var n;for(var s=0;s<w.length;s++){r=w[s];for(var o=r.tiles.length-1;o>=0;o--){n=r.tiles[o];if(n.properties.targetURL===e){r.tiles.splice(o,1);i++}}}t.resolve(i);return t.promise()};this.countBookmarks=function(e){var t=new jQuery.Deferred;var i=0;var r;var n;for(var s=0;s<w.length;s++){r=w[s];for(var o=0;o<r.tiles.length;o++){n=r.tiles[o];if(n.properties.targetURL===e){i++}}}t.resolve(i);return t.promise()};this._getImageContent=function(e){return new s(e)};this.onCatalogTileAdded=function(){};this.getTileActions=function(e){return e&&e.actions||null};S.prototype._getCatalogTileIndex=function(){var e={};return Promise.resolve(e)};this.getCatalogTileNumberUnit=function(e){return e.properties?e.properties.numberUnit:undefined}};return S});
//# sourceMappingURL=FlpLaunchPageAdapter.js.map