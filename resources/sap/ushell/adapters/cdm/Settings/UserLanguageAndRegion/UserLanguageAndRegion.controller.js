// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/i18n/Formatting","sap/ui/core/Locale","sap/ui/core/LocaleData","sap/ui/core/format/DateFormat","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ushell/Container","sap/ui/core/format/NumberFormat","sap/base/i18n/Localization","sap/ushell/resources"],function(e,a,t,n,s,g,r,o,i,u,l,d){"use strict";return g.extend("sap.ushell.adapters.cdm.Settings.UserLanguageAndRegion.UserLanguageAndRegion",{onInit:function(){this.oUser=i.getUser();var e=new t(a.getLanguageTag());var n=this.oUser.isLanguagePersonalized();var{sTimeFormat:s,sExampleDate:g,sDecimalFormat:o,sWorkWeek:u,sTimeZone:l}=this._getParsedLocaleProperties(e);var d=new r({languageList:null,selectedLanguage:this.oUser.getLanguage(),selectedDateFormat:g,selectedTimeFormat:s,selectedDecimalFormat:o,selectedTimeZone:l,isLanguagePersonalized:n,selectedWorkWeek:u});this.getView().setBusy(true);this._loadLanguagesList().then(function(e){if(e?.length>1){d.setProperty("/languageList",e);if(!n){var a=e.some(function(e){return e.key==="default"});if(a){d.setProperty("/selectedLanguage","default")}}}this.getView().setBusy(false)}.bind(this));this.oView.setModel(d)},_loadLanguagesList:function(){o.start("FLP:UserLanguageAndRegion._getLanguagesList","_getLanguagesList","FLP");return i.getServiceAsync("UserInfo").then(function(a){return new Promise(function(t){o.start("FLP:UserLanguageAndRegion._getLanguagesList","_getLanguagesList","FLP");a.getLanguageList().done(function(e){o.end("FLP:UserLanguageAndRegion._getLanguagesList");t(e)}).fail(function(a){o.end("FLP:UserLanguageAndRegion._getLanguagesList");e.error("Failed to load language list.",a,"sap.ushell.components.ushell.settings.UserLanguageAndRegion.UserLanguageAndRegion.controller");t(null)})})})},_resetLanguage:function(){var e=this.oUser.getLanguage(),a=this.getView().getModel(),t=a.getData();var n=t.isLanguagePersonalized?e:"default";a.setProperty("/selectedLanguage",n);this._updateTextFields(n)},onCancel:function(){var e=this.getView().getModel(),a=e.getData(),t=a.languageList;if(t&&t.length>0){this._resetLanguage()}},onSaveSuccess:function(a){var t={refresh:true};e.debug("[000] onSaveSuccess: oUser.resetChangedPropertyLanguage:","UserLanguageAndRegion.controller");a.resetChangedProperty("language");t.obsoleteUrlParams=["sap-language"];t.clearSapUserContextCookie=true;return t},onSave:function(a){var t=this.oUser,n=this.getView().getModel().getData(),s=n.selectedLanguage,g=t.getLanguage(),r=s&&s!==(n.isLanguagePersonalized?g:"default"),o=n.languageList&&n.languageList.length>0&&r;e.debug("[000] UserLanguageAndRegion:onSave:bUpdateLanguage:",o,"UserLanguageAndRegion.controller");if(o){e.debug("[000] UserLanguageAndRegion:onSave:UserInfo: oUser.setLanguage:",s,"UserLanguageAndRegion.controller");t.setLanguage(s);return a().then(function(){e.debug("[000] onSave:fnUpdateUserPreferences","UserLanguageAndRegion.controller");return this.onSaveSuccess(t)}.bind(this)).catch(function(a){e.debug("[000] onSave:catch:errorMessage",a,"UserLanguageAndRegion.controller");t.setLanguage(g);t.resetChangedProperty("language");this._updateTextFields(g);e.error("Failed to save Language and Region Settings",a,"sap.ushell.adapters.cdm.Settings.cdmUserLanguageRegion.UserLanguageAndRegion.controller");throw a}.bind(this))}this._resetLanguage();return Promise.resolve()},_handleLanguageSelectChange:function(e){var a=e.getSource().getSelectedKey();if(a){this._updateTextFields(a)}},_updateTextFields:function(e){a.setLanguageTag(e);var n=new t(e);var{sTimeFormat:s,sExampleDate:g,sDecimalFormat:r,sWorkWeek:o,sTimeZone:i}=this._getParsedLocaleProperties(n);var u=this.getView().getModel();u.setProperty("/selectedTimeFormat",s);u.setProperty("/selectedDateFormat",g);u.setProperty("/selectedDecimalFormat",r);u.setProperty("/selectedWorkWeek",o);u.setProperty("/selectedTimeZone",i)},_getParsedLocaleProperties:function(e){var a=n.getInstance(e);var t=a.getDatePattern("medium");var g=a.getTimePattern("medium");var r=s.getDateInstance({pattern:t});var o=a.getDecimalPattern();var i=u.getInstance({pattern:o});const c=a.getWeekendStart();const L=a.getWeekendEnd();const m=a.getDaysStandAlone("wide").filter((e,a)=>a!==c&&a!==L);return{sTimeFormat:g.indexOf("H")===-1?d.i18n.getText("fld12h"):d.i18n.getText("fld24h"),sExampleDate:r.format(new Date),sDecimalFormat:i.format(1000.2),sWorkWeek:m[0]+" - "+m[m.length-1],sTimeZone:l.getTimezone()}}})});
//# sourceMappingURL=UserLanguageAndRegion.controller.js.map