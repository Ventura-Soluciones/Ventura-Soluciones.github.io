// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isEmptyObject","sap/base/util/Version","sap/ui/core/Configuration","sap/ui/core/library","sap/ui/core/service/ServiceFactoryRegistry","sap/ui/core/UIComponent","sap/ui/core/ComponentHooks","sap/ushell/Fiori20Adapter"],function(e,i,t,n,a,s,r,o,u){"use strict";var c={I_DEFAULT_SEARCH_DEPTH:5,B_DEFAULT_LATE_ADAPTATION:false,S_FIORI20ADAPTER_URL_PARAM_NAME:"sap-ui-xx-fiori2Adaptation",S_FIORI20ADAPTER_METADATA_PARAM_NAME:"sapFiori2Adaptation",A_ALLOWLIST:["fin.*","ssuite.fin.*","fscm.*","sap.fin.*","cus.sd.*","cus.o2c.*","sap.apf.*","tl.ibp.*","ux.fnd.apf.o2c.*","fnd.apf.*","fnd.pob.o2c.*","fcg.sll.*","ux.fnd.generic-apf-application.*","hpa.cei.*","query.viewbrowser.s1.*","ssuite.vdm.viewbrowser.s1.*","ssuite.smartbusiness.kpi.s1.*","ssuite.smartbusiness.evaluation.s1.*","ssuite.smartbusiness.association.s1.*","ssuite.smartbusiness.drilldown.s1.*","ssuite.smartbusiness.tile.s1.*","ssuite.smartbusiness.tile.ce.s1.*","ssuite.smartbusiness.workspace.s1.*","ssuite.smartbusiness.runtime.s1.*","gs.fin.customersummarycn.display.*","gs.fin.financialstatement.structure.manage.*","gs.fin.financialstatement.display.*","uipsm.*","publicservices.her.*"],getConfiguration:function(e){var i;i=this._getURLParamConfiguration();if(!i){i=this._getMetadataConfiguration(e)}if(!i){i=this._getDefaultConfiguration(e)}i.iSearchDepth=i.iSearchDepth||c.I_DEFAULT_SEARCH_DEPTH;if(typeof i.iSearchDepth==="string"&&!isNaN(i.iSearchDepth)){i.iSearchDepth=parseInt(i.iSearchDepth,10)}return i},_getURLParamConfiguration:function(){if(!n||typeof n.getFiori2Adaptation!=="function"){return}var e=new URLSearchParams(window.location.search);if(!e.get(c.S_FIORI20ADAPTER_URL_PARAM_NAME)){return}var i=n.getFiori2Adaptation();var t;var a;if(typeof i==="boolean"){t=i}else if(i&&i.length>=1){a=i}if(!a&&t===undefined){return}return{bStylePage:a?a.indexOf("style")>-1:t,bMoveTitle:a?a.indexOf("title")>-1:t,bHideBackButton:a?a.indexOf("back")>-1:t,bCollapseHeader:a?a.indexOf("collapse")>-1:t,bHierarchy:a?a.indexOf("hierarchy")>-1:t}},_getMetadataConfiguration:function(e){var t=e.getManifestEntry("/sap.ui5/config")||{};var n=t[c.S_FIORI20ADAPTER_METADATA_PARAM_NAME];var a;var s;if(typeof n==="boolean"){a=n}else if(typeof n==="object"&&!i(n)){s=n}if(!s&&a===undefined){return}return{bStylePage:s?this._isSgnTrue(s.style):a,bMoveTitle:s?this._isSgnTrue(s.title):a,bHideBackButton:s?this._isSgnTrue(s.back):a,bCollapseHeader:s?this._isSgnTrue(s.collapse):a,bHierarchy:s?this._isSgnTrue(s.hierarchy):a,bLateAdaptation:s?this._isSgnTrue(s.lateAdaptation):c.B_DEFAULT_LATE_ADAPTATION}},_getDefaultConfiguration:function(e){var i=this._hasMinVersionSmallerThan(e,"1.42")&&this._isAllowed(e);return{bStylePage:i,bMoveTitle:i,bHideBackButton:i,bCollapseHeader:i,bHierarchy:i}},_isAllowed:function(e){var i=e.getMetadata().getName();for(var t=0;t<c.A_ALLOWLIST.length;t++){var n=c.A_ALLOWLIST[t].substring(0,c.A_ALLOWLIST[t].length-2);if(this._isPrefixedString(i,n)){return true}}return false},_isAdaptationRequired:function(e){for(var i in e){if(e[i]===true){return true}}return false},_isPrefixedString:function(e,i){return e&&i&&e.substring(0,i.length)===i},_hasMinVersionSmallerThan:function(e,i){var n=e.getManifestEntry("sap.ui5");var a=true;if(n&&n.dependencies&&n.dependencies.minUI5Version){var s=new t(n.dependencies.minUI5Version);a=s.compareTo(new t(i))<0}return a},_isSgnTrue:function(e){return e===true||e==="true"}};o.onUIComponentInstanceInitialized.register(function(i){const t=i.getAggregation("rootControl");if(!t||t.getId()==="navContainerFlp"||i.getId().indexOf("application-")!==0){return}const n=c.getConfiguration(i);if(!c._isAdaptationRequired(n)){return}if(!a.service||!s||typeof s.get!=="function"){e.warning("Fiori20Adapter not loaded because static FactoryRegistry is not available","sap.ui.core.service.ServiceFactoryRegistry should be a function","sap.ushell.Fiori20AdapterTest");return}const r={onBeforeRendering:function(){t.removeEventDelegate(r);const a=s.get("sap.ushell.ui5service.ShellUIService");const o=a&&a.createInstance({scopeObject:i,scopeType:"component"});if(!a||!o){e.warning("Fiori20Adapter not loaded because ShellUIService is not available","sap.ushell.ui5service.ShellUIService should be declared by configuration","sap.ushell.Fiori20AdapterTest");return}o.then(e=>u.applyTo(t,i,n,e)).catch(i=>{e.warning("Fiori20Adapter not loaded as ShellUIService is not available",i,"sap.ushell.Fiori20AdapterTest")})}};t.addEventDelegate(r)})});
//# sourceMappingURL=Fiori20AdapterTest.js.map