/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/layout/form/SimpleForm","sap/m/Input","sap/m/Label","sap/m/Title","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","../utils/DeviceType","../utils/Transformations","sap/ui/Device","sap/m/MessageStrip","../utils/AppConstants","sap/ui/layout/form/SimpleFormLayout","../utils/InsightsUtils"],function(e,t,i,s,a,r,l,o,n,h,d,u,f,g,w,v,p,P,T,C,x,S,D){var I=e.extend("sap.insights.manageCardPreview.Preview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},cardMessageInfo:{type:"object",group:"Appearance",defaultValue:null},transformation:{type:"boolean",group:"Behavior",defaultValue:false},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{titleCheck:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});I.prototype.init=function(){this.bInitialPreviewLoad=true;this.i18Bundle=D.getResourceBundle();T.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oPreviewPageHeader=new d(this.getId()+"--insightCardPreviewPage-header",{});this.oPreviewPageTitle=new a(this.getId()+"--insightCardPreviewTitle",{text:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),level:"H1"});this.oPreviewPage=new l(this.getId()+"--insightCardPreviewPage",{showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[],customHeader:[this.oPreviewPageHeader]}).addStyleClass("sapMPageBgStandard");this.setAggregation("_page",this.oPreviewPage);this.createStaticControls();this.oPreviewPageHeader.addContent(this.oPreviewPageTitle);this.oPreviewPageHeader.addContent(new u(this.getId()+"--insightCardPreviewPage-headerSpacer"));this.oPreviewPageHeader.addContent(this.oCardPreviewBtn);this.oPreviewPageHeader.addContent(this.oHideCardPreviewBtn);this.oPreviewPage.addContent(this.oDefaultVBox)};I.prototype.onBeforeRendering=function(){this.bShowCardPreview=false;this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this.oTitleTextInput.setValue(this.oManifest["sap.card"].header.title);this.oSubTitleTextInput.setValue(this.oManifest["sap.card"].header.subTitle);this._formatTitle(this.oTitleTextInput.getValue());this._adjustLayoutStyles();this.oInsightsPreviewOverflowLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsCardOverflowLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};I.prototype.createStaticControls=function(){this.oCardPreviewBtn=new v(this.getId()+"--cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new v(this.getId()+"--hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new a(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_CARD_TITLEINFO"),level:"H4"}).addStyleClass("sapUiSmallMarginTop");this.oDefaultSubText=new s(this.getId()+"--defaultSubText",{wrapping:true});this.oDefaultInfoVBox=new r(this.getId()+"--defaultInfoVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelTitle=new s(this.getId()+"--labelTitle",{text:this.i18Bundle.getText("INT_Preview_CARDTITLE"),required:true,labelFor:this.getId()+"--titleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oTitleTextInput=new i(this.getId()+"--titleTextInput",{change:this._handleTitleChange.bind(this),required:true,ariaLabelledBy:[this.getId()+"--invisibleText",this.getId()+"--defaultTitle",this.getId()+"--defaultSubText",this.getId()+"--labelTitle"]});this.oLabelSubTitle=new s(this.getId()+"--labelSubTitle",{text:this.i18Bundle.getText("INT_Preview_SubTitleTitleField_Label"),required:false,labelFor:"subTitleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oSubTitleTextInput=new i(this.getId()+"--subTitleTextInput",{change:this._handleSubTitleChange.bind(this)});this.oSimpleForm=new t(this.getId()+"--defaultPreviewForm",{width:"100%",layout:S.ColumnLayout,editable:true,adjustLabelSpan:true,labelSpanXL:12,labelSpanL:12,labelSpanM:12,labelSpanS:12,content:[this.oLabelTitle,this.oTitleTextInput,this.oLabelSubTitle,this.oSubTitleTextInput]});this.oDefaultPreviewFormFlex=new r(this.getId()+"--defaultPreviewFormFlex",{height:"100%",width:"100%",items:[this.oSimpleForm]});this.oDefaultPreviewCardSD=new g(this.getId()+"--defaultPreviewCardSD",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"}).addStyleClass("sapUiTinyMarginBeginEnd");this.oInsightsPreviewOverflowInnerHBoxSD=new f(this.getId()+"--insightsPreviewOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsPreviewOVPOverLayPositionSD");this.oInsightsPreviewOverflowLayerSD=new f(this.getId()+"--insightsPreviewOverflowLayerSD",{height:"0",items:[this.oInsightsPreviewOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewCardVBox=new r(this.getId()+"--defaultPreviewCardVBox",{width:"100%",height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardSD,this.oInsightsPreviewOverflowLayerSD]}).addStyleClass("sapUiSmallMarginTop sapUiTinyMarginBottom");this.oDefaultPreviewScrollSD=new n(this.getId()+"--defaultPreviewScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewCardVBox]});this.oDefaultPreviewFlexBox=new o(this.getId()+"--defaultPreviewFlexBox",{height:"100%",width:"100%",visible:false,justifyContent:"Center",items:[this.oDefaultPreviewScrollSD]});this.oMessageStrip=new C(this.getId()+"--messageStripId",{showIcon:true,showCloseButton:false}).addStyleClass("sapUiSmallMargin");this.oCardMessageStrip=new r(this.getId()+"--cardMessageId",{items:[this.oMessageStrip]});this.oDefaultFlexBox=new o(this.getId()+"--defaultFlexBox",{height:"100%",direction:"Column",items:[this.oDefaultInfoVBox,this.oCardMessageStrip,this.oDefaultPreviewFormFlex,this.oDefaultPreviewFlexBox]});this.oDefaultPreviewCardText=new a(this.getId()+"--defaultPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop");this.oDefaultPreviewHBox=new f(this.getId()+"--defaultPreviewHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",items:[this.oDefaultPreviewCardText]}).addStyleClass("sapUiTinyMarginBegin");this.oDefaultPreviewToolBar=new h(this.getId()+"--defaultPreviewToolBar",{width:"100%",height:"2.7rem",style:"Clear",design:"Auto",content:[this.oDefaultPreviewHBox]}).addStyleClass("sapThemeBaseBG");this.oInsightsCardOverflowInnerHBox=new f(this.getId()+"--insightsCardOverflowInnerHBox",{width:"19rem",height:"2rem"}).addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop");this.oDefaultPreviewCardLS=new g(this.getId()+"--defaultPreviewCardLS",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"});this.oInsightsCardOverflowLayer=new f(this.getId()+"--insightsCardOverflowLayer",{height:"0",items:[this.oInsightsCardOverflowInnerHBox]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewVBox=new r(this.getId()+"--defaultPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardLS,this.oInsightsCardOverflowLayer]});this.oDefaultPreviewPanel=new w(this.getId()+"--defaultPreviewPanel",{expanded:false,height:"100%",backgroundDesign:"Transparent",content:[this.oDefaultPreviewVBox]});this.oDefaultPreviewPanelFlex=new o(this.getId()+"--defaultPreviewPanelFlex",{height:"calc(100% - 2.8rem)",backgroundDesign:"Transparent",justifyContent:"Center",items:[this.oDefaultPreviewPanel]});this.oDefaultPreviewScroll=new n(this.getId()+"--defaultPreviewScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewToolBar,this.oDefaultPreviewPanelFlex]});this.oPreviewFlexBox=new o(this.getId()+"--defaultPreviewFlex",{height:"100%",width:"38%",direction:"Column",renderType:"Bare",items:[this.oDefaultPreviewScroll]}).addStyleClass("sapMPageBgStandard");this.oDefaultVBox=new r(this.getId()+"--defaultVBox",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oDefaultFlexBox,this.oPreviewFlexBox]})};I.prototype.setPreviewModeOfCard=function(){var e=p.getDialogBasedDevice()===x.DEVICE_TYPES.Desktop;var t=e?this.oDefaultPreviewCardLS:this.oDefaultPreviewCardSD;if(t&&this.getTransformation()&&(this.oManifest["sap.card"].type==="Table"||this.oManifest["sap.card"].type==="List")){t.setPreviewMode("Abstract")}else{t.setPreviewMode("Off")}};I.prototype._setCardMessageInfo=function(){var e=this.getCardMessageInfo();if(e&&e.text&&e.text.trim()!==""){if(p.getDialogBasedDevice()===x.DEVICE_TYPES.Desktop){this.oCardMessageStrip.setVisible(true)}else{this.oCardMessageStrip.setVisible(this.bShowCardPreview?false:true)}if(this.oMessageStrip){this.oMessageStrip.setText(e.text);this.oMessageStrip.setType(e.type)}}else{e=null;this.oCardMessageStrip.setVisible(false)}};I.prototype._callPreview=function(){this.bShowCardPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);if(p.getDialogBasedDevice()===x.DEVICE_TYPES.Desktop){this.oDefaultPreviewCardLS.refresh()}else{this.oDefaultPreviewCardSD.refresh()}this._setCardMessageInfo()};I.prototype._callClosePreview=function(){this.bShowCardPreview=false;this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this._setCardMessageInfo()};I.prototype._handleTitleChange=function(e){var t=e.getSource();var i=t.getValue().trim();var s;if(p.getDialogBasedDevice()===x.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.title=i;this.bInitialPreviewLoad=true}if(i){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}this.setManifest(JSON.stringify(this.oManifest));s.refresh()};I.prototype._handleSubTitleChange=function(e){var t=e.getSource();var i=t.getValue();var s;if(p.getDialogBasedDevice()===x.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.subTitle=i;this.bInitialPreviewLoad=true}s.refresh();this.setManifest(JSON.stringify(this.oManifest))};I.prototype._adjustLayoutStyles=function(){if(p.getDialogBasedDevice()!==x.DEVICE_TYPES.Desktop){if(this.bShowCardPreview){this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true)}else{this.oDefaultPreviewFlexBox.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false)}this.oPreviewFlexBox.setVisible(false);this.oDefaultPreviewCardSD.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardSD.refresh();this.oDefaultPreviewFormFlex.setWidth("100%");this.oDefaultFlexBox.setWidth("100%")}else{this.oPreviewFlexBox.setVisible(true);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultPreviewFormFlex.setWidth("50%");this.oDefaultFlexBox.setWidth("62%");this.oDefaultPreviewCardLS.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardLS.refresh()}this._setCardMessageInfo();this.oPreviewPage.setTitle(this.getDialogTitle())};I.prototype._setCardTypeForColumn=function(e){if(e["sap.card"].type==="Table"&&this.bInitialPreviewLoad&&this.getTransformation()){var t=P.createTableOptions(e);var i=t.filter(function(e){return e["sap.card"].type==="List"});if(i.length){e=i[0]}this.bInitialPreviewLoad=false}return e};I.prototype._setAriaTextOnManifest=function(e){var t=e.getSource()._ariaText.getText();var i=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(i+t)};I.prototype._formatTitle=function(e){var t=this.oTitleTextInput;if(e&&e.trim()){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}};return I});
//# sourceMappingURL=Preview.js.map