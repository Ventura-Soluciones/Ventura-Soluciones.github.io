// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ushell_abap/pbServices/ui2/Error","sap/ushell_abap/pbServices/ui2/Utils","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,i,n,jQuery){"use strict";var a=function(a,r){var o,s,l=[],u,d=true,g,f,c,h=[],p=this;function C(){if(d){throw new t(p+": page is just a stub","Page")}}function S(){if(!o){throw new t(p+": catalog is just an ID","Catalog")}}this.exit=function(){var e=p.toString();if(s){s.exit()}o=undefined;r=undefined;l=[];d=true;u=undefined;c=undefined;h=[];Object.keys(p).forEach(function(e){if(!/getCatalogData|getId|isStub|toString/.test(e)){delete p[e]}});a.forgetCatalog(p);n.debug("Exited: "+e,null,"Catalog")};this.getRemoteBaseUrl=function(){return p.addSystemToServiceUrl(o.type==="H"?"/sap/hba/apps/kpi/s/odata/hana_chip_catalog.xsodata/":o.baseUrl)};this.getRemoteCatalogService=function(){return a.getRemoteCatalogService(o)||{readChips:function(e,t,a,r,s){n.error("Catalog '"+o.id+"', type '"+o.type+"' not supported",null,"Catalog");i.callHandler(r.bind(null,{results:[]}),undefined,true)}}};function v(){var e,t,i;n.debug("Loaded: "+p,null,"Catalog");if(o.Chips){i=o.Chips.results||o.Chips;delete o.Chips;l=[];for(e=0,t=i.length;e<t;e+=1){l[e]=a.createChip(i[e])}d=false;n.debug("Initialized: "+p,null,"Catalog")}delete o.CatalogPage}this.read=function(e,t,n){var r;function s(e){o=e;v();r.resolve()}function l(e){o.Chips=e;v();r.resolve()}function d(e){e.results.forEach(function(e){e.remoteCatalogId=f});l(e)}function c(){v();g=arguments;r.reject.apply(this,arguments)}function h(t){var i;if(t.remoteId){o=t;try{i=p.getRemoteBaseUrl()}catch(e){c(e.toString());return}p.getRemoteCatalogService().readChips(i,o.remoteId,undefined,d,c)}else if(o&&e){l(t.Chips)}else{s(t)}}if(!u||u.state()!=="pending"){r=new jQuery.Deferred;u=r.promise();if(!o||e&&!o.remoteId){a.getPageBuildingService().readCatalog(f,h,r.reject.bind(r))}else{h.bind(this)(o)}}n=n||a.getPageBuildingService().getDefaultErrorHandler();u.done(i.callHandler.bind(null,t,n));u.fail(n)};this.addSystemToServiceUrl=function(i,n){if(i.indexOf("/")!==0||i.indexOf("//")===0){throw new t("addSystemToServiceUrl: Invalid URL: "+i,"Catalog")}n=n||this.getSystemAlias();if(/^[^?]*(;o=([\/;?]|$))/.test(i)){i=i.replace(/;o=([\/;?]|$)/,(n?";o="+n:"")+"$1")}else if(!/^[^?]*;o=/.test(i)&&n){i=i.replace(/(\/[^?]*?)(\/$|$|(\/?\?.*))/,"$1;o="+n+"$2")}e.getInstance().publish("sap.ushell.Container","addRemoteSystemForServiceUrl",i);return i};this.clone=function(e,t,i,n){var r,s=function(e,t){return n(e,undefined,t)};if(o&&o.type==="REMOTE"){r=this.getCatalogData();delete r.id;r.domainId=e;if(t!==undefined){r.title=t}a.createNewCatalog(r,i,n)}else{a.getPageBuildingService().cloneCatalog(this.getId(),e,t,function(e){a.createCatalog(e.id,i,s)},s)}};this.getCatalogData=function(){var e;if(!o){return undefined}e=JSON.parse(JSON.stringify(o));delete e.__metadata;return e};this.getCatalogPage=function(){S();if(o.type!=="P"&&o.type!=="CATALOG_PAGE"){return undefined}if(!s){s=a.createPage(f)}return s};this.getChips=function(){if(d){throw new t(p+": catalog is just a stub","Catalog")}return l.slice()};this.getDomainId=function(){return o&&o.domainId};this.getId=function(){return f};this.getSystemAlias=function(){return o&&o.systemAlias||undefined};this.getTitle=function(){S();return o.title};this.getType=function(){S();return o&&o.type};this.isOutdated=function(){S();return s&&!s.isStub()&&s.isOutdated()||o.outdated==="X"};this.isReadOnly=function(){C();return o.isReadOnly==="X"};this.isStub=function(){return d};this.getCachedRemoteFailureArguments=function(){return g};this.load=function(e,i){if(!d){throw new t("Catalog is not a stub anymore","Catalog")}this.read(false,e,i)};this.readChips=function(e,t,n){function r(e){e.results.forEach(function(e){a.createChip(e)});i.callHandler(t,n)}function s(e){e.results.forEach(function(e){e.remoteCatalogId=f});r(e)}function l(t){o=t;if(o.remoteId){this.getRemoteCatalogService().readChips(this.getRemoteBaseUrl(),o.remoteId,e,s,n)}else{a.getPageBuildingService().readCatalogChips(f,e,r,n)}}if(!o){a.getPageBuildingService().readCatalog(f,l.bind(this),n,true)}else{l.bind(this)(o)}};this.readRegisteredChips=function(e,t){function n(){var e=new jQuery.Deferred,t=h;h=[];if(t.length){p.readChips(t,e.resolve.bind(e),e.reject.bind(e))}else{e.resolve()}return e.promise()}if(!c||c.state()!=="pending"){c=n()}t=t||a.getPageBuildingService().getDefaultErrorHandler();c.fail(t).done(i.callHandler.bind(null,e,t))};this.refresh=function(e,t){this.read(true,e,t)};this.registerChip=function(e){if(c&&c.state()==="pending"){throw new t("Invalid state: registerChip while readRegisteredChips pending","Catalog")}h.push(e.getId())};this.remove=function(e,i){S();if(u&&u.state()==="pending"){throw new t("Catalog is being refreshed: "+this,"Catalog")}n.debug("Removing: "+this,null,"Catalog");a.getPageBuildingService().deleteCatalog(o,function(){this.exit();e()}.bind(this),i)};this.toString=function(e){var t=['Catalog({sId:"',f,'"',",bIsStub:",d];if(e){t.push(",oAlterEgo:",JSON.stringify(o),",oFactory:",a.toString(e),",aChips:",JSON.stringify(l))}t.push("})");return t.join("")};this.update=function(e,i,n){var r;S();if(Object.hasOwnProperty.call(e,"__metadata")){throw new t("Unsupported __metadata update","Catalog")}r=JSON.parse(JSON.stringify(o));Object.keys(e).forEach(function(t){r[t]=e[t]});d=true;g=undefined;a.getPageBuildingService().updateCatalog(r,function(){o=r;this.read(true,i,n)}.bind(this),function(){d=false;n=n||a.getPageBuildingService().getDefaultErrorHandler();n.apply(null,arguments)})};if(typeof r==="object"){f=r.id;if(r.remoteId){delete r.Chips}o=r;v()}else if(typeof r==="string"){f=r}if(!f){throw new t("Missing ID","Catalog")}n.debug("Created: "+this,null,"Catalog")};return a});
//# sourceMappingURL=Catalog.js.map