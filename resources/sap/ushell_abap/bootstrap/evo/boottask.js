// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/bootstrap/evo/abap.xhrlogon.LibLoader","./abap.bootstrap.utils","./abap.request.startup","./abap.request.pageset","./abap.xhrlogon.handler","./abap.theme.handler","sap/ushell/EventHub","sap/ui/performance/trace/initTraces","sap/base/util/ObjectPath","sap/base/Log","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell/bootstrap/common/common.util","./SAPCompanionConditionSetter","sap/ushell/utils/UrlParsing"],function(e,t,a,n,r,i,s,o,l,c,u,p,g,f){"use strict";var m={};var h=new RegExp("^(#)?([A-Za-z0-9_]+)-([A-Za-z0-9_]+)"),d,v;function b(e){function t(e){if(!e){return false}return e.indexOf("Shell-home")===0||e.indexOf("Launchpad-openFLPPage")===0||e.indexOf("Shell-appfinder")===0||e.indexOf("Shell-catalog")===0||e.indexOf("shell-catalog")===0||e.indexOf("Action-search")===0}function a(){return window["sap-ushell_abap-bootstrap-abap-noInitialTarget"]!==undefined}var n=e.match(h);var r=n&&n[2];var i=n&&n[3];var s=e&&!t(e)&&!a()&&r&&i;return s}function P(){var e,a=t.getLocationHref(),n=a.indexOf("#");if(n<0){return""}e=decodeURI(a.slice(n+1));return e}function S(){var e=P(),t=e.indexOf("&/");return t<0?e:e.slice(0,t)}function C(){return sap.ui.require("sap/ushell/Container")}function y(e){var t=e.match(h);return t?{semanticObject:t[2],action:t[3]}:undefined}function F(e){if(!e||e==="#"){return true}return e.indexOf("Shell-home")===0||e.indexOf("Launchpad-openFLPPage")===0||e.indexOf("Shell-appfinder")===0||e.indexOf("Shell-catalog")===0||e.indexOf("shell-catalog")===0}function A(e){if(e===undefined){return undefined}try{return JSON.parse(JSON.stringify(e))}catch(e){c.error("Could not clone object",null,"sap.ushell_abap.bootstrap");return undefined}}function T(e){return e.indexOf("sap_")===0}function w(e,t){c.debug("setSapui5Settings()",JSON.stringify(e),"sap.ushell_abap.bootstrap.abap");const a=sap.ui.require("sap/base/i18n/Formatting");const n=sap.ui.require("sap/base/i18n/Localization");if(e.language){n.setLanguage(e.language,e.ABAPLanguage)}if(e.legacyDateFormat){a.setABAPDateFormat(e.legacyDateFormat)}if(e.legacyDateCalendarCustomizing){a.setCustomIslamicCalendarData(e.legacyDateCalendarCustomizing)}if(e.legacyNumberFormat){a.setABAPNumberFormat(e.legacyNumberFormat)}if(e.legacyTimeFormat){a.setABAPTimeFormat(e.legacyTimeFormat)}if(typeof t==="object"){a.addCustomCurrencies(t)}if(e.useTimeZoneIana&&e.timeZoneIana!==""){n.setTimezone(e.timeZoneIana)}}function _(e){(l.get("sap-ushell-config.services.Container.adapter.config")||l.create("sap-ushell-config.services.Container.adapter.config")).bootTheme=A(e)}function x(e){if(!e){c.error("extractSystemThemeRoot: mandatory parameter oStartupServiceResult not supplied")}if(e.themeRoot){return e.themeRoot}if(e.client){c.warning("Theme root was not contained in startup service result. A fallback to /sap/public/bc/themes/~client-<client number> is used",null,"sap.ushell_abap.bootstrap");return"/sap/public/bc/themes/~client-"+e.client}c.error("extractSystemThemeRoot: Could not determine system theme root")}function L(e){var t,a;if(e&&e.userProfile&&e.userProfile.filter){t=e.userProfile.filter(function(e){return e.id==="THEME"});a=t.length?t[0]:{};if(a.value){return a.value}}if(e&&e.theme){return e.theme}return""}function I(e,t){if(e&&T(e)){return""}return t}function O(e,t){var a;a=L(e);return{theme:a,root:I(a,t)}}function R(e){var a,n;a=t.getUrlParameterValue("sap-theme")||t.getUrlParameterValue("sap-ui-theme");if(a){if(a.indexOf("@")>0){n=a.split("@",2);return{theme:n[0],root:n[1]}}return{theme:a,root:I(a,e)}}return undefined}function H(){const e=u.getParameterMap();return e["sap-theme"]?.[0]||e["sap-ui-theme"]?.[0]}function D(e){var t=e;var a=e.indexOf("@");if(a>=0){var n=t.slice(a+1);return i.isThemeRootSafe(n)}return true}function M(e,t){var a;var n={};var r;var i=H();if(i&&D(i)){a=R(t);r=a;c.debug(`theme: URL theme = "${r.theme}"  theme root = "${r.root}"`,null,"sap.ushell_abap.bootstrap")}else if(e){r=e;c.debug(`theme: startup service theme = "${r.theme}"  theme root = "${r.root}"`,null,"sap.ushell_abap.bootstrap");if(i){const e=r.theme;sap.ui.require("sap/ui/core/Core").ready(()=>sap.ui.require("sap/ui/core/Theming").setTheme(e))}}else{n.theme=l.get("sap-ui-config.theme");if(n.theme){n.root=l.get("sap-ui-config.themeRoots."+n.theme||"");if(!n.root){n.root=I(n.theme,t)}r={theme:n.theme,root:n.root};c.debug(`theme: html file theme = "${r.theme}"  theme root = "${r.root}"`,null,"sap.ushell_abap.bootstrap")}else{r={theme:"",root:""};c.error("Could not determine theme",null,"sap.ushell_abap.bootstrap")}}_(r);return r}function q(e){const a=u.getParameterMap();const n=t.getUrlParameterValue("sap-locale",a);const r={services:{}};const i=l.get("sap-ushell-config.services.SupportTicket.config.enabled");if(i!==false){r.services.SupportTicket={config:{enabled:e.isEmbReportingActive===true}}}r.services.ClientSideTargetResolution={adapter:{config:{services:{targetMappings:e?.services?.targetMappings}}}};r.services.LaunchPage={adapter:{config:{services:{targetMappings:e?.services?.targetMappings,launchPage:e?.services?.pbFioriHome}}}};r.services.VisualizationDataProvider={adapter:{module:"sap.ushell_abap.adapters.abap.FlpLaunchPageAdapter",config:{services:{targetMappings:e?.services?.targetMappings,launchPage:e?.services?.pbFioriHome}}}};r.services.PageBuilding={adapter:{config:{services:{pageBuilding:e?.services?.pbFioriHome}}}};r.services.Personalization={adapter:{config:{services:{personalization:e?.services?.personalization}}}};let s={};if(!n){s={language:e.languageBcp47||e.language,ABAPLanguage:e.language,legacyDateFormat:e.dateFormat,legacyDateCalendarCustomizing:e.tislcal,legacyNumberFormat:e.numberFormat===""?" ":e.numberFormat,legacyTimeFormat:e.timeFormat}}let o=l.get("sap-ushell-config.ui5.timeZoneFromServerInUI5");if(o===undefined){o=false;l.set("startupConfig.timeZoneFromServerInUI5",o,r);l.set("ushell.ui5.timeZoneFromServerInUI5",o)}let c=l.get("sap-ushell-config.startupConfig.timeZone");if(c===undefined){c="";l.set("startupConfig.timeZone",c,r)}s.useTimeZoneIana=o;s.timeZoneIana=c;const g=p.getV2ServiceMigrationConfig(r);p.mergeConfig(window["sap-ushell-config"],g,true);p.mergeConfig(window["sap-ushell-config"],r,true);M(v,d);w(s,e.currencyFormats)}function z(e){var t=m._getShellHash(),n=P(),r=y(t),i=[r],s={},o={},c;var u=l.get("sap-ushell-config.services.AppState.config")||l.create("sap-ushell-config.services.AppState.config");var p=l.get("sap-ushell-config.services.ClientSideTargetResolution.adapter.config")||l.create("sap-ushell-config.services.ClientSideTargetResolution.adapter.config");function g(e,t){var a=t.match(e);var n=[];if(!a){return}n=a[2].toString().split("=");o[n[0]]=n[1]}function f(e,t,a,n,r){if(t&&t[r]&&a&&a[n]){e[a[n]]=t[r]}}if(b(t)){g(/(\?|&)(sap-xapp-state=[A-Z0-9]+)/,t);g(/(\?|&)(sap-intent-param=[A-Z0-9]+)/,t);g(/(\?|&)(sap-system=[A-Z0-9]+)/,t);g(/(\?|&|[/])(sap-iapp-state=[A-Z0-9]+)/,n);c=a.requestDirectStart(e,r,o);u.initialAppStatesPromise=c.then(function(e){f(s,e,o,"sap-intent-param","iparState");f(s,e,o,"sap-iapp-state","iappState");f(s,e,o,"sap-xapp-state","xappState");u.initialAppStates=s;return Promise.resolve(s)});p.initialSegmentPromise=c.then(function(e){if(e.targetMappings){return Promise.resolve([i,e.targetMappings,e.systemAliases,e.urlTemplates])}return Promise.resolve(null)})}else{u.initialAppStatesPromise=Promise.resolve({});p.initialSegmentPromise=Promise.resolve(null)}}function Z(){var e=new Promise(function(e,t){var a,n;n=function(){c.info("Direct application start: resolving component waitFor promise after shell renderer created event fired.");e();C().detachRendererCreatedEvent(n)};s.once("ShellNavigationInitialized").do(function(){a=C().getRendererInternal();if(a){c.info("Direct application start: resolving component waitFor promise immediately (shell renderer already created).");e()}else{C().attachRendererCreatedEvent(n)}})});return e}function N(){g.run().catch(()=>{c.info("SAPCompanion conditions could not be set.")});var t=m._getShellHash();if(F(t)&&window["sap-ushell-config"].ushell&&window["sap-ushell-config"].ushell.spaces&&window["sap-ushell-config"].ushell.spaces.enabled){m._loadPage(t)}e.getLib().then(function(e){var t=e.FrameLogonManager.getInstance();C().oFrameLogonManager=t});if(b(t)){var a,n;window["sap-ushell-async-libs-promise-directstart"]=new Promise(function(e,t){a=e;n=t});window["sap-ushell-async-libs-promise-directstart"].catch(function(e){});C().getServiceAsync("NavTargetResolutionInternal").then(function(e){const t="#"+m._getShellHash();e.resolveHashFragment(t).done(function(e){sap.ui.require(["sap/ushell/services/AppConfiguration"],function(r){r.setCurrentApplication(e);if(e&&e.ui5ComponentName){const r=f.getBasicHash(t);e.ui5ComponentId=`application-${r}-component`;C().getServiceAsync("Ui5ComponentLoader").then(function(r){r.createComponent(e,y(t),Z(),"Application").then(function(e){a({resolvedHashFragment:e,dependenciesLoaded:true})}).catch(function(e){n(e)})})}else{a({resolvedHashFragment:e,dependenciesLoaded:false})}})}).fail(function(e){n(e)})})}}function E(e){if(e&&e.indexOf("Shell-appfinder")===0){return}C().getServiceAsync("PersonalizationV2").then(async function(e){var t={container:"sap.ushell.cdm3-1.personalization",item:"data"};var a={validity:"Infinity",keyCategory:e.KeyCategory.GENERATED_KEY,writeFrequency:e.WriteFrequency.HIGH,clientStorageAllowed:false};const n=await e.getPersonalizer(t,a);return n.getPersData()});sap.ui.require(["sap/ushell/components/pages/controller/PagesAndSpaceId"],function(t){var a=t.getPageAndSpaceId(e);var n=C().getServiceAsync("PagePersistence");Promise.all([a,n]).then(function(e){var t=e[0];var a=e[1];a.getPage(t.pageId)}).catch(function(e){c.error(e)})})}function U(e){r.initXhrLogon(window["sap-ushell-config"]);o();a.requestStartupConfig().then(function(e){var t=m._getShellHash();(l.get("sap-ushell-config.services.Container.adapter")||l.create("sap-ushell-config.services.Container.adapter")).config=e;var r=l.get("sap-ushell-config.services.LaunchPage.adapter.config")||l.create("sap-ushell-config.services.LaunchPage.adapter.config");var i=l.get("sap-ushell-config.services.ClientSideTargetResolution.adapter.config")||l.create("sap-ushell-config.services.ClientSideTargetResolution.adapter.config");if(l.get("sap-ushell-config.ushell.spaces.enabled")){l.set("sap-ushell-config.services.VisualizationDataProvider.adapter.config",r);l.set("sap-ushell-config.services.NavigationDataProvider.adapter.config",i)}z(e);d=x(e);v=O(e,d);if(!H()&&v){c.debug("theme: load theme from startup service via window",null,"sap.ushell_abap.bootstrap")}if(F(t)&&!l.get("sap-ushell-config.ushell.spaces.enabled")){n.requestPageSet(e)}var s=a.requestFullTM(e);i.navTargetDataPromise=s;r.compactTMPromise=s;l.set("sap-ushell-config.services.FlpLaunchPage.adapter.config.compactTMPromise",s);return Promise.resolve(e)},function(e){c.error("start_up request failed: "+e,null,"sap.ushell_abap.bootstrap");return Promise.resolve({})}).then(function(t){q(t);e()})}m.start=U;m.afterBootstrap=N;m._getShellHash=S;m._getFullShellHash=P;m._createWaitForRendererCreatedPromise=Z;m._loadPage=E;return m});
//# sourceMappingURL=boottask.js.map