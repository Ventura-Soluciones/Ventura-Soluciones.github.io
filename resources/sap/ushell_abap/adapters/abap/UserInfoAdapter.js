// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/ODataWrapper","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery","sap/ui/VersionInfo","sap/base/Log","sap/ushell/resources","sap/base/i18n/date/CalendarWeekNumbering"],function(e,t,jQuery,r,a,s,n){"use strict";var i;var o="default";return function(){this._updateODataObjectBasedOnDatatype=function(e,t){if(jQuery.type(e)==="string"){t.value=e.toString();t.dataType="Edm.String"}if(jQuery.type(e)==="boolean"){t.value=e.toString();t.dataType="Edm.Boolean"}return t};this._getThemeList=async function(){let e="/sap/bc/rest/themes";const t=window["sap-ushell-config"]?.startupConfig?.client;if(t){e+="/~client-"+t}const a=e+"/themeroot/v1";e+="/themelist/v1";const s=await r.load();const n=s.version;if(n){e+="/~v=UI5:"+n}e+="?filter-types=STANDARD,SET";const i=await fetch(e);if(!i.ok){throw new Error(`List API failed with status: ${i.status}`)}const o=await i.json();const u=[];const p=[];o.forEach(e=>{if(e?.type==="STANDARD"){e.name=e.label;u.push(e)}else if(e?.type==="SET"){p.push(e)}});return{themes:u,sets:p,themeRoot:a}};this.getThemeList=function(){const e=new jQuery.Deferred;this._getThemeList().then(t=>{e.resolve({options:t.themes,sets:t.sets,themeRoot:t.themeRoot})}).catch(function(r){a.error(r,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");t.read({requestUri:"/sap/opu/odata/UI2/INTEROP/Themes"},t=>{e.resolve({options:t?.results||[]})},t=>{a.error(t.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(t.message)})});return e.promise()};this.getCalendarWeekNumberingList=function(){return[{value:n.Default,title:s.i18n.getText("DefaultWeekNumberingTitle"),description:s.i18n.getText("DefaultWeekNumberingText")},{value:n.ISO_8601,title:s.i18n.getText("ISO_8601WeekNumberingTitle"),description:s.i18n.getText("ISO_8601WeekNumberingText")},{value:n.MiddleEastern,title:s.i18n.getText("MiddleEasternWeekNumberingTitle"),description:s.i18n.getText("MiddleEasternWeekNumberingText")},{value:n.WesternTraditional,title:s.i18n.getText("WesternTraditionalWeekNumberingTitle"),description:s.i18n.getText("WesternTraditionalWeekNumberingText")}]};this.getLanguageList=function(){var e=new jQuery.Deferred,r=encodeURI("/sap/opu/odata/UI2/INTEROP/UserProfilePropertyValues?$filter=id eq 'PREFERRED_LOGON_LANGUAGE'");t.read({requestUri:r},function(t){var r=[{text:s.i18n.getText("userSettings.browserLanguage"),key:o}];var a=t.results.map(function(e){return{text:e.description,key:e.value}}).sort(function(e,t){return e.text.localeCompare(t.text)});r=r.concat(a);e.resolve(r)},function(t){a.error(t.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(t.message)});return e.promise()};this.getUserProfilePropertyValueLists=function(){var e=new jQuery.Deferred;var t;var r={};var s=["NUMBER_FORMAT","TIME_ZONE","TIME_FORMAT","DATE_FORMAT","CALENDAR_WEEK_NUMBERING"];var n=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");n.openBatchQueue();var i;for(var o=0;o<s.length;o++){i=s[o];t=encodeURI("UserProfilePropertyValues?$filter=id eq '"+i+"'&$select=description,value");n.read(t,function(e){r[this]=e.results}.bind(i),function(e){a.error(e.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter")})}n.submitBatchQueue(function(){e.resolve(r)},function(t){a.error(t.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(t.message)});return e.promise()};this._createWrapper=function(t){return e.createODataWrapper(t,false,function(e){})};this.updateUserPreferences=function(e){a.debug("[000] updateUserPreferences","UserInfoAdapter");var t=this,r,s,n,u,p,l=function(){u-=1;if(u===0){r.resolve()}},d=function(e,t){r.reject(e,t)};a.debug("[000] updateUserPreferences: _createWrapper","UserInfoAdapter");i=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");r=new jQuery.Deferred;a.debug("[000] updateUserPreferences: oDataWrapper.openBatchQueue","UserInfoAdapter");i.openBatchQueue();n=e.getChangedProperties()||[];a.debug("[000] updateUserPreferences: getChangedProperties","UserInfoAdapter");u=n.length;n.forEach(function(e){var r=e.name,n=e.newValue;if(r.toUpperCase()==="LANGUAGE"){r="PREFERRED_LOGON_LANGUAGE";n=n===o?undefined:n}s="UserProfileProperties("+["id='"+r+"'","shellType='FLP')"].join(",");p={id:r,shellType:"FLP",value:n};t._updateODataObjectBasedOnDatatype(n,p);a.debug("[000] updateUserPreferences: oDataWrapper: put","UserInfoAdapter");i.put(s,p,l,d)});a.debug("[000] updateUserPreferences: submitBatchQueue","UserInfoAdapter");i.submitBatchQueue(function(){if(u===0){r.resolve()}},d);return r.promise()}}});
//# sourceMappingURL=UserInfoAdapter.js.map