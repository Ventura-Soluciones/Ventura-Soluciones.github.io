/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/Button","sap/m/NavContainer","sap/m/Page","sap/ui/core/Element","sap/ui/core/EventBus","./BaseSettingsDialog","./changeHandler/LayoutHandler","./flexibility/Layout.flexibility"],function(t,e,n,s,i,a,o,r){"use strict";function c(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const h=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function l(t,e,n){if(!t.s){if(n instanceof g){if(n.s){if(e&1){e=n.s}n=n.v}else{n.o=l.bind(null,t,e);return}}if(n&&n.then){n.then(l.bind(null,t,e),l.bind(null,t,2));return}t.s=e;t.v=n;const s=t.o;if(s){s(t)}}}const g=function(){function t(){}t.prototype.then=function(e,n){const s=new t;const i=this.s;if(i){const t=i&1?e:n;if(t){try{l(s,1,t(this.v))}catch(t){l(s,2,t)}return s}else{return this}}this.o=function(t){try{const i=t.v;if(t.s&1){l(s,1,e?e(i):i)}else if(n){l(s,1,n(i))}else{l(s,2,i)}}catch(t){l(s,2,t)}};return s};return t}();function u(t){return t instanceof g&&t.s&1}function f(t,e,n){var s=-1,i,a;function o(r){try{while(++s<t.length&&(!n||!n())){r=e(s);if(r&&r.then){if(u(r)){r=r.v}else{r.then(o,a||(a=l.bind(null,i=new g,2)));return}}}if(i){l(i,1,r)}else{i=r}}catch(t){l(i||(i=new g),2,t)}}o();return i}const d=c(a);function p(t,e,n){if(typeof t[h]==="function"){var s=t[h](),i,a,o;function p(t){try{while(!(i=s.next()).done&&(!n||!n())){t=e(i.value);if(t&&t.then){if(u(t)){t=t.v}else{t.then(p,o||(o=l.bind(null,a=new g,2)));return}}}if(a){l(a,1,t)}else{a=t}}catch(t){l(a||(a=new g),2,t)}}p();if(s.return){var r=function(t){try{if(!i.done){s.return()}}catch(t){}return t};if(a&&a.then){return a.then(r,function(t){throw r(t)})}r()}return a}if(!("length"in t)){throw new TypeError("Object is not iterable")}var c=[];for(var d=0;d<t.length;d++){c.push(t[d])}return f(c,function(t){return e(c[t])},n)}const v=c(o);const y=r["CHANGE_TYPES"];const C=d.extend("sap.cux.home.KeyUserSettingsDialog",{metadata:{designtime:"not-adaptable-tree"},renderer:{apiVersion:2},init:function n(){d.prototype.init.call(this);this.controlMap=new Map;this.detailPageMap=new Map;this.setContentWidth("23.636rem");this.setContentHeight("23.33rem");this.setStretch(false);this.setShowHeader(false);this.addButton(new t(`${this.getId()}-dialog-save-btn`,{text:this._i18nBundle.getText("saveButton"),type:"Emphasized",press:this.saveChanges.bind(this)}));this.addButton(new t(`${this.getId()}-dialog-close-btn`,{text:this._i18nBundle.getText("closeSettings"),type:"Transparent",press:this.handleCancel.bind(this)}));const s=`${this.getId()}-navContainer`;const a=new e(s);this.controlMap.set(s,a);this.addContent(this.controlMap.get(s));this._eventBus=i.getInstance();this._eventBus.subscribe("KeyUserChanges","disabledSaveBtn",(t,e,n)=>{this.getButtons()[0].setEnabled(!n?.disable)},this)},onBeforeRendering:function t(e){d.prototype.onBeforeRendering.call(this,e);const n=this.getNavContainer();n.removeAllPages();this.getPanels().forEach((t,e)=>{n.addPage(this.getPage(t,!e))});if(n.getPages()?.length){this.navigateToPage(n.getPages()[0])}},getPage:function t(e,i){const a=`${this.getId()}-${e.getId()}-page`;let o=this.controlMap.get(a);if(!o){const t=this.getNavContainer();o=new n(a,{title:e.getProperty("title"),showHeader:true,content:e.getAggregation("content"),backgroundDesign:"Transparent",showNavButton:i?false:true,navButtonPress:()=>t.back()});this.controlMap.set(a,o);const r=e.getAssociation("panel",null);const c=s.getElementById(r);const h=c?.getParent()?.getId();if(h){this.detailPageMap.set(h,o)}}return o},navigateToPage:function t(e){const n=e?.getId();const s=n?.substring(0,n.lastIndexOf("-page"));const i=this.getPanels().find(t=>s?.includes(t.getId()));i?.firePanelNavigated();const a=`${this.getId()}-navContainer`;const o=this.controlMap.get(a);if(e){o.to(e)}},getDetailsPage:function t(e){return this.detailPageMap.get(e)},hasDetailsPage:function t(e){return this.detailPageMap.has(e)},getNavContainer:function t(){const e=`${this.getId()}-navContainer`;return this.controlMap.get(e)},saveChanges:function t(){try{const t=this;return Promise.resolve(t.isValidChanges()).then(function(e){if(e){const e=t.getPanels();e.forEach(e=>{const n=e.getKeyUserChanges();if(n.length){t.createAndAddChanges(n);e.clearKeyUserChanges()}});e[1]?.onSaveClearChanges();t.close();v.resolve();v.clearChanges()}})}catch(t){return Promise.reject(t)}},isValidChanges:function t(){try{const t=this;let e=true;const n=t.getPanels()[1];const s=n.getKeyUserChanges();const i=p(s,function(t){const s=function(){if(t.changeSpecificData.changeType===y.NEWS_FEED_URL){return Promise.resolve(n.isNewsChangesValid()).then(function(t){e=t})}}();if(s&&s.then)return s.then(function(){})});return Promise.resolve(i&&i.then?i.then(function(){return e}):e)}catch(t){return Promise.reject(t)}},createAndAddChanges:function t(e){const n=[];e.forEach(t=>{n.push(t)});v.addChanges(n)},handleCancel:function t(){const e=this.getPanels();e.forEach(t=>{const e=t.getKeyUserChanges();if(e.length){t.clearKeyUserChanges()}});const n=this.getPanels()[1];n.onCancelClearKeyUserChanges();this.close()}});return C});
//# sourceMappingURL=KeyUserSettingsDialog.js.map