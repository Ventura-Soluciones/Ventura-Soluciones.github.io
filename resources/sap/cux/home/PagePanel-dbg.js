/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/Button","sap/m/FlexBox","sap/m/GenericTile","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/VBox","sap/m/library","sap/ui/core/EventBus","./BasePagePanel","./MenuItem","./Page","./utils/Constants","./utils/DataFormatUtils","./utils/Device","./utils/DragDropUtils","./utils/FESRUtil","./utils/PageManager","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,n,a,s,o,i,r,l,g,d,c,h,p,u,P,m,f,I,x){"use strict";function v(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const y=r["LoadState"];const _=v(g);const C=v(d);const B=v(c);const F=h["PAGE_SELECTION_LIMIT"];const T=h["SETTINGS_PANELS_KEYS"];const W=p["recycleId"];const M=u["DeviceType"];const b=P["attachKeyboardHandler"];const S=P["focusDraggedItem"];const D=m["addFESRId"];const E=m["addFESRSemanticStepName"];const w=v(f);const A=v(I);const N=v(x);const z={Mobile:{maxWidth:37.5,minWidth:8},Tablet:{maxWidth:37.5,minWidth:10.625},Desktop:{maxWidth:18.75,minWidth:7},LargeDesktop:{maxWidth:18.75,minWidth:7},smallTabletMinWidth:8};const L=3;const O=8;const R=4;const $=t.extend("sap.cux.home.CustomFlexBox",{renderer:{apiVersion:2},metadata:{library:"sap.cux.home",aggregations:{items:{type:"sap.ui.core.Control",multiple:true,singularName:"item",dnd:{draggable:true,droppable:true}}}},constructor:function e(n,a){t.prototype.constructor.call(this,n,a)}});const j=_.extend("sap.cux.home.PagePanel",{metadata:{library:"sap.cux.home",properties:{title:{type:"string",group:"Misc",visibility:"hidden"},key:{type:"string",group:"Misc",visibility:"hidden"}},aggregations:{pages:{type:"sap.cux.home.Page",singularName:"page",multiple:true,visibility:"hidden"}}},constructor:function e(t,n){_.prototype.constructor.call(this,t,n)},init:function e(){const t=this;_.prototype.init.call(this);this._oWrapperFlexBox=new $(`${this.getId()}-pageWrapper`,{justifyContent:"Start",height:"100%",width:"100%",direction:"Row",renderType:"Bare",wrap:"Wrap",items:this.getPlaceholderPageTiles()}).addStyleClass("pagesFlexGap sapUiSmallMarginTop sapCuxPagesWrapper");this.addDragDropConfigTo(this._oWrapperFlexBox,e=>void this._handlePageDnd(e),function(e){try{return Promise.resolve(b(e,true)).then(function(){})}catch(e){return Promise.reject(e)}});this._addContent(this._oWrapperFlexBox);this.setProperty("title",this._i18nBundle.getText("pageTitle"));const n=new C(`${this.getId()}-managePages`,{title:this._i18nBundle.getText("mngPage"),icon:"sap-icon://edit",press:()=>this._handleEditPages()});this.addAggregation("menuItems",n);D(n,"managePages");this.oEventBus=l.getInstance();this.oEventBus.subscribe("importChannel","favPagesImport",function(e,n,a){try{t.aFavPages=a;return Promise.resolve(t.writeFavPagesIntoPers(t.aFavPages)).then(function(){t._getInnerControls();t._importdone()})}catch(e){return Promise.reject(e)}},this);this.oEventBus.subscribe("pageChannel","pageUpdated",()=>{void this.getData(true)},this)},_importdone:function e(){const t={status:true};this.oEventBus.publish("importChannel","favPagesImported",t)},getData:function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const n=this;function a(){n.fireEvent("loaded");return n.oPagePromise}const s=function(){if(n.oPagePromise===undefined||n.oPagePromise===null||t){n.oPagePromise=n._getPageManagerInstance().getFavoritePages();return Promise.resolve(n.oPagePromise).then(function(e){n.aFavPages=e;n._getInnerControls();n.oPagePromise=null})}}();return Promise.resolve(s&&s.then?s.then(a):a(s))}catch(o){return Promise.reject(o)}},_handleEditPages:function e(){const t=this.getParent();t?._getLayout().openSettingsDialog(T.PAGES)},getPlaceholderPageTiles:function e(){const t=new Array(F).fill(y.Loading);const a=t.map((e,t)=>new n(`${this.getId()}--${t}`,{sizeBehavior:"Responsive",state:e,frameType:"OneByOne",mode:"IconMode",visible:true,renderOnThemeChange:true,ariaRole:"listitem",dropAreaOffset:8}).addStyleClass("cuxPagesPlaceholder"));return a},attachResizeHandler:function e(t,n,a,s){try{const e=this.aFavPages?.length,o=this.getDeviceType(),i=a.getDomRef();let r=t?i.clientWidth:n;if(!r){return}let l,g,d,c=r/16;const h=1;s.setAlignItems("Start");if(e>0){const s=this.calculatePagesPerRow(e,t);if(s){const e=z[o].maxWidth;let t=z[o].minWidth;if(o===M.Tablet&&n<736){t=z.smallTabletMinWidth}l=(c-(s-1)*h)/s;l=Math.min(l,e);l=Math.max(l,t);d=`${l}rem`;g=`${s*l+(s-1)*h}rem`}else{d="auto";g="100%"}this._setPropertyValues({hBoxWidth:g,pagesTileWidth:d});a.setWidth(g);return}return}catch(e){if(e instanceof Error){}}},getUserAvailablePages:function e(){try{const e=this;return Promise.resolve(e._getPageManagerInstance().fetchAllAvailablePages())}catch(e){return Promise.reject(e)}},calculatePagesPerRow:function e(t,n){let a=0;const s=this.getDeviceType();if(s===M.Desktop||s===M.LargeDesktop){if(n){a=Math.ceil(t>=O?R:t/2)}else{a=t>R?Math.ceil(t/2):R}}else if(s===M.Mobile){a=t<=L?1:2}else if(s===M.Tablet){a=t<=R?t:Math.ceil(t/2)}return a},_getInnerControls:function e(){const t=[];this.oInnerControls=[];const a=this.getParent();if(this.aFavPages){this.aFavPages.forEach((e,n)=>{t.push(new B(W(`${this.getId()}-favPage-${n}`),{title:e.title,subTitle:e.title===e.spaceTitle?"":e.spaceTitle,icon:e.icon,bgColor:e.BGColor,pageId:e.pageId,spaceId:e.spaceId,spaceTitle:e.spaceTitle,url:"#Launchpad-openFLPPage?pageId="+e.pageId+"&spaceId="+e.spaceId}))});t.forEach((e,t)=>{this.oInnerControls.push(new n(W(`${e.getId()}--genericTile--${t}`),{header:e.getTitle(),subheader:e.getSubTitle(),press:()=>void e.onPageTilePress(e),sizeBehavior:"Responsive",state:"Loaded",frameType:"OneByOne",mode:"IconMode",backgroundColor:e.getBgColor(),tileIcon:e.getIcon(),visible:true,renderOnThemeChange:true,ariaRole:"listitem",dropAreaOffset:8,url:e.getProperty("url")}).addStyleClass("sapCuxPageTile"));this.addAggregation("pages",e,true)});this._oWrapperFlexBox.setAlignItems(this.aFavPages.length==1?"Start":"Center");if(this.aFavPages.length){a?.panelLoadedFn("Page",{loaded:true,count:this.aFavPages.length});this._setFavPagesContent()}else{a?.panelLoadedFn("Page",{loaded:true,count:0});this._setNoPageContent()}}else{a?.panelLoadedFn("Page",{loaded:false,count:0});this.removeAggregation("content",this._oWrapperFlexBox)}},_setFavPagesContent:function e(){this._oWrapperFlexBox.removeAllItems();this._oWrapperFlexBox.removeStyleClass("pagesFlexBox");this.oInnerControls.forEach(e=>{this._oWrapperFlexBox.addItem(e)})},_createNoPageContent:function t(){if(!this._oIllusMsg){this._oIllusMsg=new a(this.getId()+"--idNoPages",{illustrationSize:s.Small,illustrationType:o.NoSavedItems,title:this._i18nBundle.getText("noDataPageTitle"),description:this._i18nBundle.getText("noPageDescription")}).addStyleClass("myHomeIllustratedMsg myHomeIllustratedMessageAlign");this.oAddPageBtn=new e(this.getId()+"--idAddPageBtn",{text:this._i18nBundle.getText("addPage"),tooltip:this._i18nBundle.getText("addPage"),type:"Emphasized",press:()=>this._handleEditPages()});E(this.oAddPageBtn,"press","addPages")}},_setNoPageContent:function e(){if(!this.oWrapperNoPageVBox){this.oWrapperNoPageVBox=new i(`${this.getId()}--wrapperNoPageVBox`,{width:"100%",height:"17rem",backgroundDesign:"Solid",justifyContent:"Center"}).addStyleClass("sapUiRoundedBorder noCardsBorder");this._createNoPageContent();this._oIllusMsg.addAdditionalContent(this.oAddPageBtn);this._oWrapperFlexBox.removeAllItems();this._oWrapperFlexBox.addStyleClass("pagesFlexBox");this.oWrapperNoPageVBox.addItem(this._oIllusMsg);this._oWrapperFlexBox.addItem(this.oWrapperNoPageVBox)}},_setPropertyValues:function e(t){const n=Object.keys(t);n.forEach(e=>{if(e==="hBoxWidth"){this._oWrapperFlexBox.setProperty("width",t[e])}else if(e==="pagesTileWidth"&&this.oInnerControls.length){this.oInnerControls.forEach(function(n){n.setProperty("width",t[e])})}})},_handlePageDnd:function e(t){try{const e=this;const n=t.getParameter?.("dropPosition"),a=t?.getParameter?.("draggedControl"),s=t.getParameter("droppedControl"),o=a.getParent()?.indexOfItem(a);let i=a.getParent()?.indexOfItem(s);if(n==="Before"&&o===i-1){i--}else if(n==="After"&&o===i+1){i++}const r=function(){if(o!==i){return Promise.resolve(e._DragnDropPages(o,i,n)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_DragnDropPages:function e(t,n,a){try{const e=this;if(a==="Before"&&t<n){n--}else if(a==="After"&&t>n){n++}const s=e.aFavPages.splice(t,1)[0];e.aFavPages.splice(n,0,s);e._getInnerControls();return Promise.resolve(e.writeFavPagesIntoPers(e.aFavPages)).then(function(){S(e._oWrapperFlexBox,n)})}catch(e){return Promise.reject(e)}},writeFavPagesIntoPers:function e(t){try{const n=this;function a(){return Promise.resolve(n.oPersonalizer.read()).then(function(e){if(!e)e={favouritePages:[]};e.favouritePages=t;return Promise.resolve(n.oPersonalizer.write(e)).then(function(){})})}const s=function(){if(n.oPersonalizer===undefined){return Promise.resolve(N.getInstance(n.persContainerId,A.getOwnerComponent(n))).then(function(e){n.oPersonalizer=e})}}();return Promise.resolve(s&&s.then?s.then(a):a(s))}catch(o){return Promise.reject(o)}},applyColorPersonalizations:function e(t){void this._getPageManagerInstance()?.applyColorPersonalizations(t)},applyIconPersonalizations:function e(t){void this._getPageManagerInstance()?.applyIconPersonalizations(t)},_getPageManagerInstance:function e(){if(!this.pageManagerInstance){const e=this.getParent();const t=e?.getParent();this.persContainerId=t?.getProperty("persContainerId")||A.getPersContainerId(this);this.pageManagerInstance=w.getInstance(this.persContainerId,A.getOwnerComponent(this))}return this.pageManagerInstance}});return j});
//# sourceMappingURL=PagePanel-dbg.js.map