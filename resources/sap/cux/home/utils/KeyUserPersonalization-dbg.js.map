{"version":3,"file":"KeyUserPersonalization-dbg.js","names":["sap","ui","define","Log","BaseObject","Lib","HashChanger","FeaturesAPI","startKeyUserAdaptation","Container","EventHub","_catch","body","recover","result","e","then","KeyUserPersonalization","constructor","component","i18nBundle","super","this","on","do","adaptationCustomData","byId","getAggregation","adaptationData","getValue","JSON","parse","setValue","getRTAUserAction","_this","Promise","resolve","load","name","isKeyUser","rtaUserActionProperties","id","getId","icon","text","getText","tooltip","press","triggerRTA","error","Error","message","reject","_this2","_temp","rootControl","catch","getServiceAsync","URLParsingService","hashChangerInstance","getInstance","shellHash","parseShellHash","getHash","hashParams","params","rtaKey","value","Object","prototype","hasOwnProperty","call","replaceHash","constructShellHash","window","location","reload"],"sources":["KeyUserPersonalization.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport Log from \"sap/base/Log\";\nimport BaseObject from \"sap/ui/base/Object\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport Lib from \"sap/ui/core/Lib\";\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\nimport UIComponent from \"sap/ui/core/UIComponent\";\nimport FeaturesAPI from \"sap/ui/fl/write/api/FeaturesAPI\";\nimport startKeyUserAdaptation from \"sap/ui/rta/api/startKeyUserAdaptation\";\nimport Container from \"sap/ushell/Container\";\nimport EventHub from \"sap/ushell/EventHub\";\nimport URLParsing from \"sap/ushell/services/URLParsing\";\nimport { UserActionProperties } from \"../Layout\";\n\nexport default class KeyUserPersonalization extends BaseObject {\n\tprivate component!: UIComponent | undefined;\n\tprivate i18nBundle!: ResourceBundle;\n\tprivate adaptationData!: object | string;\n\n\tconstructor(component: UIComponent | undefined, i18nBundle: ResourceBundle) {\n\t\tsuper();\n\n\t\tthis.component = component;\n\t\tthis.i18nBundle = i18nBundle;\n\n\t\tEventHub.on(\"keyUserAdaptationDataChange\").do(() => {\n\t\t\tconst adaptationCustomData = this.component?.byId(\"sectionWrapper\")?.getAggregation(\"adaptationData\") as CustomData;\n\t\t\tif (adaptationCustomData) {\n\t\t\t\tthis.adaptationData = adaptationCustomData.getValue() as object | string;\n\n\t\t\t\t// parse adaptation data if string\n\t\t\t\tif (typeof this.adaptationData === \"string\") {\n\t\t\t\t\tthis.adaptationData = JSON.parse(this.adaptationData) as object;\n\t\t\t\t\tadaptationCustomData.setValue(this.adaptationData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic async getRTAUserAction(): Promise<UserActionProperties | undefined> {\n\t\ttry {\n\t\t\tawait Lib.load({ name: \"sap.ui.fl\" });\n\t\t\tconst isKeyUser = await FeaturesAPI.isKeyUser();\n\t\t\tlet rtaUserActionProperties: UserActionProperties | undefined;\n\n\t\t\tif (isKeyUser) {\n\t\t\t\trtaUserActionProperties = {\n\t\t\t\t\tid: `${this.component?.getId()}-s4MyHomeAdaptUIBtn`,\n\t\t\t\t\ticon: \"sap-icon://wrench\",\n\t\t\t\t\ttext: this.i18nBundle.getText(\"adaptUIBtn\") as string,\n\t\t\t\t\ttooltip: this.i18nBundle.getText(\"adaptUIBtn\") as string,\n\t\t\t\t\tpress: () => this.triggerRTA()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn Promise.resolve(rtaUserActionProperties);\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(error instanceof Error ? error.message : (error as string));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate async triggerRTA() {\n\t\ttry {\n\t\t\tawait Lib.load({ name: \"sap.ui.fl\" });\n\t\t\tif (this.component) {\n\t\t\t\tstartKeyUserAdaptation({ rootControl: this.component }).catch(async () => {\n\t\t\t\t\tconst URLParsingService = await Container.getServiceAsync<URLParsing>(\"URLParsing\");\n\t\t\t\t\tconst hashChangerInstance = HashChanger.getInstance();\n\t\t\t\t\t//Trigger Manual Reload of Application in case of failure\n\t\t\t\t\tconst shellHash = URLParsingService.parseShellHash(hashChangerInstance.getHash());\n\t\t\t\t\tconst hashParams = (shellHash?.params || {}) as Record<string, unknown>;\n\t\t\t\t\tconst rtaKey = \"sap-ui-fl-max-layer\";\n\t\t\t\t\tconst value = \"CUSTOMER\";\n\n\t\t\t\t\tif (!Object.prototype.hasOwnProperty.call(hashParams, rtaKey)) {\n\t\t\t\t\t\thashParams[rtaKey] = value;\n\t\t\t\t\t\thashChangerInstance.replaceHash(URLParsingService.constructShellHash(shellHash), \"Unknown\");\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(error instanceof Error ? error.message : (error as string));\n\t\t\treturn;\n\t\t}\n\t}\n}\n"],"mappings":";;;;AAAAA,IAAAC,GAAAC,OAAA,0NAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GAAA,aAkjBO,SAAAC,EAAgBC,EAAMC,GAC5B,IACC,IAAIC,EAASF,GACd,CAAE,MAAMG,GACP,OAAOF,EAAQE,EAChB,CACA,GAAID,GAAUA,EAAOE,KAAM,CAC1B,OAAOF,EAAOE,UAAU,EAAGH,EAC5B,CACA,OAAOC,CACR,CAziBe,MAAMG,UAA+Bb,EAKnDc,YAAYC,EAAoCC,GAC/CC,QAEAC,KAAKH,UAAYA,EACjBG,KAAKF,WAAaA,EAElBV,EAASa,GAAG,+BAA+BC,GAAG,KAC7C,MAAMC,EAAuBH,KAAKH,WAAWO,KAAK,mBAAmBC,eAAe,kBACpF,GAAIF,EAAsB,CACzBH,KAAKM,eAAiBH,EAAqBI,WAG3C,UAAWP,KAAKM,iBAAmB,SAAU,CAC5CN,KAAKM,eAAiBE,KAAKC,MAAMT,KAAKM,gBACtCH,EAAqBO,SAASV,KAAKM,eACpC,CACD,GAEF,CAEaK,mBAAgB,IAA8C,MAAAC,EAQhEZ,KAAI,OAAAa,QAAAC,QAAAzB,EAAA,WAPV,OAAAwB,QAAAC,QACG/B,EAAIgC,KAAK,CAAEC,KAAM,eAActB,KAAA,kBAAAmB,QAAAC,QACb7B,EAAYgC,aAAWvB,KAAA,SAAzCuB,GACN,IAAIC,EAEJ,GAAID,EAAW,CACdC,EAA0B,CACzBC,GAAI,GAAGP,EAAKf,WAAWuB,6BACvBC,KAAM,oBACNC,KAAMV,EAAKd,WAAWyB,QAAQ,cAC9BC,QAASZ,EAAKd,WAAWyB,QAAQ,cACjCE,MAAOA,IAAMb,EAAKc,aAEpB,CAEA,OAAOb,QAAQC,QAAQI,EAAyB,IACjD,EAAC,SAAQS,GACR9C,EAAI8C,MAAMA,aAAiBC,MAAQD,EAAME,QAAWF,EAErD,GACD,CAAC,MAAAlC,GAAA,OAAAoB,QAAAiB,OAAArC,EAAA,EAEaiC,aAAU,IAAG,MAAAK,EAGrB/B,KAAI,MAAAgC,EAAA3C,EAAA,WAFL,OAAAwB,QAAAC,QACG/B,EAAIgC,KAAK,CAAEC,KAAM,eAActB,KAAA,cACjCqC,EAAKlC,UAAS,CACjBX,EAAuB,CAAE+C,YAAaF,EAAKlC,YAAaqC,MAAK,eAAa,OAAArB,QAAAC,QACzC3B,EAAUgD,gBAA4B,eAAazC,KAAA,SAA7E0C,GACN,MAAMC,EAAsBrD,EAAYsD,cAExC,MAAMC,EAAYH,EAAkBI,eAAeH,EAAoBI,WACvE,MAAMC,EAAcH,GAAWI,QAAU,CAAC,EAC1C,MAAMC,EAAS,sBACf,MAAMC,EAAQ,WAEd,IAAKC,OAAOC,UAAUC,eAAeC,KAAKP,EAAYE,GAAS,CAC9DF,EAAWE,GAAUC,EACrBR,EAAoBa,YAAYd,EAAkBe,mBAAmBZ,GAAY,UAClF,CAEAa,OAAOC,SAASC,QAAS,EAC1B,CAAC,MAAA7D,GAAA,OAAAoB,QAAAiB,OAAArC,EAAA,GAAE,GAEL,EAAC,SAAQkC,GACR9C,EAAI8C,MAAMA,aAAiBC,MAAQD,EAAME,QAAWF,EAErD,GAAC,OAAAd,QAAAC,QAAAkB,KAAAtC,KAAAsC,EAAAtC,KAAA,qBACF,CAAC,MAAAD,GAAA,OAAAoB,QAAAiB,OAAArC,EAAA,GACD,OAAAE,CAAA","ignoreList":[]}