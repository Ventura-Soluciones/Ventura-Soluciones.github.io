{"version":3,"file":"KeyUserPersonalization-dbg-dbg.js","names":["sap","ui","define","Log","BaseObject","Lib","HashChanger","FeaturesAPI","startKeyUserAdaptation","Container","EventHub","_catch","body","recover","result","e","then","KeyUserPersonalization","constructor","component","i18nBundle","on","do","adaptationCustomData","byId","getAggregation","adaptationData","getValue","JSON","parse","setValue","getRTAUserAction","_this","Promise","resolve","load","name","isKeyUser","rtaUserActionProperties","id","getId","icon","text","getText","tooltip","press","triggerRTA","error","Error","message","reject","_this2","_temp","rootControl","catch","getServiceAsync","URLParsingService","hashChangerInstance","getInstance","shellHash","parseShellHash","getHash","hashParams","params","rtaKey","value","Object","prototype","hasOwnProperty","call","replaceHash","constructShellHash","window","location","reload"],"sources":["KeyUserPersonalization.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport Log from \"sap/base/Log\";\nimport BaseObject from \"sap/ui/base/Object\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport Lib from \"sap/ui/core/Lib\";\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\nimport UIComponent from \"sap/ui/core/UIComponent\";\nimport FeaturesAPI from \"sap/ui/fl/write/api/FeaturesAPI\";\nimport startKeyUserAdaptation from \"sap/ui/rta/api/startKeyUserAdaptation\";\nimport Container from \"sap/ushell/Container\";\nimport EventHub from \"sap/ushell/EventHub\";\nimport URLParsing from \"sap/ushell/services/URLParsing\";\nimport { UserActionProperties } from \"../Layout\";\n\nexport default class KeyUserPersonalization extends BaseObject {\n\tprivate component!: UIComponent | undefined;\n\tprivate i18nBundle!: ResourceBundle;\n\tprivate adaptationData!: object | string;\n\n\tconstructor(component: UIComponent | undefined, i18nBundle: ResourceBundle) {\n\t\tsuper();\n\n\t\tthis.component = component;\n\t\tthis.i18nBundle = i18nBundle;\n\n\t\tEventHub.on(\"keyUserAdaptationDataChange\").do(() => {\n\t\t\tconst adaptationCustomData = this.component?.byId(\"sectionWrapper\")?.getAggregation(\"adaptationData\") as CustomData;\n\t\t\tif (adaptationCustomData) {\n\t\t\t\tthis.adaptationData = adaptationCustomData.getValue() as object | string;\n\n\t\t\t\t// parse adaptation data if string\n\t\t\t\tif (typeof this.adaptationData === \"string\") {\n\t\t\t\t\tthis.adaptationData = JSON.parse(this.adaptationData) as object;\n\t\t\t\t\tadaptationCustomData.setValue(this.adaptationData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic async getRTAUserAction(): Promise<UserActionProperties | undefined> {\n\t\ttry {\n\t\t\tawait Lib.load({ name: \"sap.ui.fl\" });\n\t\t\tconst isKeyUser = await FeaturesAPI.isKeyUser();\n\t\t\tlet rtaUserActionProperties: UserActionProperties | undefined;\n\n\t\t\tif (isKeyUser) {\n\t\t\t\trtaUserActionProperties = {\n\t\t\t\t\tid: `${this.component?.getId()}-s4MyHomeAdaptUIBtn`,\n\t\t\t\t\ticon: \"sap-icon://wrench\",\n\t\t\t\t\ttext: this.i18nBundle.getText(\"adaptUIBtn\") as string,\n\t\t\t\t\ttooltip: this.i18nBundle.getText(\"adaptUIBtn\") as string,\n\t\t\t\t\tpress: () => this.triggerRTA()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn Promise.resolve(rtaUserActionProperties);\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(error instanceof Error ? error.message : (error as string));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate async triggerRTA() {\n\t\ttry {\n\t\t\tawait Lib.load({ name: \"sap.ui.fl\" });\n\t\t\tif (this.component) {\n\t\t\t\tstartKeyUserAdaptation({ rootControl: this.component }).catch(async () => {\n\t\t\t\t\tconst URLParsingService = await Container.getServiceAsync<URLParsing>(\"URLParsing\");\n\t\t\t\t\tconst hashChangerInstance = HashChanger.getInstance();\n\t\t\t\t\t//Trigger Manual Reload of Application in case of failure\n\t\t\t\t\tconst shellHash = URLParsingService.parseShellHash(hashChangerInstance.getHash());\n\t\t\t\t\tconst hashParams = (shellHash?.params || {}) as Record<string, unknown>;\n\t\t\t\t\tconst rtaKey = \"sap-ui-fl-max-layer\";\n\t\t\t\t\tconst value = \"CUSTOMER\";\n\n\t\t\t\t\tif (!Object.prototype.hasOwnProperty.call(hashParams, rtaKey)) {\n\t\t\t\t\t\thashParams[rtaKey] = value;\n\t\t\t\t\t\thashChangerInstance.replaceHash(URLParsingService.constructShellHash(shellHash), \"Unknown\");\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(error instanceof Error ? error.message : (error as string));\n\t\t\treturn;\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}