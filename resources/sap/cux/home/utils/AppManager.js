/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/i18n/ResourceBundle","sap/ui/VersionInfo","sap/ui/base/Object","sap/ui/model/odata/v2/ODataModel","sap/ushell/Config","sap/ushell/Container","./AnalyticalCardSkeleton","./Constants","./DataFormatUtils","./HttpHelper","./RecommendedCardUtil"],function(e,t,n,r,i,o,s,a,c,u,l,f){"use strict";function d(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const h=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function p(e,t,n){if(!e.s){if(n instanceof m){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=p.bind(null,e,t);return}}if(n&&n.then){n.then(p.bind(null,e,t),p.bind(null,e,2));return}e.s=t;e.v=n;const r=e.o;if(r){r(e)}}}const m=function(){function e(){}e.prototype.then=function(t,n){const r=new e;const i=this.s;if(i){const e=i&1?t:n;if(e){try{p(r,1,e(this.v))}catch(e){p(r,2,e)}return r}else{return this}}this.o=function(e){try{const i=e.v;if(e.s&1){p(r,1,t?t(i):i)}else if(n){p(r,1,n(i))}else{p(r,2,i)}}catch(e){p(r,2,e)}};return r};return e}();function g(e){return e instanceof m&&e.s&1}function v(e,t,n){var r=-1,i,o;function s(a){try{while(++r<e.length&&(!n||!n())){a=t(r);if(a&&a.then){if(g(a)){a=a.v}else{a.then(s,o||(o=p.bind(null,i=new m,2)));return}}}if(i){p(i,1,a)}else{i=a}}catch(e){p(i||(i=new m),2,e)}}s();return i}const P=a["AnalyticalCardSkeleton"];function I(e,t,n){if(typeof e[h]==="function"){var r=e[h](),i,o,s;function l(e){try{while(!(i=r.next()).done&&(!n||!n())){e=t(i.value);if(e&&e.then){if(g(e)){e=e.v}else{e.then(l,s||(s=p.bind(null,o=new m,2)));return}}}if(o){p(o,1,e)}else{o=e}}catch(e){p(o||(o=new m),2,e)}}l();if(r.return){var a=function(e){try{if(!i.done){r.return()}}catch(e){}return e};if(o&&o.then){return o.then(a,function(e){throw a(e)})}a()}return o}if(!("length"in e)){throw new TypeError("Object is not iterable")}var c=[];for(var u=0;u<e.length;u++){c.push(e[u])}return v(c,function(e){return t(c[e])},n)}const S=c["COLUMN_LENGTH"];function _(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const y=c["DEFAULT_BG_COLOR"];const z=c["FALLBACK_ICON"];const b=c["FEATURE_TOGGLES"];const C=c["FEATURE_TOGGLE_SRVC_URL"];const D=c["MYHOME_PAGE_ID"];const M=c["MYHOME_SPACE_ID"];const A=c["MYINSIGHT_SECTION_ID"];const E=c["RECOMMENDATION_SRVC_URL"];const V=c["RECOMMENDED_CARD_LIMIT"];const j=u["createBookMarkData"];const R=u["getLeanURL"];const O=d(l);const U=d(f);const T={MUST_INCLUDE_RECOMMEDED_APPS:["F0862","F1823"]};const L=t=>{let n={};if(t){if(typeof t==="object"){n=t}else{try{n=JSON.parse(t)}catch(t){e.error(t instanceof Error?t.message:String(t));n=undefined}}}return n};const w=e=>{let t={};if(e?._instantiationData?.chip?.configuration){const n=L(e._instantiationData.chip.configuration);if(n?.tileConfiguration){const e=L(n.tileConfiguration);if(e){t=L(e.TILE_PROPERTIES)}}}return t};const x=e=>{let t="";let n={};if(e?.target?.semanticObject&&e?.target?.action){t=`#${e.target.semanticObject}-${e.target.action}`}else if(e?._instantiationData?.chip?.configuration){n=w(e);if(n?.semanticObject&&n?.semanticAction){t=`#${n?.semanticObject}-${n?.semanticAction}`}}return t};const F=e=>{let t=x(e)||"";const n=w(e);if(n?.evaluationId){t+="?EvaluationId="+n.evaluationId}return t};const B=e=>e.vizType?.startsWith("X-SAP-UI2-CHIP:SSB");const N=(e,t)=>{const n=t?._instantiationData?.chip?.bags?.sb_tileProperties?.texts;return{title:e.title?e.title:n?.title||"",subtitle:e.subtitle?e.subtitle:n?.description||""}};const k=e=>{e.forEach(t=>{e.filter(e=>e.appId===t.appId&&e?.visualization?.id!==t?.visualization?.id&&e.persConfig?.sectionIndex===t.persConfig?.sectionIndex).forEach(e=>{e?.persConfig?.duplicateApps?.push(t)})});return e};const G=e=>e?.target?.parameters?.["sap-ui-tech-hint"]?.value?.value==="GUI";const H=e=>e.fioriId&&T.MUST_INCLUDE_RECOMMEDED_APPS.includes(e.fioriId);const q=(e,t)=>!t.some(t=>t.visualization?.target?.semanticObject===e.visualization?.target?.semanticObject&&t.visualization?.target?.action===e.visualization?.target?.action);class Q extends r{aRequestQueue=[];bInsightsSectionPresent=false;vizDataModified=false;_oVizCacheData={};_favPageVisualizations=[];componentData={};fioriAppData={};constructor(){super();this.recommendedUtilInstance=U.getInstance()}static getInstance(){if(!Q.Instance){Q.Instance=new Q}return Q.Instance}_fetchRequestFromQueue(e){try{const t=this;return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(n){let r;t.aRequestQueue=t.aRequestQueue||[];const i=t.aRequestQueue.find(e=>e.pageId===D);if(!i||e===true||t.vizDataModified===true){t.vizDataModified=false;r=n.getPage(D);if(i){i.pageLoadPromise=r}else{t.aRequestQueue.push({pageId:D,pageLoadPromise:r})}}else{r=i.pageLoadPromise}return r})}catch(e){return Promise.reject(e)}}_fetchDynamicVizs(e){return this.fetchFavVizs(e,true).then(e=>e.filter(e=>e.isCount||e.isSmartBusinessTile))}_getSections(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const t=this;return Promise.resolve(t._fetchRequestFromQueue(e)).then(function(e){const n=e&&e.sections||[],r=n.findIndex(e=>e.default);if(r>0){function i(){return t._getSections(true)}const o=function(){if(t._oMoveAppsPromise!==undefined){t._oMoveAppsPromise=t.moveSection(r,0);return Promise.resolve(t._oMoveAppsPromise).then(function(){})}}();return o&&o.then?o.then(i):i(o)}else{return n}})}catch(e){return Promise.reject(e)}}_fetchMyHomeVizs(e){try{const t=this;const n=[];t._oVizCacheData=t._oVizCacheData||{};return Promise.resolve(t._getSections(e)).then(function(e){return Promise.resolve(s.getServiceAsync("VisualizationInstantiation")).then(function(r){e.forEach((e,i)=>{e?.visualizations?.forEach((o,s)=>{const a=o.vizConfig,c=a?.["sap.app"]||{title:"?"},u={};u.oldAppId=x(a?.["sap.flp"]);u.appId=o?.targetURL;u.url=o?.targetURL;if(!u.url&&B(o)){u.url=F(a?.["sap.flp"])}u.leanURL=R(u.url);u.title=o?.title||N(c,o)?.title;u.subtitle=o.subtitle||N(c,o).subtitle;u.BGColor=y().key;u.isFav=true;u.isSection=false;u.icon=a?.["sap.ui"]?.icons?.icon||z;if(o?.indicatorDataSource){u.isCount=true;u.indicatorDataSource=o.indicatorDataSource.path;u.contentProviderId=o.contentProviderId}u.isSmartBusinessTile=B(o);if(u.isSmartBusinessTile){if(!t._oVizCacheData[u.appId]){t._oVizCacheData[u.appId]=r.instantiateVisualization(o);t._oVizCacheData[u.appId].setActive(true)}u.vizInstance=t._oVizCacheData[u.appId]}u.persConfig={pageId:D,sectionTitle:e.title,sectionId:e.id,sectionIndex:i,visualizationIndex:s,isDefaultSection:e.default,isPresetSection:e.preset,duplicateApps:[]};u.visualization=o;u.visualization.title=u.title;u.visualization.subtitle=u.subtitle;n.push(u)})});return n})})}catch(e){return Promise.reject(e)}}_copyDynamicVizs(){try{const e=this;return Promise.resolve(e._fetchDynamicVizs(true)).then(function(t){return Promise.all(t.map(t=>e.addVisualization(t.visualization.vizId,A)))})}catch(e){return Promise.reject(e)}}fetchFavVizs(e,t){try{const n=this;return Promise.resolve(n._fetchMyHomeVizs(e)).then(function(e){const r=e.filter(e=>e.persConfig&&e.persConfig.sectionId!==A&&e.url&&e.title);if(t){return n._filterDuplicateVizs(k(r),false)}else{return n._addGroupInformation(r)}})}catch(e){return Promise.reject(e)}}fetchInsightApps(e,t){try{const n=this;function r(){return Promise.resolve(i())}const i=function(){try{return Promise.resolve(n._fetchMyHomeVizs(e)).then(function(e){return e.filter(e=>e.persConfig?.sectionId===A&&e.url&&e.title)})}catch(e){return Promise.reject(e)}};const s=function(){if(!n.bInsightsSectionPresent){return Promise.resolve(n._getSections(e)).then(function(e){n.insightsSectionIndex=e.findIndex(function(e){return e.id===A});const r=function(){if(n.insightsSectionIndex===-1&&(o.last("/core/shell/enablePersonalization")||o.last("/core/catalog/enabled"))&&n.bInsightsSectionPresent===false){n.bInsightsSectionPresent=true;return Promise.resolve(n.addSection({sectionIndex:e?.length,sectionProperties:{id:A,title:t}})).then(function(){return Promise.resolve(n._copyDynamicVizs()).then(function(){})})}else{n.bInsightsSectionPresent=true}}();if(r&&r.then)return r.then(function(){})})}}();return Promise.resolve(s&&s.then?s.then(r):r(s))}catch(a){return Promise.reject(a)}}addVisualization(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;try{return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(n){return Promise.resolve(n.addVisualization(D,t,e)).then(function(){})})}catch(e){return Promise.reject(e)}}removeVisualizations(e){let{sectionId:t,vizIds:n}=e;try{const e=this;return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(r){const i=I(n,function(n){return Promise.resolve(e._getSections(true)).then(function(e){const i=e.findIndex(e=>e.id===t);const o=i>-1?e[i]:null;const s=o?.visualizations?.findIndex(e=>e.id===n)??-1;const a=function(){if(s>-1){return Promise.resolve(r.deleteVisualization(D,i,s)).then(function(){})}}();if(a&&a.then)return a.then(function(){})})});if(i&&i.then)return i.then(function(){})})}catch(e){return Promise.reject(e)}}updateVisualizations(e){let{pageId:t,sourceSectionIndex:n,sourceVisualizationIndex:r,oVisualizationData:i}=e;try{return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(e){return e.updateVisualization(t,n,r,i)})}catch(e){return Promise.reject(e)}}createInsightSection(e){try{let t=false;const n=this;function r(e){return t?e:Promise.resolve()}const i=function(){if(!n.bInsightsSectionPresent){return Promise.resolve(n._getSections()).then(function(r){const i=r.findIndex(function(e){return e.id===A});if(i===-1&&(o.last("/core/shell/enablePersonalization")||o.last("/core/catalog/enabled"))){const i=n.addSection({sectionIndex:r.length,sectionProperties:{id:A,title:e,visible:true}});t=true;return i}})}}();return Promise.resolve(i&&i.then?i.then(r):r(i))}catch(s){return Promise.reject(s)}}addSection(e){try{const{sectionIndex:t,sectionProperties:n}=e;return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(e){return Promise.resolve(e.addSection(D,t,{...n,visible:true})).then(function(){})})}catch(e){return Promise.reject(e)}}getSectionVisualizations(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{const n=this;return Promise.resolve(n.fetchFavVizs(t)).then(function(t){if(e){return t.find(t=>t.isSection&&t.id===e)?.apps||[]}else{return t.filter(e=>!e.isSection)}})}catch(e){return Promise.reject(e)}}addBookMark(e,t){try{const n=this;return Promise.resolve(s.getServiceAsync("BookmarkV2")).then(function(r){return Promise.resolve(r.getContentNodes()).then(function(i){const o=i.find(e=>e.id===M);const s=o?.children?.find(e=>e.id===D);return Promise.resolve(r.addBookmark(j(e),s)).then(function(){return t?n.moveVisualization(t):Promise.resolve()})})})}catch(e){return Promise.reject(e)}}getVisualization(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;try{const r=this;return Promise.resolve(r.getSectionVisualizations(t,n)).then(function(t){return t.find(t=>t.appId===e)})}catch(e){return Promise.reject(e)}}moveVisualization(e){try{const t=this;return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(n){t.vizDataModified=true;return n.moveVisualization(D,e.sourceSectionIndex,e.sourceVisualizationIndex,e.targetSectionIndex,e.targetVisualizationIndex)})}catch(e){return Promise.reject(e)}}_filterDuplicateVizs(e,t){return e.filter((e,n,r)=>{const i=r.findIndex(t=>t.appId===e.appId);return t?i!==n:i===n})}_addGroupInformation(e){const t=[],n=[];let r;k(e).forEach(e=>{if(e.persConfig?.isDefaultSection){t.push(e)}else{r=n.find(t=>t.isSection&&t.id===e.persConfig?.sectionId);if(!r){n.push({id:e.persConfig?.sectionId,index:e.persConfig?.sectionIndex,title:e.persConfig?.sectionTitle||"",badge:"1",BGColor:y().key,icon:"sap-icon://folder-full",isSection:true,isPresetSection:e.persConfig?.isPresetSection,apps:[e]})}else{r.apps?.push(e);r.badge=r.apps?.length.toString()}}});return[...n,...this._filterDuplicateVizs(t,false)]}moveSection(e,t){try{return Promise.resolve(s.getServiceAsync("Pages").then(function(n){const r=n.getPageIndex(D);return n.moveSection(r,e,t)}))}catch(e){return Promise.reject(e)}}_getFeatureToggles(){try{let e=C+"?$filter=";const t=Object.keys(b);const n=t.map(e=>"ToggleId eq '"+b[e]+"'").join(" or ");e=e+"("+n+")";return Promise.resolve(O.GetJSON(e)).then(function(e){const t=e;if(t?.error){throw new Error(t.error.message)}return t?.value||[]})}catch(e){return Promise.reject(e)}}isFeatureEnabled(t){try{const n=this;return Promise.resolve(_(function(){return Promise.resolve(n._getFeatureToggles()).then(function(e){const n=e.find(e=>e.ToggleId===t);return!n||n.State===""?false:true})},function(t){e.error("Unable to load feature toggles: "+t.message);return false}))}catch(e){return Promise.reject(e)}}isURLParamEnabled(e){const t=new URLSearchParams(window.location.search);return t?.get(e)?.toLowerCase()==="true"||false}_getRecommenedFioriIds(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{let n=false;const r=this;function i(e){return n?e:r.recommendedFioriIds}const o=function(){if(!r.recommendedFioriIds||t){return _(function(){return Promise.resolve(O.GetJSON(E)).then(function(e){const t=e;r.recommendedFioriIds=t?.value?.map(e=>e.app_id)||[]})},function(t){e.error("Unable to load recommendations: "+t.message);const r=Promise.resolve([]);n=true;return r})}}();return Promise.resolve(o&&o.then?o.then(i):i(o))}catch(s){return Promise.reject(s)}}_getCatalogApps(){try{let t=false;const n=this;function r(e){return t?e:Promise.resolve(n.catalogAppData)}const i=function(){if(!n.catalogAppData){return _(function(){return Promise.resolve(s.getServiceAsync("SearchableContent")).then(function(e){n.catalogAppData=e.getApps({includeAppsWithoutVisualizations:false});const r=n.catalogAppData;t=true;return r})},function(r){n.catalogAppData=undefined;e.error(r instanceof Error?"Error while fetching catalog apps:"+r.message:String(r));const i=[];t=true;return i})}}();return Promise.resolve(i&&i.then?i.then(r):r(i))}catch(o){return Promise.reject(o)}}isAddCardToInsightsHidden(e){return e?.component?.settings?.tableSettings?.addCardtoInsightsHidden}_checkValidManifests(e){const t=e["sap.app"]?.dataSources;const n=e["sap.ui.generic.app"]&&t?.mainService;if(!n){return false}const r=e["sap.ui.generic.app"]?.pages;if(Array.isArray(r)){return this.recommendedUtilInstance._isListReport(r[0])&&!this.isAddCardToInsightsHidden(r[0])}const i=Object.values(r);if(i.length>0){return i.some(e=>typeof e==="object"&&this.recommendedUtilInstance._isListReport(e)&&!this.isAddCardToInsightsHidden(e))}return false}_getOdataModel(e){return new Promise(function(t){const n=e?.["sap.app"]?.dataSources;const r=n?.mainService;let o=(r?.settings?.annotations||[]).map(e=>n?.[e]?.uri||"").filter(Boolean);const s=new i(r?.uri,{annotationURI:o,loadAnnotationsJoined:true});s.attachMetadataLoaded(()=>{t(s)});s.attachMetadataFailed(()=>{t(s)})})}_getEntitySet(e){const t=e["sap.ui.generic.app"]?.pages;if(Array.isArray(t)){return t[0].entitySet}else if(t){for(const e in t){const n=t[e];if(this.recommendedUtilInstance._isListReport(n)){return n.entitySet}}}return undefined}loadI18n(e,n){try{const r=this;function i(){return r._RBManifestMap[s]}const o=e?.["sap.app"]?.["i18n"]?.["bundleUrl"];const s=new URL(o,n).href;r._RBManifestMap=r._RBManifestMap||{};const a=function(){if(!r._RBManifestMap[s]){return Promise.resolve(t.create({bundleUrl:s,async:true,terminologies:e["sap.app"]?.["i18n"]?.["terminologies"]})).then(function(e){r._RBManifestMap[s]=e})}}();return Promise.resolve(a&&a.then?a.then(i):i(a))}catch(c){return Promise.reject(c)}}getI18nValueOrDefaultString(e,t){let n="";if(e&&e.startsWith("{{")){n=e.substring(2,e.length-2)}else if(e&&e.startsWith("{")){n=e.substring(1,e.length-1)}return n?t.getText(n):e}_getAnalyticalCardManifest(){return JSON.parse(JSON.stringify(P))}getProcessedManifest(t,n,r,i){try{const o=this;return Promise.resolve(_(function(){function e(){return o.recommendedUtilInstance._createCardManifest(m,i,s,h)}const s=n.manifest;const a=o._getEntitySet(s);if(!a){return undefined}const c=t.getODataEntitySet(a);const u=o.recommendedUtilInstance.getLineItemDetails(t,s,a);if(!u?.lineItem){return undefined}const l=u.entitySet||a;const f=l===a?c:t.getODataEntitySet(l);const d=t.getODataEntityType(f.entityType);const h=u?.lrSettings?.["bSupressCardRowNavigation"];if(o.recommendedUtilInstance.hasMandatoryProperties(f,d?.property)){return undefined}const p=o.recommendedUtilInstance._getParametersisedEntitySetParams(t,l,true);if(p?.entitySetName&&p?.parameters?.length){const e=t.getODataEntitySet(p.entitySetName);if(o.recommendedUtilInstance.hasMandatoryProperties(e,p.parameters)){return undefined}}const m=o.recommendedUtilInstance._getManifestCardData(s,u,r,t);if(m.columns.length<S){return undefined}const g=u?.headerInfo;const v=g.TypeNamePlural?.String||"";m.cardTitle=v||m.cardTitle;const P=function(){if(!v&&s["sap.app"]?.i18n){const e=s["sap.app"].i18n.bundleUrl;const t=s["sap.app"].title;const r=function(){if(e&&(t.startsWith("i18n>")||t.startsWith("{"))){return Promise.resolve(o.loadI18n(s,n.url)).then(function(e){m.cardTitle=o.getI18nValueOrDefaultString(m.cardTitle,e)})}}();if(r&&r.then)return r.then(function(){})}}();return P&&P.then?P.then(e):e(P)},function(t){e.error("Error while processing manifest",t instanceof Error?t.message:String(t));return undefined}))}catch(e){return Promise.reject(e)}}fetchMetaModels(t){try{const n=this;const r=t.map(function(t){try{return Promise.resolve(_(function(){return Promise.resolve(n._getOdataModel(t.manifest)).then(function(e){return e?.getMetaModel()})},function(t){e.error("Error while fetching metamodel",t instanceof Error?t.message:String(t));return undefined}))}catch(e){return Promise.reject(e)}});return Promise.resolve(Promise.all(r))}catch(e){return Promise.reject(e)}}combineManifestsAndMetaModels(e,t){return e.reduce((e,n,r)=>{const i=t[r];if(i){e.push({manifest:n,metaModel:i})}return e},[])}processManifests(e,t){try{const n=this;return Promise.all(e.map(e=>{const r=t.find(t=>t.resolutionResult?.ui5ComponentName===e.manifest.manifest?.["sap.app"]?.id);return n.getProcessedManifest(e.metaModel,e.manifest,r,n.versionInfo)}))}catch(e){return Promise.reject(e)}}processAppList(e,t,n){if(!e&&t&&t.length){return t.reduce((e,t)=>{const r=n?.[t.id]||[];const i=r.find(e=>e.semanticObject===t.target?.semanticObject&&e.action===t.target?.action);return i?[...e,i.fioriId]:e},[])}return e||[]}_getCardManifest(t,r){try{const i=this;return Promise.resolve(_(function(){return Promise.resolve(Promise.all([i._getCatalogApps(),i.getFioriAppData()])).then(function(e){let[o,s]=e;return Promise.resolve(n.load()).then(function(e){i.versionInfo=e;const n=Object.values(s).flat();const a=i.componentData;const c=i.processAppList(t,r,a);return Promise.resolve(i.fetchManifests(c,s,o)).then(function(e){const t=e.filter(e=>i._checkValidManifests(e.manifest));return Promise.resolve(i.fetchMetaModels(t)).then(function(e){const r=i.combineManifestsAndMetaModels(t,e);return Promise.resolve(i.processManifests(r,n)).then(function(e){return e.filter(e=>e!==undefined)})})})})})},function(t){e.error("Error while fetching card manifest",t instanceof Error?t.message:String(t));return[]}))}catch(e){return Promise.reject(e)}}fetchManifests(t,n,r){try{return Promise.resolve(_(function(){const i=t.map(function(t){try{let i=false;const o=n[t]||[];const s=I(o,function(t){const n=r.find(e=>t.semanticObject===e.target?.semanticObject&&t.action===e.target?.action);const o=t?.resolutionResult?.applicationDependencies?.manifest;return function(){if(n&&o){return _(function(){return Promise.resolve(fetch(o)).then(function(e){return Promise.resolve(e.json()).then(function(t){const n=t;const r={url:e.url,manifest:n};i=true;return r})})},function(t){e.error("Error while fetching manifest",t instanceof Error?t.message:String(t));i=true;return undefined})}}()},function(){return i});return Promise.resolve(s&&s.then?s.then(function(e){return i?e:undefined}):i?s:undefined)}catch(e){return Promise.reject(e)}});return Promise.resolve(Promise.all(i)).then(function(e){return e.filter(e=>e!==undefined)})},function(t){e.error("Error while processing manifests",t instanceof Error?t.message:String(t));return[]}))}catch(e){return Promise.reject(e)}}_removeDuplicateCards(e){const t={};const n=[];e.forEach(e=>{const r=e?.descriptorContent?.["sap.card"]?.header?.title||"";if(!t[r]){n.push(e);t[r]=true}});return n}getRecommenedCards(){try{const t=this;return Promise.resolve(_(function(){return Promise.resolve(t._getRecommenedFioriIds()).then(function(e){return Promise.resolve(t._getCardManifest(e)).then(function(e){const n=e?.slice(0,V);const r=n?.map(e=>{let t;if(e?.["sap.card"]){e["sap.card"].rec=true;t=e["sap.app"]?.id}return{id:t,descriptorContent:e}});return t._removeDuplicateCards(r)})})},function(t){e.error("Error while fetching recommended cards:",t instanceof Error?t.message:String(t));return[]}))}catch(e){return Promise.reject(e)}}getRecommendedVisualizations(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const t=this;function n(){return t._recommendedVisualizations}const r=function(){if(!t._recommendedVisualizations||e){return Promise.resolve(t._getRecommenedFioriIds(e)).then(function(n){const r=function(){if(n.length){let r=[];let i=[];return Promise.resolve(Promise.all([t._getVisualizationsByFioriIds(n),t._fetchMyHomeVizs(e)])).then(function(e){let[n,o]=e;n=n.filter(e=>q(e,o));n.forEach(e=>{if(H(e)){i.push(e)}else{r.push(e)}});t._recommendedVisualizations=r.slice(0,10-i.length).concat(i)})}else{t._recommendedVisualizations=[]}}();if(r&&r.then)return r.then(function(){})})}}();return Promise.resolve(r&&r.then?r.then(n):n(r))}catch(i){return Promise.reject(i)}}_getInboundApps(){try{return Promise.resolve(_(function(){return Promise.resolve(s.getServiceAsync("ClientSideTargetResolution")).then(function(e){return e?._oAdapter?._aInbounds||[]})},function(t){e.error("Error while fetching inbound apps: "+t.message);return[]}))}catch(e){return Promise.reject(e)}}getFioriAppData(){try{const t=this;return Promise.resolve(_(function(){function e(){return t.fioriAppData}const n=function(){if(!Object.keys(t.componentData).length){t.componentData={};t.fioriAppData={};return Promise.resolve(t._getInboundApps()).then(function(e){e.forEach(e=>{const n=e?.signature?.parameters?.["sap-fiori-id"]?.defaultValue?.value;const r=e?.resolutionResult?.ui5ComponentName;if(n){const i={action:e.action,semanticObject:e.semanticObject,resolutionResult:e.resolutionResult};t.fioriAppData[n]=t.fioriAppData[n]||[];t.fioriAppData[n].push(i);if(r){const e={...i,fioriId:n};t.componentData[r]=t.componentData[r]||[];t.componentData[r].push(e)}}})})}}();return n&&n.then?n.then(e):e(n)},function(t){e.error(t instanceof Error?t.message:String(t));return{}}))}catch(e){return Promise.reject(e)}}_getVisualizationsByFioriIds(e){try{const t=this;const n=[];const r=new Map;return Promise.resolve(Promise.all([t._getInboundApps(),t._getCatalogApps()])).then(function(t){let[i,o]=t;e.forEach(e=>{const t=i.filter(function(t){return t?.signature.parameters["sap-fiori-id"]?.defaultValue?.value===e});t.forEach(t=>{let i=o.filter(e=>e?.target?.semanticObject===t.semanticObject&&e.target.action===t.action);const s=i.filter(e=>G(e));const a=i.filter(e=>!G(e));if(s.length>0&&a.length>0){i=[...a]}i.forEach(t=>{let i=t.visualizations[0];let o={title:i.title,subtitle:i.subtitle,icon:i.icon,url:i.targetURL,vizId:i.vizId,fioriId:e,visualization:i};if(!r.has(o.url)||!r.has(o.title)){r.set(o.url,true);r.set(o.title,true);n.push(o)}})})});return n})}catch(e){return Promise.reject(e)}}_getAllFavPageApps(t,n){try{let r=false;const i=this;return Promise.resolve(_(function(){function e(e){return r?e:[]}const o=function(){if(t){i._favPageVisualizations=i._favPageVisualizations||[];const e=i._favPageVisualizations.reduce((e,t)=>{if(t.pageId&&!e.includes(t.pageId)){e.push(t.pageId)}return e},[]);const o=t.map(e=>e.pageId);const s=e.length===0||!e.every(e=>o.includes(e));if(!n&&!s){const e=i._favPageVisualizations;r=true;return e}else{return Promise.resolve(i._loadAllPageVisualizations(t)).then(function(e){i._favPageVisualizations=e;const t=i._favPageVisualizations;r=true;return t})}}}();return o&&o.then?o.then(e):e(o)},function(t){e.error(t);return[]}))}catch(e){return Promise.reject(e)}}_loadAllPageVisualizations(t){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{const r=e=>t.find(t=>t.pageId===e)?.BGColor??y().key;return Promise.resolve(_(function(){const e=[];return Promise.resolve(s.getServiceAsync("SpaceContent")).then(function(i){return Promise.resolve(i.getPages(t.map(e=>e.pageId))).then(function(t){const i=Object.values(t);for(const t of i){const i=t.sections||[];for(const o of i){const i=o.visualizations||[];for(const o of i){const i={appId:o.targetURL,vizId:o.vizId,icon:o.icon,BGColor:r(t.id),pageId:t.id};if(!n||!e.some(e=>e.appId===i.appId)){e.push(i)}}}}return e})})},function(t){e.error(t);return[]}))}catch(e){return Promise.reject(e)}}}return Q});
//# sourceMappingURL=AppManager.js.map