/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/EventBus","sap/ushell/Config","sap/ushell/Container","./ColorUtils","./Constants","./PagesIconsConstants","./UshellPersonalizer"],function(e,n,o,t,r,s,a,i){"use strict";function l(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const c=l(r);const u=s["DEFAULT_BG_COLOR"];const f=s["FALLBACK_ICON"];const P=s["fnFetchLegendColor"];const g=s["MYHOME_SPACE_ID"];const h=s["PAGE_SELECTION_LIMIT"];const d=a["PAGES"];const p=a["SPACES"];const v=l(i);const C=e.extend("sap.cux.home.utils.PageManager",{constructor:function o(t,r){e.prototype.constructor.call(this);this.colorUtils=c;this.persContainerId=t;this.oOwnerComponent=r;this._eventBus=n.getInstance()},_getPersonalization:function e(){return v.getInstance(this.persContainerId,this.oOwnerComponent)},fetchAllAvailableSpaces:function e(){try{const e=this;if(e._aSpaces){return Promise.resolve(e._aSpaces)}return Promise.resolve(t.getServiceAsync("BookmarkV2")).then(function(n){return Promise.resolve(n.getContentNodes()).then(function(n){const o=n;e._aSpaces=o.filter(e=>e.id!==g);e._aSpaces.forEach(function(e){e.BGColor=u();e.applyColorToAllPages=false});return e._aSpaces})})}catch(e){return Promise.reject(e)}},fetchAllAvailablePages:function e(){let n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const e=this;if(e._aPages){return Promise.resolve(e._aPages)}return Promise.resolve(e.fetchAllAvailableSpaces()).then(function(o){e._aPages=[];o.forEach(o=>{if(Array.isArray(o.children)){o.children.forEach(t=>{if(!n||n&&!e._aPages.find(e=>e.id===t.id)){e._aPages.push({title:t.label,icon:f,isIconLoaded:false,pageId:t.id,spaceId:o.id,spaceTitle:o.label,url:"#Launchpad-openFLPPage?pageId="+t.id+"&spaceId="+o.id})}})}});return e._aPages})}catch(e){return Promise.reject(e)}},_getDefaultPages:function e(n){const o=n.slice(0,h)||[];return this.getFavPages(o)},_getIconForPage:function e(n){let o=d.find(e=>n.pageId?.includes(e.id));if(!o){o=p.find(e=>n.spaceId?.includes(e.id))}n.icon=o?.icon||f;n.isIconLoaded=true},_applyIconsForFavPages:function e(n){const o=n.filter(e=>!e.isIconLoaded);o.forEach(e=>{this._getIconForPage(e)})},getFavPages:function e(n){let o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{const t=this;function r(){if(n.length){t._applyIconsForFavPages(n)}return n}n.forEach(e=>{e.selected=true;if(!e.BGColor){e.BGColor=t.colorUtils.getFreeColor()}else{t.colorUtils.addColor(e.BGColor)}});const s=function(){if(o){function e(){return Promise.resolve(t.oPersonalizer.read()).then(function(e){if(!e)e={favouritePages:[]};e.favouritePages=n;return Promise.resolve(t.oPersonalizer.write(e)).then(function(){t._eventBus.publish("pageChannel","pageUpdated")})})}const r=function(){if(!t.oPersonalizer){return Promise.resolve(t._getPersonalization()).then(function(e){t.oPersonalizer=e})}}();return r&&r.then?r.then(e):e(r)}}();return Promise.resolve(s&&s.then?s.then(r):r(s))}catch(a){return Promise.reject(a)}},getFavoritePages:function e(){let n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const t=encodeURIComponent(o.last("/core/spaces/enabled"));if(!t){return Promise.resolve([])}if(this.aFavPages&&!n){return Promise.resolve(this.aFavPages)}if(this.oGetFavPagesPromise===undefined){this.oGetFavPagesPromise=this._getFavPages(n)}return this.oGetFavPagesPromise},_getFavPages:function e(n){try{const e=this;return Promise.resolve(e._getPersonalization()).then(function(o){e.oPersonalizer=o;return Promise.resolve(e.oPersonalizer.read()).then(function(o){const t=o?.favouritePages;return Promise.resolve(e.fetchAllAvailablePages(true)).then(function(r){function s(){return e.aFavPages}const a=function(){if(!t){return Promise.resolve(e._getDefaultPages(r)).then(function(n){e.aFavPages=n})}else{let s=[],a;t?.forEach(e=>{a=r.find(function(n){return n.pageId===e.pageId});if(a){a.BGColor=e.BGColor;s.push(a)}});s=s.slice(0,h);const i=function(){if(s.length||!t?.length){return Promise.resolve(e.getFavPages(s,s.length!==t?.length||n)).then(function(n){e.aFavPages=n})}else{const n=function(){if(!s.length&&t.length){o.favouritePages=[];return Promise.resolve(e.oPersonalizer.write(o)).then(function(){return Promise.resolve(e._getDefaultPages(r)).then(function(n){e.aFavPages=n})})}}();if(n&&n.then)return n.then(function(){})}}();if(i&&i.then)return i.then(function(){})}}();return a&&a.then?a.then(s):s(a)})})})}catch(e){return Promise.reject(e)}},applyColorPersonalizations:function e(n){try{const o=this;function t(){return Promise.resolve(o.fetchAllAvailableSpaces()).then(function(e){n.forEach(n=>{const t=!!n.pageId;const r=e?.find(e=>e.id===n.spaceId);const s=r?.children.find(e=>e.id===n.pageId);const a=o.aFavPages.find(e=>e.pageId===n.pageId);const i=o._aPages?.find(e=>e.pageId===n.pageId);if(!t&&r){const e=P(n.BGColor);r.BGColor=e;r.applyColorToAllPages=n.applyColorToAllPages;r.isSpacePersonalization=true;r.children.forEach(e=>{const t=o.aFavPages.find(n=>n.pageId===e.id);if(t){const o=t.isPagePersonalization?t.oldColor:u();t.BGColor=r.applyColorToAllPages?n.BGColor:o;e.BGColor=t.BGColor}else{e.BGColor=r.applyColorToAllPages?n.BGColor:u();o._aPages.forEach(n=>{if(n.spaceId===r.id){n.BGColor=e.BGColor}})}})}else if(s){const e=r?.applyColorToAllPages?{...r.BGColor}:P(n.BGColor);if(a){a.isPagePersonalization=true;a.BGColor=e;a.oldColor=P(n.BGColor)}s.isPagePersonalization=true;s.BGColor=e;s.oldColor=P(n.BGColor);if(i){i.isPagePersonalization=true;i.BGColor=e;i.oldColor=P(n.BGColor)}}});o._eventBus.publish("pageChannel","pageUpdated")})}if(!n?.length){return Promise.resolve()}const r=function(){if(!o.aFavPages){return Promise.resolve(o.getFavoritePages()).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(t):t(r))}catch(s){return Promise.reject(s)}},applyIconPersonalizations:function e(n){try{const o=this;function t(){return Promise.resolve(o.fetchAllAvailableSpaces()).then(function(e){n.forEach(n=>{const t=!!n.pageId;const r=e?.find(e=>e.id===n.spaceId);if(!t){if(r){r.icon=n.icon;r.isSpaceIconPersonalization=true;r.children.forEach(e=>{if(!e.isPageIconPersonalization){const n=o.aFavPages.find(n=>n.pageId===e.id);if(n){n.icon=r.icon||f;e.icon=r.icon||f}}})}}else{const e=r?.children.find(e=>e.id===n.pageId);const t=o.aFavPages.find(e=>e.pageId===n.pageId);if(e&&t){t.isPageIconPersonalization=true;e.isPageIconPersonalization=true;t.icon=n.icon;e.icon=n.icon;t.oldIcon=n.oldIcon;e.oldIcon=n.oldIcon}}});o._eventBus.publish("pageChannel","pageUpdated")})}if(!n?.length){return Promise.resolve()}const r=function(){if(!o.aFavPages){return Promise.resolve(o._getFavPages(false)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(t):t(r))}catch(s){return Promise.reject(s)}}});C.oCacheInstances={};C.getInstance=function e(n,o){if(C.oCacheInstances[n]){return C.oCacheInstances[n]}const t=new C(n,o);C.oCacheInstances[n]=t;return t};return C});
//# sourceMappingURL=PageManager-dbg.js.map