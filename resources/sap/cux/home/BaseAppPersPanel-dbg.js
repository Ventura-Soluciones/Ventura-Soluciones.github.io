/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/EventBus","./BaseAppPanel","./utils/Constants","./utils/DataFormatUtils","./utils/PageManager","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,n,o,r,i,s){"use strict";function a(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const c=a(t);const u=n["DEFAULT_APP_ICON"];const p=n["DEFAULT_BG_COLOR"];const l=n["FALLBACK_ICON"];const g=n["MYHOME_PAGE_ID"];const P=o["getLeanURL"];const f=a(r);const d=a(i);const h=a(s);const I=c.extend("sap.cux.home.BaseAppPersPanel",{metadata:{library:"sap.cux.home",properties:{persContainerId:{type:"string",group:"Misc",defaultValue:"",visibility:"hidden"}}},constructor:function e(t,n){c.prototype.constructor.call(this,t,n)},init:function t(){c.prototype.init.call(this);this._eventBus=e.getInstance();this._eventBus.subscribe("pageChannel","pageUpdated",()=>{void this.applyPersonalization()},this)},_getPersonalizer:function e(){try{const e=this;const t=e._getPersContainerId();if(!t){throw new Error("No Container ID Provided for personalisation!")}return Promise.resolve(h?.getInstance(t,d.getOwnerComponent(e)))}catch(e){return Promise.reject(e)}},getPersonalization:function e(){try{const e=this;return Promise.resolve(e._getPersonalizer()).then(function(e){return Promise.resolve(e?.read()).then(function(e){return e||{}})})}catch(e){return Promise.reject(e)}},setPersonalization:function e(t){try{const e=this;return Promise.resolve(e._getPersonalizer()).then(function(e){return Promise.resolve(e.write(t)).then(function(){})})}catch(e){return Promise.reject(e)}},_getAppPersonalization:function e(){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(e){return e?.favoriteApps||[]})}catch(e){return Promise.reject(e)}},setFavAppsPersonalization:function e(t){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(n){const o=function(){if(n){n.favoriteApps=t;return Promise.resolve(e.setPersonalization(n)).then(function(){})}}();if(o&&o.then)return o.then(function(){})})}catch(e){return Promise.reject(e)}},applyPersonalization:function e(){try{const e=this;let t=e.fetchTileVisualization();return Promise.resolve(e._applyTilesPersonalization(t))}catch(e){return Promise.reject(e)}},_applyTilesPersonalization:function e(t,n){let o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;try{const e=this;return Promise.resolve(Promise.all([e._getAppPersonalization(),e._getFavPages()])).then(function(r){let[i,s]=r;return Promise.resolve(e.appManagerInstance._getAllFavPageApps(s,o)).then(function(o){const r=e.getAggregation("groups")||[];const s=n?e._getGroup(n)?.getApps()||[]:e.getApps()||[];for(const a of t){const t=e._getItem(a,r,s);const{color:c,icon:u}=e._getItemPersonalization(t,i,o,n);if(c){t?.setProperty("bgColor",c,true);a.setBackgroundColor(c)}if(u){t?.setProperty("icon",u,true);a.setTileIcon(u)}}})})}catch(e){return Promise.reject(e)}},_getItem:function e(t,n,o){const r=t.data("groupId");if(r){return n.find(e=>e.getGroupId()===r)}else{return o.find(e=>P(e.getUrl())===t.getUrl())}},_getItemPersonalization:function e(t,n,o,r){let i="";let s="";if(!t)return{color:i,icon:s};if(t.isA("sap.cux.home.Group")){const e=n?.find(e=>e.isSection&&e.sectionId===t.getGroupId());i=e?.BGColor}else{const e=t;const a=[e.getUrl()];const c=e.data("oldAppId");if(c){a.push(c)}const u=e.getVizId();const l=r?n?.find(e=>!e.isSection&&e.sectionId===r&&e.appId&&a.includes(e.appId)):n?.find(e=>this?.isA("sap.cux.home.FavAppPanel")?e.isRecentlyAddedApp&&e.appId&&a.includes(e.appId):e.appId&&a.includes(e.appId));const g=o.find(e=>e.vizId===u||e.appId&&a.includes(e.appId));const P=l?.BGColor||g?.BGColor||p().key;i=typeof P==="object"?P.key:P;s=this?.isA("sap.cux.home.FavAppPanel")?this._getFavAppIcon(e,g?.icon):this.getAppIcon()}return{color:i,icon:s}},_getFavPages:function e(){try{const e=this;return Promise.resolve(e._getPageManagerInstance().getFavoritePages()).then(function(e){return e.concat({pageId:g,BGColor:p().key})})}catch(e){return Promise.reject(e)}},getAppIcon:function e(){return u},_getFavAppIcon:function e(t,n){return n||t?.getIcon()||l},_getPageManagerInstance:function e(){if(!this._pageManagerInstance){this._pageManagerInstance=f.getInstance(this._getPersContainerId(),d.getOwnerComponent(this))}return this._pageManagerInstance},_getPersContainerId:function e(){let t=this.getProperty("persContainerId");if(!t){t=d.getPersContainerId(this)}return t}});return I});
//# sourceMappingURL=BaseAppPersPanel-dbg.js.map