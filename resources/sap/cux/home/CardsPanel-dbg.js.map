{"version":3,"file":"CardsPanel-dbg.js","names":["sap","ui","define","Log","GridContainer","GridContainerSettings","SelectionVariant","CardHelper","InsightsInMemoryCachingHost","HBox","HeaderContainer","VBox","EventBus","Card","JSONModel","Container","S4MyHome","__BasePanel","__MenuItem","__TilesPanel","___utils_Accessibility","__AppManager","___utils_Constants","___utils_DataFormatUtils","___utils_Device","___utils_DragDropUtils","___utils_FESRUtil","___utils_InsightsUtils","__PersonalisationUtils","__UShellPersonalizer","_interopRequireDefault","obj","__esModule","default","_catch","body","recover","result","e","then","BasePanel","_finallyRethrows","finalizer","bind","MenuItem","TilesPanel","checkPanelExists","AppManager","FEATURE_TOGGLES","SETTINGS_PANELS_KEYS","recycleId","calculateCardWidth","DeviceType","fetchElementProperties","focusDraggedItem","addFESRId","createShowMoreActionButton","createShowMoreMenuItem","getAssociatedFullScreenMenuItem","sortMenuItems","targetsAreEqual","PersonalisationUtils","UShellPersonalizer","cardsMenuItems","cardsContainerMenuItems","cardsContainerActionButtons","sortedMenuItems","REFRESH","EDIT_CARDS","AI_INSIGHT_CARD","Constants","PLACEHOLDER_CARD_COUNT","CARDS_GAP","RECOMMENDATION_PATH","runtimeHostCreated","CardsPanel","extend","metadata","library","properties","title","type","group","defaultValue","visibility","key","fullScreenName","host","defaultAggregation","aggregations","cards","multiple","singularName","events","handleHidePanel","parameters","handleUnhidePanel","visibleCardsUpdated","constructor","_constructor","id","settings","BasePanel.prototype.constructor.call","this","aVisibleCardInstances","cardsInViewport","_appSwitched","_headerVisible","init","_init","_this","BasePanel.prototype.init.call","setProperty","cardWidth","cardHeight","getDeviceType","Mobile","_oData","userVisibleCards","userAllCards","isPhone","_controlModel","appManagerInstance","getInstance","_controlMap","Map","refreshMenuItem","_createRefreshMenuItem","editCardsMenuItem","_createEditCardsMenuItem","menuItems","forEach","menuItem","addAggregation","_sortMenuItems","oEventBus","subscribe","sChannelId","sEventId","oData","Promise","resolve","_createCards","rerenderCards","_importdone","reject","_setupWrapper","_toggleCardActivity","_this2","toggleUserActions","event","show","getParameter","_temp2","_temp","attachRouteMatched","error","warning","Error","message","String","aCards","_this3","cardHelperInstance","_getManifestEntryFromCard","oCard","sEntry","cardWithManifestPromise","manifestEntry","getManifestEntry","_pManifestReady","attachManifestReady","_addRuntimeHost","_this4","_this5","_this6","_this7","_this8","getProperty","action","oEvent","sType","oParameters","_temp3","ibnTarget","preventDefault","oIntegrationCardManifest","aHeaderActions","header","actions","oCheckSemanticProperty","configuration","_semanticDateRangeSetting","value","JSON","parse","Object","keys","length","processSemanticDate","aContentActions","getContentActions","oHeaderAction","oContentAction","bOldCardExtension","indexOf","_manageOldCardExtension","getServiceAsync","navigationService","navigate","target","params","ibnParams","text","_i18nBundle","getText","icon","_refreshCardData","visible","oEntry","cacheType","cardId","getParent","_getLayout","openSettingsDialog","INSIGHTS_CARDS","oCardParams","aRelevantFilters","_relevantODataFilters","bRelevantFilters","aRelevantParams","_relevantODataParameters","bRelevantParams","oCardDataSource","dataSources","oFilterService","filterService","oDataSourceSettings","odataVersion","getParentAppDetails","descriptorContent","parentApp","semanticObject","intents","isNavigationSupported","_navigationService$is","aResponses","supported","sShellHash","semanticURL","shellHash","attachAction","oCardSV","getCombinedParameters","sParamName","sFilterName","oCardParamsFilterName","aSelectOptions","SelectOptions","aRanges","Ranges","Sign","Option","Low","massAddSelectOption","oTempParam","selectionVariant","toJSONObject","stringify","_getContentActions","manifest","content","item","row","stateData","status","publish","require","InsightsCacheData","sCardId","cacheDataInstance","clearCache","refreshData","_refreshData","_this9","_temp4","_getServiceAsync","_refreshUserCards","renderPanel","_renderPanel","_this10","_temp8","_temp6","fireEvent","_temp5","aiFlagEnabled","undefined","updateAICardCreationStatus","_temp7","_getServiceAsync2","_rerenderCards","skipRecommendation","arguments","_this11","_cardsRendered","_temp14","sDefaultAggreName","_getCardContainer","getMetadata","getDefaultAggregationName","removeAllAggregation","_showPlaceHolders","_getUserVisibleCardModel","userVisibleCardModel","listBinding","bindList","hasListeners","enableExtendedChangeDetection","attachChange","visibleCards","_showCards","getPersonalisationProperty","showRecommendation","_temp13","_temp12","_getRecommendationCards","_temp11","_temp10","checkForRecommendedCards","_temp9","_updateRecommendationStatus","fireHandleHidePanel","setNewVisibleCards","_setNewVisibleCards","_this12","visibleCardModel","aNewCards","_checkForRecommendedCards","_this13","manifestIds","oVisCard","idx","rec","push","rank","ranking","index","uniqueManifestDetails","getUniqueManifestDetails","regenerateCards","aUpdatedCards","_exit","_temp16","_result2","_temp15","_updateCards","map","newManifest","_getUniqueManifestDetails","exists","some","existingItem","_getManifests","_this14","_getCardManifest","aManifests","aRegeneratedCards","mappedResults","_removeDuplicateRegeneratedCards","_regenerateCards","allManifestIds","_this15","aMappedManifest","createUniqueKey","uniqueMap","uniqueKey","oError","aOriginalList","originalMap","originalItem","parentAppId","values","_getPersonalizationData","_this16","_temp18","oPersonalizer","read","oPersData","_temp17","_getPersonalization","_this16$_getPersonali","_getPersonalisationProperty","propertyKey","_this17","_this18","getRecommenedCards","aRecommendedCards","_handleRecommendationCards","_this19","cardManifests","_cardsFlexWrapper","getId","renderType","width","items","_createCardContainer","_createMobileCardContainer","setModel","_addContent","cardsContainerSettings","columnSize","rowSize","gap","cardsContainer","addStyleClass","setLayout","addDragDropConfigTo","_handleCardsDnd","cardsMobileContainer","scrollStep","scrollStepByItem","gridLayout","scrollTime","showDividers","cardManifest","_getAnalyticalCardManifest","placeholderArray","Array","_calculatePlaceholderCardCount","fill","aInsightsCards","_","card","height","previewMode","oPreviewHBox","justifyContent","layoutDomRef","_getInsightsContainer","getDomRef","count","sectionDomRef","childNodes","domProperties","availableWidth","cardLayoutConfig","containerWidth","totalCards","minWidth","maxWidth","Math","floor","panelName","getName","fireHandleUnhidePanel","updatePanelsItemCount","oUserCard","overlay","overlayHBoxWrapper","addItem","oPreviewVBox","direction","_handleEditCards","parent","getSource","isA","handleHideHeader","_handleHideHeader","_toggleHeaderActions","handleAddHeader","_handleAddHeader","refreshCards","_refreshCards","_this20","sInsertPosition","oDragItem","iDragItemIndex","indexOfItem","oDropItem","iDropItemIndex","setBusy","_temp21","_temp20","setTimeout","_temp19","_getUserAllCardModel","userAllCardsModel","updateCardList","_wasThrown","_result3","_updateCardList","_this21","aUserVisibleCards","aUserAllCards","sDragedPositionRank","sDropedPositionRank","iUpdatedDragItemIndex","findIndex","iUpdatedDropItemIndex","_temp22","handleDndCardsRanking","_updateMultipleCards","_sortCardsOnRank","filter","sort","a","b","persContainerId","getPersContainerId","ownerComponent","getOwnerComponent","_this22","write","_calculateVisibleCardCount","layout","pageDomRef","deviceType","isHeaderVisible","sectionNodeIndex","iAvailableWidth","max","_adjustLayout","isMobileDevice","isElementExpanded","_getCurrentExpandedElementName","cardCount","slice","getManifest","cardWrapper","shareCardsInViewport","showFullScreenButton","toggleFullScreenElements","fullScreenButton","fullScreenText","getTitle","updateMenuItem","get","SHOW_MORE","updateActionButton","setWidth","setColumnSize","getContainerMenuItems","_getContainerMenuItems","_containerMenuItems","containerRefreshMenuItem","containerEditCardsMenuItem","containerShowMoreMenuItem","set","getContainerActionButtons","_getContainerActionButtons","_containerActionButtons","actionButton","insightsContainer","fesrId","press","_createAddInsightCardMenuItem","_generateInsightCardsWithAI","_this23","showAddCardWithSearchDialog","_isDesktopDevice","Tablet","_updateAICardCreationStatus","_this24","aPromises","isFeatureEnabled","AI_GENERATED_CARD","all","aResult","oNavigationService","enabled","addInsightCardMenuItem","containerAddInsightMenuItem","CardsPanelName","InsightsContainerName","parentContainerContent","getContent","TilesPanelName","find","panel","cardPanelExist","tilePanelExist","setVisible","addCommonMenuItems","catch","bShow","getAggregation","toggleMenuListItem","toggleActionButton","panelMenuItems","_shareCardsInViewport"],"sources":["CardsPanel.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport Log from \"sap/base/Log\";\nimport GridContainer from \"sap/f/GridContainer\";\nimport GridContainerSettings from \"sap/f/GridContainerSettings\";\nimport SelectionVariant from \"sap/fe/navigation/SelectionVariant\";\nimport CardHelper from \"sap/insights/CardHelper\";\nimport InsightsInMemoryCachingHost from \"sap/insights/base/InMemoryCachingHost\";\nimport Button from \"sap/m/Button\";\nimport HBox from \"sap/m/HBox\";\nimport HeaderContainer from \"sap/m/HeaderContainer\";\nimport VBox from \"sap/m/VBox\";\nimport Event from \"sap/ui/base/Event\";\nimport ManagedObject, { MetadataOptions } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport Control from \"sap/ui/core/Control\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport EventBus from \"sap/ui/core/EventBus\";\nimport { DropInfo$DropEventParameters } from \"sap/ui/core/dnd/DropInfo\";\nimport Host from \"sap/ui/integration/Host\";\nimport Card from \"sap/ui/integration/widgets/Card\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport Container from \"sap/ushell/Container\";\nimport S4MyHome from \"sap/ushell/api/S4MyHome\";\nimport { Intent } from \"sap/ushell/services/AppLifeCycle\";\nimport Navigation from \"sap/ushell/services/Navigation\";\nimport BasePanel from \"./BasePanel\";\nimport { $CardsPanelSettings } from \"./CardsPanel\";\nimport InsightsContainer from \"./InsightsContainer\";\nimport MenuItem from \"./MenuItem\";\nimport TilesPanel from \"./TilesPanel\";\nimport {\n\tICard,\n\tICardAction,\n\tICardActionParameters,\n\tICardDetails,\n\tICardHelper,\n\tICardHelperInstance,\n\tICardManifest,\n\tInsightsCacheData,\n\tIRegeneratedCard,\n\tISapApp,\n\tISapCard\n} from \"./interface/CardsInterface\";\nimport { checkPanelExists } from \"./utils/Accessibility\";\nimport AppManager from \"./utils/AppManager\";\nimport { FEATURE_TOGGLES, SETTINGS_PANELS_KEYS } from \"./utils/Constants\";\nimport { recycleId } from \"./utils/DataFormatUtils\";\nimport { calculateCardWidth, DeviceType, fetchElementProperties } from \"./utils/Device\";\nimport { focusDraggedItem } from \"./utils/DragDropUtils\";\nimport { addFESRId } from \"./utils/FESRUtil\";\nimport {\n\tcreateShowMoreActionButton,\n\tcreateShowMoreMenuItem,\n\tgetAssociatedFullScreenMenuItem,\n\tsortMenuItems,\n\ttargetsAreEqual\n} from \"./utils/InsightsUtils\";\nimport PersonalisationUtils from \"./utils/PersonalisationUtils\";\nimport UShellPersonalizer, { IPersonalizationData } from \"./utils/UshellPersonalizer\";\n\nexport enum cardsMenuItems {\n\tREFRESH = \"cards-refresh\",\n\tEDIT_CARDS = \"cards-editCards\",\n\tAI_INSIGHT_CARD = \"cards-addAIInsightCard\"\n}\n\nexport enum cardsContainerMenuItems {\n\tREFRESH = \"container-cards-refresh\",\n\tEDIT_CARDS = \"container-cards-editCards\",\n\tSHOW_MORE = \"cardsContainerFullScreenMenuItem\",\n\tAI_INSIGHT_CARD = \"container-cards-addAIInsightCard\"\n}\n\nexport enum cardsContainerActionButtons {\n\tSHOW_MORE = \"cardsContanerFullScreenActionButton\"\n}\nconst sortedMenuItems: (cardsMenuItems | string)[] = [\n\tcardsMenuItems.REFRESH,\n\tcardsMenuItems.EDIT_CARDS,\n\tcardsMenuItems.AI_INSIGHT_CARD,\n\t\"showMore\",\n\t\"settings\"\n];\n\ninterface IcardActionEvent {\n\tgetParameter(sParam: string): unknown;\n\tpreventDefault(): void;\n}\n\nconst Constants = {\n\tPLACEHOLDER_CARD_COUNT: 10,\n\tCARDS_GAP: 16\n};\n\nexport interface TargetIntent {\n\ttarget: Partial<Intent>;\n\tparams?: {\n\t\t[key: string]: string;\n\t};\n}\nconst RECOMMENDATION_PATH = \"showRecommendation\";\nlet runtimeHostCreated = false;\n\n/**\n *\n * Panel class for managing and storing Insights Cards.\n *\n * @extends sap.cux.home.BasePanel\n *\n * @author SAP SE\n * @version 0.0.1\n * @since 1.122.0\n *\n * @internal\n * @experimental Since 1.122\n * @public\n *\n * @alias sap.cux.home.CardsPanel\n */\n\nexport default class CardsPanel extends BasePanel {\n\tstatic readonly metadata: MetadataOptions = {\n\t\tlibrary: \"sap.cux.home\",\n\t\tproperties: {\n\t\t\ttitle: { type: \"string\", group: \"Misc\", defaultValue: \"\", visibility: \"hidden\" },\n\t\t\tkey: { type: \"string\", group: \"Misc\", defaultValue: \"\", visibility: \"hidden\" },\n\t\t\tfullScreenName: { type: \"string\", group: \"Misc\", defaultValue: \"SI2\", visibility: \"hidden\" },\n\t\t\thost: { type: \"sap.ui.integration.Host\", group: \"Misc\", defaultValue: null, visibility: \"hidden\" }\n\t\t},\n\t\tdefaultAggregation: \"cards\",\n\t\taggregations: {\n\t\t\t/**\n\t\t\t * Aggregation of cards available within the cards panel\n\t\t\t */\n\t\t\tcards: { type: \"sap.ui.integration.widgets.Card\", multiple: true, singularName: \"card\", visibility: \"hidden\" }\n\t\t},\n\t\tevents: {\n\t\t\thandleHidePanel: {\n\t\t\t\tparameters: {}\n\t\t\t},\n\t\t\thandleUnhidePanel: {\n\t\t\t\tparameters: {}\n\t\t\t},\n\t\t\t/**\n\t\t\t * Event is fired when cards in viewport are updated.\n\t\t\t */\n\t\t\tvisibleCardsUpdated: {\n\t\t\t\tparameters: {\n\t\t\t\t\tcards: { type: \"sap.ui.integration.widgets.Card[]\" }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tprivate cardHelperInstance!: ICardHelperInstance;\n\tprivate _cardsFlexWrapper!: VBox;\n\tprivate cardsContainer!: GridContainer;\n\tprivate cardsMobileContainer!: HeaderContainer;\n\tprivate aVisibleCardInstances: Card[] = [];\n\tprivate _oData!: Record<string, unknown>;\n\tprivate _controlModel!: JSONModel;\n\tprivate oPersonalizer!: UShellPersonalizer;\n\tprivate appManagerInstance!: AppManager;\n\tprivate cardsContainerSettings!: GridContainerSettings;\n\tprivate cardWidth!: string;\n\tprivate cardHeight!: string;\n\tprivate cardsInViewport: Card[] = [];\n\tprivate oEventBus!: EventBus;\n\tprivate _appSwitched: boolean = false;\n\tprivate _containerMenuItems!: MenuItem[];\n\tprivate _containerActionButtons!: Button[];\n\tprivate insightsContainer!: InsightsContainer;\n\tprivate _headerVisible: boolean = false;\n\tprivate _controlMap!: Map<string, UI5Element>;\n\tprivate aiFlagEnabled!: boolean;\n\tprivate _cardsRendered!: Promise<void> | undefined;\n\n\tconstructor(idOrSettings?: string | $CardsPanelSettings);\n\tconstructor(id?: string, settings?: $CardsPanelSettings);\n\t/**\n\t * Constructor for a new card panel.\n\t *\n\t * @param {string} [id] ID for the new control, generated automatically if an ID is not provided\n\t * @param {object} [settings] Initial settings for the new control\n\t */\n\tpublic constructor(id?: string, settings?: $CardsPanelSettings) {\n\t\tsuper(id, settings);\n\t}\n\n\t/**\n\t * Initializes the Cards Panel.\n\t *\n\t * @private\n\t * @override\n\t */\n\tpublic init() {\n\t\tsuper.init();\n\t\tthis.setProperty(\"key\", \"cards\");\n\t\tthis.setProperty(\"enableFullScreen\", true);\n\t\tthis.cardWidth = \"19rem\";\n\t\tthis.cardHeight = this.getDeviceType() === DeviceType.Mobile ? \"25.5rem\" : \"33rem\";\n\n\t\t//Initialize Tiles Model\n\t\tthis._oData = {\n\t\t\tuserVisibleCards: [] as ICard[],\n\t\t\tuserAllCards: [] as ICard[],\n\t\t\tisPhone: this.getDeviceType() === DeviceType.Mobile\n\t\t};\n\t\tthis._controlModel = new JSONModel(this._oData);\n\t\tthis.appManagerInstance = AppManager.getInstance();\n\t\tthis._controlMap = new Map();\n\t\t// Setup Menu Items\n\t\tconst refreshMenuItem = this._createRefreshMenuItem(cardsMenuItems.REFRESH, \"cardsRefresh\");\n\t\tconst editCardsMenuItem = this._createEditCardsMenuItem(cardsMenuItems.EDIT_CARDS, \"manageCards\");\n\n\t\tconst menuItems = [refreshMenuItem, editCardsMenuItem];\n\t\tmenuItems.forEach((menuItem) => this.addAggregation(\"menuItems\", menuItem));\n\t\tthis._sortMenuItems(sortedMenuItems);\n\n\t\tthis.oEventBus = EventBus.getInstance();\n\t\t// Subscribe to the event\n\t\tthis.oEventBus.subscribe(\n\t\t\t\"importChannel\",\n\t\t\t\"cardsImport\",\n\t\t\tasync (sChannelId?: string, sEventId?: string, oData?) => {\n\t\t\t\tawait this._createCards(oData as ICardManifest[]);\n\t\t\t\tawait this.rerenderCards();\n\t\t\t\tthis._importdone();\n\t\t\t},\n\t\t\tthis\n\t\t);\n\n\t\t// Setup Wrapper for Cards\n\t\tthis._setupWrapper();\n\n\t\t// Toggles the activity of cards\n\t\tthis._toggleCardActivity();\n\t}\n\n\t/**\n\t * Toggles the activity of cards on route change.\n\t *\n\t * @private\n\t * @returns {void}\n\t */\n\tprivate _toggleCardActivity(): void {\n\t\tconst toggleUserActions = async (event: Event<{ isMyHomeRoute: boolean }>) => {\n\t\t\tconst show = event.getParameter(\"isMyHomeRoute\");\n\t\t\tif (show) {\n\t\t\t\tif (this._appSwitched) {\n\t\t\t\t\tawait this.rerenderCards();\n\t\t\t\t\tthis._appSwitched = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._appSwitched = true;\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\tS4MyHome.attachRouteMatched({}, toggleUserActions, this);\n\t\t} catch (error) {\n\t\t\tLog.warning(error instanceof Error ? error.message : String(error));\n\t\t}\n\t}\n\n\t/**\n\t * Create imported cards\n\t * @param {ICardManifest[]} aCards - array of card manifests\n\t * @returns {any}\n\t */\n\tprivate async _createCards(aCards: ICardManifest[]) {\n\t\tawait this.cardHelperInstance?._createCards(aCards);\n\t\treturn this.rerenderCards();\n\t}\n\n\t/**\n\t * Retrieves a manifest entry from a card.\n\t * If the manifest entry is not immediately available, it waits for the manifest to be ready.\n\t *\n\t * @param {object} oCard - The card object from which to retrieve the manifest entry.\n\t * @param {string} sEntry - The manifest entry key to retrieve.\n\t * @returns {Promise<ICardManifest | undefined>} A promise that resolves with the manifest entry value.\n\t */\n\tprivate _getManifestEntryFromCard(oCard: Card, sEntry: string): Promise<ICardManifest | undefined> {\n\t\tconst cardWithManifestPromise = oCard as Card & { _pManifestReady?: Promise<ICardManifest | undefined> };\n\t\tconst manifestEntry = oCard.getManifestEntry(sEntry) as ICardManifest | undefined;\n\t\tif (manifestEntry) {\n\t\t\treturn Promise.resolve(manifestEntry);\n\t\t} else {\n\t\t\tif (!cardWithManifestPromise._pManifestReady) {\n\t\t\t\tcardWithManifestPromise._pManifestReady = new Promise<ICardManifest | undefined>((resolve) => {\n\t\t\t\t\toCard.attachManifestReady(() => {\n\t\t\t\t\t\tresolve(oCard.getManifestEntry(sEntry) as ICardManifest | undefined);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn cardWithManifestPromise._pManifestReady;\n\t\t}\n\t}\n\n\t/**\n\t * Adds a runtime host for the cards panel.\n\t *\n\t * @private\n\t */\n\tprivate _addRuntimeHost() {\n\t\tconst host = (this.getProperty(\"host\") || new InsightsInMemoryCachingHost(\"runtimeHost\")) as Host;\n\t\tconst action = async (oEvent: IcardActionEvent) => {\n\t\t\tconst sType = oEvent.getParameter(\"type\") as string;\n\t\t\tlet oParameters = (oEvent.getParameter(\"parameters\") as ICardActionParameters) || {};\n\n\t\t\tif (sType === \"Navigation\" && oParameters.ibnTarget) {\n\t\t\t\toEvent.preventDefault();\n\t\t\t\tconst oCard = (oEvent.getParameter(\"card\") as Card) || {},\n\t\t\t\t\toIntegrationCardManifest = (oCard?.getManifestEntry(\"sap.card\") || {}) as ISapCard,\n\t\t\t\t\taHeaderActions = oIntegrationCardManifest?.header?.actions || [];\n\n\t\t\t\t//processing semantic date as param for navigation\n\t\t\t\t//check to verify if _semanticDateRangeSetting property is present in manifest\n\t\t\t\tlet oCheckSemanticProperty;\n\t\t\t\tif (oIntegrationCardManifest?.configuration?.parameters?._semanticDateRangeSetting?.value) {\n\t\t\t\t\toCheckSemanticProperty = JSON.parse(\n\t\t\t\t\t\toIntegrationCardManifest.configuration.parameters._semanticDateRangeSetting.value\n\t\t\t\t\t) as object;\n\t\t\t\t}\n\t\t\t\tif (oCheckSemanticProperty && Object.keys(oCheckSemanticProperty).length) {\n\t\t\t\t\toParameters = this.cardHelperInstance.processSemanticDate(\n\t\t\t\t\t\toParameters,\n\t\t\t\t\t\toIntegrationCardManifest\n\t\t\t\t\t) as ICardActionParameters;\n\t\t\t\t}\n\n\t\t\t\tlet aContentActions = this.getContentActions(oIntegrationCardManifest);\n\n\t\t\t\tconst oHeaderAction = aHeaderActions[0] || {},\n\t\t\t\t\toContentAction = aContentActions[0] || {};\n\n\t\t\t\tconst bOldCardExtension = !!(\n\t\t\t\t\t(oHeaderAction?.parameters &&\n\t\t\t\t\t\ttypeof oHeaderAction.parameters === \"string\" &&\n\t\t\t\t\t\toHeaderAction.parameters.indexOf(\"{= extension.formatters.addPropertyValueToAppState\") > -1) ||\n\t\t\t\t\t(oContentAction?.parameters &&\n\t\t\t\t\t\ttypeof oContentAction.parameters === \"string\" &&\n\t\t\t\t\t\toContentAction.parameters.indexOf(\"{= extension.formatters.addPropertyValueToAppState\") > -1)\n\t\t\t\t);\n\n\t\t\t\tthis._manageOldCardExtension(bOldCardExtension, oEvent, oParameters);\n\n\t\t\t\tconst navigationService = await Container.getServiceAsync<Navigation>(\"Navigation\");\n\t\t\t\tawait navigationService.navigate({\n\t\t\t\t\ttarget: oParameters.ibnTarget,\n\t\t\t\t\tparams: oParameters.ibnParams\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tconst actions = [\n\t\t\t{\n\t\t\t\ttype: \"Custom\",\n\t\t\t\ttext: this._i18nBundle?.getText(\"refresh\") as string,\n\t\t\t\ticon: \"sap-icon://refresh\",\n\t\t\t\taction: (oCard: Card) => {\n\t\t\t\t\tthis._refreshCardData(oCard);\n\t\t\t\t},\n\t\t\t\tvisible: async (oCard: Card) => {\n\t\t\t\t\tconst oEntry = await this._getManifestEntryFromCard(oCard, \"sap.insights\");\n\t\t\t\t\treturn oEntry && !oEntry.cacheType;\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"Custom\",\n\t\t\t\ttext: this._i18nBundle?.getText(\"viewFilteredBy\") as string,\n\t\t\t\ticon: \"sap-icon://filter\",\n\t\t\t\taction: (oCard: Card) => {\n\t\t\t\t\tconst cardId = (oCard.getManifestEntry(\"sap.app\") as ISapApp).id;\n\t\t\t\t\t(this.getParent() as InsightsContainer)\n\t\t\t\t\t\t?._getLayout()\n\t\t\t\t\t\t.openSettingsDialog(SETTINGS_PANELS_KEYS.INSIGHTS_CARDS, { cardId });\n\t\t\t\t},\n\t\t\t\tvisible: async (oCard: Card) => {\n\t\t\t\t\tconst oEntry = await this._getManifestEntryFromCard(oCard, \"sap.insights\");\n\t\t\t\t\tif (oEntry) {\n\t\t\t\t\t\tconst oCardParams = (oCard.getManifestEntry(\"sap.card\") as ISapCard)?.configuration?.parameters;\n\t\t\t\t\t\tconst aRelevantFilters = oCardParams?._relevantODataFilters?.value || [];\n\t\t\t\t\t\tconst bRelevantFilters = aRelevantFilters?.length;\n\t\t\t\t\t\tconst aRelevantParams = oCardParams?._relevantODataParameters?.value || [];\n\t\t\t\t\t\tconst bRelevantParams = aRelevantParams?.length;\n\t\t\t\t\t\tconst oCardDataSource = (oCard.getManifestEntry(\"sap.app\") as ISapApp).dataSources;\n\t\t\t\t\t\tconst oFilterService = oCardDataSource?.filterService;\n\t\t\t\t\t\tconst oDataSourceSettings = oFilterService?.settings;\n\t\t\t\t\t\t// show ViewFilteredBy Option only if relevantFilters or relevantParameters are there and is OdataV2 version\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\t(bRelevantFilters || bRelevantParams) &&\n\t\t\t\t\t\t\toDataSourceSettings &&\n\t\t\t\t\t\t\toDataSourceSettings.odataVersion === \"2.0\"\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"Custom\",\n\t\t\t\ttext: this._i18nBundle?.getText(\"navigateToParent\") as string,\n\t\t\t\ticon: \"sap-icon://display-more\",\n\t\t\t\tvisible: async (oCard: Card) => {\n\t\t\t\t\treturn this._getManifestEntryFromCard(oCard, \"sap.insights\").then(async (oEntry: ICardManifest | undefined) => {\n\t\t\t\t\t\tif (oEntry) {\n\t\t\t\t\t\t\tconst parentApp = await this.cardHelperInstance.getParentAppDetails({\n\t\t\t\t\t\t\t\tdescriptorContent: oCard.getManifestEntry(\"/\") as ICardManifest\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (parentApp.semanticObject && parentApp.action) {\n\t\t\t\t\t\t\t\tconst navigationService = await Container.getServiceAsync<Navigation>(\"Navigation\");\n\t\t\t\t\t\t\t\tconst intents: TargetIntent[] = [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttarget: {\n\t\t\t\t\t\t\t\t\t\t\tsemanticObject: parentApp.semanticObject,\n\t\t\t\t\t\t\t\t\t\t\taction: parentApp.action\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\tconst aResponses = (await navigationService.isNavigationSupported(intents)) as { supported: boolean }[];\n\t\t\t\t\t\t\t\treturn aResponses[0].supported || false;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\taction: async (oCard: Card) => {\n\t\t\t\t\tconst parentApp = await this.cardHelperInstance.getParentAppDetails({\n\t\t\t\t\t\tdescriptorContent: oCard.getManifestEntry(\"/\") as ICardManifest\n\t\t\t\t\t});\n\t\t\t\t\tconst sShellHash = parentApp.semanticURL || parentApp.semanticObject;\n\t\t\t\t\tconst navigationService = await Container.getServiceAsync<Navigation>(\"Navigation\");\n\t\t\t\t\tawait navigationService.navigate({\n\t\t\t\t\t\ttarget: {\n\t\t\t\t\t\t\tshellHash: sShellHash\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\thost.attachAction(action);\n\t\thost.setProperty(\"actions\", actions);\n\t\tthis.setProperty(\"host\", host);\n\t}\n\n\t/**\n\t * Updates parameters for an old card extension\n\t * @private\n\t * @param {boolean} bOldCardExtension - Determines whether the card is using an old card extension.\n\t * @param {IcardActionEvent} oEvent - An event object\n\t * @param {ICardActionParameters} oParameters - Parameter object\n\t */\n\n\tprivate _manageOldCardExtension(bOldCardExtension: boolean, oEvent: IcardActionEvent, oParameters: ICardActionParameters) {\n\t\tif (bOldCardExtension) {\n\t\t\tconst oCardSV = new SelectionVariant();\n\t\t\tconst oCardParams = (oEvent.getParameter(\"card\") as Card).getCombinedParameters();\n\t\t\t(oCardParams?._relevantODataParameters as string[]).forEach((sParamName: string) => {\n\t\t\t\tif (oParameters.ibnParams) {\n\t\t\t\t\toParameters.ibnParams[sParamName] = oCardParams[sParamName];\n\t\t\t\t}\n\t\t\t});\n\t\t\t(oCardParams?._relevantODataFilters as string[]).forEach((sFilterName: string) => {\n\t\t\t\tconst oCardParamsFilterName = JSON.parse(oCardParams[sFilterName] as string) as {\n\t\t\t\t\tParameters: unknown;\n\t\t\t\t\tSelectOptions: { PropertyName: string; Ranges: { Sign: string; Option: string; Low: string }[] }[];\n\t\t\t\t};\n\t\t\t\tconst aSelectOptions = oCardParamsFilterName.SelectOptions[0];\n\t\t\t\tconst aRanges = aSelectOptions.Ranges;\n\t\t\t\tif (aRanges?.length === 1 && aRanges[0].Sign === \"I\" && aRanges[0].Option === \"EQ\") {\n\t\t\t\t\tif (oParameters.ibnParams) {\n\t\t\t\t\t\toParameters.ibnParams[sFilterName] = aRanges[0].Low;\n\t\t\t\t\t}\n\t\t\t\t} else if (aRanges?.length > 0) {\n\t\t\t\t\toCardSV.massAddSelectOption(sFilterName, aRanges);\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst oTempParam = JSON.parse(oParameters?.ibnParams?.[\"sap-xapp-state-data\"] as string) as Record<string, unknown>;\n\t\t\toTempParam.selectionVariant = oCardSV.toJSONObject();\n\t\t\tif (oParameters.ibnParams) {\n\t\t\t\toParameters.ibnParams[\"sap-xapp-state-data\"] = JSON.stringify(oTempParam);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves actions for a card based on its content type.\n\t *\n\t * @private\n\t * @param {ISapCard} manifest - The manifest object.\n\t * @returns {Array} The content actions.\n\t */\n\tprivate getContentActions(manifest: ISapCard): ICardAction[] {\n\t\tlet actions;\n\t\tif (manifest.type === \"List\") {\n\t\t\tactions = manifest?.content?.item?.actions;\n\t\t} else if (manifest.type === \"Table\") {\n\t\t\tactions = manifest?.content?.row?.actions;\n\t\t} else {\n\t\t\tactions = manifest?.content?.actions;\n\t\t}\n\t\treturn actions || [];\n\t}\n\n\t/**\n\t * Handles the completion of the import process.\n\t *\n\t * @private\n\t */\n\tprivate _importdone() {\n\t\tconst stateData = { status: true };\n\t\tthis.oEventBus.publish(\"importChannel\", \"cardsImported\", stateData);\n\t}\n\n\t/**\n\t * Refreshes the data for a given card.\n\t *\n\t * @private\n\t * @param {Card} oCard - The card to refresh.\n\t */\n\tprivate _refreshCardData(oCard: Card) {\n\t\tsap.ui.require([\"sap/insights/base/CacheData\"], (InsightsCacheData: InsightsCacheData) => {\n\t\t\tconst sCardId = (oCard.getManifestEntry(\"sap.app\") as ISapApp).id;\n\t\t\tconst cacheDataInstance = InsightsCacheData.getInstance();\n\t\t\tcacheDataInstance.clearCache(sCardId);\n\t\t\toCard.refreshData();\n\t\t});\n\t}\n\n\t/**\n\t * Triggers a full refresh of the Insights Cards's data and UI.\n\t *\n\t * Reloads all the user cards within the Insights Cards section by reinitializing relevant services\n\t * and re-rendering the panel.\n\t *\n\t * @public\n\t * @returns {Promise<void>} A promise that resolves once the Insights Cards section has been refreshed.\n\t */\n\tpublic async refreshData(): Promise<void> {\n\t\ttry {\n\t\t\tthis.cardHelperInstance = await (CardHelper as ICardHelper).getServiceAsync();\n\t\t\tawait this.cardHelperInstance._refreshUserCards(false);\n\t\t\tawait this.renderPanel();\n\t\t} catch (error) {\n\t\t\tLog.error(\"Failed to refresh cards: \", error instanceof Error ? error.message : (error as string));\n\t\t}\n\t}\n\n\t/**\n\t * Renders the panel.\n\t *\n\t * @private\n\t * @returns {Promise<void>} A promise that resolves when the panel is rendered.\n\t */\n\tpublic async renderPanel(): Promise<void> {\n\t\tif (!this.cardHelperInstance) {\n\t\t\tthis.cardHelperInstance = await (CardHelper as ICardHelper).getServiceAsync();\n\t\t}\n\t\tif (this.aiFlagEnabled === undefined) {\n\t\t\tawait this.updateAICardCreationStatus();\n\t\t}\n\t\tawait this.rerenderCards();\n\t\tthis.fireEvent(\"loaded\");\n\t}\n\n\t/**\n\t * Rerenders the cards.\n\t *\n\t * @private\n\t * @returns {Promise<void>} A promise that resolves when the cards are rerendered.\n\t */\n\tprivate async rerenderCards(skipRecommendation: boolean = false) {\n\t\tif (!this._cardsRendered) {\n\t\t\tthis._cardsRendered = new Promise((resolve, reject) => {\n\t\t\t\tvoid (async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Enable placeholders after updating/rerendering cards\n\t\t\t\t\t\tconst sDefaultAggreName = this._getCardContainer().getMetadata().getDefaultAggregationName();\n\n\t\t\t\t\t\tthis._getCardContainer().removeAllAggregation(sDefaultAggreName);\n\t\t\t\t\t\tthis._showPlaceHolders();\n\t\t\t\t\t\t// Fetch Cards from insights service\n\t\t\t\t\t\tconst userVisibleCardModel = await this.cardHelperInstance?._getUserVisibleCardModel();\n\t\t\t\t\t\tconst aCards = userVisibleCardModel.getProperty(\"/cards\") as ICard[];\n\t\t\t\t\t\tconst listBinding = userVisibleCardModel?.bindList(\"/cards\");\n\t\t\t\t\t\tif (!listBinding.hasListeners(\"change\")) {\n\t\t\t\t\t\t\tlistBinding?.enableExtendedChangeDetection(true, \"/cards\", {});\n\t\t\t\t\t\t\tlistBinding?.attachChange(async () => {\n\t\t\t\t\t\t\t\tawait (this._cardsRendered ?? Promise.resolve());\n\t\t\t\t\t\t\t\tconst visibleCards = userVisibleCardModel.getProperty(\"/cards\") as ICard[];\n\t\t\t\t\t\t\t\tif (visibleCards.length !== this.aVisibleCardInstances.length) {\n\t\t\t\t\t\t\t\t\tthis._showCards(visibleCards);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._controlModel.setProperty(\"/userVisibleCards\", aCards);\n\t\t\t\t\t\tlet showRecommendation = await this.getPersonalisationProperty(RECOMMENDATION_PATH);\n\t\t\t\t\t\tif (aCards.length === 0 && showRecommendation === undefined && !skipRecommendation) {\n\t\t\t\t\t\t\tawait this._getRecommendationCards();\n\t\t\t\t\t\t} else if (aCards.length) {\n\t\t\t\t\t\t\tif (showRecommendation === undefined) {\n\t\t\t\t\t\t\t\tawait this._updateRecommendationStatus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// from available cards, check for old recommended cards and update it if present,\n\t\t\t\t\t\t\t// else show available visible cards\n\t\t\t\t\t\t\tawait this.checkForRecommendedCards(aCards);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.fireHandleHidePanel();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._cardsRendered = undefined;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.fireHandleHidePanel();\n\t\t\t\t\t\tthis._cardsRendered = undefined;\n\t\t\t\t\t\tif (error instanceof Error) {\n\t\t\t\t\t\t\tLog.error(error.message);\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t});\n\t\t}\n\t\treturn this._cardsRendered;\n\t}\n\t/**\n\t * Sets the new visible cards in the model and updates the UI.\n\t * @private\n\t */\n\tprivate async setNewVisibleCards() {\n\t\tconst visibleCardModel = await this.cardHelperInstance._getUserVisibleCardModel();\n\t\tconst aNewCards = visibleCardModel.getProperty(\"/cards\") as ICard[];\n\t\tthis._controlModel.setProperty(\"/userVisibleCards\", aNewCards);\n\t\tthis._showCards(aNewCards);\n\t}\n\n\t/**\n\t * Checks for recommended cards and updates their manifests if necessary.\n\t *\n\t * This method iterates through the provided cards to identify recommended cards that need to be updated.\n\t * It regenerates the manifests for these cards, updates the model with the regenerated cards, and displays\n\t * the updated cards. If no recommended cards are found, it displays the original cards.\n\t *\n\t * @param {ICard[]} aCards - An array of card objects to check for recommendations.\n\t * Each card contains a `descriptorContent` property with metadata about the card.\n\t * @returns {Promise<void>} A promise that resolves when the check and updates are complete.\n\t * @private\n\t */\n\tprivate async checkForRecommendedCards(aCards: ICard[]): Promise<void> {\n\t\tlet manifestIds: ICardDetails[] = [];\n\t\taCards.forEach((oVisCard, idx) => {\n\t\t\tlet oCard = oVisCard.descriptorContent;\n\t\t\tif (\n\t\t\t\toCard[\"sap.card\"]?.rec === true &&\n\t\t\t\t(!oCard[\"sap.card\"][\"configuration\"] || !oCard[\"sap.card\"][\"configuration\"][\"csrfTokens\"])\n\t\t\t) {\n\t\t\t\tmanifestIds.push({\n\t\t\t\t\tcardId: oCard?.[\"sap.app\"]?.id as string,\n\t\t\t\t\trank: oCard?.[\"sap.insights\"]?.ranking || oVisCard?.rank,\n\t\t\t\t\tid: oCard?.[\"sap.insights\"]?.[\"parentAppId\"] || \"\",\n\t\t\t\t\ttarget: oCard?.[\"sap.card\"]?.[\"header\"]?.[\"actions\"]?.length\n\t\t\t\t\t\t? (oCard[\"sap.card\"][\"header\"][\"actions\"][0]?.[\"parameters\"] as ICardActionParameters)?.ibnTarget\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tindex: idx\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tif (manifestIds.length) {\n\t\t\tconst uniqueManifestDetails: ICardDetails[] = this.getUniqueManifestDetails(manifestIds);\n\t\t\tconst aUpdatedCards = await this.regenerateCards(uniqueManifestDetails, manifestIds);\n\t\t\tif (aUpdatedCards?.length) {\n\t\t\t\t// Update the model with updated cards\n\t\t\t\tawait this.cardHelperInstance._updateCards(\n\t\t\t\t\taUpdatedCards.map((oCard: ICardDetails) => oCard?.newManifest?.descriptorContent) as ICardManifest[]\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.setNewVisibleCards();\n\t\t} else {\n\t\t\tthis._showCards(aCards);\n\t\t}\n\t}\n\n\t/**\n\t * Filters and returns a list of unique manifest IDs.\n\t *\n\t * This method iterates through the provided list of manifest IDs and ensures that only unique entries\n\t * are included in the returned list. Uniqueness is determined based on the `id` and `target` properties.\n\t *\n\t * @param {ICardDetails[]} manifestIds - An array of manifest ID objects to filter for uniqueness.\n\t * Each object contains properties such as `id` and `target`.\n\t * @returns {ICardDetails[]} An array of unique manifest ID objects.\n\t * @private\n\t */\n\tprivate getUniqueManifestDetails(manifestIds: ICardDetails[]): ICardDetails[] {\n\t\tconst uniqueManifestDetails: ICardDetails[] = [];\n\t\tmanifestIds.forEach((item) => {\n\t\t\tconst exists = uniqueManifestDetails.some(\n\t\t\t\t(existingItem) => existingItem.id === item.id && targetsAreEqual(existingItem.target, item.target)\n\t\t\t);\n\t\t\tif (!exists) {\n\t\t\t\tuniqueManifestDetails.push(JSON.parse(JSON.stringify(item)) as ICardDetails);\n\t\t\t}\n\t\t});\n\t\treturn uniqueManifestDetails;\n\t}\n\n\t/**\n\t * Retrieves and processes card manifests based on the provided manifest IDs.\n\t *\n\t * This method fetches card manifests using the `AppManager` instance,\n\t * and removes duplicate regenerated cards to ensure uniqueness.\n\t *\n\t * @param {ICardDetails[]} manifestIds - An array of manifest ID objects to fetch and process.\n\t * Each object contains details such as `id`, `target`, and other card-specific properties.\n\t * @returns {Promise<ICardDetails[]>} A promise that resolves to an array of processed and unique card manifest details.\n\t * @private\n\t */\n\tprivate async _getManifests(manifestIds: ICardDetails[]): Promise<ICardDetails[]> {\n\t\t// from the provided manifestIds which are unique generate new recommended card manifests\n\t\tlet aManifests = await this.appManagerInstance._getCardManifest(undefined, manifestIds);\n\t\tif (aManifests?.length) {\n\t\t\tlet aRegeneratedCards = aManifests.map(function (oCard) {\n\t\t\t\tif (oCard?.[\"sap.card\"]) {\n\t\t\t\t\toCard[\"sap.card\"].rec = true;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tid: oCard[\"sap.app\"]?.id,\n\t\t\t\t\tdescriptorContent: oCard\n\t\t\t\t} as IRegeneratedCard;\n\t\t\t});\n\t\t\t// sometimes same card is recommended more than once, hence remove such duplicates\n\t\t\tlet mappedResults = this._removeDuplicateRegeneratedCards(aRegeneratedCards, manifestIds);\n\t\t\treturn mappedResults;\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Regenerates card manifests and updates the original manifest list with the regenerated data.\n\t *\n\t * This method fetches updated card manifests, maps them to their corresponding original cards,\n\t * and updates the `newManifest` property of the original cards. It ensures that the regenerated\n\t * cards are correctly associated with their original counterparts based on a unique key.\n\t *\n\t * @param {ICardDetails[]} manifestIds - An array of manifest ID objects to regenerate.\n\t * Each object contains details such as `id`, `target`, and other card-specific properties.\n\t * @param {ICardDetails[]} allManifestIds - An array of all manifest ID objects, including those\n\t * that need to be updated with regenerated manifests.\n\t * @returns {Promise<ICardDetails[] | undefined>} A promise that resolves to an array of updated card details,\n\t * or `undefined` if an error occurs.\n\t * @private\n\t */\n\tprivate async regenerateCards(manifestIds: ICardDetails[], allManifestIds: ICardDetails[]): Promise<ICardDetails[] | undefined> {\n\t\ttry {\n\t\t\tlet aMappedManifest = await this._getManifests(manifestIds);\n\n\t\t\t// create unique identifier for each card based on its id and target properties.\n\t\t\tconst createUniqueKey = (item: ICardDetails): string => {\n\t\t\t\tif (item?.target?.semanticObject && item?.target?.action) {\n\t\t\t\t\treturn item.id + \"|\" + item.target.semanticObject + \"|\" + item.target.action;\n\t\t\t\t}\n\t\t\t\treturn item.id; // Return just the id if the target is invalid\n\t\t\t};\n\n\t\t\tlet uniqueMap: Record<string, IRegeneratedCard> = {};\n\t\t\t// Create a map of unique keys to newManifest data\n\t\t\t// Iterate through the aMappedManifest array and populate the uniqueMap with unique keys and their corresponding newManifest data\n\t\t\t// This ensures that each unique key maps to its respective newManifest data, allowing for easy retrieval later.\n\t\t\t// This is done to avoid duplicates and ensure that each card is only represented once in the final output.\n\t\t\taMappedManifest.forEach(function (item) {\n\t\t\t\tlet uniqueKey = createUniqueKey(item);\n\t\t\t\tif (item.newManifest) {\n\t\t\t\t\tuniqueMap[uniqueKey] = item.newManifest;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet aUpdatedCards: ICardDetails[] = [];\n\t\t\tif (aMappedManifest.length) {\n\t\t\t\t// Map newManifest data back into allManifestIds based on the uniquekey\n\t\t\t\tallManifestIds.forEach(function (oCard) {\n\t\t\t\t\tlet uniqueKey = createUniqueKey(oCard);\n\t\t\t\t\t// Check if the uniqueKey exists in the uniqueMap, if present, assign the corresponding newManifest data to the oCard object\n\t\t\t\t\t// This effectively updates the oCard object with the newManifest data, allowing for further processing or rendering.\n\t\t\t\t\t// This is done to ensure that the original card objects are updated with the newManifest data, allowing for further processing or rendering.\n\t\t\t\t\tif (uniqueMap[uniqueKey]) {\n\t\t\t\t\t\toCard.newManifest = uniqueMap[uniqueKey];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newManifest = oCard[\"newManifest\"];\n\t\t\t\t\tconst descriptorContent = newManifest?.descriptorContent;\n\t\t\t\t\tif (descriptorContent) {\n\t\t\t\t\t\tdescriptorContent[\"sap.insights\"] = {\n\t\t\t\t\t\t\t...descriptorContent[\"sap.insights\"],\n\t\t\t\t\t\t\tranking: oCard.rank\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (descriptorContent[\"sap.app\"]) {\n\t\t\t\t\t\t\tdescriptorContent[\"sap.app\"].id = oCard.cardId;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnewManifest.id = oCard.cardId;\n\t\t\t\t\t\taUpdatedCards.push(JSON.parse(JSON.stringify(oCard)) as ICardDetails);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn aUpdatedCards;\n\t\t} catch (oError) {\n\t\t\tLog.error(oError instanceof Error ? oError.message : String(oError));\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Removes duplicate regenerated cards and maps them to their corresponding original cards.\n\t *\n\t * This method processes a list of regenerated cards and maps them to their corresponding original cards\n\t * based on their `id`. If a regenerated card matches an original card, it is added as the `newManifest`\n\t * property of the original card. The method ensures that each original card is updated with its corresponding\n\t * regenerated card, if available.\n\t *\n\t * @param {IRegeneratedCard[]} aCards - An array of regenerated cards. Each card contains a `descriptorContent` property\n\t * that includes metadata about the card.\n\t * @param {ICardDetails[]} aOriginalList - An array of original card details. Each card contains an `id` property\n\t * that is used to match it with regenerated cards.\n\t * @returns {ICardDetails[]} An array of original card details, with the `newManifest` property updated for cards\n\t * that have matching regenerated cards.\n\t * @private\n\t */\n\tprivate _removeDuplicateRegeneratedCards(aCards: IRegeneratedCard[], aOriginalList: ICardDetails[]): ICardDetails[] {\n\t\t// Create a mapping from aOriginalList for easy access (grouping by id)\n\t\tconst originalMap = {} as Record<string, ICardDetails>;\n\t\taOriginalList.forEach((originalItem) => {\n\t\t\tif (originalItem.id) {\n\t\t\t\toriginalMap[originalItem.id] = JSON.parse(JSON.stringify(originalItem)) as ICardDetails;\n\t\t\t}\n\t\t});\n\n\t\t// Process each card in aCards\n\t\taCards.forEach(function (oCard) {\n\t\t\tconst sCardId = oCard?.descriptorContent?.[\"sap.insights\"]?.parentAppId as string;\n\t\t\t// Check if we have a matching original list item\n\t\t\tif (sCardId && originalMap[sCardId]) {\n\t\t\t\tconst originalItem = originalMap[sCardId];\n\t\t\t\t// Check if updatedManifest already added\n\t\t\t\tif (!originalItem[\"newManifest\"]) {\n\t\t\t\t\t// Map newManifest to the original item\n\t\t\t\t\toriginalItem[\"newManifest\"] = oCard;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn Object.values(originalMap);\n\t}\n\n\t/**\n\t * Retrieves personalization data from the personalization service.\n\t *\n\t * This method ensures that the personalization service (`oPersonalizer`) is initialized\n\t * and fetches the latest personalization data. If no data is found, it returns an empty object.\n\t *\n\t * @private\n\t * @returns {Promise<IPersonalizationData>} A promise that resolves to the personalization data.\n\t * If no data is available, an empty object is returned.\n\t */\n\tprivate async _getPersonalizationData(): Promise<IPersonalizationData> {\n\t\tif (!this.oPersonalizer) {\n\t\t\tthis.oPersonalizer = await this._getPersonalization();\n\t\t}\n\t\tconst oPersData = await this.oPersonalizer.read();\n\t\treturn oPersData || {};\n\t}\n\n\t// Fetch personalization data property value\n\tprivate async getPersonalisationProperty(propertyKey: string) {\n\t\tconst oPersData = await this._getPersonalizationData();\n\t\treturn oPersData?.[propertyKey as keyof IPersonalizationData];\n\t}\n\n\t/**\n\t * Checks for recommendation cards.\n\t *\n\t * @private\n\t * @returns {Promise<void>} A promise that resolves when the check is complete.\n\t */\n\tprivate async _getRecommendationCards() {\n\t\tconst aRecommendedCards = await this.appManagerInstance.getRecommenedCards();\n\t\tif (aRecommendedCards?.length) {\n\t\t\treturn this._handleRecommendationCards(aRecommendedCards);\n\t\t}\n\t\tthis.fireHandleHidePanel();\n\t}\n\n\t/**\n\t * Handle Recommendation Cards\n\t * @param aRecommendedCards\n\t * @private\n\t */\n\tprivate async _handleRecommendationCards(aRecommendedCards: ICard[]) {\n\t\tconst cardManifests = aRecommendedCards.map((oCard) => oCard.descriptorContent);\n\t\tawait this.cardHelperInstance?._createCards(cardManifests);\n\t\tawait this._updateRecommendationStatus();\n\t\treturn this.setNewVisibleCards();\n\t}\n\n\t/**\n\t * Sets up the wrapper for the cards.\n\t *\n\t * @private\n\t */\n\tprivate _setupWrapper() {\n\t\tif (!this._cardsFlexWrapper) {\n\t\t\tthis._cardsFlexWrapper = new VBox(`${this.getId()}-cardsFlexWrapper`, {\n\t\t\t\trenderType: \"Bare\",\n\t\t\t\twidth: \"100%\",\n\t\t\t\titems: [this._createCardContainer(), this._createMobileCardContainer()]\n\t\t\t});\n\t\t\tthis._cardsFlexWrapper.setModel(this._controlModel);\n\t\t\tthis._addContent(this._cardsFlexWrapper);\n\t\t}\n\t}\n\n\t/**\n\t * Creates the card container.\n\t *\n\t * @private\n\t * @returns {GridContainer} The card container.\n\t */\n\tprivate _createCardContainer() {\n\t\tthis.cardsContainerSettings = new GridContainerSettings(`${this.getId()}-insightsCardsContainerSettings`, {\n\t\t\tcolumnSize: this.cardWidth,\n\t\t\trowSize: this.cardHeight,\n\t\t\tgap: \"1rem\"\n\t\t});\n\t\tthis.cardsContainer = new GridContainer(`${this.getId()}-insightsCardsFlexBox`, {\n\t\t\tvisible: \"{= !${/isPhone}}\"\n\t\t})\n\t\t\t.addStyleClass(\"sapUiSmallMarginTop\")\n\t\t\t.setLayout(this.cardsContainerSettings);\n\t\tthis.cardsContainer.setModel(this._controlModel);\n\t\tthis.addDragDropConfigTo(this.cardsContainer, (oEvent) => this._handleCardsDnd(oEvent));\n\n\t\treturn this.cardsContainer;\n\t}\n\n\t/**\n\t * Creates the mobile card container.\n\t *\n\t * @private\n\t * @returns {HeaderContainer} The mobile card container.\n\t */\n\tprivate _createMobileCardContainer() {\n\t\tthis.cardsMobileContainer = new HeaderContainer(`${this.getId()}-insightsCardsMobileFlexBox`, {\n\t\t\tscrollStep: 0,\n\t\t\tscrollStepByItem: 1,\n\t\t\tgridLayout: true,\n\t\t\tscrollTime: 1000,\n\t\t\tshowDividers: false,\n\t\t\tvisible: \"{/isPhone}\"\n\t\t});\n\t\tthis.cardsMobileContainer.setModel(this._controlModel);\n\t\tthis.addDragDropConfigTo(this.cardsMobileContainer, (oEvent) => this._handleCardsDnd(oEvent));\n\n\t\treturn this.cardsMobileContainer;\n\t}\n\n\t/**\n\t * Displays placeholder cards while loading.\n\t *\n\t * @private\n\t * @returns {void}\n\t */\n\tprivate _showPlaceHolders() {\n\t\tconst cardManifest = this.appManagerInstance._getAnalyticalCardManifest();\n\t\tconst placeholderArray = new Array(this._calculatePlaceholderCardCount()).fill(null);\n\t\tconst aInsightsCards = placeholderArray.map((_, index: number) => {\n\t\t\tconst card = new Card(recycleId(`${this.getId()}--placeHolderCard--${index}`), {\n\t\t\t\twidth: this.cardWidth,\n\t\t\t\theight: this.cardHeight,\n\t\t\t\tpreviewMode: \"Abstract\",\n\t\t\t\tmanifest: cardManifest,\n\t\t\t\thost: this.getProperty(\"host\") as Control\n\t\t\t}).addStyleClass(\"sapUiSmallMarginEnd\");\n\t\t\treturn card;\n\t\t});\n\t\t// Create Wrapper HBox for Card\n\t\tconst oPreviewHBox = new HBox(recycleId(`${this.getId()}--wrapperBox`), {\n\t\t\tjustifyContent: \"SpaceBetween\",\n\t\t\titems: aInsightsCards\n\t\t});\n\n\t\t// add HBox as item to GridList\n\t\tconst sDefaultAggreName = this._getCardContainer().getMetadata().getDefaultAggregationName();\n\t\tif (sDefaultAggreName) {\n\t\t\tthis._getCardContainer().addAggregation(sDefaultAggreName, oPreviewHBox);\n\t\t}\n\t}\n\n\t/**\n\t * Calculates the number of placeholder cards that can fit within the available container width.\n\t *\n\t * @private\n\t * @returns {number} The number of placeholder cards that should be displayed. Defaults to 1 if no valid count is determined.\n\t */\n\tprivate _calculatePlaceholderCardCount(): number {\n\t\tconst layoutDomRef = this._getInsightsContainer()?._getLayout()?.getDomRef();\n\t\tlet count = 0;\n\t\tif (layoutDomRef) {\n\t\t\tconst sectionDomRef = layoutDomRef.childNodes[0] as Element;\n\t\t\tconst domProperties = fetchElementProperties(sectionDomRef, [\"width\", \"padding-left\", \"padding-right\"]);\n\t\t\tlet availableWidth = domProperties.width - domProperties[\"padding-left\"] - domProperties[\"padding-right\"];\n\t\t\tconst cardLayoutConfig = {\n\t\t\t\tcontainerWidth: availableWidth,\n\t\t\t\ttotalCards: Constants.PLACEHOLDER_CARD_COUNT,\n\t\t\t\tminWidth: 304,\n\t\t\t\tmaxWidth: 583\n\t\t\t};\n\t\t\tconst cardWidth = this.getDeviceType() === DeviceType.Mobile ? 19 : calculateCardWidth(cardLayoutConfig);\n\n\t\t\t// Calculate and log the number of cards that can fit\n\t\t\tcount =\n\t\t\t\tthis.getDeviceType() === DeviceType.Mobile\n\t\t\t\t\t? this.aVisibleCardInstances.length\n\t\t\t\t\t: Math.floor(availableWidth / (cardWidth + Constants.CARDS_GAP));\n\t\t\tthis.cardWidth = `${cardWidth / 16}rem`;\n\t\t}\n\n\t\treturn count || 1;\n\t}\n\n\t/**\n\t * Displays the cards.\n\t *\n\t * @private\n\t * @param {ICard[]} aCards - The cards to display.\n\t */\n\tprivate _showCards(aCards: ICard[]) {\n\t\tconst panelName = this.getMetadata().getName();\n\t\tthis.fireHandleUnhidePanel();\n\t\tthis._getInsightsContainer()?.updatePanelsItemCount(aCards.length, panelName);\n\t\tif (this._headerVisible) {\n\t\t\tthis.setProperty(\n\t\t\t\t\"title\",\n\t\t\t\t`${this._i18nBundle?.getText(\"insights\")} ${this._i18nBundle.getText(\"insightsCardsTitle\")} (${aCards.length})`\n\t\t\t);\n\t\t}\n\t\tconst sDefaultAggreName = this._getCardContainer().getMetadata().getDefaultAggregationName();\n\t\tthis._getCardContainer().removeAllAggregation(sDefaultAggreName);\n\t\tthis.aVisibleCardInstances = [];\n\t\tthis.cardsInViewport = [];\n\n\t\t// Setup Host For Cards\n\t\tif (!runtimeHostCreated) {\n\t\t\tthis._addRuntimeHost();\n\t\t\truntimeHostCreated = true;\n\t\t}\n\n\t\taCards.forEach((oCard, index) => {\n\t\t\tconst manifest = oCard.descriptorContent;\n\t\t\t// Create Card Instance\n\t\t\tconst oUserCard = new Card(recycleId(`${this.getId()}--userCard--${index}`), {\n\t\t\t\twidth: this.cardWidth,\n\t\t\t\theight: this.cardHeight,\n\t\t\t\tmanifest,\n\t\t\t\thost: this.getProperty(\"host\") as Control\n\t\t\t});\n\n\t\t\tthis.aVisibleCardInstances.push(oUserCard);\n\n\t\t\tthis.addAggregation(\"cards\", oUserCard, true);\n\n\t\t\tconst items: Control[] = [oUserCard];\n\n\t\t\t// Add overlay in case of List and Table Card\n\t\t\tconst sType = manifest[\"sap.card\"]?.type;\n\t\t\tif (sType === \"Table\" || sType === \"List\") {\n\t\t\t\tconst overlay = new HBox(recycleId(`${this.getId()}--overlay--${index}`), {\n\t\t\t\t\twidth: this.cardWidth,\n\t\t\t\t\theight: \"2rem\"\n\t\t\t\t}).addStyleClass(\"insightsCardOverflowTop\");\n\t\t\t\tconst overlayHBoxWrapper = new HBox(recycleId(`${this.getId()}--overlayHBoxId--${index}`), {\n\t\t\t\t\theight: \"0\"\n\t\t\t\t}).addStyleClass(\"sapMFlexBoxJustifyCenter\");\n\t\t\t\toverlayHBoxWrapper.addItem(overlay);\n\t\t\t\titems.push(overlayHBoxWrapper);\n\t\t\t}\n\n\t\t\t// Create Wrapper VBox for Card\n\t\t\tconst oPreviewVBox = new VBox(recycleId(`${this.getId()}--previewBoxId--${index}`), {\n\t\t\t\tdirection: \"Column\",\n\t\t\t\tjustifyContent: \"Center\",\n\t\t\t\titems: items\n\t\t\t});\n\n\t\t\t// add VBox as item to GridList\n\t\t\tconst sDefaultAggreName = this._getCardContainer().getMetadata().getDefaultAggregationName();\n\t\t\tthis._getCardContainer().addAggregation(sDefaultAggreName, oPreviewVBox);\n\t\t});\n\t}\n\n\t/**\n\t * Handles the edit cards event.\n\t *\n\t * @private\n\t * @param {Event} event - The event object.\n\t */\n\tprivate _handleEditCards(event: Event) {\n\t\t/* If called from Panel Header event.source() will return TilesPanel, if called from Insights Container event.source() will return InsightsContainer.\n\t\t_getLayout is available at Container Level*/\n\t\tlet parent: ManagedObject = event.getSource<CardsPanel>().getParent() || this;\n\t\tif (parent?.isA(\"sap.cux.home.CardsPanel\")) {\n\t\t\tparent = parent.getParent() as ManagedObject;\n\t\t}\n\t\t(parent as InsightsContainer)?._getLayout().openSettingsDialog(SETTINGS_PANELS_KEYS.INSIGHTS_CARDS);\n\t}\n\n\t/**\n\t * Hides the header of the cards panel.\n\t *\n\t * @private\n\t */\n\tpublic handleHideHeader() {\n\t\tthis._headerVisible = false;\n\t\tthis.setProperty(\"title\", \"\");\n\t\tthis._toggleHeaderActions(false);\n\t}\n\n\t/**\n\t * Adds the header to the cards panel.\n\t *\n\t * @private\n\t */\n\tpublic handleAddHeader() {\n\t\tthis._headerVisible = true;\n\t\tthis.setProperty(\n\t\t\t\"title\",\n\t\t\t`${this._i18nBundle?.getText(\"insights\")} ${this._i18nBundle.getText(\"insightsCardsTitle\")} (${(this._controlModel.getProperty(\"/userVisibleCards\") as ICard[])?.length})`\n\t\t);\n\t\tthis._toggleHeaderActions(true);\n\t}\n\n\t/**\n\t * Refreshes the cards.\n\t *\n\t * @private\n\t */\n\tprivate refreshCards() {\n\t\t// This should be done via Host once implemented\n\t\tthis.aVisibleCardInstances.forEach((card) => this._refreshCardData(card));\n\t}\n\n\t/**\n\t * Handles the drag and drop of cards.\n\t *\n\t * @private\n\t * @param {Event<DropInfo$DropEventParameters>} oEvent - The drop event parameters.\n\t */\n\tprivate async _handleCardsDnd(oEvent: Event<DropInfo$DropEventParameters>) {\n\t\tconst sInsertPosition = oEvent.getParameter(\"dropPosition\") as string,\n\t\t\toDragItem = oEvent.getParameter(\"draggedControl\") as Control,\n\t\t\tiDragItemIndex = (oDragItem.getParent() as GridContainer)?.indexOfItem(oDragItem),\n\t\t\toDropItem = oEvent.getParameter(\"droppedControl\") as Control,\n\t\t\tiDropItemIndex = (oDragItem.getParent() as GridContainer).indexOfItem(oDropItem);\n\n\t\tthis._cardsFlexWrapper?.setBusy(true);\n\t\t// take the moved item from dragIndex and add to dropindex\n\t\ttry {\n\t\t\tif (!(this._controlModel.getProperty(\"/userAllCards\") as ICard[]).length) {\n\t\t\t\tconst userAllCardsModel = await this.cardHelperInstance._getUserAllCardModel();\n\t\t\t\tthis._controlModel.setProperty(\"/userAllCards\", userAllCardsModel.getProperty(\"/cards\"));\n\t\t\t\tawait this.updateCardList(sInsertPosition, iDropItemIndex, iDragItemIndex);\n\t\t\t} else {\n\t\t\t\tawait this.updateCardList(sInsertPosition, iDropItemIndex, iDragItemIndex);\n\t\t\t}\n\t\t\tsetTimeout(() => {\n\t\t\t\tfocusDraggedItem(this._getCardContainer(), iDropItemIndex);\n\t\t\t}, 0);\n\t\t} catch (error) {\n\t\t\tif (error instanceof Error) {\n\t\t\t\tLog.error(error.message);\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._cardsFlexWrapper?.setBusy(false);\n\t\t}\n\t}\n\n\t/**\n\t * Updates the card list based on the drag and drop operation.\n\t *\n\t * @private\n\t * @param {string} sInsertPosition - The position to insert the item.\n\t * @param {number} iDropItemIndex - The index of the dropped item.\n\t * @param {number} iDragItemIndex - The index of the dragged item.\n\t * @returns {Promise<void>} A promise that resolves when the card list is updated.\n\t */\n\tprivate async updateCardList(sInsertPosition: string, iDropItemIndex: number, iDragItemIndex: number) {\n\t\tconst aUserVisibleCards = this._controlModel.getProperty(\"/userVisibleCards\") as ICard[],\n\t\t\taUserAllCards = this._controlModel.getProperty(\"/userAllCards\") as ICard[],\n\t\t\tsDragedPositionRank = aUserVisibleCards[iDragItemIndex]?.rank,\n\t\t\tsDropedPositionRank = aUserVisibleCards[iDropItemIndex]?.rank;\n\t\tlet iUpdatedDragItemIndex = aUserAllCards.findIndex((oCard: ICard) => oCard.rank === sDragedPositionRank),\n\t\t\tiUpdatedDropItemIndex = aUserAllCards.findIndex((oCard: ICard) => oCard.rank === sDropedPositionRank);\n\n\t\tif (\n\t\t\t(sInsertPosition === \"Before\" && iDragItemIndex === iDropItemIndex - 1) ||\n\t\t\t(sInsertPosition === \"After\" && iDragItemIndex === iDropItemIndex + 1) ||\n\t\t\tiDragItemIndex === iDropItemIndex\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tif (sInsertPosition === \"Before\" && iUpdatedDragItemIndex < iUpdatedDropItemIndex) {\n\t\t\tiUpdatedDropItemIndex--;\n\t\t} else if (sInsertPosition === \"After\" && iUpdatedDragItemIndex > iUpdatedDropItemIndex) {\n\t\t\tiUpdatedDropItemIndex++;\n\t\t}\n\t\tif (iUpdatedDragItemIndex !== iUpdatedDropItemIndex) {\n\t\t\tconst aUpdatedCards = this.cardHelperInstance.handleDndCardsRanking(\n\t\t\t\tiUpdatedDragItemIndex,\n\t\t\t\tiUpdatedDropItemIndex,\n\t\t\t\taUserAllCards\n\t\t\t);\n\t\t\tawait this.cardHelperInstance._updateMultipleCards(aUpdatedCards, \"PUT\");\n\t\t\tthis._sortCardsOnRank(aUserAllCards);\n\t\t\tthis._controlModel.setProperty(\"/userAllCards\", aUserAllCards);\n\t\t\tthis._controlModel.setProperty(\n\t\t\t\t\"/userVisibleCards\",\n\t\t\t\taUserAllCards.filter((oCard: ICard) => oCard.visibility)\n\t\t\t);\n\t\t\tawait this.rerenderCards();\n\t\t}\n\t}\n\n\t/**\n\t * Sorts the cards based on their rank property.\n\t *\n\t * @private\n\t * @param {ICard[]} aCards - The array of cards to sort.\n\t */\n\tprivate _sortCardsOnRank(aCards: ICard[]) {\n\t\t// Sort Cards based on it rank property where rank is a alphanumeric string\n\t\taCards.sort((a, b) => {\n\t\t\tif (a.rank && b.rank) {\n\t\t\t\tif (a.rank < b.rank) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (a.rank > b.rank) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\t/**\n\t * Retrieves the personalization instance.\n\t *\n\t * @private\n\t * @returns {UShellPersonalizer} The personalization instance.\n\t */\n\tpublic _getPersonalization() {\n\t\tconst persContainerId = PersonalisationUtils.getPersContainerId(this);\n\t\tconst ownerComponent = PersonalisationUtils.getOwnerComponent(this) as Component;\n\t\treturn UShellPersonalizer.getInstance(persContainerId, ownerComponent);\n\t}\n\n\t/**\n\t * Updates the recommendation status based on the feature toggle.\n\t * @returns {Promise} A promise that resolves when the recommendation status is updated.\n\t */\n\tprivate async _updateRecommendationStatus() {\n\t\tconst oPersData = await this._getPersonalizationData();\n\t\toPersData[RECOMMENDATION_PATH] = true;\n\t\treturn this.oPersonalizer.write(oPersData);\n\t}\n\n\t/**\n\t * Calculates the number of visible cards that can fit within the available width of the parent container.\n\t *\n\t * @private\n\t * @returns {number} - The number of visible cards.\n\t */\n\tprivate _calculateVisibleCardCount() {\n\t\tconst layout = this._getInsightsContainer()._getLayout();\n\t\tconst pageDomRef = layout.getDomRef();\n\t\tconst deviceType = this.getDeviceType();\n\t\tlet count = 1;\n\n\t\tif (pageDomRef) {\n\t\t\tconst isHeaderVisible = layout.getProperty(\"showHeader\") as boolean;\n\t\t\tconst sectionNodeIndex = isHeaderVisible ? 1 : 0;\n\t\t\tconst sectionDomRef = pageDomRef.childNodes[sectionNodeIndex] as Element;\n\t\t\tconst domProperties = fetchElementProperties(sectionDomRef, [\"width\", \"padding-left\", \"padding-right\"]);\n\t\t\tconst iAvailableWidth = domProperties.width - domProperties[\"padding-left\"] - domProperties[\"padding-right\"];\n\t\t\tconst totalCards = this.aVisibleCardInstances.length;\n\n\t\t\tconst cardLayoutConfig = { containerWidth: iAvailableWidth, totalCards: totalCards, minWidth: 304, maxWidth: 583 };\n\t\t\tconst cardWidth = calculateCardWidth(cardLayoutConfig);\n\t\t\tthis.cardWidth = `${cardWidth / 16}rem`;\n\t\t\tif (deviceType === DeviceType.Mobile) {\n\t\t\t\tcount = totalCards;\n\t\t\t} else {\n\t\t\t\t// Multiply by 16 because `cardWidth` is in rems\n\t\t\t\tcount = Math.max(Math.floor(iAvailableWidth / cardWidth), 1);\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t}\n\n\t/**\n\t * Adjusts the layout of the cards panel based on the current layout and device type.\n\t *\n\t * @private\n\t * @override\n\t */\n\tpublic _adjustLayout() {\n\t\tconst layout = this._getInsightsContainer()?._getLayout();\n\t\tlet cardWidth = this.cardWidth;\n\t\tconst isMobileDevice = this.getDeviceType() === DeviceType.Mobile;\n\n\t\tif (layout && this.aVisibleCardInstances?.length > 0) {\n\t\t\tconst isElementExpanded = layout._getCurrentExpandedElementName() === this.getProperty(\"fullScreenName\");\n\n\t\t\t//_calculateVisibleCardCount needs to be called in all scenarios to get the correct card width according to device width.\n\t\t\t//if expanded, again the card count is reset to available cards count\n\t\t\tlet cardCount = this._calculateVisibleCardCount();\n\t\t\tif (isElementExpanded) {\n\t\t\t\tcardCount = this.aVisibleCardInstances.length;\n\t\t\t}\n\t\t\tthis._controlModel.setProperty(\"/isPhone\", isMobileDevice);\n\n\t\t\t// update cards in viewport\n\t\t\tif (cardCount !== this.cardsInViewport.length) {\n\t\t\t\tthis.cardsInViewport = this.aVisibleCardInstances.slice(0, cardCount);\n\n\t\t\t\tconst sDefaultAggreName = this._getCardContainer().getMetadata().getDefaultAggregationName();\n\t\t\t\tthis._getCardContainer().removeAllAggregation(sDefaultAggreName);\n\t\t\t\tthis.cardsInViewport.forEach((card) => {\n\t\t\t\t\tconst manifest = card.getManifest() as ICardManifest;\n\t\t\t\t\tconst sType = manifest[\"sap.card\"]?.type;\n\t\t\t\t\tlet overlayHBoxWrapper!: HBox;\n\t\t\t\t\tif (sType === \"Table\" || sType === \"List\") {\n\t\t\t\t\t\tconst overlay = new HBox({\n\t\t\t\t\t\t\twidth: this.cardWidth,\n\t\t\t\t\t\t\theight: \"2rem\"\n\t\t\t\t\t\t}).addStyleClass(\"insightsCardOverflowLayer insightsCardOverflowTop\");\n\t\t\t\t\t\toverlayHBoxWrapper = new HBox({\n\t\t\t\t\t\t\theight: \"0\"\n\t\t\t\t\t\t}).addStyleClass(\"sapMFlexBoxJustifyCenter\");\n\t\t\t\t\t\toverlayHBoxWrapper.addItem(overlay);\n\t\t\t\t\t}\n\t\t\t\t\tconst cardWrapper = new VBox({\n\t\t\t\t\t\tdirection: \"Column\",\n\t\t\t\t\t\tjustifyContent: \"Center\",\n\t\t\t\t\t\titems: [card]\n\t\t\t\t\t});\n\t\t\t\t\tif (overlayHBoxWrapper) {\n\t\t\t\t\t\tcardWrapper.addItem(overlayHBoxWrapper);\n\t\t\t\t\t}\n\t\t\t\t\tconst sDefaultAggreName = this._getCardContainer().getMetadata().getDefaultAggregationName();\n\t\t\t\t\tthis._getCardContainer().addAggregation(sDefaultAggreName, cardWrapper);\n\t\t\t\t});\n\n\t\t\t\tthis.shareCardsInViewport();\n\t\t\t}\n\n\t\t\t// show/hide Full Screen Button if available\n\t\t\tconst showFullScreenButton = isElementExpanded || this.aVisibleCardInstances.length > cardCount;\n\t\t\tif (this._headerVisible) {\n\t\t\t\tthis._getInsightsContainer()?.toggleFullScreenElements(this, showFullScreenButton);\n\t\t\t} else {\n\t\t\t\tconst fullScreenButton = getAssociatedFullScreenMenuItem(this);\n\t\t\t\tconst fullScreenText = fullScreenButton.getTitle();\n\t\t\t\tthis._getInsightsContainer()?.updateMenuItem(\n\t\t\t\t\tthis._controlMap.get(`${this.getId()}-${cardsContainerMenuItems.SHOW_MORE}`) as MenuItem,\n\t\t\t\t\tshowFullScreenButton,\n\t\t\t\t\tfullScreenText\n\t\t\t\t);\n\t\t\t\tthis._getInsightsContainer()?.updateActionButton(\n\t\t\t\t\tthis._controlMap.get(`${this.getId()}-${cardsContainerActionButtons.SHOW_MORE}`) as Button,\n\t\t\t\t\tshowFullScreenButton,\n\t\t\t\t\tfullScreenText\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.cardWidth = this.getDeviceType() === DeviceType.Mobile ? \"19rem\" : \"22rem\";\n\t\t}\n\n\t\t// update width of cards on resize\n\t\tif (cardWidth !== this.cardWidth) {\n\t\t\tthis.aVisibleCardInstances.forEach((card) => card.setWidth(this.cardWidth));\n\t\t\tthis.cardsContainerSettings?.setColumnSize(this.cardWidth);\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves the menu items for the container.\n\t *\n\t * @private\n\t * @returns {MenuItem[]} An array of MenuItem instances.\n\t */\n\tpublic getContainerMenuItems(): MenuItem[] {\n\t\tif (!this._containerMenuItems) {\n\t\t\tconst containerRefreshMenuItem = this._createRefreshMenuItem(cardsContainerMenuItems.REFRESH, \"containerCardsRefresh\");\n\t\t\tconst containerEditCardsMenuItem = this._createEditCardsMenuItem(cardsContainerMenuItems.EDIT_CARDS, \"containerManageCards\");\n\t\t\tconst containerShowMoreMenuItem = createShowMoreMenuItem(this, cardsContainerMenuItems.SHOW_MORE, \"containerCardsShowMore\");\n\t\t\tthis._controlMap.set(`${this.getId()}-${cardsContainerMenuItems.SHOW_MORE}`, containerShowMoreMenuItem);\n\t\t\tthis._containerMenuItems = [containerRefreshMenuItem, containerEditCardsMenuItem, containerShowMoreMenuItem];\n\t\t}\n\t\treturn this._containerMenuItems;\n\t}\n\n\t/**\n\t * Retrieves the action buttons for the container.\n\t *\n\t * @private\n\t * @returns {Button[]} An array of Button instances.\n\t */\n\tpublic getContainerActionButtons(): Button[] {\n\t\tif (!this._containerActionButtons) {\n\t\t\tthis._containerActionButtons = [];\n\t\t\tconst actionButton = createShowMoreActionButton(this, cardsContainerActionButtons.SHOW_MORE, \"containerCardsShowMore\");\n\t\t\tif (actionButton) {\n\t\t\t\tthis._controlMap.set(`${this.getId()}-${cardsContainerActionButtons.SHOW_MORE}`, actionButton);\n\t\t\t\tthis._containerActionButtons.push(actionButton);\n\t\t\t}\n\t\t}\n\n\t\treturn this._containerActionButtons;\n\t}\n\n\t/**\n\t * Retrieves the insights container.\n\t *\n\t * @private\n\t * @returns {InsightsContainer} - The insights container.\n\t */\n\tprivate _getInsightsContainer(): InsightsContainer {\n\t\tif (!this.insightsContainer) {\n\t\t\tthis.insightsContainer = this.getParent() as InsightsContainer;\n\t\t}\n\t\treturn this.insightsContainer;\n\t}\n\n\t/**\n\t * Creates the refresh menu item.\n\t *\n\t * @param {string} id - The ID of the menu item.\n\t * @param {string} fesrId - The FESR ID of the menu item.\n\t * @returns {MenuItem} - The created menu item.\n\t * @private\n\t */\n\tprivate _createRefreshMenuItem(id: string, fesrId?: string): MenuItem {\n\t\tconst menuItem = new MenuItem(`${this.getId()}-${id}`, {\n\t\t\ttitle: this._i18nBundle.getText(\"refresh\"),\n\t\t\ticon: \"sap-icon://refresh\",\n\t\t\tvisible: false,\n\t\t\tpress: () => this.refreshCards()\n\t\t});\n\t\tthis._controlMap.set(`${this.getId()}-${id}`, menuItem);\n\t\tif (fesrId) {\n\t\t\taddFESRId(menuItem, fesrId);\n\t\t}\n\n\t\treturn menuItem;\n\t}\n\n\t/**\n\t * Creates the edit cards menu item.\n\t *\n\t * @param {string} id - The ID of the menu item.\n\t * @param {string} fesrId - The FESR ID of the menu item.\n\t * @returns {MenuItem} - The created menu item.\n\t * @private\n\t */\n\tprivate _createEditCardsMenuItem(id: string, fesrId?: string): MenuItem {\n\t\tconst menuItem = new MenuItem(`${this.getId()}-${id}`, {\n\t\t\ttitle: this._i18nBundle.getText(\"manageCards\"),\n\t\t\ticon: \"sap-icon://edit\",\n\t\t\tvisible: false,\n\t\t\tpress: (event: Event) => this._handleEditCards(event)\n\t\t});\n\t\tthis._controlMap.set(`${this.getId()}-${id}`, menuItem);\n\t\tif (fesrId) {\n\t\t\taddFESRId(menuItem, fesrId);\n\t\t}\n\t\treturn menuItem;\n\t}\n\n\t/**\n\t * Creates the Add Insight cards menu item.\n\t *\n\t * @param {string} id - The ID of the menu item.\n\t * @param {string} fesrId - The FESR ID of the menu item.\n\t * @returns {MenuItem} - The created menu item.\n\t * @private\n\t */\n\tprivate _createAddInsightCardMenuItem(id: string, fesrId?: string): MenuItem {\n\t\tconst menuItem = new MenuItem(`${this.getId()}-${id}`, {\n\t\t\ttitle: this._i18nBundle.getText(\"addInsightsCard\"),\n\t\t\ticon: \"sap-icon://duplicate\",\n\t\t\tvisible: false,\n\t\t\tpress: () => this._generateInsightCardsWithAI()\n\t\t});\n\t\tthis._controlMap.set(`${this.getId()}-${id}`, menuItem);\n\t\tif (fesrId) {\n\t\t\taddFESRId(menuItem, fesrId);\n\t\t}\n\t\treturn menuItem;\n\t}\n\n\t/**\n\t * Generates insight cards using AI. The showAddCardWithSearchDialog method of the card helper service instance\n\t * is called with  a callback which updates the control model with the visible cards\n\t * @private\n\t */\n\tprivate _generateInsightCardsWithAI() {\n\t\tthis.cardHelperInstance.showAddCardWithSearchDialog(async () => {\n\t\t\tawait this.rerenderCards(true);\n\t\t});\n\t}\n\n\t/**\n\t * Checks if the current device type is a desktop.\n\t *\n\t * @returns {boolean} True if the device is not a mobile or tablet, otherwise false.\n\t */\n\tprivate _isDesktopDevice(): boolean {\n\t\tconst deviceType = this.getDeviceType();\n\t\treturn deviceType !== DeviceType.Mobile && deviceType !== DeviceType.Tablet;\n\t}\n\n\t/**\n\t * Returns AI_GENERATED_CARD feature toggle status and set the value to addAICardFlagEnabled\n\t * @private\n\t */\n\tpublic async updateAICardCreationStatus(): Promise<void> {\n\t\tlet aPromises = [\n\t\t\tContainer.getServiceAsync<Navigation>(\"Navigation\"),\n\t\t\tthis.appManagerInstance.isFeatureEnabled(FEATURE_TOGGLES.AI_GENERATED_CARD)\n\t\t];\n\t\treturn await Promise.all(aPromises).then((aResult) => {\n\t\t\tlet oNavigationService = aResult[0] as Navigation;\n\t\t\tlet enabled: boolean = aResult[1] as boolean;\n\t\t\t// if smart toggle enabled check if navigation supported\n\t\t\tif (enabled) {\n\t\t\t\toNavigationService\n\t\t\t\t\t.isNavigationSupported([\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: {\n\t\t\t\t\t\t\t\tsemanticObject: \"IntelligentPrompt\",\n\t\t\t\t\t\t\t\taction: \"personalize\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t])\n\t\t\t\t\t.then((aResponses) => {\n\t\t\t\t\t\tthis.aiFlagEnabled = aResponses[0].supported || false;\n\t\t\t\t\t\tif (this.aiFlagEnabled && this._isDesktopDevice()) {\n\t\t\t\t\t\t\tconst addInsightCardMenuItem = this._createAddInsightCardMenuItem(\n\t\t\t\t\t\t\t\tcardsMenuItems.AI_INSIGHT_CARD,\n\t\t\t\t\t\t\t\t\"AddAIInsightCard\"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.addAggregation(\"menuItems\", addInsightCardMenuItem);\n\t\t\t\t\t\t\tthis._sortMenuItems(sortedMenuItems);\n\t\t\t\t\t\t\tconst containerAddInsightMenuItem = this._createAddInsightCardMenuItem(\n\t\t\t\t\t\t\t\tcardsContainerMenuItems.AI_INSIGHT_CARD,\n\t\t\t\t\t\t\t\t\"AddAIInsightCard\"\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst CardsPanelName = this.getMetadata().getName();\n\t\t\t\t\t\t\tconst InsightsContainerName = this._getInsightsContainer().getMetadata().getName();\n\t\t\t\t\t\t\tconst parentContainerContent = this._getInsightsContainer().getContent();\n\t\t\t\t\t\t\tconst TilesPanelName =\n\t\t\t\t\t\t\t\tparentContainerContent\n\t\t\t\t\t\t\t\t\t.find((panel) => panel instanceof TilesPanel)\n\t\t\t\t\t\t\t\t\t?.getMetadata()\n\t\t\t\t\t\t\t\t\t?.getName() || \"\";\n\n\t\t\t\t\t\t\t// Check if the specific panels exist within the insights container\n\t\t\t\t\t\t\tconst cardPanelExist = checkPanelExists(this.insightsContainer, InsightsContainerName, CardsPanelName);\n\t\t\t\t\t\t\tconst tilePanelExist = checkPanelExists(this.insightsContainer, InsightsContainerName, TilesPanelName);\n\n\t\t\t\t\t\t\t// Apply visibility settings to the respective menu items\n\t\t\t\t\t\t\tcontainerAddInsightMenuItem.setVisible(!cardPanelExist || !tilePanelExist);\n\t\t\t\t\t\t\taddInsightCardMenuItem.setVisible(cardPanelExist && tilePanelExist);\n\n\t\t\t\t\t\t\t// call addcommonmenuitems so that the new menuitem is added to the container\n\t\t\t\t\t\t\tthis.insightsContainer?.addCommonMenuItems([containerAddInsightMenuItem]);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tLog.warning(error instanceof Error ? error.message : String(error));\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Toggles the visibility of the header actions.\n\t *\n\t * @param {boolean} bShow - Whether to show or hide the header actions.\n\t * @private\n\t */\n\tprivate _toggleHeaderActions(bShow: boolean) {\n\t\t(this.getAggregation(\"menuItems\") as MenuItem[])?.forEach((menuItem) => {\n\t\t\tthis._getInsightsContainer()?.toggleMenuListItem(menuItem, bShow);\n\t\t});\n\t\t(this.getAggregation(\"actionButtons\") as Button[])?.forEach((actionButton) =>\n\t\t\tthis._getInsightsContainer()?.toggleActionButton(actionButton, bShow)\n\t\t);\n\t}\n\n\t/**\n\t * Retrieves the card container based on the device type.\n\t *\n\t * @private\n\t * @returns {GridContainer | HeaderContainer} - The card container.\n\t *\n\t */\n\tprivate _getCardContainer() {\n\t\tif (this.getDeviceType() === DeviceType.Mobile) {\n\t\t\treturn this.cardsMobileContainer;\n\t\t}\n\t\treturn this.cardsContainer;\n\t}\n\n\t/**\n\t * Sorts the menu items based on the provided order.\n\t *\n\t * @private\n\t * @param {string[]} menuItems - The order of the menu items.\n\t */\n\tprivate _sortMenuItems(menuItems: string[]) {\n\t\tconst panelMenuItems = this.getAggregation(\"menuItems\") as MenuItem[];\n\t\tlet sortedMenuItems = sortMenuItems(menuItems, panelMenuItems);\n\t\tthis.removeAllAggregation(\"menuItems\");\n\t\tsortedMenuItems?.forEach((menuItem) => this.addAggregation(\"menuItems\", menuItem));\n\t}\n\n\t/**\n\t * Shares the cards that are currently in the viewport by firing the \"visibleCardsUpdated\" event.\n\t *\n\t * @private\n\t */\n\tprivate shareCardsInViewport() {\n\t\tconst cardCount = this._calculateVisibleCardCount();\n\t\tconst visibleCards = this._controlModel.getProperty(\"/userVisibleCards\") as ICard[];\n\t\tconst cardsInViewport = visibleCards?.slice(0, cardCount);\n\t\tif (cardsInViewport?.length) {\n\t\t\tthis.fireEvent(\"visibleCardsUpdated\", { cards: cardsInViewport });\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}