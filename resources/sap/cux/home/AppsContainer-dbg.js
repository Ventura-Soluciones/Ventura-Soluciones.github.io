/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/GenericTile","sap/m/Panel","sap/m/library","sap/ui/core/EventBus","sap/ui/core/theming/Parameters","sap/ushell/api/S4MyHome","./AppsContainerGenericPlaceholder","./BaseContainer","./RecommendedAppPanel","./library","./utils/DataFormatUtils","./utils/Device"],function(e,t,n,o,i,s,r,a,c,l,p,u,g){"use strict";function h(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function d(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const f=o["BackgroundDesign"];const y=o["FrameType"];const m=o["GenericTileMode"];const P=o["GenericTileScope"];const _=o["TileSizeBehavior"];const b=a["getAppsPlaceholder"];const T=h(c);const C=h(l);const A=p["OrientationType"];const v=u["getLeanURL"];const D=g["DeviceType"];const M=()=>{const e="sapLegendColor9";return{key:e,value:s.get({name:e}),assigned:false}};const S={PLACEHOLDER_ITEMS_COUNT:5};const w=T.extend("sap.cux.home.AppsContainer",{metadata:{events:{appsLoaded:{parameters:{apps:{type:"sap.cux.home.App[]"},tiles:{type:"sap.m.GenericTile[]"}}}}},renderer:{...T.renderer,apiVersion:2},constructor:function e(t,n){T.prototype.constructor.call(this,t,n);this._isInitialRender=true},init:function e(){T.prototype.init.call(this);this.setProperty("title",this._i18nBundle?.getText("appsTitle"));if(this.getDeviceType()===D.Mobile){this.setProperty("orientation",A.Vertical)}const t=i.getInstance();t.subscribe("importChannel","recommendationSettingChanged",(e,t,n)=>{const o=n.showRecommendation;if(!o){const e=this.getContent()?.[0];this.setProperty("selectedKey",e?.getProperty("key"))}});this.setProperty("enableLazyLoad",false);this.addStyleClass("sapCuxAppsContainer");this.addCustomSetting("text",this._i18nBundle.getText("myAppMsg"));this._attachRouteChangeEvent()},_attachRouteChangeEvent:function t(){const n=this;const o=function(e){try{const t=e.getParameter("isMyHomeRoute");const o=function(){if(t){const e=function(){if(n._appSwitched){n.showPersistedDialog();return Promise.resolve(n.load()).then(function(){n._appSwitched=false})}}();if(e&&e.then)return e.then(function(){})}else{n._setPanelsDirty();n._appSwitched=true}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};try{r.attachRouteMatched({},o,this)}catch(t){e.warning("Unable to attach route change handler",t instanceof Error?t.message:String(t))}},onBeforeRendering:function e(){if(this._isInitialRender){this._isInitialRender=false;this._attachPanelSupportedEvent();this._removeUnsupportedPanels()}this.adjustLayout();T.prototype.onBeforeRendering.call(this)},onAfterRendering:function e(){try{const e=this;return Promise.resolve(e._activateRecommendationTabPanel()).then(function(){})}catch(e){return Promise.reject(e)}},load:function e(){try{const e=this;const t=e.getPanels();return Promise.resolve(Promise.all(t.map(t=>e._setApps(t)))).then(function(){})}catch(e){return Promise.reject(e)}},getPanels:function e(){const t=this.getDeviceType()===D.Mobile;return t?this.getContent():[this._getSelectedPanel()]},showPersistedDialog:function e(){const t=this.getPanels();for(const e of t){e.firePersistDialog()}},_setPanelsDirty:function e(){const t=this.getContent();for(const e of t){e.setDesktopViewDirty(true);e.setMobileViewDirty(true)}},_generatePlaceholder:function e(t){if(!t.isLoaded()){t.destroyAggregation("apps",true);const e=t.generateApps(new Array(S.PLACEHOLDER_ITEMS_COUNT).fill({status:"Loading"}));t.setApps(e);this._updatePanelContent(t)}},_setApps:function t(n){try{const t=this;const o=d(function(){function e(){n.fireEvent("loaded")}const o=function(){if(n.isDirty()&&n.isMobileDirty()){t._generatePlaceholder(n);return Promise.resolve(n.loadApps?.()).then(function(){function e(){let e=[];let o=n.getApps();e=n.fetchTileVisualization(e);t.fireEvent("appsLoaded",{apps:o,tiles:e})}if(t.getDeviceType()===D.Mobile){n.setMobileViewDirty(false)}else{n.setDesktopViewDirty(false)}n.setLoaded(true);t._updatePanelContent(n);const o=function(){if(n.isA("sap.cux.home.BaseAppPersPanel")){return Promise.resolve(n.applyPersonalization()).then(function(){})}}();return o&&o.then?o.then(e):e(o)})}}();return o&&o.then?o.then(e):e(o)},function(o){t.showErrorCard(n);e.error(`Error setting apps for panel: ${n.getTitle()}`,o instanceof Error?o.message:String(o))});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_updatePanelContent:function e(t){const n=t.getApps()||[];const o=t.getAggregation("groups")||[];const i=this.getDeviceType()===D.Mobile;const s=i?t._generateMobileAppsWrapper():t._generateAppsWrapper();const r=i?"content":"items";s.destroyAggregation(r);let a=i?this._generateMobileCards([...o,...n],t.getId()):this._generateTiles([...o,...n]);this._addWrapperContent(s,a,r);this._updatePanelContentVisibility(t)},_updatePanelContentVisibility:function e(t){const n=t.getApps()||[];const o=t.getAggregation("groups")||[];const i=this.getDeviceType()===D.Mobile;const s=t._generateDesktopAppsWrapper();const r=t._generateMobileAppsWrapper();const a=t._generateErrorMessage();const c=[...n,...o].length!==0;s.setVisible(c&&!i);r.setVisible(c&&i);r.getParent().setWidth(i&&c?"100%":"auto");a.setVisible(!c)},_getAppTile:function e(n){const o=this.getDeviceType()===D.Mobile;const i=n.getAggregation("menuItems")||[];const s=o?`${n.getId()}-mobile-tile`:`${n.getId()}-tile`;return new t(s,{scope:i.length&&!o?P.ActionMore:P.Display,state:n.getStatus(),mode:m.IconMode,sizeBehavior:_.Small,header:n.getTitle(),backgroundColor:n.getBgColor()||M()?.key,tileIcon:n.getIcon(),url:v(n.getUrl()),frameType:y.TwoByHalf,renderOnThemeChange:true,dropAreaOffset:4,subheader:n.getSubTitle(),press:e=>n._onPress(e),width:o?"15rem":"100%"}).addStyleClass("tileLayout sapMGTTwoByHalf")},_getGroupTile:function e(n){const o=this.getDeviceType()===D.Mobile;const i=n.getAggregation("menuItems")||[];const s=o?`${n.getId()}-mobile-tile`:`${n.getId()}-tile`;return new t(s,{scope:i.length&&!o?P.ActionMore:P.Display,state:n.getStatus(),mode:m.IconMode,sizeBehavior:_.Small,header:n.getTitle(),backgroundColor:n.getBgColor()||M()?.key,tileIcon:n.getIcon(),frameType:y.TwoByHalf,renderOnThemeChange:true,dropAreaOffset:4,tileBadge:n.getNumber(),press:e=>n._onPress(e),width:o?"15rem":"100%"}).addStyleClass("tileLayout sapMGTTwoByHalf").data("groupId",n.getGroupId())},_onPanelSelect:function e(t){try{const e=this;T.prototype._onPanelSelect.call(e,t);const n=e._getSelectedPanel();return Promise.resolve(e._setApps(n)).then(function(){})}catch(e){return Promise.reject(e)}},_refreshAllPanels:function e(){try{const e=this;e._setPanelsDirty();return Promise.resolve(e._setApps(e._getSelectedPanel())).then(function(){})}catch(e){return Promise.reject(e)}},refreshPanel:function e(t){try{const e=this;t.setMobileViewDirty(true);t.setDesktopViewDirty(true);return Promise.resolve(e._setApps(t)).then(function(){})}catch(e){return Promise.reject(e)}},_toggleTabView:function e(){if(this.getDeviceType()!==D.Mobile){const e=this.getContent();const t=e.filter(e=>e.isSupported());const n=this._getInnerControl();n?.toggleStyleClass("sapUiITBHide",t.length===1)}},_onPanelSupported:function e(t,n){const o=n.getParameter("isSupported");t.setSupported(o);this._togglePanelVisibility(t,o);this._toggleTabView()},_togglePanelVisibility:function e(t,n){if(this.getDeviceType()===D.Mobile){const e=this._getPanelContentWrapper(t);e.setVisible(n)}else{const e=this._getInnerControl();const o=e?.getItems()||[];const i=o.find(e=>e.getKey()===t.getKey());i?.setVisible(n)}},_removeUnsupportedPanels:function e(){const t=this.getContent();const n=t.filter(e=>!e.isSupported());for(const e of n){this._togglePanelVisibility(e,false)}this._toggleTabView()},_attachPanelSupportedEvent:function e(){const t=this.getContent();for(const e of t){if(!e.hasListeners("supported")){e.attachSupported(this._onPanelSupported.bind(this,e))}}},_activateRecommendationTabPanel:function e(){try{const e=this;const t=e.getContent();const n=e.getDeviceType()===D.Mobile;const o=t?t.find(e=>e instanceof C):null;const i=function(){if(o instanceof C&&!n){return Promise.resolve(o._enableRecommendationTab()).then(function(){})}}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},adjustLayout:function e(){const t=this.getDeviceType()===D.Mobile;const n=this.getProperty("orientation");const o=t?A.Vertical:A.SideBySide;const i=n!==o;this.toggleActionButtons(!t);if(!i){return}this.setProperty("orientation",o);const s=this.getContent();s.forEach(e=>{if(!e.isDirty()&&!e.isMobileDirty()){this._updatePanelContentVisibility(e)}else if(e.isDirty()!==e.isMobileDirty()){e.setDesktopViewDirty(false);e.setMobileViewDirty(false);this._updatePanelContent(e)}});this._removeUnsupportedPanels()},_generateMobileCards:function e(t,o){const i=[];for(let e=0;e<t.length;e+=7){const s=t.slice(e,e+7);const r=new n(`${o}--${e}`,{backgroundDesign:f.Solid,height:"23.5rem",width:"17rem",content:this._generateTiles(s)}).addStyleClass("sapUiMobileAppsCard appPanelBorder myAppMFBContent");i.push(r)}return i},_generateTiles:function e(t){return t.map(e=>e.isA("sap.cux.home.Group")?this._getGroupTile(e):this._getAppTile(e))},_addWrapperContent:function e(t,n,o){t.destroyAggregation(o);n.forEach(e=>{t.addAggregation(o,e)})},showErrorCard:function e(t){const n=t._generateErrorMessage();const o=t._generateDesktopAppsWrapper();const i=t._generateMobileAppsWrapper();o?.setVisible(false);i?.setVisible(false);n?.setVisible(true)},getGenericPlaceholderContent:function e(){return b()}});return w});
//# sourceMappingURL=AppsContainer-dbg.js.map