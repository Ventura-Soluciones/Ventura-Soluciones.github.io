/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/tools/BatchParser","sap/ui/model/odata/v4/ODataContextBinding","sap/ui/model/odata/v4/ODataListBinding","sap/ui/model/odata/v4/ODataPropertyBinding","sap/ui/base/ManagedObject","sap/ui/model/ManagedObjectBindingSupport"],function(e,t,n,r,s,a){"use strict";var o={};var i=e.parseBatch;var c=e.BatchContent;function d(e){const o=r.prototype.createAndSetCache;const i=n.prototype.createAndSetCache;const c=t.prototype.createAndSetCache;let d=0;const p={};n.prototype.createAndSetCache=function(){const e=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=i.apply(this,n);s.__feBinding=e;if(!this.mParameters["sap-valid-feTrace"]){s.__feCacheId=d++;this.changeParameters({"sap-valid-feTrace":s.__feCacheId})}else{s.__feCacheId=this.mParameters["sap-valid-feTrace"]}p[s.__feCacheId]=s;return s};const f=t.prototype.applyParameters;t.prototype.applyParameters=function(e){if(!e["sap-valid-feTrace"]){e["sap-valid-feTrace"]=d++}f.apply(this,[e])};t.prototype.createAndSetCache=function(){const e=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=c.apply(this,n);s.__feBinding=e;s.__feCacheId=this.mParameters["sap-valid-feTrace"];p[s.__feCacheId]=s;return s};r.prototype.createAndSetCache=function(){const e=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=o.apply(this,n);s.__feBinding=e;if(this.getRootBinding()===this){return s}if(!this.getRootBinding().mParameters?.["sap-valid-feTrace"]){s.__feCacheId=d++;this.getRootBinding().changeParameters({"sap-valid-feTrace":s.__feCacheId})}else{s.__feCacheId=this.mParameters["sap-valid-feTrace"]}s.__feCacheId=d++;p[s.__feCacheId]=s;return s};const h=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=e.apply(this,n);Object.keys(this.mBindingInfos).forEach(e=>{if(this.mBindingInfos[e].binding){this.mBindingInfos[e].binding.__feSource=this;this.mBindingInfos[e].binding.__feForProp=e;if(!this.mBindingInfos[e].binding.hasOwnProperty("closestDomRef")){Object.defineProperty(this.mBindingInfos[e].binding,"closestDomRef",{get:function(){let e=this.__feSource;while(e&&e.getDomRef&&!e.getDomRef()){e=e.getParent()}return e?.getDomRef&&e.getDomRef()}})}if(this.mBindingInfos[e].binding.aBindings){this.mBindingInfos[e].binding.aBindings.forEach(t=>{t.__feSource=this;t.__feInComposite=true;t.__feForProp=e;t.__feComposite=this.mBindingInfos[e].binding;if(!t.hasOwnProperty("closestDomRef")){Object.defineProperty(t,"closestDomRef",{get:function(){let e=this.__feSource;while(e&&e.getDomRef&&!e.getDomRef()){e=e.getParent()}return e?.getDomRef&&e.getDomRef()}})}})}}});return s}};const u=a.updateBindings;const g=s.prototype.updateBindings;a.updateBindings=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return h(u).apply(this,t)};s.prototype.updateBindings=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return h(g).apply(this,t)};e.createdCaches=p}function p(e){d(e);const t=XMLHttpRequest;window.XMLHttpRequest=function(){const n=new t;const r=n.open;const s=n.send;const a=n.setRequestHeader;n.open=function(){this.request??={};for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}this.request.url=t[1];r.apply(this,t)};n.send=function(){this.request??={};for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}this.request.body=t[0];s.apply(this,t)};n.setRequestHeader=function(){this.request??={};this.request.header??={};for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}this.request.header[t[0].toLowerCase()]=t[1];a.apply(this,t)};n.addEventListener("load",function(t){if(t.target.responseURL.includes("$batch")){const n=this.request.body;const r=this.request.header["content-type"].split("boundary=")[1];const s=i(new c(n),r);const a=t.target.getResponseHeader("content-type").split("boundary=")[1];const o=t.target.responseText;const d=i(new c(o),a);d.parts.forEach((t,n)=>{const r=s.parts[n];const a=e.supportModel.getProperty("/data");const o=new URL(`http://example.com/${r.url}`);const i=new URLSearchParams(o.search);const c=i.get("sap-valid-feTrace");const d={};o.searchParams.forEach((e,t)=>{d[t]=e});a.push({urlBase:r.url.split("?")[0],request:r,responseBody:JSON.stringify(t.body,null,4),responseBodyObj:t.body,parameters:JSON.stringify(d,null,4),trace:c});e.supportModel.setProperty("/data",a);e.supportModel.refresh()})}});return n}}o.addODataTrace=p;return o},false);
//# sourceMappingURL=ODataTracer.js.map