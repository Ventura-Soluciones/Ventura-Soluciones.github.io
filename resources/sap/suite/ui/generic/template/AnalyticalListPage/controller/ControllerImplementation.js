sap.ui.define(["sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/AnalyticalListPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/AnalyticalListPage/controller/FilterBarController","sap/suite/ui/generic/template/listTemplates/controller/ToolbarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterBarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/suite/ui/generic/template/AnalyticalListPage/controller/AnalyticGridController","sap/ui/table/AnalyticalTable","sap/ui/model/odata/AnnotationHelper","sap/ui/model/analytics/odata4analytics","sap/suite/ui/generic/template/AnalyticalListPage/controller/ContentAreaController","sap/suite/ui/generic/template/listTemplates/controller/IappStateHandler","sap/ui/Device","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/AnnotationHelper","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/base/util/ObjectPath","sap/suite/ui/generic/template/lib/ShareUtils","sap/base/util/merge","sap/base/util/deepExtend","sap/suite/ui/generic/template/listTemplates/listUtils","sap/suite/ui/generic/template/listTemplates/controller/MultipleViewsHandler","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/listTemplates/controller/MessageStripHelper","sap/ui/model/json/JSONModel","sap/ui/comp/personalization/Util","sap/suite/ui/generic/template/lib/insights/InsightsHandler","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/filterHelper","sap/suite/ui/generic/template/js/AnnotationHelperHiddenTermSupport","sap/suite/ui/generic/template/AnalyticalListPage/controller/CtxMenuHandler"],function(e,t,a,r,n,i,o,l,s,d,c,u,g,p,f,m,v,C,S,h,F,b,y,P,I,T,H,A,E,B,M,D){"use strict";var V=new v("AnalyticalListPage.controller.ControllerImplementation");var w=V.getLogger();var _=V.Level;var U="chart",R="visual",O="compact",L=900;return{getMethods:function(v,V,x){var N={};N.oRefreshTimer=null;N.nRefreshInterval=0;N.bVisualFilterInitialised=false;N._bIsStartingUp=true;var K=false;var k=new D(x,V,N);function j(e){N.oRefreshTimer=setTimeout(function(){var e=x.getOwnerComponent();var t=e.getModel("_templPriv");if(!t.getProperty("/alp/filterChanged")){v.refreshBinding()}},e)}function z(e){if(N.nRefreshInterval!==0){if(N.oRefreshTimer!==null){clearTimeout(N.oRefreshTimer)}if(!e){j(N.nRefreshInterval)}}}function G(){var e=x.getOwnerComponent();var t=e.getModel("_templPriv");t.setProperty("/listReport/isLeaf",e.getIsLeaf())}function q(e,t){var a=e&&e.property;return a.filter(function(e){return typeof e[t]!=="undefined"})}function W(t){var a=t.getModel(),r=a&&a.getMetaModel(),n=r&&r.getODataEntityType(E.getEntityTypeNameFromEntitySetName(t.getEntitySet(),r)),i,o=r&&r.getODataEntityType(E.getEntityTypeNameFromEntitySetName(t.getEntitySet(),r),true),l=f.createSVAnnotation(n,r,N.oController.getOwnerComponent().getQualifier());if(N.oController.getOwnerComponent().getFilterDefaultsFromSelectionVariant()&&l){i=b.createSVObject(h({},l),t)}else{if(N.oController.getOwnerComponent().getFilterDefaultsFromSelectionVariant()&&!l){w.warning("No SelectionVariant found in the annotation : No default values filled in FilterBar")}var c=n&&q(n,"com.sap.vocabularies.Common.v1.FilterDefaultValue"),u,g,p,m,v,C=[];try{u=new d.Model(new d.Model.ReferenceByModel(a));v=u&&u.findQueryResultByName(t.getEntitySet());g=v&&v.getParameterization();p=g&&r.getODataEntitySet(g.getEntitySet().getQName());m=p&&r.getODataEntityType(p.entityType);C=m?q(m,"defaultValue"):[]}catch(e){w.error(e)}if(c.length>0||C.length>0){i=new e;c.forEach(function(e){var t=r.createBindingContext(o+"/property/[${path:'name'}==='"+e.name+"']/com.sap.vocabularies.Common.v1.FilterDefaultValue");i.addSelectOption(e.name,"I","EQ",s.format(t))});C.forEach(function(e){i.addParameter(e.name,e.defaultValue)})}}return i}function J(e){var t=e.getSource();t.suspendSetFilterData();var a=W(t);if(a){N.oIappStateHandler.fnSetFiltersUsingUIState(a.toJSONObject(),{},true,false)}N.oIappStateHandler.onSmartFilterBarInitialise();x.onInitSmartFilterBarExtension(e);x.templateBaseExtension.onInitSmartFilterBar(e)}function Q(){var e=N.oIappStateHandler.onSmartFilterBarInitialized();e.then(function(){var e=N.oController.getOwnerComponent();if(N.hideVisualFilter||e.getDefaultFilterMode()=="visual"&&e.getModel().mMetadataUrlParams&&e.getModel().mMetadataUrlParams["sap-value-list"]==="none"){if(N.alr_visualFilterBar&&!N.alr_visualFilterBar.getAssociateValueListsCalled()){N.alr_visualFilterBar.setAssociateValueListsCalled(true)}N.oSmartFilterbar.associateValueLists()}N._bIsStartingUp=false;if(N.bVisualFilterInitialised){N.oIappStateHandler.fnUpdateVisualFilterBar()}if(N.sNavType!==sap.fe.navigation.NavType.iAppState){N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()}},function(e){if(e instanceof Error){e.showMessageBox()}N.oIappStateHandler.fnOnError();N._bIsStartingUp=false}).finally(function(){if(N.oSmartFilterableKPI){var e=N.oSmartFilterableKPI.getContent();e.forEach(function(e){if(e.getSmartFilterId){e._bStopDataLoad=false;e._updateKpiList(true)}})}})}function X(e){var t=e.getSource(),a=e.getParameters().limitReached,r=t.getSelectedIndices(),n,i;if(r.length>0){if(a){n="Your last selection was limited to the maximum of "+t.getLimit()+" items.";V.oServices.oApplication.showMessageToast(n)}}i=t.getParent();V.oCommonUtils.setEnabledToolbarButtons(i)}function $(e){var t=e.getParameters();var a=e.getSource();V.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(a,t)}function Y(e){var t,a;t=e.getParameters();a=e.getSource();V.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(a.getEntitySet(),a.getFieldSemanticObjectMap(),t,N)}function Z(e){var t=N.oSmartFilterbar;var a=[];if(e.fetchVariant()&&e.fetchVariant().filter&&e.fetchVariant().filter.filterItems){a=e.fetchVariant().filter.filterItems}var r={search:!!t.getBasicSearchValue(),filter:!!(a.length||t.retrieveFiltersWithValues().length)};return r}function ee(e){var t=e.getId();var a=Z(e);var r="";if(a.search||a.filter){r=V.oCommonUtils.getContextText("NOITEMS_SMARTCHART_WITH_FILTER",t)}else{r=V.oCommonUtils.getContextText("NOITEMS_SMARTCHART",t)}e.getChartAsync().then(function(e){e.setCustomMessages({NO_DATA:r})})}function te(e){var t=function(){var e=V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(N.oSmartChart);var t=e.getModel().getMetaModel();var a=t.getODataEntitySet(e.getEntitySet()).entityType;var r=N.oSmartTable.getTable();var n=r.getBinding("rows")||r.getBinding("items");var i=n?n.getDownloadUrl():"";var o=n?n.aApplicationFilter||n.aApplicationFilters:[];if(!o.length){return Promise.resolve({sServiceUrl:i})}var l=N.oSmartFilterbar.getFilterData();var s=B.getFilterParams(t,a,o,l);if(s){i=V.oCommonUtils.fnReplaceFiltersWithGetDownloadUrl(i,s);return Promise.resolve({sServiceUrl:i})}else{return Promise.resolve({sServiceUrl:""})}};var a={sharePageToPressed:function(e){var t=V.oServices.oApplication.getBusyHelper();if(t.isBusy()){return}var a=V.oServices.oApplication.getAppTitle();var r=S.getCurrentUrl().then(function(t){switch(e){case"Email":a=V.oCommonUtils.getText("EMAIL_HEADER",[a]);sap.m.URLHelper.triggerEmail(null,a,t);break;default:break}});t.setBusy(r)},shareJamPressed:function(){S.openJamShareDialog(V.oServices.oApplication.getAppTitle())},shareTilePressed:function(){S.fireBookMarkPress()},getServiceUrl:function(){return t().then(function(e){if(e.sServiceUrl){e.sServiceUrl=e.sServiceUrl?e.sServiceUrl+"&$top=0&$inlinecount=allpages":""}var t={serviceUrl:e.sServiceUrl};x.onSaveAsTileExtension(t);return t.serviceUrl})},getModelData:function(){var e=C.get("sap.ushell.Container.getUser");var t=x.getOwnerComponent().getAppComponent();var r=t.getManifestEntry("sap.ui");var n=t.getManifestEntry("sap.app");return a.getServiceUrl().then(function(t){return S.getCurrentUrl().then(function(a){return{serviceUrl:t,icon:r&&r.icons?r.icons.icon:"",shellTitle:n?n.title:"",isShareInJamActive:!!e&&e().isJamActive(),customUrl:S.getCustomUrl(),currentUrl:a}})})}};S.openSharePopup(V.oCommonUtils,e,a)}return{onInit:function(){var e=x.getOwnerComponent();w.setLevel(_.WARNING,"ALPSmartFilterBar");var t=e.getModel("_templPriv");t.setProperty("/alp",{filterMode:e.getHideVisualFilter()?O:e.getDefaultFilterMode(),contentView:e.getDefaultContentView(),autoHide:e.getAutoHide(),visibility:{hybridView:g.system.phone||g.system.tablet&&!g.system.desktop?false:true},filterChanged:false});N.hideVisualFilter=e.getHideVisualFilter();N.hideVisualFilter=N.hideVisualFilter===undefined||N.hideVisualFilter!==true?false:true;N.quickVariantSelectionX=e.getQuickVariantSelectionX();N.oSmartFilterbar=x.byId("template::SmartFilterBar");N.oSmartTable=x.byId("table");N.oSmartFilterableKPI=x.byId("template::KPITagContainer::filterableKPIs");N.oPage=x.byId("template::Page");N.oSmartChart=x.byId("chart");var i=new y(N,x,V);N.oMultipleViewsHandler=i;N.oMessageStripHelper=new I(V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(N.oSmartTable),i,x,V,"alp");if(x.getOwnerComponent().getProperty("dshQueryName")){N.oAnalyticGridContainer=x.byId("template::AnalyticGridContainer");N.oAnalyticGridController=new o;N.oAnalyticGridController.setState(N)}N.alr_compactFilterContainer=x.byId("template::CompactFilterContainer");N.alr_visualFilterContainer=x.byId("template::VisualFilterContainer");N.alr_filterContainer=x.byId("template::FilterContainer");N.alr_visualFilterBar=x.byId("template::VisualFilterBar");var s="";if(N.quickVariantSelectionX){s=i.getSelectedKey()}var d=P.getStableId({type:"ALPTable",subType:"ColumnListItem",sQuickVariantKey:s});N.alp_ColumnListItem=x.byId(d);if(N.alr_visualFilterBar){var p=e.getFilterSettings();if(p&&Object.keys(p).length>0){N.alr_visualFilterBar.setFilterSettings(p)}N.alr_visualFilterBar.setSmartFilterId(N.oSmartFilterbar.getId());N.alr_visualFilterBar.attachOnFilterItemAdded(function(e){var t=e.getParameters();t.attachBeforeRebindVisualFilter(function(e){var t=e.getParameters();var a=t.sEntityType;var r=t.sDimension;var n=t.sMeasure;var i=t.oContext;var o=N.oController;o.onBeforeRebindVisualFilterExtension(a,r,n,i)})})}N.oKpiTagContainer=x.byId("template::KPITagContainer::globalKPIs");N.oFilterableKpiTagContainer=x.byId("template::KPITagContainer::filterableKPIs");if(N.oKpiTagContainer||N.oFilterableKpiTagContainer){sap.ui.require(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiTagController"],function(e){e.init(N)})}N.oContentArea=new c;N.oTemplateUtils=V;N.toolbarController=new r;N.oController=x;N.filterBarController=new a;N.filterBarController.init(N);N.oContentArea.createAndSetCustomModel(N);N.oInsightsHandler=new A(N,x,V);N.oMultipleViewsHandler.getInitializationPromise().then(function(){N.oContentArea.setState(N)});var f=V.oServices.oInsightsFECardProvider&&V.oServices.oInsightsFECardProvider.getCardProviderInsightsInstance();if(f&&!V.oCommonUtils.isMultiViewMultiEntity()){V.oServices.oInsightsFECardProvider.fnRegisterComponentForProvider(N.oInsightsHandler,x.getView().getId());t.bindProperty("/alp/filterChanged").attachChange(function(e){if(!e.getSource().getValue()){var t=V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(N.oSmartChart);N.oInsightsHandler.getCardsToShare("Analytical",t).then(function(e){f.onViewUpdate(true,e)})}else{f.onViewUpdate(true,[])}})}if(!N.hideVisualFilter){N.visualFilterBarContainer=new n;N.visualFilterBarContainer.init(N)}if(N.alr_visualFilterBar){N.alr_visualFilterBar.addEventDelegate({onAfterRendering:function(){if(N.oSmartFilterbar.isInitialised()){N.oSmartFilterbar.setFilterData({_CUSTOM:N.oIappStateHandler.getFilterState()})}}})}N.oIappStateHandler=new u(N,x,V);G();x.byId("template::FilterText").attachBrowserEvent("click",function(){x.byId("template::Page").setHeaderExpanded(true)});t.setProperty("/listReport/isHeaderExpanded",true);t.setProperty("/generic/bDataAreShownInChart",false);if(N.oSmartTable){var C=N.oSmartTable.getTable()}var S="sapUiSizeCozy",h="sapUiSizeCompact",b="sapUiSizeCondensed";if(m.isUiTable(C)||C instanceof l){var T=x.getView();var H=document.body;if(H.classList.contains(S)||T.hasStyleClass(S)){N.oSmartTable.addStyleClass(S)}else if(H.classList.contains(h)||T.hasStyleClass(h)){var E=e.getCondensedTableLayout();if(E===false){N.oSmartTable.addStyleClass(h)}else{N.oSmartTable.addStyleClass(b)}}}if(N.oSmartFilterableKPI){N.oSmartFilterableKPI.setModel(e.getModel("_templPriv"),"_templPriv");var B=N.oSmartFilterableKPI.getContent(),M=N.oController;B.forEach(function(e){if(e.getSmartFilterId){e.attachBeforeRebindFilterableKPI(function(e){var t=e.getParameters(),a=t.selectionVariant,r=t.entityType,n=e.getSource().getId();M.onBeforeRebindFilterableKPIExtension(a,r,n)},M)}})}v.getUrlParameterInfo=function(){return N.oIappStateHandler.getUrlParameterInfo()};v.onComponentActivate=function(){};v.refreshBinding=function(){if(N.alr_visualFilterBar&&N.alr_visualFilterBar.updateVisualFilterBindings){N.alr_visualFilterBar.updateVisualFilterBindings()}if(N.oSmartChart&&N.oSmartChart.rebindChart){N.oSmartChart.rebindChart()}if(N.oSmartTable){V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(N.oSmartTable).refresh()}if(N.oKpiTagContainer){var e=N.oKpiTagContainer.mAggregations.content;for(var t in e){if(e[t]._createGlobalKpi){e[t]._createGlobalKpi()}}}if(N.oFilterableKpiTagContainer){var e=N.oFilterableKpiTagContainer.mAggregations.content;for(var t in e){if(e[t]._createFilterableKpi){e[t]._createFilterableKpi()}}}z()};v.onSuspend=function(){z(true)};v.onRestore=function(){if(N.nRefreshInterval){j(N.nRefreshInterval)}};if(N.alr_visualFilterBar){N.alr_visualFilterBar.attachInitialized(function(e){N.bVisualFilterInitialised=true;if(!N._bIsStartingUp){N.oIappStateHandler.fnUpdateVisualFilterBar(true)}})}N.oSmartFilterbar.attachFilterChange(function(t){var a=e.getModel("_templPriv");N.oIappStateHandler.fnCheckMandatory();var r=N.oSmartFilterbar.isDialogOpen();var n=t.getSource(),i;i=F({},n.getFilterData(true));if(r&&N.visualFilterDialogContainer){var o=N.visualFilterDialogContainer.oVerticalBox.getModel("_dialogFilter");o.setData(i)}else{var l=N.oController.getOwnerComponent().getModel("_filter");l.setData(i)}if(t.getParameters().filterItem){if(!N.hideVisualFilter){N.filterBarController.changeVisibility(t)}a.setProperty("/alp/_ignoreChartSelections",false)}N.filterBarController._updateFilterLink();if(!N.oSmartFilterbar.isLiveMode()&&!N.oSmartFilterbar.isDialogOpen()){a.setProperty("/alp/filterChanged",true)}});var T=x.getView();var H=document.body;var D,U;if(H.classList.contains(S)||T.hasStyleClass(S)){D=true}if(D&&e.getTableType()!=="ResponsiveTable"){var R=e.getModel("_templPriv");if(g.resize.height<=L){U=R.getProperty("/alp/contentView");R.setProperty("/alp/enableHybridMode",false);R.setProperty("/alp/contentView",U==="charttable"?"chart":U)}N.resizeHandler=function(e){var t=e.height;if(t<=L){U=R.getProperty("/alp/contentView");R.setProperty("/alp/enableHybridMode",false);R.setProperty("/alp/contentView",U==="charttable"?"chart":U)}else{R.setProperty("/alp/enableHybridMode",true)}};g.resize.attachHandler(N.resizeHandler)}if(e.getRefreshIntervalInMinutes()){N.nRefreshInterval=e.getRefreshIntervalInMinutes();N.nRefreshInterval=(N.nRefreshInterval<1?1:N.nRefreshInterval)*6e4}var K=x.byId(P.getStableId({type:"ALPAction",subType:"Share"})+"-internalBtn");if(K){K.attachPress(function(){te(K)})}},attachRefreshInterval:j,clearingRefreshTimerInterval:z,onExit:function(){if(N.resizeHandler){g.resize.detachHandler(N.resizeHandler)}if(N.oRefreshTimer!==null){clearTimeout(N.oRefreshTimer)}},handlers:{onBack:function(){V.oServices.oNavigationController.navigateBack()},onSmartTableInit:function(e){var t=e.getSource(),a=t.getToolbar(),r=a.getContent(),n;var i=M.getHiddenColumnInfo(t);if(i&&i.staticHiddenColumns&&i.staticHiddenColumns.length>0){t.deactivateColumns(i.staticHiddenColumns)}t.setHeight("100%");V.oCommonUtils.checkToolbarIntentsSupported(t);if(N._pendingTableToolbarInit){if(!N.oSmartFilterableKPI&&!N.oMultipleViewsHandler.getMode()){a.insertContent(N.alr_viewSwitchButtonOnTable,r.length)}}if(N._pendingTableToolbarInit){for(var o=0;o<r.length;o++){if(r[o].mProperties.text==="Settings"){n=o}}a.insertContent(N._autoHideToggleBtn,n)}delete N._pendingTableToolbarInit;t.attachShowOverlay(function(e){t.getToolbar().setEnabled(!e.getParameter("overlay").show)});var l=new T({highlightMode:"rebindTable"});t.setModel(l,"_tableHighlight");V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(t).addCellSelector()},onBeforeRebindTable:function(e){var t=e.getSource();var a=e.getParameter("bindingParams");N.oMessageStripHelper.onBeforeRebindControl(e);if(N.chartController&&N.chartController.oChart){var r=N.chartController.oChart,n=N.chartController._chartInfo;n.drillStack=N.chartController.oChart.getDrillStack();var i=n.drillStack&&n.drillStack.length>0?n.drillStack[n.drillStack.length-1]:undefined}var o=x.getOwnerComponent().getModel("_templPriv");var l=o.getProperty("/alp/contentView");if(l===U){a.preventTableBind=true;K=true}var s=o.getProperty("/alp/_ignoreChartSelections");if(N.detailController.isFilter()&&N.oSmartChart&&!s){N.detailController._applyChartSelectionOnTableAsFilter(e,r)}if(N.detailController.isFilter()&&i&&i.filter){a.filters.push(i.filter)}var d=[];var c=t.getTable().getColumns();for(var u=0;u<c.length;u++){var g=c[u];if(g.getGrouped&&g.getGrouped()){d.push(g.getLeadingProperty?g.getLeadingProperty():H.getColumnKey(g))}}N.detailController._updateExpandLevelInfo(d,a);if(x.getOwnerComponent().getModel().getDefaultCountMode()==="None"&&t._isAnalyticalTable){a.parameters.provideTotalResultSize=false;t.setShowRowCount(false)}x.onBeforeRebindTableExtension(e);N.oMultipleViewsHandler.aTableFilters=F({},a.filters);var p=a.events.refresh||Function.prototype;a.events.refresh=function(e){N.oMultipleViewsHandler.onDataRequested();p.call(this,e)};var f=a.events.dataRequested||Function.prototype;a.events.dataRequested=function(e){var a=this;N.detailController.onSmartTableDataRequested(t).then(function(){f.call(a,e)})};var m=a.events.dataReceived||Function.prototype;a.events.dataReceived=function(e){N.oContentArea.enableToolbar();V.oCommonEventHandlers.onDataReceived(t);var a=M.getHiddenColumnInfo(t);V.oCommonEventHandlers.hideTableCells(t,a);V.oComponentUtils.hidePlaceholder();m.call(this,e)};V.oCommonEventHandlers.onBeforeRebindTable(e,{setBindingPath:t.setTableBindingPath.bind(t),ensureExtensionFields:x.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:x.templateBaseExtension.addFilters,resolveParamaterizedEntitySet:N.oMultipleViewsHandler.resolveParameterizedEntitySet,isMandatoryFiltersRequired:false,isFieldControlRequired:false,isPopinWithoutHeader:false,isDataFieldForActionRequired:false,isFieldControlsPathRequired:false});var v=a.filters.slice(0);N.oMultipleViewsHandler.onRebindContentControl(a,v);t.getModel("_tableHighlight")&&t.getModel("_tableHighlight").setProperty("/highlightMode","rebindTable");N.detailController._applyCriticalityInfo(e,t);b.handleErrorsOnTableOrChart(V,e,N)},onSelectionDetailsActionPress:function(e){N.oMultipleViewsHandler.onDetailsActionPress(e)},addEntry:function(e){var t=e.getSource();V.oCommonEventHandlers.addEntry(t,false,N.oSmartFilterbar)},deleteEntries:function(e){V.oCommonEventHandlers.deleteEntries(e)},onSelectionChange:function(e){var t=e.getSource(),a=t.getModel(),r=t.getModel("_templPriv");var n=a.getMetaModel(),i=n.getODataEntitySet(this.getOwnerComponent().getEntitySet()),o=i["Org.OData.Capabilities.V1.DeleteRestrictions"];var l=o&&o.Deletable&&o.Deletable.Path?o.Deletable.Path:"";var s=false;var d=true;var c=l&&l!=="";var u=V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(V.oCommonUtils.getOwnerPresentationControl(t)).getSelectedContexts();if(u.length>0){for(var g=0;g<u.length;g++){var p=a.getObject(u[g].getPath());if(!(p.IsActiveEntity&&p.HasDraftEntity&&p.DraftAdministrativeData&&p.DraftAdministrativeData.InProcessByUser)){d=false}if(c){if(a.getProperty(l,u[g])){c=false}}if(!d&&!c){s=true;break}}}r.setProperty("/listReport/deleteEnabled",s)},onMultiSelectionChange:X,onChange:function(e){V.oCommonEventHandlers.onChange(e)},onContactDetails:function(e){V.oCommonEventHandlers.onContactDetails(e)},onSmartFilterBarInitialise:J,onSmartFilterBarInitialized:Q,onEditStateFilterChanged:function(e){e.getSource().fireChange()},onFilterPress:function(e){N.filterBarController.showDialog.call(N.filterBarController)},onClearPress:function(e){N.filterBarController.clearFilters();x.onClearFilterExtension(e)},onGoPress:function(e){N.filterBarController.fnCheckMandatory();var t=N.oSmartFilterbar.isDialogOpen();if(!t){N.filterBarController.onGoFilter()}},onBeforeSFBVariantSave:function(){if(N.oSmartFilterbar.isDialogOpen()&&!N.hideVisualFilter){N.visualFilterDialogContainer._updateFilterBarFromDialog.call(N.visualFilterDialogContainer)}var e=N.oIappStateHandler.getCurrentAppState();if(!this.getOwnerComponent().getProperty("smartVariantManagement")){delete e.customData["sap.suite.ui.generic.template.genericData"].contentView}var t=N.oSmartFilterbar.getFilterData(true);var a,r=N.oSmartFilterbar.getBasicSearchControl();if(r&&r.getValue){a=r.getValue()}t._CUSTOM=e.customData;t._CUSTOM["sap.suite.ui.generic.template.genericData"].variantDirty=false;N.oSmartFilterbar.setFilterData(t,true);if(a){N.oSmartFilterbar.getBasicSearchControl().setValue(a)}N.oSmartFilterbar.fireFilterChange()},onAfterSFBVariantLoad:function(e){if(!N.oSmartFilterbar.isDialogOpen()){N.filterBarController._afterSFBVariantLoad();if(N.oSmartFilterableKPI&&!N.oSmartFilterbar.isLiveMode()){var t=N.oSmartFilterableKPI.getContent();t.forEach(function(t){if(t.getSmartFilterId){if(e.getParameter("executeOnSelect")){t.bSearchTriggred=true}}})}}},onBeforeRebindChart:function(e){var t=e.getSource();ee(t);var a=e.getParameters().bindingParams;N.oMultipleViewsHandler.aTableFilters=F({},a.filters);var r=a.filters.slice(0);var n={setBindingPath:t.setChartBindingPath.bind(t),ensureExtensionFields:Function.prototype,addExtensionFilters:x.templateBaseExtension.addFilters,resolveParamaterizedEntitySet:N.oMultipleViewsHandler.resolveParameterizedEntitySet,isFieldControlRequired:false,isMandatoryFiltersRequired:true};x.onBeforeRebindChartExtension(e);var i=a.events.dataReceived||Function.prototype;a.events.dataReceived=function(e){if(!t.getToolbar().getEnabled()){N.oContentArea.enableToolbar()}V.oComponentUtils.hidePlaceholder();i.call(this,e)};V.oCommonUtils.onBeforeRebindTableOrChart(e,n,N.oSmartFilterbar);N.oMultipleViewsHandler.onRebindContentControl(a,r);b.handleErrorsOnTableOrChart(V,e,N)},onListNavigate:function(e){V.oCommonEventHandlers.onListNavigate(e,N)},onCallActionFromToolBar:function(e){var t=V.oCommonUtils.getParentTable;V.oCommonUtils.getParentTable=function(){return N.oSmartTable};V.oCommonEventHandlers.onCallActionFromToolBar(e,N);V.oCommonUtils.getParentTable=t;t=null},onCallActionFromList:function(e){},onDataFieldForIntentBasedNavigation:function(e){V.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,N)},onDataFieldWithEmail:function(e){V.oCommonEventHandlers.onDataFieldWithEmail(e)},onDataFieldWithIntentBasedNavigation:function(e){V.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,N)},onBeforeSemanticObjectLinkPopoverOpens:function(e){var t=e.getSource();var a=N.oSmartFilterbar.getUiState({allFilters:false}).getSelectionVariant();if(N.oSmartFilterbar.getEntitySet()!==t.getEntitySet()){a.FilterContextUrl=V.oServices.oApplication.getNavigationHandler().constructContextUrl(t.getEntitySet(),t.getModel())}var r=JSON.stringify(a);V.oCommonUtils.semanticObjectLinkNavigation(e,r,x)},onAssignedFiltersChanged:function(e){if(e&&e.getSource()){if(N&&N.oSmartFilterbar&&N.filterBarController){x.byId("template::FilterText").setText(N.oSmartFilterbar.retrieveFiltersWithValuesAsText())}}},onToggleFiltersPressed:function(){var e=x.getOwnerComponent();var t=e.getModel("_templPriv");t.setProperty("/listReport/isHeaderExpanded",t.getProperty("/listReport/isHeaderExpanded")===true?false:true)},onSearchButtonPressed:function(){if(g.system.phone&&N.oPage.getHeaderExpanded()){N.oPage.setHeaderExpanded(false)}var e=x.getOwnerComponent().getModel();N.oController.getOwnerComponent().getModel("_templPriv").setProperty("/alp/filterChanged",false);N.oController.getOwnerComponent().getModel("_templPriv").setProperty("/generic/bDataAreShownInChart",true);e.attachEventOnce("requestSent",function(){if(!N._bIsStartingUp){N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()}else{N.oIappStateHandler.fnResolveStartUpPromise()}});N.oController.getOwnerComponent().getModel("_templPriv").setProperty("/alp/_ignoreChartSelections",true);if(N.oSmartTable){V.oCommonUtils.refreshModel(N.oSmartTable.getEntitySet())}else{V.oCommonUtils.refreshModel(N.oSmartChart.getEntitySet())}z()},onSemanticObjectLinkNavigationPressed:$,onSemanticObjectLinkNavigationTargetObtained:Y,onAfterTableVariantSave:function(){N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onAfterApplyTableVariant:function(){setTimeout(function(){N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},0)},onAfterChartVariantSave:function(e){N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL();V.oCommonUtils.setEnabledToolbarButtons(e.getSource())},onAfterApplyChartVariant:function(){setTimeout(function(){N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},0)},onFilterModeSegmentedButtonChange:function(e){N.filterBarController.handleFilterSwitch();N.oController._templateEventHandlers.onSegmentButtonPressed();N.filterBarController.fnCheckMandatory()},onContentViewSegmentButtonPressed:function(e){var t=e.getSource().getSelectedKey();if(t==="crosstable"&&!N.oAnalyticGrid){N.oAnalyticGridController.initAnalyticGrid()}if((t==="table"||t==="charttable")&&K){N.oSmartTable.rebindTable();K=false}if(!N.oSmartFilterableKPI&&!N.oController.getOwnerComponent().getContentTitle()){var a=N.oController.getView(),r;if(t==="customview1"){r="template::contentViewExtensionToolbar"}else if(t==="customview2"){r="template::contentViewExtension2Toolbar"}else if(t==="chart"||t==="charttable"){r=a.byId("template::masterViewExtensionToolbar")?"template::masterViewExtensionToolbar":"template::ChartToolbar"}else if(t==="table"){r="template::TableToolbar"}N.oController._templateEventHandlers.setFocusOnContentViewSegmentedButtonItem(a,r)}N.oController._templateEventHandlers.onSegmentButtonPressed(!N.oController.getOwnerComponent().getProperty("smartVariantManagement"))},setFocusOnContentViewSegmentedButtonItem:function(e,t){var a=e.byId(t);if(a){var r=a.getContent().length,n=a.getContent()[r-1];if(n){n.addEventDelegate({onAfterRendering:function(e){e.srcControl.focus()}})}}},onSegmentButtonPressed:function(e){if(!e){N.oController.byId("template::PageVariant").currentVariantSetModified(true);N.oSmartFilterbar.setFilterData({_CUSTOM:N.oIappStateHandler.getFilterState()})}N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onShareListReportActionButtonPress:function(e){V.oCommonUtils.executeIfControlReady(te,P.getStableId({type:"ALPAction",subType:"Share"})+"-internalBtn")},onDeterminingDataFieldForAction:function(e){var t=N.oController.getOwnerComponent().getModel("_templPriv");var a=t.getProperty("/alp/contentView");var r=V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(a===U?N.oSmartChart:N.oSmartTable);V.oCommonEventHandlers.onDeterminingDataFieldForAction(e,r)},onDeterminingDataFieldForIntentBasedNavigation:function(e){var t=e.getSource();var a=N.oController.getOwnerComponent().getModel("_templPriv");var r=a.getProperty("/alp/contentView");var n=V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(r===U?N.oSmartChart:N.oSmartTable).getSelectedContexts();V.oCommonEventHandlers.onDeterminingDataFieldForIntentBasedNavigation(t,n,N.oSmartFilterbar)},onInlineDataFieldForAction:function(e){V.oCommonEventHandlers.onInlineDataFieldForAction(e)},onInlineDataFieldForIntentBasedNavigation:function(e){V.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),N)},onAutoHideToggle:function(){N.oSmartTable.getModel("_tableHighlight").setProperty("/highlightMode","eyeModeSwitch");N.chartController&&N.chartController._updateTable();N.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onFullScreenToggled:function(e){var t=e.getParameter("fullScreen");var a=e.getSource().getModel("_templPriv");a.setProperty("/alp/fullScreen",t)},onDialogClosed:function(e){N.visualFilterDialogContainer._closeDialog.call(N.visualFilterDialogContainer,e)},onDialogOpened:function(e){if(!N.visualFilterDialogContainer){N.visualFilterDialogContainer=new i;N.visualFilterDialogContainer.init(N)}var t=N.oController.getView().getModel("_templPriv"),a=R,r={},n;n=t.getProperty("/alp/searchable");if(!n){if(N.alr_visualFilterBar&&!N.alr_visualFilterBar.getAssociateValueListsCalled()){N.alr_visualFilterBar.setAssociateValueListsCalled(true);N.oSmartFilterbar.associateValueLists()}}r.item=new p({icon:"sap-icon://filter-analytics",tooltip:"{i18n>FILTER_VISUAL}",key:a,enabled:"{_templPriv>/alp/searchable}"});r.selectionChange=function(e){N.visualFilterDialogContainer._toggle.call(N.visualFilterDialogContainer,e)};r.content=N.visualFilterDialogContainer._createForm();r.search=function(e){N.visualFilterDialogContainer._triggerSearchInFilterDialog.call(N.visualFilterDialogContainer,e)};r.filterSelect=function(e){N.visualFilterDialogContainer._triggerDropdownSearch.call(N.visualFilterDialogContainer,e)};N.oSmartFilterbar.addAdaptFilterDialogCustomContent(r)},onDialogClear:function(e){x.onClearFilterExtension(e)},onRestore:function(e){N.visualFilterDialogContainer._restoreDialog.call(N.visualFilterDialogContainer)},onDialogCancel:function(e){N.visualFilterDialogContainer._cancelDialog.call(N.visualFilterDialogContainer)},onRowSelectionChange:function(e){var t=e.getSource();V.oCommonUtils.setEnabledToolbarButtons(t)},dataStateFilter:function(e,t){return N.oMessageStripHelper.dataStateFilter(e,t)},dataStateClose:function(){N.oMessageStripHelper.onClose()},onAddCardsToRepository:function(e){var t=V.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(N.oSmartChart);t.getInitializationPromise().then(function(){N.oInsightsHandler.prepareAndShowCard(e,{cardType:"Analytical"},t)})},onBeforeExport:function(e){V.oCommonEventHandlers.onBeforeExport(e)},beforeOpenContextMenu:function(e,t){k.beforeOpenContextMenu(e,t)},onContextMenu:function(e,t){k.onContextMenu(e,t)}},formatters:{formatItemTextForMultipleView:function(e){return N.oMultipleViewsHandler?N.oMultipleViewsHandler.formatItemTextForMultipleView(e):""},formatMessageStrip:function(e,t){return N.oMultipleViewsHandler?N.oMultipleViewsHandler.formatMessageStrip(e,t):""}},extensionAPI:new t(V,x,N)}}}});
//# sourceMappingURL=ControllerImplementation.js.map