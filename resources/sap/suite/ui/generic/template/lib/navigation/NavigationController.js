/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/base/util/isEmptyObject","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/core/library","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/jsonHelper","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/suite/ui/generic/template/genericUtilities/ProcessObserver","sap/suite/ui/generic/template/genericUtilities/Queue","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/navigation/startupParameterHelper","sap/suite/ui/generic/template/lib/TemplateComponent","sap/base/strings/whitespaceReplacer","sap/m/IllustratedMessageType","sap/ui/util/openWindow"],function(e,t,r,n,a,o,i,s,u,l,d,p,c,f,v,g,y,m,h,b,C){"use strict";var N="lib.navigation.NavigationController";var P=new s(N).getLogger();var k=o.routing.HistoryDirection;var R=a.getInstance();var H=sap.ui.require("sap/ushell/Container");var T=function(){};function S(e){e=e||R.getDirection();return e===k.Backwards}var L=g.getCrossAppNavServicePromise();var I="sap-iapp-state--create";var B="sap-iapp-state--history";function x(e){var t=e.substring(e.length-5,e.length);if(t==="query"){return e.substring(0,e.length-5)}return e}function A(e){if(e.indexOf("/")===0){return e}return"/"+e}function w(e){var t="";var r="";var n=Object.keys(e).sort();n.forEach(function(n){var a=e[n];if(Array.isArray(a)){var o=a.sort();for(var i=0;i<o.length;i++){var s=o[i];r=r+t+n+"="+s;t="&"}}else{r=r+t+n+"="+a;t="&"}});return r}function D(e,t){e=e||"";var r=e.charAt(e.length-1)==="/"?"?":"/?";return e+(t?r+t:"")}function F(e,a){var o=[];var s,N;var F;var O;var M;var E;var j,U;var K;var V;var q;var z;var _=["-","-","-"];var Q=Promise.resolve();var G=(new p).start();function W(t,r,n){var a=t.iHashChangeCount+1;U={iHashChangeCount:a,backTarget:t.iHashChangeCount,componentsDisplayed:Object.create(null),LeaveByBack:true,backSteps:1};if(r){K.followUpNeeded={mode:r.mode,displayMode:r.displayMode,identity:{treeNode:e.mRoutingTree[r.route],keys:r.keys,appStates:r.appStates}};Oe(null)}if(n){e.oApplicationProxy.setNextFocus(function(){setTimeout(function(){i.focusControl(n)},0)})}}function J(r){V=false;e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true);q={};F=S();var n=[];if(F){e.oBusyHelper.getUnbusy().then(function(){F=false});K={mode:-1};if(o.length){var i=o.pop();M=i.isInitialNavigation;O=i.myIntentPromise;E=i.previousHashes;E.push(i.currentHash);W(i.currentHash,i.serializedBackOption,i.focus);return}}else{var s=L.then(function(e){return e.isInitialNavigation().then(function(e){M=e})});n.push(s)}var u=H&&new Promise(function(e){H.getServiceAsync("AppLifeCycle").then(function(t){var n=t.getCurrentApplication();var a=function(){n=n||t.getCurrentApplication();var a=r&&(n.disableKeepAliveAppRouterRetrigger&&n.disableKeepAliveAppRouterRetrigger.bind(n,false)||t.disableKeepAliveAppRouterRetrigger&&t.disableKeepAliveAppRouterRetrigger.bind(t,false));(a||Function.prototype)();var o=n.getIntent();e(o)};if(n){a()}else{t.attachAppLoaded(null,a)}})});O=u?Promise.all([u,H&&H.getServiceAsync("URLParsing")]).then(function(e){var r=t({},e[0]);var n=e[1];r.appSpecificRoute="&/";var a=n.constructShellHash(r);return"#"+a}):Promise.resolve("");var l=e.oAppComponent.getComponentData();e.myIntentPromise=l&&l.feEnvironment&&l.feEnvironment.getIntent&&Promise.resolve(l.feEnvironment.getIntent())||u||Promise.resolve({semanticObject:"",action:""});te();var d=r?a.initialize:Function.prototype;var p=!F&&!a.oHashChanger.getHash()&&l;var c=p&&p.startupParameters;if(c){y.parametersToNavigation(e,c).then(function(t){if(t){j={treeNode:e.mRoutingTree.root,keys:[],appStates:Object.create(null)};kt(t)}d(!!t)})}else{d()}return Promise.all(n)}var X=Promise.resolve();var Y=Promise.resolve();var Z=new d;function $(){var e=S();if(!e){var t=ee();o.push({isInitialNavigation:M,myIntentPromise:O,currentHash:U,previousHashes:E,serializedBackOption:t.serializedBackOption,focus:t.focus})}O=null;U=null;E=null;j=null;z=null;q=null}function ee(e){var t=s.getData()||{};if(t.focus){return t}if(!e){var r=i.getControlWithFocus();e=r&&r.getId()}if(e){t.focus=e;s.setData(t);s.save()}return t}function te(e){U={iHashChangeCount:0,backTarget:0,componentsDisplayed:Object.create(null)};j=e?j:null;E=[];if(!F){K=null}z=null}function re(){return Ot(e.mRoutingTree.root.sRouteName).then(function(){return e.mRoutingTree.root.componentCreated})}function ne(){return a.oAppComponent.getManifestEntry("sap.app").title}function ae(){return a.oAppComponent.getProperty("draftDiscardConfirmationSettings").enabled}function oe(){return H&&H.getServiceAsync("URLParsing")}function ie(r,n,a){if(!r){return Promise.resolve()}var o=r&&e.componentRegistry[r];var i=[];var s=o&&o.methods.getUrlParameterInfo;if(s){i.push(o.viewRegistered.then(function(){var e=n&&A(n);return s(e,U.componentsDisplayed[o.route]===1).then(function(e){t(a,e)})}))}i.push(o.oStatePreserverPromise.then(function(e){var r=n&&A(n);return e.getUrlParameterInfo(r,U.componentsDisplayed[o.route]===1).then(function(e){t(a,e)})}));return Promise.all(i)}function se(e){var t=e.treeNode.componentId;var r=e.treeNode.getPath(2,e.keys);var n=e.appStates;return ie(t,r,n)}function ue(t,r){if(t.treeNode===r.treeNode){r.appStates=t.appStates;return Promise.resolve()}r.appStates=Object.create(null);if(r.treeNode.fCLLevel===0||r.treeNode.fCLLevel===3){return se(r)}return e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(j,r)}function le(t,r,n){var a=e.mRoutingTree[t];return ie(a.componentId,n,r)}function de(t,r){var n;if(!t&&r instanceof m){var a=r&&e.componentRegistry[r.getId()];var o=a&&a.methods.getTitle;n=o&&o()}else if(!t&&r&&r.title){n=r.title}n=n||ne();e.oShellServicePromise.then(function(t){var r=e.componentRegistry[j.treeNode.componentId];var a=r.oControllerUtils&&r.oControllerUtils.oServices.oTemplateCapabilities.fnConstructTitleAdditionalInfo;if(a){t.setTitle(n,r.oControllerUtils.oServices.oTemplateCapabilities.fnConstructTitleAdditionalInfo(n,e,j))}else{t.setTitle(n)}var o=r.utils.getTemplatePrivateModel();o.setProperty("/objectPage/headerInfo/objectShellTitle",n)}).catch(function(){P.warning("No ShellService available")})}function pe(t){var n=[e.oPagesDataLoadedObserver.getProcessFinished(true)];var a=null;var o=U.iHashChangeCount;delete j.componentsDisplayed;var i=-1;var s=[];for(var u in e.componentRegistry){var l=e.componentRegistry[u];var d=l.oControllerUtils&&l.oControllerUtils.oServices.oTemplateCapabilities.oMessageButtonHelper;var p=U.componentsDisplayed[l.route]===1;var c=l.utils.getTemplatePrivateModel();c.setProperty("/generic/isActive",p);if(p){if(l.viewLevel>0){var f=e.mRoutingTree[l.route];if(f.isDraft){s.push(c)}}n.push(l.oViewRenderedPromise);if(l.viewLevel>i){i=l.viewLevel;a=l.oComponent}}else{l.utils.suspendBinding()}if(d){d.setEnabled(p)}}Promise.all(n).then(function(){var n=r(U.componentsDisplayed)||e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isAppTitlePrefered();de(n,t||a);if(o===U.iHashChangeCount&&r(q)){e.oAppComponent.firePageDataLoaded()}var i=s.some(function(e){return e.getProperty("/objectPage/displayMode")>1});var u=e.oAppComponent.getModel();u.setTransitionMessagesOnlyForGroup("Changes",i)})}var ce=pe.bind(null,null);c.testable(function(e){j=e;E.push(U);U={backTarget:0,componentsDisplayed:Object.create(null)}},"setCurrentIdentity");c.testable(function(e){N=e},"setHistoryKey");function fe(){return j}function ve(e,t){if(Array.isArray(e)&&e.length<2){e=e[0]}if(Array.isArray(t)&&t.length<2){t=t[0]}if(Array.isArray(e)){if(Array.isArray(t)){if(e.length===t.length){e=e.sort();t=t.sort();return e.every(function(e,r){return e===t[r]})}return false}return false}return t===e}function ge(n,a){if(!n||n.treeNode!==a.treeNode){return false}for(var o=a.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){if(!o.noKey&&a.keys[o.level]!==n.keys[o.level]){return false}}if(r(n.appStates)){return r(a.appStates)}var i=t(Object.create(null),a.appStates,n.appStates);for(var s in i){var u=s===B?N:a.appStates[s];if(!ve(u,n.appStates[s])){return false}}return true}function ye(e){return ge(j,e)}function me(t,n,a){var o=Object.create(null);for(var i=t;i.level>0;i=e.mRoutingTree[i.parentRoute]){if(!i.noKey){o["keys"+i.level]=n[i.level]}}var s=!r(a);var u=t.sRouteName+(s?"query":"");if(s){o["query"]=a}return{route:u,parameters:o}}function he(t){var r=me(K.identity.treeNode,K.identity.keys,K.identity.appStates);if(!e.ghostapp){a.oRouter.navTo(r.route,r.parameters,t)}}function be(t){if(!t||!K.identity){return}var r=function(r,n,a){a=n?n.getId():a;var o=e.componentRegistry[a];(o.methods.presetDisplayMode||Function.prototype)(t,r)};for(var n=K.identity.treeNode;n;n=n.parentRoute&&e.mRoutingTree[n.parentRoute]){if(n.componentId){r(U.componentsDisplayed[n.sRouteName]===1,null,n.componentId)}else{n.componentCreated.then(r.bind(null,false))}if(n.fCLLevel===0||n.fCLLevel===3){break}}}function Ce(e){if(!K||K.identity){return Promise.resolve(e)}var t=U;for(var r=0;r>e;r--){if(t.backTarget===0){return Promise.resolve(e)}t=E[t.backTarget]}K.mode=e;while(ye(t.identity)){K.mode--;if(t.backTarget===0){return Promise.resolve(K.mode)}t=E[t.backTarget]}if(t.identity.treeNode.level===0){K.identity=t.identity;return Promise.resolve(K.mode)}return Dt(t.identity).then(function(e){if(!e){K.identity=t.identity;return Promise.resolve(K.mode)}if(ye(e.identity)){K.mode--;return Ce(K.mode)}K.identity=e.identity;K.followUpNeeded=true;return Promise.resolve(K.mode)})}function Ne(t){var r;if(t){if(t.identity){t.identity.appStates[B]=N}if(K){if(t.identity){K={identity:t.identity,followUpNeeded:true,mode:K?K.mode:0};be(t.displayMode)}return}if(t.identity&&ye(t.identity)){return}r=t.mode;if(r===1&&t.identity&&U.backTarget&&ge(E[U.backTarget],t.identity)){r=-1}K={identity:t.identity,mode:r};be(t.displayMode)}else{r=1}K.followUpNeeded=K.identity&&r<0;if(K.identity||r===-1&&U.backTarget){e.oBusyHelper.setBusyReason("HashChange",!e.ghostapp,undefined,undefined,true);G.stop()}else{K=null}if(r>=0){he(r===1)}else if(!e.ghostapp){return Ce(r).then(function(e){window.history.go(e)})}}function Pe(e,t){e.text=e.headerTitle!==t&&t||"";if(z&&z.linkInfos.length>e.level){z.adjustNavigationHierarchy()}}function ke(t,r){var o=Object.create(null);if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(o,t)}var i={treeNode:t};var s={treeNode:t,keys:j.keys.slice(0,t.level+1),appStates:o};var u;var l=se(s).then(function(){var e=me(t,j.keys,o);u=a.oRouter.getURL(e.route,e.parameters);o[B]=N;e=me(t,j.keys,o);i.fullLink=a.oRouter.getURL(e.route,e.parameters)});r.push(l);i.navigate=function(r,n){if(e.oFlexibleColumnLayoutHandler&&!n){var a;for(var i=E[U.backTarget];i.backTarget>0&&!a;i=E[i.backTarget]){if(i.identity.treeNode===t){a=i.identity}}e.oFlexibleColumnLayoutHandler.adaptPreferredLayout(o,t,a)}e.oBusyHelper.setBusy(l.then(function(){return Ve(s,false,r)}),undefined,undefined,true)};i.adaptBreadCrumbLink=function(e){l.then(function(){var t=n.getInstance();var r=t.hrefForAppSpecificHash?t.hrefForAppSpecificHash(u):"#/"+u;e.setHref(r)})};return i}function Re(e,t){var r={title:h(t.treeNode.headerTitle||""),icon:t.treeNode.titleIconUrl||"",subtitle:h(t.treeNode.text),intent:e+t.fullLink};return r}function He(){var t=[];var r=[O];var n=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.hasNavigationMenuSelfLink(j);for(var a=n?j.treeNode:e.mRoutingTree[j.treeNode.parentRoute];a;a=e.mRoutingTree[a.parentRoute]){var o=ke(a,r);t[a.level]=o}var i=Promise.all(r);var s=function(){e.oShellServicePromise.then(function(e){e.setHierarchy([]);i.then(function(r){var n=r[0];var a=[];for(var o=t.length-1;o>=0;o--){a.push(Re(n,t[o]))}e.setHierarchy(a)})}).catch(function(){P.warning("No ShellService available")})};z={linkInfos:t,adjustNavigationHierarchy:s};s()}function Te(){return z.linkInfos}function Se(t,r){var n=Object.create(null);var a=x(t);n.treeNode=e.mRoutingTree[a];n.appStates=r["?query"]||Object.create(null);n.keys=[""];for(var o=n.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){n.keys[o.level]=o.noKey?"":r["keys"+o.level]}return n}function Le(e){var t=j;if(K&&K.identity&&!K.followUpNeeded){j=K.identity}else{var r=e.getParameter("config");j=Se(r.name,e.getParameter("arguments"))}j.previousIdentity=t;j.componentsDisplayed=Object.create(null);j.componentsDisplayed[j.treeNode.sRouteName]=1;if(j.treeNode.level===0){Be=null}He()}function Ie(r,n){var a={identity:{treeNode:j.treeNode,keys:j.keys,appStates:t(Object.create(null),j.appStates)},mode:1};if(Array.isArray(n)&&n.length<2){n=n[0]}if(n){a.identity.appStates[r]=n}else{delete a.identity.appStates[r]}var o=Z.getProcessFinished(true).then(function(){Ne(a)});e.oBusyHelper.setBusy(o,undefined,undefined,true);return o}var Be;function xe(t,r,n,a,o,i){var s=t.then(function(t){t.appStates=i||Object.create(null);var s;if(t.treeNode.fCLLevel===0||t.treeNode.fCLLevel===3){s=se(t)}else{s=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(j,t)}if(!r&&o&&o.bIsCreate&&o.bIsDraft&&!o.bIsDraftModified){Be={index:E.length,path:a.getPath(),identity:t,displayMode:tt()}}return s.then(function(){return Ve(t,r,n)})});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}function Ae(t,r,n,a,o){if(!t||Array.isArray(t)&&t.length===0){return yt(r)}var i=Array.isArray(t)?t:[t];var s=i.length===1&&(!j||j.treeNode.level>0)&&l.analyseContext(i[0]);var u=s&&e.mEntityTree[s.entitySet];var d=u&&(u.level===1?["",s.key]:e.oApplicationProxy.getIdentityKeyForContext(i[0]));var p=d?Promise.resolve({treeNode:u,keys:d}):new Promise(function(e,t){var r=0,n;var a=function(){if(r==i.length){e(n)}else{var t=i[r];var o=We(n,t,true,true);o.promise.then(function(e){r++;n=e;a()})}};a()});var c=!u||Ge(u);e.oBusyHelper.setBusy(p,undefined,undefined,c);return xe(p,r,n,i[0],a,o)}function we(t,r,n,a){var o=We(null,t,true,true);var i=o.promise;e.oBusyHelper.setBusy(i,undefined,undefined,o.willShowPlaceholder);return xe(i,r,n,t,a).then(Function.prototype,Function.prototype)}function De(r){var n=r.getPath();if(!Be||Be.path!==n){if(n===j.treeNode.getPath(2,j.keys)&&r.getObject().HasActiveEntity){return e.oApplicationProxy.getSiblingPromise(n).then(function(e){var t={treeNode:j.treeNode,keys:["",l.analyseContext(e).key],appStates:j.appStates};return{identity:t,mode:1,displayMode:1}},function(){var t={treeNode:e.mRoutingTree.root,keys:[""],appStates:Object.create(null)};var r=se(t);return r.then(function(){return{identity:t,mode:1,displayMode:1}})})}return null}var a;var o=function(e,t){return e!==a.identity.keys[t]};for(var i=Be.index+1;i<E.length;i++){a=E[i];if(!a.identity||!a.identity.treeNode||a.identity.treeNode.level<Be.identity.treeNode.level||Be.identity.keys.some(o)){return null}}var s=0;for(var u=U;u.iHashChangeCount!==Be.index;u=E[u.backTarget]){if(u.iHashChangeCount<Be.index){return null}s--}var d=E[Be.index].identity;var p={treeNode:d.treeNode,keys:d.keys,appStates:Object.create(null)};var c={identity:p,mode:s,displayMode:Be.displayMode};if(d.treeNode.fCLLevel===0||d.treeNode.fCLLevel===3){t(p.appStates,d.appStates);return Promise.resolve(c)}return e.oFlexibleColumnLayoutHandler.getSpecialDraftCancelPromise(j,d,p.appStates).then(function(){return c})}function Fe(e){return Ne.bind(null,e)}function Oe(e){var t=s.getData();if(!t){if(!e){return}t={}}t.serializedBackOption=e&&{mode:e.mode,displayMode:e.displayMode,route:e.identity.treeNode.sRouteName,keys:e.identity.keys,appStates:e.identity.appStates};s.setData(t);s.save()}function Me(t){var r=[];var n=Object.create(null);return e.oApplicationProxy.fillSiblingKeyPromise(j.treeNode,j.keys,r,t).then(function(e){return Je(e,n,r).then(function(){return{treeNode:e,keys:r,appStates:n}})})}function Ee(e,t){var r=1+e;return Me(t).then(function(e){return G.makeQueuable(Ve.bind(null,e,true,r,false))})}function je(r,n,a,o){var i=l.analyseContext(r);var s={keys:["",i.key],appStates:Object.create(null)};var u=o?s:G.makeQueuable(Ve.bind(null,s,true,n,false));if(j.treeNode.level===1){s.treeNode=j.treeNode;t(s.appStates,j.appStates);return Promise.resolve(u)}if(a){a.keys.forEach(function(e){if(e){s.keys.push(e)}});s.treeNode=a.treeNode}if(s.treeNode===j.treeNode){t(s.appStates,j.appStates);return Promise.resolve(u)}var d=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(j,s);return d.then(function(){return u})}function Ue(t,r){if((t&&t.treeNode)!==r.treeNode){return Promise.resolve(false)}if(e.oFlexibleColumnLayoutHandler&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(t,r)){return Promise.resolve(false)}var n=true;var a=t.treeNode.sRouteName;for(var o=t.treeNode;o.level>0;o=e.mRoutingTree[o.parentRoute]){var i=o.noKey||t.keys[o.level]===r.keys[o.level];if(!i&&o.noOData){return Promise.resolve(false)}n=n&&i;if(o.noOData){a=o.parentRoute}}if(n){return Promise.resolve(true)}var s=e.mRoutingTree[a];var u=t.keys.slice(0,s.level+1);var l=r.keys.slice(0,s.level+1);var d=s.getPath(2,u);var p=s.getPath(2,l);return e.oApplicationProxy.areTwoKnownPathesIdentical(d,p,s.level===1,t,r)}function Ke(t){var r=E[U.backTarget];var n=-1;if(r&&(t.level===0||e.oFlexibleColumnLayoutHandler&&t.fCLLevel===0)){for(;r.backTarget>0&&r.identity.treeNode&&r.identity.treeNode.level>t.level;n--){r=E[r.backTarget]}}return r&&{candidateHash:r,candidateCount:n}}function Ve(t,r,n,a){var o=Ke(t.treeNode);var i=Ue(o&&o.candidateHash.identity,t);var s=i.then(function(e){var i=e?o.candidateCount:0+!!r;var s={identity:t,mode:i,displayMode:n};if(a){return s}Ne(s)});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}function qe(e){if(F){return yt(true)}var t=ze();kt({title:t.dataLoadFailedTitle,text:t.dataLoadFailedText,description:"",viewLevel:e.fCLLevel,messageType:b.NoData});return Promise.resolve()}function ze(){return{dataLoadFailedTitle:e.getText("ST_ERROR"),dataLoadFailedText:e.getText("ST_GENERIC_ERROR_LOAD_DATA_TEXT")}}function _e(t,r,n,a){if(!r){return{treeNode:e.mRoutingTree.root,key:""}}var o=l.analyseContext(r);var i=t.level&&t.entitySet===o.entitySet?t:t.children.indexOf(o.entitySet)>=0&&e.mEntityTree[o.entitySet];if(i){return{treeNode:i,key:o.key}}if(n){var s=e.oAppComponent.getModel();var u=s.getMetaModel();var d=u.getODataEntitySet(o.entitySet);var p=u.getODataEntityType(d.entityType);var c;var f=t.children.some(function(t){i=e.mEntityTree[t];c=i.navigationProperty;if(!c){return false}var r=u.getODataAssociationEnd(p,c);return!!r&&r.multiplicity.endsWith("1")});if(f){return{treeNode:i,navigationProperty:c}}}if(a&&t.level>0){var v=e.mRoutingTree[t.parentRoute];return _e(v,r,n,true)}}function Qe(e,t,r,n){if(n.navigationProperty){return new Promise(function(a,o){var i=r.getModel();i.createBindingContext(n.navigationProperty,r,null,function(r){var i=r&&Qe(e,t,r,{treeNode:n.treeNode,key:l.analyseContext(r).key});if(i){i.then(a,o)}else{o()}})})}var a=t.slice(0,n.treeNode.level);a.push(n.key);return Promise.resolve({treeNode:n.treeNode,keys:a})}function Ge(t){return e.bEnablePlaceholder&&t.componentId!==_[Math.min(t.fCLLevel,2)]&&(t.level>0||!t.componentId)&&!!(t.behaviour&&t.behaviour.getPlaceholderInfo())}function We(t,r,n,a){var o=t&&t.treeNode||j&&j.treeNode||e.mRoutingTree.root;var i=t&&t.keys||j&&j.keys||[""];var s=_e(o,r,n,a);var u=s&&s.treeNode;return u?{promise:Qe(o,i,r,s),targetNode:u,willShowPlaceholder:Ge(u)}:{promise:Promise.reject()}}function Je(t,r,n){var a={treeNode:t,keys:n||j.keys.slice(0,t.level+1),appStates:r};if(t.fCLLevel===0||t.fCLLevel===3){return se(a)}return e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForNavigation(j,a)}function Xe(t,r){var n=We({treeNode:e.mRoutingTree.root},t,false,true);var a=n.promise;var o=a.then(function(e){e.appStates=Object.create(null);if(e.treeNode===j.treeNode){Object.assign(e.appStates,j.appStates);var t={identity:e,mode:1,displayMode:1};if(r){return t}Ne(t);return null}var n=Je(e.treeNode,e.appStates);return n.then(Ve.bind(null,e,true,1,r))});e.oBusyHelper.setBusy(o,undefined,undefined,n.willShowPlaceholder);return o}function Ye(t){var r;var n=0;for(r=U;r.backTarget>0&&(!r.identity||!r.identity.treeNode||r.identity.treeNode.level>t);n++){r=E[r.backTarget]}if(!M&&(n===0||!r.identity.treeNode||r.identity.treeNode.level>t)){window.history.go(-n-1);return Promise.resolve()}var a=-n||1;var o=Lt(t);var i={treeNode:o,keys:j.keys.slice(0,o.level+1),appStates:Object.create(null)};var s=Je(i.treeNode,i.appStates).then(function(){if(a<0&&(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2)&&r.identity.treeNode===i.treeNode){for(;r.backTarget>0&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(r.identity,i);a--){r=E[r.backTarget];if(r.identity.treeNode!==i.treeNode){break}}}var t={identity:i,mode:a,displayMode:i.treeNode.isDraft?6:1};Ne(t)});e.oBusyHelper.setBusy(s,undefined,undefined,true);return s}var Ze;function $e(t,r,n,a){var o=e.mEntityTree[t];var i=e.componentRegistry[o.componentId];var s;if(r){s=L.then(function(t){return t.createEmptyAppState(e.oAppComponent).then(function(e){e.setData(u.getStringifiable(r));e.save();return e.getKey()})})}else{s=Promise.resolve()}var l=j?j.keys.slice(0,o.level):[""];l.push("-");a=a||Object.create(null);var d=Je(o,a,l);var p=Promise.all([s,d]).then(function(e){var t=e[0];if(t){a[I]=t}var r={treeNode:o,keys:l,appStates:a};Ze=n;if(ye(r)){var s={componentsDisplayed:U.componentsDisplayed,isNonDraftCreate:true};return xt("-",s,i.oComponent)}else{var u=!j||!!(i&&i.nonDraftCreateContext);return Ve(r,u,4)}});e.oBusyHelper.setBusy(p,undefined,undefined,true);return p}function et(r){var n=We(null,r,false,false);var a=n.promise;var o=a.then(function(e){e.appStates=Object.create(null);t(e.appStates,j.appStates);delete e.appStates[I];var r={identity:e,mode:1};Ne(r)});e.oBusyHelper.setBusy(o,undefined,undefined,n.willShowPlaceholder);return o}function tt(){var t=e.componentRegistry[j.treeNode.componentId];var r=t.utils.getTemplatePrivateModel();var n=r.getProperty("/objectPage/displayMode")||0;return n}function rt(t,r,n,a,o){var i=j.keys.slice(0,t.level);i.push(r?n:"");var s=Object.create(null);var u=Je(t,s,i);var l=u.then(function(){var e={treeNode:t,keys:i,appStates:s};return Ve(e,a,o)});e.oBusyHelper.setBusy(l,undefined,undefined,true);return l}function nt(t,r,n,a,o,i){var s;var u=true;for(var l=0;l<t.children.length&&!s;l++){var d=t.children[l];var p=e.mEntityTree[d];if(p[t.level?"navigationProperty":"sRouteName"]===r){s=p.sRouteName;u=!p.noKey}}var c=!s&&n&&t.embeddedComponents[n];if(c){for(var f=0;f<c.pages.length&&!s;f++){var v=c.pages[f];if(v.navigationProperty===r){s=t.sRouteName+"/"+n+"/"+r;u=!(v.routingSpec&&v.routingSpec.noKey)}}}if(s){var g=e.mRoutingTree[s];if(!i){i=tt()}return rt(g,u,a,o,i)}if(!n&&t.level>0){return nt(e.mRoutingTree[t.parentRoute],r,null,a,o,i)}return Promise.reject()}function at(t,r,n,a){var o=We({treeNode:t},r,true,false);var i=o.promise;var s=i.then(function(e){e.appStates=Object.create(null);var t=Je(e.treeNode,e.appStates,e.keys);return t.then(Ve.bind(null,e,a,n,false))});e.oBusyHelper.setBusy(s,undefined,undefined,o.willShowPlaceholder);return s}function ot(t){var r={};var n=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFullscreenLayout(t.treeNode.fCLLevel);if(n){r["FCLLayout"]=n}var o=me(t.treeNode,t.keys,r);var i=a.oRouter.getURL(o.route,o.parameters);var s=i.startsWith("/")?"&":"&/";i=s+i;return ut(i)}function it(e,t){var r=We({treeNode:e},t,true,false);var n=r.promise;return n.then(ot).then(function(e){C(e)}).catch(function(e){P.error("Error while opening the context '"+t.getPath()+"' in a new tab: "+e)})}function st(e,t){var r=We({treeNode:e},t,true,false);var n=r.promise;return n.then(ot).catch(function(e){P.error("Error while getting the URL for the context '"+t.getPath()+"': "+e)})}function ut(e){var t=sap.ui.require("sap/ushell/Container");if(!t){return Promise.reject("Unable to proceed as 'sap/ushell/Container' is not found!")}e=encodeURI(e);var r=t.getServiceAsync("URLParsing");var n=t.getFLPUrlAsync(true);return Promise.all([r,n]).then(function(t){var r=t[0];var n=t[1];var a=new URL(n);var o=a.hash;var i=r.parseShellHash(o);i.appSpecificRoute=e;o=r.constructShellHash(i);a.hash=o;return a.toString()})}function lt(r,n){var a=e.oAppComponent.getModel();var o;var i=n.lastIndexOf("/");if(i>0){var s=n.substring(i);if(s.indexOf("(")<0){o=n.substring(0,i)}else{o=n}}else{o=n}var u=[];var d,p;var c;var f;var g=function(){c=c.substring(0,c.length-f.length-2);c=c.substring(0,c.lastIndexOf("/"));p=p&&e.mRoutingTree[p.parentRoute]};for(c=o;c&&(!p||p.level>0);g()){var y=l.analyseContextPath(c,a);f=y.key||"";if(!d){d=e.mEntityTree[y.entitySet];p=d}if(p){if(p.noOData||p.noKey||!p.isDraft){return null}u.push(f)}}if(!d){return null}u.push("");u.reverse();var m=d.getPath(2,u);if(!n.startsWith(m)){return null}var h={treeNode:d,keys:u,appStates:Object.create(null)};var b={identity:h,mode:0,displayMode:6};var C;if(d===j.treeNode){if(u.every(function(e,t){return e===j.keys[t]})){return null}t(h.appStates,j.appStates);C=Promise.resolve()}else{C=se(h).then(function(){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(h.appStates,d)}})}var N=function(t,n){var a=sap.ui.getCore().getMessageManager();var o=a.getMessageModel();var i=o.bindList("/");var s=r.aTargets;var u;i.getAllCurrentContexts().some(function(e){var t=e.getObject();var r=t.aTargets;if(s.length===r.length&&s.every(function(e){return r.indexOf(e)>=0})){u=t;return true}});if(u){var l=e.componentRegistry[d.componentId];var p=l.oControllerUtils;v.prepareForMessageHandling([u],p);v.navigateFromMessageTitleEvent(p,u,l.oComponent,false,m);return}n()};var P=C.then(function(){Ne(b);return true});e.oBusyHelper.setBusy(Promise.all([P,d.componentCreated]));e.oApplicationProxy.setNextFocus(N);return P}function dt(){return!!K}function pt(t){P.info("Navigate back");if(U.backTarget&&A(R.getPreviousHash()||"")!==A(U.hash)){e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true)}U.LeaveByBack=!U.forwardingInfo;if(U.LeaveByBack){U.backSteps=t}window.history.go(-t)}function ct(t,r){t=A(t||"");P.info("Navigate to hash: "+t);if(t===U.hash){P.info("Navigation suppressed since hash is the current hash");return}U.targetHash=t;if(U.backTarget&&A(R.getPreviousHash()||"")===t){a.navigateBack();return}e.oBusyHelper.setBusyReason("HashChange",true,undefined,undefined,true);U.LeaveByReplace=r;if(r){a.oHashChanger.replaceHash(t)}else{a.oHashChanger.setHash(t)}}function ft(t,r,n,a){var o=r.then(function(e){t=D(t,e);if(a){U.backwardingInfo={count:a.count,index:a.index,targetHash:A(t)};pt(a.count)}else{ct(t,n)}return t});e.oBusyHelper.setBusy(o,undefined,undefined,true);return o}function vt(e,t,r){var n=E[U.backTarget];return n&&n.hash&&A(n.hash.split("?")[0])===A(t)&&{count:1,index:U.backTarget}}function gt(){var t={treeNode:e.mRoutingTree.root,keys:[""],appStates:Object.create(null)};var r=se(t);return r.then(function(){return t})}function yt(t){if(j.treeNode.level===0){return Promise.resolve()}var r=gt();var n=r.then(function(e){Ve(e,t)});e.oBusyHelper.setBusy(n,undefined,undefined,true);return n}function mt(t,r){var n=U.componentsDisplayed;var a=function(t){var a=e.componentRegistry[t.getId()];(a.methods.presetDisplayMode||Function.prototype)(r,n[a.route]===1)};for(var o=0;o<t.length;o++){var i=t[o];i.then(a)}}function ht(t,r,n,a){var o={};var i=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFCLAppStatesPromise(t,o);var s=le(t,o,r);var u=(i?Promise.all([i,s]):s).then(w.bind(null,o));var l=vt(a,r,n);var d=ft(r,u,a,l);e.oBusyHelper.setBusy(d,undefined,undefined,true);return d}function bt(e,t,r,n){if(typeof e==="string"){var a=e;var o=A(a);if(o==="/"){return yt(r)}var i=o.split("/");var s=i.length-1;var u=[];var l;switch(s){case 1:l=i[1].split("(")[0];break;default:l="";var d="";for(var p=0;p<s;p++){var c=i[p+1];var f=c.indexOf("(");if(f>0){c=c.substring(0,f)}l=l+d+c;d="/"}l=l.replace(g.getEmbeddedComponentsPatternDelimiter(),"/")}mt(u,n||0);return ht(l,a,s,r)}return Ae(e,r,n)}function Ct(t,r){U.componentsDisplayed[t]=r;var n=e.mRoutingTree[t];var a=n.componentId;if(a){var o=e.componentRegistry[a];var i=o.utils.getTemplatePrivateModel();i.setProperty("/generic/isActive",r===1)}}function Nt(t){var r,n,o,i;if(t){r=t.text;o=t.messageType||b.UnableToUpload;n=t.description;i=t.additionalContent}e.oTemplatePrivateGlobalModel.setProperty("/generic/messagePage",{text:r,messageType:o,description:n,additionalContent:i});if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.displayMessagePage(t,U.componentsDisplayed)}else{var s=a.oRouter.getTargets();if(!e.ghostapp){var u=s.display("messagePage");e.oBusyHelper.setBusy(u)}for(var l in U.componentsDisplayed){Ct(l,5)}}pe(t)}function Pt(){if(!r(q)){var e=null;for(var t=0;!e;t++){e=q[t]}q={};Nt(e)}}function kt(t){if(e.oAppComponent.isDestroyed()){return}if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.hidePlaceholder();t.viewLevel=t.viewLevel||0;q[t.viewLevel]=t;var r=Promise.all([Y,e.oPagesDataLoadedObserver.getProcessFinished(true)]);r.then(Pt);r.then(e.oBusyHelper.setBusyReason.bind(null,"HashChange",false,undefined,undefined,true));return}e.oNavigationHost.hidePlaceholder();Nt(t);e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true)}function Rt(){var t=[];if(j){var r=j.componentsDisplayed||U.componentsDisplayed;for(var n in e.componentRegistry){var a=e.componentRegistry[n];if(r[a.route]===1){t.push(n)}}}return t.sort(function(t,r){return e.componentRegistry[t].viewLevel-e.componentRegistry[r].viewLevel})}function Ht(){var t=[];for(var r in e.componentRegistry){t.push(r)}return t}function Tt(e){return j.keys.slice(0,e+1)}function St(){var t=j.treeNode.componentId;var r=e.componentRegistry[t];var n=!!r.nonDraftCreateContext;if(n){var a=Object.assign({},U);a.isNonDraftCreate=n;return a}return U}function Lt(t){return e.oApplicationProxy.getAncestralNode(j.treeNode,t)}function It(t,r){return t?new Promise(function(n,a){L.then(function(o){var i=o.getAppState(e.oAppComponent,t);i.then(function(e){var t=e.getData();if(t===undefined){a(undefined);return}if(r){t=u.deStringify(t)}n(t)}).catch(function(){i.catch(a.bind(null,undefined))})})}):Promise.reject()}function Bt(e,t,r){var n=false;for(var a=0;a<e.length;a++){var o=e[a];if(o.isStateChange(t)){n=r?false:true}}return n}function xt(t,r,n){var a=n.getId();var o=e.componentRegistry[a];var i=Tt(o.viewLevel);var s=o.route;var u=r.componentsDisplayed[s];var l=u===1;var d=function(t){o.sCurrentBindingPath=t;var r=function(){var r=o.utils.bindComponent(o.sCurrentBindingPath,l);return r.then(function(){(o.methods.onActivate||Function.prototype)(t,l)}).then(function(){if(a===j.treeNode.componentId){var r=Object.create(null);r.root=true;for(var n=j.treeNode;n.level>0;n=e.mRoutingTree[n.parentRoute]){r[n.sRouteName]=true;if(n.contextTargets){for(var i=0;i<n.contextTargets.length;i++){var s=n.contextTargets[i];s.setBindingContext(null);n.bindElement(s,null,false)}}}for(var u in e.mRoutingTree){if(!r[u]){var d=e.mRoutingTree[u];d.unbindElement(e.oNavigationHost,true);if(d.contextTargets){d.contextTargets.forEach(d.unbindElement)}}}}o.utils.refreshBinding();o.oStatePreserverPromise.then(function(e){e.applyAppState(t,l)})})};var n=o.fnViewRegisteredResolve?o.viewRegistered.then(r):r()||Promise.resolve();return Promise.all([n,o.viewRegistered]).then(function(){o.aKeys=i;var e=o.reactivate;if(e){delete o.reactivate;e.then(function(e){e()})}})};U.componentsDisplayed[s]=1;var p=e.mRoutingTree[s];_[Math.min(p.fCLLevel,2)]=a;if(r.isNonDraftCreate&&t==="-"){var c=e.mRoutingTree[p.parentRoute];var v=c.getPath(2,i);var g=e.oAppComponent.getModel();var y=v?new Promise(function(t){var r={canonicalRequest:!e.bCreateRequestsCanonical};g.createBindingContext(v,null,r,t)}):Promise.resolve();return y.then(function(t){var r=t?p.navigationProperty:"/"+n.getEntitySet();var a=j.appStates[I];var i=It(a,true);var s=function(n){o.nonDraftCreateContext=Ze||o.nonDraftCreateContext||f.createNonDraft(t,r,g,n,e.oApplicationProxy.mustRequireRequestsCanonical());Ze=null;return d(o.nonDraftCreateContext.getPath())};return i.then(s,s)})}delete o.nonDraftCreateContext;return d(t)}function At(e,t,r){return xt(e,t,r).then(ce)}function wt(t,r,n){var a={};if(r||n){var o=t.level;for(var i=0;i<o;i++){a[i]=e.oPaginatorInfo[i]}}e.oPaginatorInfo=a}function Dt(t){return e.oApplicationProxy.getAlternativeIdentityPromise(t)}var Ft=Object.create(null);function Ot(t,r,n){if(e.oAppComponent.isDestroyed()){return Promise.resolve()}if(Ft[t.sRouteName]){return Ft[t.sRouteName].then(function(r){if(t.createComponent){if(n||e.oAppComponent.isDestroyed()){return Promise.resolve()}t.createComponent();delete t.createComponent;return Promise.resolve()}return r})}P.debug("Prepare host view for route "+t.sRouteName);var o=a.createHostView();Ft[t.sRouteName]=o;var i=a.oRouter.getViews();i.setView(t.sRouteName,o);return o.then(function(e){i.setView(t.sRouteName,e);var a=e.byId("host");if(n){t.createComponent=Zt.bind(null,a,t.sRouteName,r)}else{Zt(a,t.sRouteName,r)}return e})}function Mt(t){var r=e.mRoutingTree;if(r[t]){P.debug("Start preloading of component for route "+t);return Ot(r[t],true)}return Promise.resolve()}function Et(t){V=false;G.stop();Z.startProcess();Le(t);Ot(j.treeNode);j.treeNode.display();if(e.oFlexibleColumnLayoutHandler){Q=e.oFlexibleColumnLayoutHandler.handleBeforeRouteMatched(j)}}function jt(){var e={isInitialNavigation:M,historicalEntries:[]};for(var r=U;r.iHashChangeCount>0;r=E[r.backTarget]){var n=r===U?j:r.identity;var a=n.treeNode&&{sRouteName:n.treeNode.sRouteName,keys:n.keys,appStates:n.appStates};e.historicalEntries.push(a)}s.setData(e);s.save();var o=j.appStates[B];if(o===N||!(o||U.backTarget||M)){return false}K=null;Ne({identity:{treeNode:j.treeNode,keys:j.keys,appStates:t(Object.create(null),j.appStates)},mode:1});return true}function Ut(){Z.stopProcess();var t=A(a.oHashChanger.getHash()||"");var r;if(K&&K.followUpNeeded){if(K.identity){if(!ye(K.identity)){Ne();return}}else{var n=K.followUpNeeded;r=U;r.LeaveByBack=K.mode===-1;E.push(r);U={iHashChangeCount:r.iHashChangeCount+1,identity:j,hash:t,backTarget:r.LeaveByBack?E[r.backTarget].backTarget:r.iHashChangeCount,componentsDisplayed:Object.create(null)};K=null;Ne(n);return}}e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true);var o=j.treeNode.level;P.info("Route matched with hash "+t);if(U.backwardingInfo){r=U;r.identity=j.previousIdentity;delete j.previousIdentity;E.push(r);var i=r.iHashChangeCount+1;U={iHashChangeCount:i,forwardingInfo:{bIsProgrammatic:true,bIsBack:true,iHashChangeCount:i,targetHash:r.backwardingInfo.targetHash,componentsDisplayed:r.componentsDisplayed},backTarget:E[r.backwardingInfo.index].backTarget,componentsDisplayed:Object.create(null)}}if(U.forwardingInfo&&U.forwardingInfo.targetHash&&U.forwardingInfo.targetHash!==t){U.hash=t;var s=U.forwardingInfo.targetHash;delete U.forwardingInfo.targetHash;ct(s,true);return}var u=Bt(e.aStateChangers,j.appStates,!!e.oFlexibleColumnLayoutHandler);if(u){K=null;U.hash=t;if(!jt()){G.start()}return}e.oTemplatePrivateGlobalModel.setProperty("/generic/routeLevel",o);var l=U.forwardingInfo;delete U.forwardingInfo;if(!l){l={componentsDisplayed:U.componentsDisplayed,isNonDraftCreate:!j.treeNode.isDraft&&j.keys[j.treeNode.level]==="-"};var d=U.iHashChangeCount;l.iHashChangeCount=d+1;var p=R.getDirection();if(K){l.bIsProgrammatic=!!K.identity;l.bIsBack=K.mode<0;if(l.bIsBack){U.backSteps=0-K.mode}l.bIsForward=!l.bIsBack&&p===k.Forwards;U.LeaveByReplace=K.mode===1}else{l.bIsProgrammatic=t===U.targetHash;l.bIsBack=!!(U.LeaveByBack||!l.bIsProgrammatic&&p===k.Backwards);l.bIsForward=!l.bIsBack&&p===k.Forwards;U.LeaveByReplace=l.bIsProgrammatic&&U.LeaveByReplace;if(!l.bIsProgrammatic&&j.previousIdentity&&j.previousIdentity.treeNode.level>0&&!j.previousIdentity.treeNode.isDraft){var c=j.treeNode!==j.previousIdentity.treeNode;for(var f=1;!c&&f<j.keys.length;f++){c=j.keys[f]!==j.previousIdentity.keys[f]}if(c){var v=e.componentRegistry[j.previousIdentity.treeNode.componentId];var g=v.oComponent.getModel("ui");if(g.getProperty("/editable")){v.utils.cancelEdit()}}}}U.LeaveByBack=l.bIsBack;r=U;r.identity=j.previousIdentity;delete j.previousIdentity;E.push(r);U={iHashChangeCount:l.iHashChangeCount,componentsDisplayed:Object.create(null)};if(r.LeaveByReplace){U.backTarget=r.backTarget}else if(l.bIsBack){var y=r.backTarget;for(var m=r.backSteps||1;m>0;m--){y=E[y].backTarget}U.backTarget=y}else{U.backTarget=d}}U.hash=t;var h=function(t){K=null;if(t){var n,a;if(ge(r.identity,t.identity)){n=U.backTarget&&E[U.backTarget];a=-1}else if(t.identity.treeNode.level===0){yt();return}else{n=t.identity;var o=U.backTarget&&E[U.backTarget];a=o&&o.treeNode===n.treeNode?-1:1}var i={identity:n,mode:a,displayMode:t.displayMode};Ne(i);return}if(jt()){return}wt(j.treeNode,l.bIsProgrammatic,l.bIsBack);if(e.oFlexibleColumnLayoutHandler){Y=e.oFlexibleColumnLayoutHandler.handleRouteMatched(l)}else{Y=j.treeNode.componentCreated.then(function(e){return At(l.isNonDraftCreate?"-":j.treeNode.getPath(2,j.keys),l,e)})}e.oBusyHelper.setBusy(Y,undefined,undefined,true);Y.then(G.start)};if(l.bIsBack&&!(K&&K.identity)){e.oBusyHelper.setBusy(Dt(j).then(h),undefined,undefined,true)}else{h()}}function Kt(){var t=Promise.all([Q,X.then(function(){return e.oStatePreserversAvailablePromise})]);var r=t.then(Ut,e.oBusyHelper.setBusyReason.bind(null,"HashChange",false,undefined,undefined,true));e.oBusyHelper.setBusy(r,undefined,undefined,true);Qt()}function Vt(t){E.push(U);var r;var n;var a;if(t){M=t.isInitialNavigation;n=t.serializedBackOption;a=t.focus;for(var o=t.historicalEntries.length;o>0;o--){var i=t.historicalEntries[o-1];r={iHashChangeCount:E.length,backTarget:E.length-1};if(i){r.identity={treeNode:e.mRoutingTree[i.sRouteName],keys:i.keys,appStates:i.appStates}}E.push(r)}}else{r={iHashChangeCount:1,backTarget:0,identity:j};E.push(r)}W(r,n,a);Kt()}function qt(){if(S()){zt()}if(F&&!E.length){var e=j.appStates[B];var t=It(e);t.then(Vt,Vt);return}Kt()}function zt(){if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.hidePlaceholder()}else{e.oNavigationHost.hidePlaceholder()}}function _t(){j={appStates:Object.create(null),keys:[]};kt({title:e.getText("ST_ERROR"),text:e.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:"",messageType:b.PageNotFound});e.oBusyHelper.setBusyReason("HashChange",false,undefined,undefined,true)}function Qt(){var t=function(e){if(!e.selectionInfo){return false}for(var t=1;t<=e.level;t++){if(e.selectionInfo.keys[t]!==j.keys[t]){return false}}return true};var r=function(e,t,r,n){if(e.selectionInfo===t){r.setProperty("/generic/currentActiveChildContext",n)}};for(var n,a=j.treeNode;a;a=n){n=a.parentRoute&&e.mRoutingTree[a.parentRoute];if(n){n.selectionInfo={pageEntitySet:a.entitySet,path:a.getPath(3,j.keys),keys:j.keys.slice(0,a.level+1)}}var o=a.componentId&&e.componentRegistry[a.componentId];if(o){var i=o.utils.getTemplatePrivateModel();if(t(a)){var s=a.selectionInfo;i.setProperty("/generic/currentActiveChildContext",s.path);if(o.oController.onChildOpenedExtension){o.oController.onChildOpenedExtension(s,r.bind(null,a,s,i))}}else{a.selectionInfo=null;i.setProperty("/generic/currentActiveChildContext","")}}}}a.oRouter.attachBeforeRouteMatched(Et);a.oRouter.attachRouteMatched(qt);a.oRouter.attachBypassed(_t);var Gt=[];function Wt(e,t){a[e]=t;Gt.push(e)}function Jt(){Gt.forEach(function(e){a[e]=G.makeQueuable(a[e])});a.routerInitialized=Function.prototype}function Xt(t){var r=!e.oFlexibleColumnLayoutHandler||t===j.treeNode||!e.oFlexibleColumnLayoutHandler.hasIdentityFullscreenLayout(j);if(r){X=Promise.all([X,t.componentCreated])}return r}function Yt(e,t){var r=t.getOwnModels();for(var n in r){var a=r[n];var o=n==="undefined"?undefined:n;e.setModel(a,o)}}function Zt(r,n,a){P.debug("Create TemplateComponent for route "+n);var o=e.mRoutingTree[n];var i=o.page.component.name;var s=o.entitySet;var u=o.fCLLevel-(o.fCLLevel===3||!e.oFlexibleColumnLayoutHandler);var l=u<0?e.oNavigationObserver:e.aNavigationObservers[u];var p=new d;var c=u<0?e.oHeaderLoadingObserver:e.aHeaderLoadingObservers[u];c.addObserver(p);var f=new T;var v={appComponent:e.oAppComponent,isLeaf:!o.page.pages||!o.page.pages.length,entitySet:s,navigationProperty:o.navigationProperty,componentData:{registryEntry:{oAppComponent:e.oAppComponent,route:n,routeConfig:o.page,viewLevel:o.level,routingSpec:o.page.routingSpec,oNavigationObserver:l,oHeaderLoadingObserver:p,preprocessorsData:f}}};if(o.page.component.settings){t(v,o.page.component.settings)}e.oAppComponent.runAsOwner(function(){var t=e.oAppComponent.createId(v.componentData.registryEntry.routeConfig.component.name+"::"+v.componentData.registryEntry.routeConfig.entitySet);P.debug("Start to create component "+t+" for route "+n);var o=sap.ui.core.Component.create({name:i,settings:v,handleValidation:true,manifest:true,id:t});e.oAppComponent.registerForDestroy(o);return o.then(function(t){P.debug("Component for route "+n+" was created");if(a){Yt(r,e.oAppComponent);r.setComponent(t);t.onBeforeRendering()}else{r.setComponent(t)}})})}function $t(){V=true}function er(e){if(V){V=false;return false}if(K){return false}if(e.isCrossAppNavigation){return true}var t=tr(a.oRouter,e.innerAppRoute);if(!t){return false}var r=Se(t.name,t.arguments);return r.treeNode!==j.treeNode||r.keys.some(function(e,t){return e!==j.keys[t]})}function tr(e,t){var r=e.getRouteInfoByHash(t);if(r){return r}var n=t.split("&/");var a=n[n.length-1];r=e.getRouteInfoByHash(a);if(r){return r}a=a.substring(a.indexOf("/"));r=e.getRouteInfoByHash(a);return r}function rr(t){var r=e.oApplicationProxy.getAncestralNode(t,1);return r.isDraft?r:t}function nr(){if(j.treeNode.level===0){return false}var t=s.getData().historicalEntries;if(t.length===1||t[1].sRouteName==="root"){return true}if(t[0].keys.length===2&&t[1].keys.length===2){var r=[],n=[];t[0].keys[1].split(",").forEach(function(e){r.push(e.split("=")[0])});t[1].keys[1].split(",").forEach(function(e){n.push(e.split("=")[0])});if(JSON.stringify(r)===JSON.stringify(n)){return true}}var a=rr(j.treeNode);var o=e.mRoutingTree[t[1].sRouteName];var i=rr(o);return a!==i}function ar(t,r){if(!r){return t.viewLevel>0}if(t.viewLevel>0&&t.entitySet===r){return false}var n=e.mEntityTree[r];if(!n){return false}if(n.fCLLevel===0||n.level<=t.level){return true}return e.oFlexibleColumnLayoutHandler.willBeOpenedInFullscreen(n)}a.routerInitialized=Jt;a.treeNodeFirstDisplay=Xt;a.navigate=ct;Wt("navigateBack",Ne.bind(null,{mode:-1}));a.activateOneComponent=xt;a.afterActivation=ce;a.addUrlParameterInfoForRoute=le;a.getApplicableStateForIdentityAddedPromise=se;a.adaptAppStates=ue;a.setVisibilityOfRoute=Ct;a.getActiveComponents=Rt;a.getAllComponents=Ht;a.getRootComponentPromise=re;a.getActivationInfo=St;a.navigationWillLeavePage=ar;a.getCurrentKeys=Tt;a.getAppTitle=ne;a.getParsedShellHashFromFLP=oe;a.isDiscardDraftConfirmationNeeded=ae;Wt("navigateByExchangingQueryParam",Ie);Wt("navigateToSubContext",Ae);Wt("navigateToDetailContextIfPossible",we);a.getSwitchToSiblingFunctionPromise=Ee;a.getSwitchToSiblingPromise=je;a.getNavigationFunction=Fe;a.getSpecialDraftCancelOptionPromise=De;a.getRootIdentityPromise=gt;a.setBackNavigationOption=Oe;a.getCurrentIdentity=fe;Wt("navigateToIdentity",Ve);Wt("navigateAfterActivation",Xe);Wt("navigateUpAfterDeletion",Ye);Wt("navigateForNonDraftCreate",$e);Wt("adaptUrlAfterNonDraftCreateSaved",et);Wt("navigateToChildInHierarchy",nt);Wt("navigateFromNodeAccordingToContext",at);a.isNavigating=dt;a.getLinksToUpperLayers=Te;a.setTextForTreeNode=Pe;Wt("navigationContextNotFound",qe);Wt("navigateToMessageTarget",lt);a.clearHistory=G.makeQueuable(te.bind(null,true));a.suspend=$;a.restore=J.bind(null,false);a.leave=ee;a.prepareHostView=Ot;a.preloadComponent=Mt;a.navigateToMessagePage=kt;a.getAppStateFromShell=It;a.userHasAcceptedDataLoss=$t;a.unwantedDataLossPossible=er;a.isBackLeavingTheEditScope=nr;a.openContextInNewTab=it;a.getTargetIdentityForContext=st;var Zt=c.testable(Zt,"createTemplateComponent");var oe=c.testable(oe,"getParsedShellHashFromFLP");var Ot=c.testable(Ot,"prepareHostView");var Mt=c.testable(Mt,"preloadComponent");var tr=c.testable(tr,"getRouteInfoByHash");var Bt=c.testable(Bt,"getIsStateChange");c.testable(function(e){a.createHostView=e},"setCreateHostView");c.testable(function(e){Ot=e},"setPrepareHostView");e.oBusyHelper.setBusy((oe()||Promise.resolve()).then(function(t){var r=t&&t.parseParameters(document.location.search);e.bEnablePlaceholder=e.bEnablePlaceholder&&!(r&&r["sap-ui-xx-placeholder"]&&r["sap-ui-xx-placeholder"][0]==="false");var n=L.then(function(t){return t.createEmptyAppState(e.oAppComponent,true).then(function(e){s=e;N=s.getKey()})});return n.then(function(){return g.generateRoutingStructure(e).then(J.bind(null,true))})}),undefined,undefined,true);return{navigateToRoot:G.makeQueuable(yt),navigateToContext:G.makeQueuable(bt),navigateToMessagePage:kt,navigateBack:function(){a.navigateBack()}}}function O(e,r){var n=r.oAppComponent.getRouter();var a={oAppComponent:r.oAppComponent,oRouter:n,oHashChanger:n.getHashChanger(),oTemplateContract:r};r.oNavigationControllerProxy=a;var o=new Promise(function(e){a.initialize=function(t){n.initialize(t);e();a.routerInitialized()};a.fnInitializationResolve=e});r.oBusyHelper.setBusy(o,undefined,undefined,true);t(e,F(r,a))}var M=e.extend("sap.suite.ui.generic.template.lib.navigation.NavigationController",{metadata:{library:"sap.suite.ui.generic.template"},constructor:function(t){e.apply(this,arguments);c.testableStatic(O,"NavigationController")(this,t)}});M._sChanges="Changes";return M});
//# sourceMappingURL=NavigationController.js.map