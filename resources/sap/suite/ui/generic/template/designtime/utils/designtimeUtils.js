/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
*/
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/core/Component","sap/ui/core/message/MessageType","sap/suite/ui/generic/template/genericUtilities/testableHelper"],function(e,t,n,a){"use strict";const o={Page:"Page",Control:"Control",Application:"Application"};const i={ChangePageConfiguration:"appdescr_ui_generic_app_changePageConfiguration",AddNewObjectPage:"appdescr_ui_generic_app_addNewObjectPage"};function s(e,t,n){return new Promise(function(a,o){sap.ui.require(["sap/ui/model/json/JSONModel","sap/m/InputListItem","sap/m/List","sap/m/MultiInput","sap/m/Input","sap/m/CheckBox","sap/ui/core/Item","sap/m/Select","sap/m/Token","sap/m/MultiComboBox"],function(o,i,s,r,c,d,u,l,p,g){const m=new o;m.setData(e);const f=new s;f.setModel(m);const h=new i({label:"{label}"});h.bindAggregation("content",{path:"control",factory:function(e,a){const o=a.getProperty("type");const i=a.getProperty("id");switch(o){case"string":if(a.getProperty("enum")){const e=new u({text:"{name}",key:"{id}"});const a=new l({selectedItem:"{value}",change:function(e){t[this.data("id")]=e.getParameter("selectedItem").getKey()},enabled:{path:"disabled",formatter:function(e){return!e}}}).data("id",i);a.bindItems({path:"enum",template:e});a.setSelectedKey(n[i]);return a}else{return new c({value:"{value}",change:function(e){t[this.data("id")]=e.getParameter("value")}}).data("id",i)}case"string[]":if(a.getProperty("enum")){const e=new u({text:"{name}",key:"{id}"});const a=new g({width:"60%",selectedKeys:t[i]||[],selectionChange:function(e){t[this.data("id")]=e.getSource().getSelectedKeys()},enabled:{path:"disabled",formatter:function(e){return!e}}}).data("id",i);a.bindItems({path:"enum",template:e});a.setSelectedKeys(n[i]||[]);return a}else{const e=new r({width:"70%",showValueHelp:false,showClearIcon:true,tokens:(t[i]||[]).map(function(e){return new p({text:e,key:e})}),tokenUpdate:function(e){const n=t[this.data("id")];if(e.getParameter("addedTokens").length>0){n.push(e.getParameter("addedTokens")[0].getKey())}else if(e.getParameter("removedTokens").length>0){const t=n.indexOf(e.getParameter("removedTokens")[0].getKey());if(t!==-1){n.splice(t,1)}}}}).data("id",i);e.addValidator(function(e){return new p({key:e.text,text:e.text})});return e}case"number":return new c({value:"{value}",type:"Number",change:function(e){t[this.data("id")]=parseFloat(e.getParameter("value"))}}).data("id",i);case"boolean":return new d({selected:"{value}",select:function(e){t[this.data("id")]=e.getParameter("selected")}}).data("id",i);case"booleanOrString":const e=new u({text:"{name}",key:"{id}"});const o=new l({selectedItem:"{value}",change:function(e){let n=e.getParameter("selectedItem").getKey();if(n.toLowerCase()==="false"||n.toLowerCase()==="true"){n=JSON.parse(n)}t[this.data("id")]=n}}).data("id",i);o.bindItems({path:"enum",template:e});o.setSelectedKey(n[i]);return o;case"booleanOrStringCheckbox":const s=a.getProperty("enum");const m=new d({selected:n[i]===s.find(e=>e.name==="true").id,select:function(e){const n=e.getParameter("selected");const a=n?s.find(e=>e.name==="true").id:s.find(e=>e.name==="false").id;t[this.data("id")]=a}}).data("id",i);return m;case"json":return new c({value:"{value}",change:function(e){try{t[this.data("id")]=JSON.parse(e.getParameter("value"))}catch(e){}}}).data("id",i);default:return null}}});f.bindItems({path:"/",template:h});a(f)})})}function r(e){return t.getOwnerComponentFor(e)}function c(e,t){return t.map(function(t){const n={label:t.name,tooltip:t.description,control:[]};const a={type:t.type,enum:t.enums,value:e[t.id],id:t.id};n.control.push(a);return n})}let d=function(e,t,n,a=i.ChangePageConfiguration,o=false){const s=e.getAppComponent();return{appComponent:s,selector:s,changeSpecificData:{appDescriptorChangeType:a,content:{parameters:{parentPage:{component:o?"sap.suite.ui.generic.template":e.getMetadata().getComponentName(),entitySet:!o?e.getEntitySet():undefined},entityPropertyChange:{propertyPath:t,operation:"UPSERT",propertyValue:n}}}}}};async function u(e,t,a,o,i,r){const c=await s(e,t,a);return new Promise(function(e,a){sap.ui.require(["sap/m/Dialog","sap/m/Button","sap/m/MessageStrip"],function(s,d,u){const l=new u({type:n.Warning,showIcon:true,text:"{i18n>RTA_CONFIGURATION_INFO_MESSAGE}"});l.addStyleClass("sapUiSmallMarginBottom");const p=new s({title:o,contentWidth:i?i.width:"550px",contentHeight:i?i.height:"300px",content:[l,c],resizable:true,buttons:[new d({text:"{i18n>RTA_CONFIGURATION_APPLY}",type:"Emphasized",press:function(){p.close();e(t)}}),new d({text:"{i18n>RTA_CONFIGURATION_CANCEL}",press:function(){p.close();a()}})]});p.setModel(r,"i18n");p.addStyleClass("sapUiContentPadding");p.addStyleClass("sapUiRTABorder");p.open()})})}let l=function(e,t,n,a){const i={};e.forEach(function(e){if(typeof t[e.id]!=="object"&&t[e.id]!==n[e.id]||typeof t[e.id]==="object"&&JSON.stringify(t[e.id])!==JSON.stringify(n[e.id])){const t=e.getPath?e.getPath(a):e.id;const s={};const r=!!e.bSupportsGlobalScope&&a.sScope===o.Application;if(e.writeObject?.length&&e.writeObjectFor===n[e.id]){e.writeObject.forEach(function(e){s[e.getPath?e.getPath(a):e.id]=n[e.id]});i[t]={value:s,bIsGlobalChange:r}}else if(!e.skipChange){i[t]={value:n[e.id],bIsGlobalChange:r}}}});return i};let p=function(e,t,n){const a=[];const o={};for(const[i,s]of Object.entries(e)){o[i]=s.value;a.push(d(t,i,s.value,n,s.bIsGlobalChange))}return a};function g(e,t,n,a,o){const i=l(n,t,e,o);return p(i,a,o.sChangeType)}function m(e){const t=r(e);return t.getRootControl().getLocalId(e.getId())}function f(t){const n=t.getManifest();const a=n["sap.ui.generic.app"]["settings"];const o=["tableSettings.createMode","statePreservationMode","flexibleColumnLayout","inBoundParameters"];const i={};o.forEach(function(t){const n=e.get(t,a);if(n){e.set(t,n,i)}});return i}function h(e,t){const n=r(e).getMetadata().getComponentName();return t.filter(e=>!e.restrictedTo||e.restrictedTo.includes(n))}l=a.testableStatic(l,"getChangedPropertyValues");p=a.testableStatic(p,"getChanges");d=a.testableStatic(d,"getChangeStructure");function y(){var e="fiori-tools-rta-mode";const t=new URLSearchParams(window.location.search);const n=t.get(e);return n}const b={True:"true",ForAdaptation:"forAdaptation"};function C(e){if(!y()){return e.filter(e=>e.keyUser)}return e}return{openAdaptionDialog:u,getSettings:c,extractChanges:g,getOwnerComponentFor:r,createAdaptionDialogContent:s,getLocalId:m,SettingScope:o,ChangeType:i,getSupportedGlobalManifestSettings:f,filterDesigntimeSettingsByFloorPlan:h,getRtaModeValue:y,FioriToolsRtaMode:b,getAllowedDesigntimeSettingsBasedOnAdaptationMode:C}});
//# sourceMappingURL=designtimeUtils.js.map