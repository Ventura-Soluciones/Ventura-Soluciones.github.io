sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(t,e){"use strict";function n(t,e){function n(){return e.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(n){var a=n.getSource();var r=a.getBindingContext("buttons");var i=r.getProperty("link");var o=r.getProperty("param");var s=i.intent;var c=s.split("#")[1].split("-")[0];var p=s.split("-")[1].split("?")[0].split("~")[0];var v={semanticObject:c,action:p,parameters:o};e.oCommonUtils.fnProcessDataLossOrDraftDiscardConfirmation(function(){var n=t.getView().getBindingContext();e.oCommonEventHandlers.onRelatedAppNavigation(v,n)},Function.prototype,"LeaveApp")}},"buttons")}function a(t){var e=t.intent;var n=e.split("-")[0].split("#")[1];var a=e.split("-")[1].split("?")[0];return{link:t,semanticObject:n,action:a}}function r(r){var i=r.getSource();e.oServices.oApplication.performAfterSideEffectExecution(function(){var r=e.oServices.oApplication.getBusyHelper();var o=new Promise(function(o,s){var c=e.oServices.oApplication.getIntentPromise();var p=n();var v=sap.ui.require("sap/ushell/Container");var l=v&&v.getServiceAsync("Navigation");Promise.allSettled([c,p,l]).then(function(n){var c=n.some(function(t){return t.status==="rejected"});if(c){s();return}var p=n.map(function(t){return t.value});var v=p[0];var l=v.semanticObject;var u=v.action;var m=p[1];var f=t.getView().getBindingContext();var g=p[2];var b=f.getModel().getMetaModel();var d=f.getObject();var y=d.__metadata.type;var O=b.getODataEntityType(y);var A=O["com.sap.vocabularies.Common.v1.SemanticKey"];var j={};if(A&&A.length>0){for(var S=0;S<A.length;S++){var C=A[S].PropertyPath;if(!j[C]){j[C]=d[C]}}}else{for(var h in O.key.propertyRef){var x=O.key.propertyRef[h].name;if(!j[x]){j[x]=d[x]}}}var P=e.oComponentUtils.getSettings();var k=P.relatedAppsSettings;var w;var E=k&&Object.keys(k).length>0;if(E){const t=new Set;t.add(l);for(const e in k){if(k.hasOwnProperty(e)){const n=k[e].semanticObject;t.add(n)}}let e=Array.from(t);e=e.map(t=>({semanticObject:t}));w=g.getLinks(e)}else{var R=t.getOwnerComponent().getAppComponent();w=g.getLinks([{semanticObject:l,params:j,ui5Component:R}])}w.then(function(t){var n=t.flat(Infinity);var s=n.map(a);var c=function(t){return t.String};var p=O["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]||[];var v=p.map(c);O.property.forEach(function(t){var e=t["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]||[];v=v.concat(e.map(c))});s=s.filter(function(t){return t.semanticObject!==l||t.action!==u});s=s.filter(function(t){var e=t.semanticObject===l?"":t.semanticObject;var n=E&&k[e]&&k[e].semanticObjectAction;if(n){for(var a in n){if(n[a].action===t.action){return true}}return false}else{return v.indexOf(t.action)===-1}});s.sort(function(t,e){if(t.link.text<e.link.text){return-1}if(t.link.text>e.link.text){return 1}return 0});var f=m.getModel("buttons");var g=s.map(function(t){return{enabled:true,text:t.link.text,link:t.link,param:j}});if(g.length===0){g.push({enabled:false,text:e.oCommonUtils.getText("NO_RELATED_APPS")})}f.setProperty("/buttons",g);o();r.getUnbusy().then(m.openBy.bind(m,i))}).catch(s)})});r.setBusy(o)},true)}return{getRelatedApps:r}}return t.extend("sap.suite.ui.generic.template.ObjectPage.controller.RelatedAppsHandler",{constructor:function(t,a){e(this,n(t,a))}})});
//# sourceMappingURL=RelatedAppsHandler.js.map